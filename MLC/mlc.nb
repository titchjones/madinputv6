(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    446598,      13346]
NotebookOptionsPosition[    412890,      12346]
NotebookOutlinePosition[    415369,      12401]
CellTagsIndexPosition[    415326,      12398]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["MLC", "Title"],

Cell["\<\
Mathematica Lattice Code
Version 1.8\
\>", "Subtitle"],

Cell["\<\
Hywel Owen and James Jones
This version by Hywel Owen\
\>", "Subtitle"],

Cell["8th June 2004", "Subsubtitle"],

Cell[CellGroupData[{

Cell["Introduction", "Section"],

Cell[CellGroupData[{

Cell["About MLC", "Subsection"],

Cell["\<\
MLC is an optics code written completely using core Mathematica commands. It \
should therefore run on any computer with Mathematica installed. It also has \
the advantage that it uses the same element and field definitions that MAD \
does, so the same input file can be alternately run with MLC or Madinput/MAD \
for comparison.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Implementation Details", "Subsection"],

Cell["\<\
MLC requires the Madinput package, as it uses Madinput to process the element \
commands and to provide functionality such as splitting elements of MADDraw. \
It does not require MAD, however.
The MLC commands are defined in the MLC section of the notebook. Examples are \
given in the section that follows it.\
\>", "Text"],

Cell[CellGroupData[{

Cell["Version 1.8", "Subsubsection"],

Cell["Added new beam distribution commands for alpha<>0.", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.7", "Subsubsection"],

Cell["\<\
An option has been added to allow a single-pass correction for non-paraxial \
transport. The function MLCPropagateNonParaxialRay calculates the retardation \
to first order of large amplitude particles.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.6", "Subsubsection"],

Cell["\<\
A minor bug in the calculation of phase advances has been fixed. Phase \
advances greater then \[Pi]/2 in single elements are now calculated correctly.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.5", "Subsubsection"],

Cell["\<\
Non-relativistic transport has been added. A parameter \[Gamma] can now be \
defined and applied to a beamline definition, which defines the reference \
energy. If this parameter is not given, then \[Gamma]=\[Infinity] is assumed \
(ultrarelativistic particles)\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.3/1.4", "Subsubsection"],

Cell["\<\
Developing cavity matrices - there are a variety of cavity matrix definitions \
now present, but they have not yet been debugged.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.2", "Subsubsection"],

Cell["\<\
Changed the definitions of Subscript[R, 51], Subscript[R, 52]and Subscript[R, \
56]so that they are consistent with MAD. Subscript[R, 56]will now have the \
opposite sign to before. This is an important change! This now means that the \
signs are opposite to the TRANSPORT notations.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.1", "Subsubsection"],

Cell["\<\
Fixed a bug in MLCLinearQuadrupoleMatrix so it doesn't cause errors if the \
quadrupole strength is zero. You can now set zero quardupole strengths (it \
replaces the element with a drift matrix).\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 1.0", "Subsubsection"],

Cell["\<\
Finally decide to release it as a stable (?) version.
Changed the definition of BPM so you can have non-zero length BPMs as in MAD. \
These are modelled as drift spaces.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.19", "Subsubsection"],

Cell["\<\
Adds the kick element as a drift space similar to hkick and vkick.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.17", "Subsubsection"],

Cell["\<\
Added Chromaticity Calculations. Some discrepancy between MLC and MAD - could \
be due to method of integration (MAD only approximates). Also added Beam Size \
and Beam Angle commands.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.16", "Subsubsection"],

Cell["\<\
Added Momentum Compaction, Energy Loss, Partition Functions, Energy Spread, \
Emittance and Damping Times.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.15", "Subsubsection"],

Cell["Added Synchrotron Radiation Integrals 1 - 5", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.14", "Subsubsection"],

Cell["\<\
Fixed DPY calculation. Not quite done yet.
Added a beam distribution generator. The truncation only occurs in x and x' \
planes independently, so it isn't quite right, but will do if the number of \
sigmas is large.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.13", "Subsubsection"],

Cell["\<\
Modified MLCPlotPeriodicOptics to automatically label and colour plots.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.12", "Subsubsection"],

Cell["\<\
Added a couple of helpful commands, including MLCGeneratePeriodicTwissTable, \
which means you don't have to find your own Periodic Functions any more, and \
added MLCPlotPeriodicOptics, which does a standard scaled plot of a system. \
You still have to use MLCElementList to generate the elements\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.11", "Subsubsection"],

Cell["\<\
Minor update to include MLCPropagateRay command, which performs linear \
ray-tracing through the element system.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Version 0.10", "Subsubsection"],

Cell["\<\
First version with everything tested, i.e. phase advances, twiss values in \
both planes, and horizontal dispersion.\
\>", "Text"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Known Bugs - Correct up to Version 1.2", "Subsection"],

Cell["\<\
Path lengths and Subscript[R, 56]terms have been compared with MAD and found \
to be exactly the same - the R matrices should be considered to be exactly \
the same as in MAD.
The phase advance through a dipole magnet gives very slightly different \
values than MAD. This could actually be a truncation error in MAD, since the \
propagation of phase involves calculating the ArcSin of a small number. For \
very long elements in which the phase advance is greater than 2 Pi, there \
could be an error of 2 Pi in the calculated phase advance across this \
element. This can be solved by slicing the elements up by using \
MADSplitElements. This could be an issue with other codes, but I'm not sure....
There is a bug in the calculation of DPY; this error occurs in the \
MLCWedgeBendMagnet element definition.\
\>", "Text"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Notebook Initialisation", "Section"],

Cell[CellGroupData[{

Cell["General Setup", "Subsection"],

Cell[BoxData[
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "\"\<spell1\>\""}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "\"\<spell\>\""}], "]"}]], "Input"],

Cell["\<\
Turns off those annoying messages when you define similar-looking variable \
names.\
\>", "Text"],

Cell[BoxData[
 RowBox[{"Needs", "[", "\"\<Madtomma`MADInput`ReadInMADFiles`\>\"", 
  "]"}]], "Input",
 CellChangeTimes->{{3.4620162025576363`*^9, 3.46201621724523*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<BarCharts`\>\""}], ";", 
  RowBox[{"<<", "\"\<Histograms`\>\""}], ";", 
  RowBox[{"<<", "\"\<PieCharts`\>\""}]}]], "Input"],

Cell["\<\
These lines load the other standard packages used in this notebook.\
\>", "Text"],

Cell[BoxData[
 RowBox[{"<<", "\"\<ErrorBarPlots`\>\""}]], "Input"],

Cell[BoxData[
 RowBox[{"<<", "\"\<PlotLegends`\>\""}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Setup Default File Locations and Scratch Directories", "Subsection"],

Cell[BoxData[
 RowBox[{"workingdirectory", "=", "\"\<c:\\\\mad\>\""}]], "Input"],

Cell[BoxData[
 RowBox[{"SetDirectory", "[", "workingdirectory", "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Define Useful Parameters", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mm", "=", 
   RowBox[{"10", "^", 
    RowBox[{"-", "3"}]}]}], ";", 
  RowBox[{"mrad", "=", 
   RowBox[{"10", "^", 
    RowBox[{"-", "3"}]}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"Notation", "[", 
  RowBox[{
   TagBox[
    SubscriptBox["k", "B"],
    "NotationTemplateTag",
    BaseStyle->"NotationTemplateStyle"], " ", "\[DoubleLongLeftRightArrow]", 
   " ", 
   TagBox["BoltzmannConstant",
    "NotationTemplateTag",
    BaseStyle->"NotationTemplateStyle"]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Subscript", "[", 
  RowBox[{"k", ",", " ", "B"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Notation", "[", 
  RowBox[{
   TagBox[
    SubscriptBox["R", "g"],
    "NotationTemplateTag",
    BaseStyle->"NotationTemplateStyle"], " ", "\[DoubleLongLeftRightArrow]", 
   " ", 
   TagBox["MolarGasConstant",
    "NotationTemplateTag",
    BaseStyle->"NotationTemplateStyle"]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Subscript", "[", 
  RowBox[{"R", ",", " ", "g"}], "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Define Some Useful Functions", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ColorQ", "[", "x_", "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"RGBColor", ",", "GrayLevel", ",", "Hue", ",", "CMYKColor"}], 
      "}"}], ",", 
     RowBox[{"Head", "[", "x", "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GradientColor", "[", 
    RowBox[{"x", ":", 
     RowBox[{"{", 
      RowBox[{"cols__", "?", "ColorQ"}], "}"}]}], "]"}], ":=", 
   RowBox[{"GradientColor", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"Length", "[", "x", "]"}], "-", "1"}]}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Length", "[", "x", "]"}], "-", "1"}], ")"}]}], ",", "x"}], 
      "}"}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GradientColor", "[", 
    RowBox[{"x", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", 
         RowBox[{"_", "?", "ColorQ"}]}], "}"}], ".."}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"newx", "=", "x"}], ",", "res", ",", "redf", ",", "greenf", 
       ",", "xvals", ",", "cols", ",", "bluef", ",", "func"}], "}"}], ",", 
     RowBox[{
      RowBox[{"newx", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{"x", ",", 
         RowBox[{
          RowBox[{"OrderedQ", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], "&"}]}], 
        "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"newx", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "=!=", "0"}], ",", 
        RowBox[{"PrependTo", "[", 
         RowBox[{"newx", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"newx", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
       "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{
           RowBox[{"Last", "[", "newx", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "=!=", "1.`"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"newx", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{
             RowBox[{"Last", "[", "newx", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xvals", ",", "cols"}], "}"}], "=", 
       RowBox[{"Transpose", "[", "newx", "]"}]}], ";", 
      RowBox[{"res", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"xvals", ",", "#1"}], "}"}], "]"}], "&"}], ")"}], "/@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToColor", "[", 
               RowBox[{"#1", ",", "RGBColor"}], "]"}], "&"}], ")"}], "/@", 
            "cols"}], ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"redf", ",", "greenf", ",", "bluef"}], "}"}], "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"#1", ",", 
            RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}], "&"}], ")"}], 
        "/@", "res"}]}], ";", 
      RowBox[{"func", "=", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"RGBColor", "[", 
          RowBox[{
           RowBox[{"redf", "[", "#1", "]"}], ",", 
           RowBox[{"greenf", "[", "#1", "]"}], ",", 
           RowBox[{"bluef", "[", "#1", "]"}]}], "]"}], "]"}], "&"}]}], ";", 
      RowBox[{"ListDensityPlot", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "i"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "1", ",", "0.01`"}], "}"}]}], "]"}], 
         "]"}], ",", 
        RowBox[{"Mesh", "->", "False"}], ",", 
        RowBox[{"DataRange", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"Axes", "->", 
         RowBox[{"{", 
          RowBox[{"True", ",", "False"}], "}"}]}], ",", 
        RowBox[{"Frame", "->", "False"}], ",", 
        RowBox[{"AspectRatio", "->", 
         RowBox[{"1", "/", "10"}]}], ",", 
        RowBox[{"ColorFunction", "->", "func"}]}], "]"}], ";", "func"}]}], 
    "]"}]}], ";"}]}], "Input"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["MLC Version 1.8", "Section"],

Cell[CellGroupData[{

Cell["Package Functions", "Subsubsection"],

Cell[BoxData[
 RowBox[{"BeginPackage", "[", 
  RowBox[{"\"\<MLC`MLC`\>\"", ",", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Madtomma`MADInput`MADInput`\>\"", ",", "\"\<Madtomma`Mfs`Mfs`\>\"", 
     ",", "\"\<Madtomma`Mfs`MAD8Survey`\>\"", ",", "\"\<Notation`\>\"", ",", 
     "\"\<Units`\>\"", ",", "\"\<PhysicalConstants`\>\""}], "}"}]}], 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4620162315734468`*^9, 3.462016231776573*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCExtraList", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCStripUnusedExtraFields", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCElementList", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGetElementLengths", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearThickWigglerMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5729415946084614`*^9},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearDriftMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearSextupoleMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearKickerMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearBPMMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearMarkerMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearThickQuadrupoleMatrix", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearThinQuadrupoleMatrix", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearWedgeBendMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearSolenoidMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearBeamRotationMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearPoleFaceRotationMatrix", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearSectorBendMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearRFCCavityMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearCavityMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearRSCavityMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearTRCavityMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCLinearMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCRMatrices", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCOneTurnRMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCStability", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCFindPeriodicPhase", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCFindPeriodicTwiss", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCFindPeriodicDispersion", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTwissVectorToMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTwissMatrixToVector", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateSinglePlaneRMatrices", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateTwissMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReverseDot", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCCumulativeRMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCReverseCumulativeRMatrices", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateTwissPhaseVector", "::", "usage"}], "=", "\"\<\>\""}],
   ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTwissOperator", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateTwiss", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateDispersion", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateTwissTable", "::", "usage"}], "=", 
   "\"\<MLCGenerateTwissTable[Lattice,{\[Beta]x,\[Alpha]x,\[Gamma]x,\[Beta]y,\
\[Alpha]y,\[Gamma]y},{mux,muy},{\[Eta]x,\[Eta]x',\[Eta]y,\[Eta]y',0,1}]\>\""}]\
, ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4487935858291616`*^9, 3.4487936331726084`*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGeneratePeriodicTwissTable", "::", "usage"}], "=", 
   "\"\<MLCGeneratePeriodicTwissTable[Lattice]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.448793636531962*^9, 3.448793645375655*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateRay", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTwissOperator", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateTwiss", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DotOperator", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCRetardNonParaxialRay", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateAndRetardOperator", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPropagateNonParaxialRay", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCBetaGamma", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateBeamDistribution6D", "::", "usage"}], "=", 
   "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPlot", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCPlotPeriodicOptics", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCMatrixInspect", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"integralSRI1", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI1", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SR2Element", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI2", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SR3Element", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI3", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"integralSRI4", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI4", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"integralSRI5H", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI5H", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI5", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Alpha]c", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Epsilon]", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSRI", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCU0", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCJx", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCJ\[Epsilon]", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCES", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Tau]x", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Tau]y", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Tau]\[Epsilon]", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Epsilon]x", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Epsilon]y", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Sigma]x", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Sigma]y", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Sigma]primex", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLC\[Sigma]primey", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCChromaticity", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateR56", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateR51", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateR52", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADReadRMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADReadTMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGenerateRMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTransportCompose", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCOneTurnRTMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCCumulativeRTMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTransport", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTransportCompose", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5491737065214486`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCOneTurnRTMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5491737082871075`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCCumulativeRTMatrices", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5491737102402697`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTransport", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5491737122871847`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MLCElems", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCS", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCBETX", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCALFX", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCGAMX", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCBETY", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCALFY", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCGAMY", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCMUX", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCMUY", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCDX", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCDPX", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCDY", "::", "usage"}], "=", "\"\<\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MLCDPY", "::", "usage"}], "=", "\"\<\>\""}], ";"}]}], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCSetEnergy", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGetEnergy", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCEnergy", "::", "usage"}], "=", 
   "\"\<Global Energy within MLC\>\""}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Input",
 InitializationCell->True,
 Background->None]
}, Open  ]],

Cell[CellGroupData[{

Cell["Distribution Functions", "Subsubsection"],

Cell["\<\
TruncatedGaussianSample creates a sample drawn from a Gaussian Distribution \
of mean \[Mu] and s.d. \[Sigma] which is truncated at n sigma\
\>", "Text",
 CellChangeTimes->{3.4487934070965643`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TruncatedGaussianSample", "[", 
   RowBox[{"mean_", ",", "sigma_", ",", "n_"}], "]"}], ":=", 
  RowBox[{"(", "\n", 
   RowBox[{
    RowBox[{"While", "[", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"a", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"NormalDistribution", "[", 
            RowBox[{"mean", ",", "sigma"}], "]"}], "]"}]}], ")"}], "-", 
        "mean"}], "]"}], ">", 
      RowBox[{"(", 
       RowBox[{"n", "*", "sigma"}], ")"}]}], "]"}], ";", "a"}], 
   ")"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"TruncatedGaussianSample", "[", 
   RowBox[{"mean_", ",", "0", ",", "n_"}], "]"}], ":=", 
  RowBox[{"(", "\n", "mean", ")"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"TruncatedGaussianSample", "[", 
   RowBox[{"mean_", ",", "0.", ",", "n_"}], "]"}], ":=", 
  RowBox[{"(", "\n", "mean", ")"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell["GaussianEnsemble creates a set of such samples", "Text",
 CellChangeTimes->{3.4487934088934164`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GaussianEnsemble", "[", 
    RowBox[{
    "nparticles_", ",", "nmean_", ",", "nsigma_", ",", "ntruncation_"}], 
    "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"TruncatedGaussianSample", "[", 
      RowBox[{"nmean", ",", "nsigma", ",", "ntruncation"}], "]"}], ",", 
     RowBox[{"{", "nparticles", "}"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell["\<\
UniformEnsemble creates a set of samples drawn from a Uniform (rectangular) \
distribution between nmin and nmax\
\>", "Text",
 CellChangeTimes->{3.448793410471521*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"UniformEnsemble", "[", 
    RowBox[{"nparticles_", ",", "nmin_", ",", "nmax_"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Random", "[", 
      RowBox[{"UniformDistribution", "[", 
       RowBox[{"nmin", ",", "nmax"}], "]"}], "]"}], ",", 
     RowBox[{"{", "nparticles", "}"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell["\<\
UniformEnsemble creates a set of samples drawn from a Uniform (rectangular) \
distribution between nmin and nmax\
\>", "Text",
 CellChangeTimes->{3.4487934119871264`*^9}],

Cell["\<\
Mathematica includess a command which shows how to get the standard deviation \
of a uniform sample. This is simply:\
\>", "Text",
 CellChangeTimes->{3.4487934125808687`*^9}],

Cell[BoxData[
 RowBox[{"StandardDeviation", "[", 
  RowBox[{"UniformDistribution", "[", 
   RowBox[{"{", 
    RowBox[{"xmin", ",", "xmax"}], "}"}], "]"}], "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Process Commands", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCExtraList", "[", "lattice_", "]"}], ":=", 
  RowBox[{"ToExpression", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"MADFlatten", "[", "lattice", "]"}], "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCStripUnusedExtraFields", "[", "extralist_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Drop", "[", 
     RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", "extralist"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCElementList", "[", "lattice_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MADFlatten", "[", "lattice", "]"}], ",", 
      RowBox[{"MLCStripUnusedExtraFields", "[", 
       RowBox[{"MLCExtraList", "[", "lattice", "]"}], "]"}]}], "}"}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGetElementLengths", "[", "lattice_", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"MADFlatten", "[", "lattice", "]"}], "//", "Transpose"}], ")"}], 
   "[", 
   RowBox[{"[", "3", "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None]
}, Closed]],

Cell[CellGroupData[{

Cell["Matrix Element Definitions", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCEnergy", "=", 
   RowBox[{"0", " ", "Giga", " ", "ElectronVolt"}]}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCEnergy", "::", "ChangeEnergy"}], "=", 
  "\"\<Energy Set from `1` to `2`\>\""}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSetEnergy", "[", "energy_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Energy", ">", "0"}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MLCEnergy", "::", "ChangeEnergy"}], ",", "MLCEnergy", ",", 
         "energy"}], "]"}]}], "]"}], ";", 
     RowBox[{"MLCEnergy", "=", "energy"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGetEnergy", "[", "]"}], ":=", "MLCEnergy"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearDriftMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "\[Beta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]", "^", "2"}]}]}], "]"}]}], ";", "\n", 
     TagBox[
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"1", "L", "0", "0", "0", "0"},
         {"0", "1", "0", "0", "0", "0"},
         {"0", "0", "1", "L", "0", "0"},
         {"0", "0", "0", "1", "0", "0"},
         {"0", "0", "0", "0", "1", 
          FractionBox["L", 
           RowBox[{
            SuperscriptBox["\[Beta]", "2"], 
            SuperscriptBox["\[Gamma]", "2"]}]]},
         {"0", "0", "0", "0", "0", "1"}
        }], "\[NoBreak]", ")"}],
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearSextupoleMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"MLCLinearDriftMatrix", "[", 
   RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearKickerMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"MLCLinearDriftMatrix", "[", 
   RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearBPMMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"MLCLinearDriftMatrix", "[", 
   RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearMarkerMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"IdentityMatrix", "[", "6", "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearMultipoleMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "13", "]"}], "]"}], "]"}], ">", "0"}], ",", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"k", ",", "f"}], "}"}], ",", 
      RowBox[{
       RowBox[{"k", "=", 
        RowBox[{"Abs", "[", 
         RowBox[{"elem", "[", 
          RowBox[{"[", "13", "]"}], "]"}], "]"}]}], " ", ";", 
       RowBox[{"f", "=", 
        FractionBox[
         RowBox[{"-", "1"}], 
         RowBox[{"k", " "}]]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
          "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Sign", "[", 
             RowBox[{"elem", "[", 
              RowBox[{"[", "13", "]"}], "]"}], "]"}], 
            FractionBox["1", "f"]}], ",", "1", ",", "0", ",", "0", ",", "0", 
           ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "0", ",", "0", ",", "0"}], 
          "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", 
           FractionBox[
            RowBox[{"-", 
             RowBox[{"Sign", "[", 
              RowBox[{"elem", "[", 
               RowBox[{"[", "13", "]"}], "]"}], "]"}]}], "f"], ",", "1", ",", 
           "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], 
          "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], 
          "}"}]}], "}"}]}]}], "]"}], ",", 
    RowBox[{"IdentityMatrix", "[", "6", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.602399391507968*^9, 3.602399474468768*^9}, {
   3.602399537399168*^9, 3.6023995724367676`*^9}, {3.6023996158047676`*^9, 
   3.6023996173803678`*^9}, {3.6023996683455677`*^9, 
   3.6023996977359676`*^9}, {3.6023998474683676`*^9, 
   3.6023998780755677`*^9}, {3.6024000307295675`*^9, 
   3.6024000374775677`*^9}, {3.602400174398568*^9, 3.602400191546568*^9}, {
   3.602400311896568*^9, 3.602400339829568*^9}, {3.6024003786895676`*^9, 
   3.602400445882568*^9}, {3.602400516886568*^9, 3.6024005549835677`*^9}, 
   3.6024005951375675`*^9, {3.6024918135049033`*^9, 3.602491817375903*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"MLCLinearThickQuadrupoleMatrix", "[", 
    RowBox[{"elem_", ",", 
     RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"L", ",", "k"}], "}"}], ",", 
     RowBox[{
      RowBox[{"L", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", 
      RowBox[{"k", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Positive", "[", 
         RowBox[{"elem", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"k", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"elem", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", 
             RowBox[{
              RowBox[{"Sin", "[", 
               RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", "0", ",", "0",
              ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "k"}], " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"k", " ", "L"}], "]"}]}], ",", 
             RowBox[{"Cos", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", "0", ",", "0", ",", "0", 
             ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"Cosh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", 
             RowBox[{
              RowBox[{"Sinh", "[", 
               RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", "0", ",", 
             "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"k", " ", 
              RowBox[{"Sinh", "[", 
               RowBox[{"k", " ", "L"}], "]"}]}], ",", 
             RowBox[{"Cosh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", "0", ",", "0"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], 
            "}"}]}], "}"}]}], ",", 
        RowBox[{
         RowBox[{"k", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"-", 
            RowBox[{"elem", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cosh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", 
             RowBox[{
              RowBox[{"Sinh", "[", 
               RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", "0", ",", "0",
              ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"k", " ", 
              RowBox[{"Sinh", "[", 
               RowBox[{"k", " ", "L"}], "]"}]}], ",", 
             RowBox[{"Cosh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", "0", ",", "0", ",", "0", 
             ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"Cos", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", 
             RowBox[{
              RowBox[{"Sin", "[", 
               RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", "0", ",", 
             "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{
              RowBox[{"-", "k"}], " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"k", " ", "L"}], "]"}]}], ",", 
             RowBox[{"Cos", "[", 
              RowBox[{"k", " ", "L"}], "]"}], ",", "0", ",", "0"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], 
            "}"}]}], "}"}]}]}], "]"}]}]}], "]"}]}], "*)"}]], "Input",
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearThickWigglerMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "k", ",", "\[Beta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"k", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]", "^", "2"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"elem", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[NoBreak]", 
        RowBox[{"{", "\n", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "1", ",", " ", "L", ",", " ", "0", ",", " ", "0", ",", " ", "0", 
            ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "1", ",", " ", "0", ",", " ", "0", ",", " ", "0", 
            ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{"Cosh", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", " ", "0", ",", 
            " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{"k", " ", 
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ",", " ", 
            RowBox[{"Cosh", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", "0", ",", " ", "0"}], 
           "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "1", 
            ",", " ", 
            RowBox[{"L", "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Beta]", "^", "2"}], " ", 
               RowBox[{"\[Gamma]", "^", "2"}]}], ")"}]}]}], "}"}], ",", "\n", 
          " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", 
            ",", " ", "1"}], "}"}]}], "\n", "}"}]}], ",", 
       RowBox[{
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "===", "0"}], ",", 
       TagBox[
        RowBox[{"MLCLinearDriftMatrix", "[", 
         RowBox[{"elem", ",", "\[Gamma]"}], "]"}],
        Function[BoxForm`e$, 
         MatrixForm[BoxForm`e$]]]}], "\[NoBreak]", "]"}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.572941121828188*^9, 3.5729411874597507`*^9}, {
   3.5729437755845375`*^9, 3.572943807075686*^9}, 3.572943845635542*^9, {
   3.572951181371042*^9, 3.5729512052594304`*^9}, 3.572951245117416*^9, {
   3.572952605885479*^9, 3.5729526311810083`*^9}, {3.5729527167025595`*^9, 
   3.5729527212630157`*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearThickQuadrupoleMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "k", ",", "\[Beta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"k", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]", "^", "2"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"Positive", "[", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"elem", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"Sin", "[", 
              RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", " ", "0", ",", 
            " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "k"}], " ", 
             RowBox[{"Sin", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ",", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", "0", ",", " ", "0", 
            ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{"Cosh", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", " ", "0", ",", 
            " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{"k", " ", 
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ",", " ", 
            RowBox[{"Cosh", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", "0", ",", " ", "0"}], 
           "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "1", 
            ",", " ", 
            RowBox[{"L", "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Beta]", "^", "2"}], " ", 
               RowBox[{"\[Gamma]", "^", "2"}]}], ")"}]}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", 
            ",", " ", "1"}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Negative", "[", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"-", 
           RowBox[{"elem", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[NoBreak]", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Cosh", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", " ", "0", ",", 
            " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"k", " ", 
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ",", " ", 
            RowBox[{"Cosh", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", "0", ",", " ", "0", 
            ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"Sin", "[", 
              RowBox[{"k", " ", "L"}], "]"}], "/", "k"}], ",", " ", "0", ",", 
            " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{"-", "k"}], " ", 
             RowBox[{"Sin", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ",", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"k", " ", "L"}], "]"}], ",", " ", "0", ",", " ", "0"}], 
           "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "1", 
            ",", " ", 
            RowBox[{"L", "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Beta]", "^", "2"}], " ", 
               RowBox[{"\[Gamma]", "^", "2"}]}], ")"}]}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", 
            ",", " ", "1"}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
       "True", ",", 
       RowBox[{"MLCLinearDriftMatrix", "[", 
        RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.572952653649255*^9, 3.572952725939483*^9}, 
   3.5729528323721256`*^9, {3.572952883592247*^9, 3.572952903687256*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearThinQuadrupoleMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "k"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"k", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"Abs", "[", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], ";", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"Positive", "[", 
            RowBox[{"elem", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"-", "k"}], " ", 
            RowBox[{"Sin", "[", 
             RowBox[{"k", " ", "L"}], "]"}]}], ",", 
           RowBox[{"k", " ", 
            RowBox[{"Sinh", "[", 
             RowBox[{"k", " ", "L"}], "]"}]}]}], "]"}], ",", "1", ",", "0", 
         ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "0", ",", "0", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"k", ">", "0"}], ",", 
           RowBox[{"k", " ", 
            RowBox[{"Sinh", "[", 
             RowBox[{"k", " ", "L"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"-", "k"}], " ", 
            RowBox[{"Sin", "[", 
             RowBox[{"k", " ", "L"}], "]"}]}]}], "]"}], ",", "1", ",", "0", 
         ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], 
        "}"}]}], "}"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearWedgeBendMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "L", ",", "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", 
      ",", "\[Beta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"\[Rho]", "=", 
      RowBox[{"L", "/", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}]}], ";", 
     RowBox[{"n", "=", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], " ", 
       RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
     RowBox[{"h", "=", 
      RowBox[{"1", "/", "\[Rho]"}]}], ";", 
     RowBox[{"kx", "=", 
      RowBox[{"h", " ", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
     RowBox[{"ky", "=", 
      RowBox[{"h", " ", 
       RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]", "^", "2"}]}]}], "]"}]}], ";", "\n", 
     TagBox[
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"kx", " ", "L"}], "]"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", "L", ",", 
            FractionBox[
             RowBox[{"Sin", "[", 
              RowBox[{"kx", " ", "L"}], "]"}], "kx"]}], "]"}], ",", "0", ",", 
          "0", ",", "0", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", 
            FractionBox[
             RowBox[{"h", " ", 
              SuperscriptBox["L", "2"]}], 
             RowBox[{"2", " ", "\[Beta]"}]], ",", 
            FractionBox[
             RowBox[{"h", " ", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Cos", "[", 
                 RowBox[{"kx", " ", "L"}], "]"}]}], ")"}]}], 
             RowBox[{"\[Beta]", " ", 
              SuperscriptBox["kx", "2"]}]]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "kx"}], " ", 
           RowBox[{"Sin", "[", 
            RowBox[{"kx", " ", "L"}], "]"}]}], ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"kx", " ", "L"}], "]"}], ",", "0", ",", "0", ",", "0", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", 
            FractionBox[
             RowBox[{"h", " ", "L"}], "\[Beta]"], ",", 
            FractionBox[
             RowBox[{"h", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"kx", " ", "L"}], "]"}]}], 
             RowBox[{"\[Beta]", " ", "kx"}]]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"ky", " ", "L"}], "]"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ky", "==", "0"}], ",", "L", ",", 
            FractionBox[
             RowBox[{"Sin", "[", 
              RowBox[{"ky", " ", "L"}], "]"}], "ky"]}], "]"}], ",", "0", ",", 
          "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{
           RowBox[{"-", "ky"}], " ", 
           RowBox[{"Sin", "[", 
            RowBox[{"ky", " ", "L"}], "]"}]}], ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"ky", " ", "L"}], "]"}], ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"h", " ", "L"}], "\[Beta]"]}], ",", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"h", " ", 
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "L"}], "]"}]}], 
              RowBox[{"\[Beta]", " ", "kx"}]]}]}], "]"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"h", " ", 
               SuperscriptBox["L", "2"]}], 
              RowBox[{"2", " ", "\[Beta]"}]]}], ",", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"h", " ", 
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"Cos", "[", 
                  RowBox[{"kx", " ", "L"}], "]"}]}], ")"}]}], 
              RowBox[{"\[Beta]", " ", 
               SuperscriptBox["kx", "2"]}]]}]}], "]"}], ",", "0", ",", "0", 
          ",", "1", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", 
            RowBox[{
             FractionBox["L", 
              RowBox[{
               SuperscriptBox["\[Beta]", "2"], " ", 
               SuperscriptBox["\[Gamma]", "2"]}]], "-", 
             FractionBox[
              RowBox[{
               SuperscriptBox["h", "2"], " ", 
               SuperscriptBox["L", "3"]}], 
              RowBox[{"6", " ", 
               SuperscriptBox["\[Beta]", "2"]}]]}], ",", 
            RowBox[{
             FractionBox["L", 
              RowBox[{
               SuperscriptBox["\[Beta]", "2"], " ", 
               SuperscriptBox["\[Gamma]", "2"]}]], "-", 
             FractionBox[
              RowBox[{
               SuperscriptBox["h", "2"], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"kx", " ", "L"}], "-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"kx", " ", "L"}], "]"}]}], ")"}]}], 
              RowBox[{
               SuperscriptBox["\[Beta]", "2"], " ", 
               SuperscriptBox["kx", "3"]}]]}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], 
         "}"}]}], "}"}],
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearSolenoidMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "K", ",", "Cval", ",", "Sval"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", 
     RowBox[{"K", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", 
     RowBox[{"Cval", "=", 
      RowBox[{"Cos", " ", "[", 
       RowBox[{"K", " ", "L"}], "]"}]}], ";", 
     RowBox[{"Sval", "=", 
      RowBox[{"Sin", "[", 
       RowBox[{"K", " ", "L"}], "]"}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Cval", ",", 
         RowBox[{"Sval", "/", "K"}], ",", "0", ",", "0", ",", "0", ",", "0"}],
         "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "K"}], " ", "Sval"}], ",", "Cval", ",", "0", ",", "0", 
         ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "Cval", ",", 
         RowBox[{"Sval", "/", "K"}], ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "K"}], " ", "Sval"}], ",", "Cval", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1"}], 
        "}"}]}], "}"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearBeamRotationMatrix", "[", "\[Alpha]_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Cos", "[", "\[Alpha]", "]"}], ",", "0", ",", 
      RowBox[{"Sin", "[", "\[Alpha]", "]"}], ",", "0", ",", "0", ",", "0"}], 
     "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"Cos", "[", "\[Alpha]", "]"}], ",", "0", ",", 
      RowBox[{"Sin", "[", "\[Alpha]", "]"}], ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Sin", "[", "\[Alpha]", "]"}]}], ",", "0", ",", 
      RowBox[{"Cos", "[", "\[Alpha]", "]"}], ",", "0", ",", "0", ",", "0"}], 
     "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"-", 
       RowBox[{"Sin", "[", "\[Alpha]", "]"}]}], ",", "0", ",", 
      RowBox[{"Cos", "[", "\[Alpha]", "]"}], ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], "}"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], "}"}]}],
    "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearPoleFaceRotationMatrix", "[", 
   RowBox[{"\[Beta]_", ",", "\[Rho]_", ",", "k_", ",", "gap_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[CurlyPhi]", ",", "h"}], "}"}], ",", 
    RowBox[{
     RowBox[{"h", "=", 
      RowBox[{"1", "/", "\[Rho]"}]}], ";", 
     RowBox[{"\[CurlyPhi]", "=", 
      RowBox[{"k", " ", "h", " ", "gap", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"Sin", "[", "\[Beta]", "]"}], "^", "2"}]}], ")"}], "/", 
        RowBox[{"Cos", "[", "\[Beta]", "]"}]}]}]}], ";", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"h", " ", 
          RowBox[{"Tan", "[", "\[Beta]", "]"}]}], ",", "1", ",", "0", ",", 
         "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "0", ",", "0", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "h"}], " ", 
          RowBox[{"Tan", "[", 
           RowBox[{"\[Beta]", "-", "\[CurlyPhi]"}], "]"}]}], ",", "1", ",", 
         "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], 
        "}"}]}], "}"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearSectorBendMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "beta1", ",", "beta2", ",", "L", ",", "\[Rho]", ",", "k", ",", "gap", 
      ",", "\[Beta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"k", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], ";", 
     RowBox[{"beta1", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "10", "]"}], "]"}]}], ";", 
     RowBox[{"beta2", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]", "^", "2"}]}]}], "]"}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"elem", "[", 
          RowBox[{"[", "6", "]"}], "]"}], "]"}], ">", "0"}], ",", 
       RowBox[{
        RowBox[{"\[Rho]", "=", 
         RowBox[{"L", "/", 
          RowBox[{"elem", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}]}], ";", 
        RowBox[{"Chop", "[", 
         RowBox[{
          RowBox[{"MLCLinearPoleFaceRotationMatrix", "[", 
           RowBox[{"beta2", ",", "\[Rho]", ",", "k", ",", "0.0"}], "]"}], ".", 
          RowBox[{"MLCLinearWedgeBendMatrix", "[", 
           RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ".", 
          RowBox[{"MLCLinearPoleFaceRotationMatrix", "[", 
           RowBox[{"beta1", ",", "\[Rho]", ",", "k", ",", "0.0"}], "]"}]}], 
         "]"}]}], ",", 
       RowBox[{"MLCLinearDriftMatrix", "[", 
        RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearRectBendMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "beta1", ",", "beta2", ",", "L", ",", "\[Rho]", ",", "k", ",", "gap", 
      ",", "\[Beta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"k", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], ";", 
     RowBox[{"beta1", "=", 
      RowBox[{
       RowBox[{"elem", "[", 
        RowBox[{"[", "10", "]"}], "]"}], "+", 
       RowBox[{
        RowBox[{
        "elem", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], "/", 
        "2.809"}]}]}], ";", 
     RowBox[{"beta2", "=", 
      RowBox[{
       RowBox[{"elem", "[", 
        RowBox[{"[", "11", "]"}], "]"}], "+", 
       RowBox[{
        RowBox[{
        "elem", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], "/", 
        "2.809"}]}]}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]", "^", "2"}]}]}], "]"}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"elem", "[", 
          RowBox[{"[", "6", "]"}], "]"}], "]"}], ">", "0"}], ",", 
       RowBox[{
        RowBox[{"\[Rho]", "=", 
         RowBox[{"L", "/", 
          RowBox[{"elem", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}]}], ";", 
        RowBox[{"Chop", "[", 
         RowBox[{
          RowBox[{"MLCLinearPoleFaceRotationMatrix", "[", 
           RowBox[{"beta2", ",", "\[Rho]", ",", "k", ",", "0.0"}], "]"}], ".", 
          RowBox[{"MLCLinearWedgeBendMatrix", "[", 
           RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ".", 
          RowBox[{"MLCLinearPoleFaceRotationMatrix", "[", 
           RowBox[{"beta1", ",", "\[Rho]", ",", "k", ",", "0.0"}], "]"}]}], 
         "]"}]}], ",", 
       RowBox[{"MLCLinearDriftMatrix", "[", 
        RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5057193753441925`*^9, 3.5057193932353907`*^9}, {
  3.505719601429552*^9, 3.5057196183050923`*^9}, {3.505719653571846*^9, 
  3.5057196609783325`*^9}, {3.5057196982920265`*^9, 3.5057197087611117`*^9}, {
  3.505719771888132*^9, 3.50571984012469*^9}, {3.5057198736257625`*^9, 
  3.505719891079446*^9}, {3.505719967956906*^9, 3.505719990676383*^9}, {
  3.505720031115177*^9, 3.505720044803115*^9}, {3.5057200788198285`*^9, 
  3.5057201458844748`*^9}, {3.5057202342154255`*^9, 3.5057203028894987`*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearRFCCavityMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "dE", ",", "\[Phi]", ",", "\[Lambda]", ",", "E0"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"Print", "[", "\"\<1\>\"", "]"}], ";", 
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"dE", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "10", "]"}], "]"}]}], ";", 
     RowBox[{"\[Phi]", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "12", "]"}], "]"}]}], ";", 
     RowBox[{"E0", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "14", "]"}], "]"}]}], ";", "\n", 
     TagBox[
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"1", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"dE", "==", "0"}], ",", "L", ",", 
            RowBox[{"L", 
             FractionBox["E0", 
              RowBox[{"dE", "  ", 
               RowBox[{"Cos", "[", "\[Phi]", "]"}]}]], 
             RowBox[{"Log", "[", 
              RowBox[{"1", "+", 
               FractionBox[
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}], "E0"]}], "]"}]}]}], 
           "]"}], "0", "0", "0", "0"},
         {"0", 
          FractionBox["E0", 
           RowBox[{"E0", "+", 
            RowBox[{"dE", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]], "0", "0", "0", "0"},
         {"0", "0", "1", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"dE", "==", "0"}], ",", "L", ",", 
            RowBox[{"L", 
             FractionBox["E0", 
              RowBox[{"dE", "  ", 
               RowBox[{"Cos", "[", "\[Phi]", "]"}]}]], 
             RowBox[{"Log", "[", 
              RowBox[{"1", "+", 
               FractionBox[
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}], "E0"]}], "]"}]}]}], 
           "]"}], "0", "0"},
         {"0", "0", "0", 
          FractionBox["E0", 
           RowBox[{"E0", "+", 
            RowBox[{"dE", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]], "0", "0"},
         {"0", "0", "0", "0", "1", "0"},
         {"0", "0", "0", "0", 
          RowBox[{
           FractionBox[
            RowBox[{"dE", " ", 
             RowBox[{"Sin", "[", "\[Phi]", "]"}]}], 
            RowBox[{"E0", "+", 
             RowBox[{"dE", " ", 
              RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]], 
           FractionBox[
            RowBox[{"2", "\[Pi]"}], "\[Lambda]"]}], 
          FractionBox["E0", 
           RowBox[{"E0", "+", 
            RowBox[{"dE", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]]}
        }], "\[NoBreak]", ")"}],
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell["Linear Cavity with no focusing:", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearCavityMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"L", ",", "dE", ",", "\[Phi]", ",", "\[Lambda]", ",", "E0"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"Print", "[", "\"\<2\>\"", "]"}], ";", 
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"dE", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "10", "]"}], "]"}]}], ";", 
     RowBox[{"\[Phi]", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.99792458", " ", 
         RowBox[{"10", "^", "2"}]}], ")"}], "/", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "12", "]"}], "]"}]}]}], ";", 
     RowBox[{"E0", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "20", "]"}], "]"}]}], ";", "\n", 
     TagBox[
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"1", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"dE", "==", "0"}], ",", "L", ",", 
            RowBox[{"L", 
             FractionBox["E0", 
              RowBox[{"dE", "  ", 
               RowBox[{"Cos", "[", "\[Phi]", "]"}]}]], 
             RowBox[{"Log", "[", 
              RowBox[{"1", "+", 
               FractionBox[
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}], "E0"]}], "]"}]}]}], 
           "]"}], "0", "0", "0", "0"},
         {"0", 
          FractionBox["E0", 
           RowBox[{"E0", "+", 
            RowBox[{"dE", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]], "0", "0", "0", "0"},
         {"0", "0", "1", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"dE", "==", "0"}], ",", "L", ",", 
            RowBox[{"L", 
             FractionBox["E0", 
              RowBox[{"dE", "  ", 
               RowBox[{"Cos", "[", "\[Phi]", "]"}]}]], 
             RowBox[{"Log", "[", 
              RowBox[{"1", "+", 
               FractionBox[
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}], "E0"]}], "]"}]}]}], 
           "]"}], "0", "0"},
         {"0", "0", "0", 
          FractionBox["E0", 
           RowBox[{"E0", "+", 
            RowBox[{"dE", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]], "0", "0"},
         {"0", "0", "0", "0", "1", "0"},
         {"0", "0", "0", "0", 
          RowBox[{
           FractionBox[
            RowBox[{"dE", " ", 
             RowBox[{"Sin", "[", "\[Phi]", "]"}]}], 
            RowBox[{"E0", "+", 
             RowBox[{"dE", " ", 
              RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]], 
           FractionBox[
            RowBox[{"2", "\[Pi]"}], "\[Lambda]"]}], 
          FractionBox["E0", 
           RowBox[{"E0", "+", 
            RowBox[{"dE", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]]}
        }], "\[NoBreak]", ")"}],
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]]}]}], "]"}]}]], "Code",
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearRSCavityMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "L", ",", "dE", ",", "\[Phi]", ",", "\[Lambda]", ",", "E0", ",", 
      "\[Alpha]f"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"dE", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "10", "]"}], "]"}]}], ";", 
     RowBox[{"\[Phi]", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.99792458", " ", 
         RowBox[{"10", "^", "2"}]}], ")"}], "/", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "12", "]"}], "]"}]}]}], ";", 
     RowBox[{"E0", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "20", "]"}], "]"}]}], ";", 
     RowBox[{"\[Alpha]f", "=", 
      RowBox[{
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Sqrt", "[", "8", "]"}], 
          RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}], " ", 
       RowBox[{"Log", "[", 
        RowBox[{"1", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dE", " ", 
            RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}], "/", "E0"}]}], 
        "]"}]}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dE", "==", "0"}], ",", 
       RowBox[{"MLCLinearDriftMatrix", "[", "elem", "]"}], ",", "\n", 
       RowBox[{"(", "\[NoBreak]", 
        RowBox[{"{", "\n", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Cos", "[", "\[Alpha]f", "]"}], "-", 
             RowBox[{
              RowBox[{"Sqrt", "[", "2", "]"}], 
              RowBox[{"Cos", "[", "\[Phi]", "]"}], 
              RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}]}], ",", " ", 
            RowBox[{
             RowBox[{"Sqrt", "[", "8", "]"}], 
             RowBox[{"E0", "/", 
              RowBox[{"(", 
               RowBox[{"dE", " ", 
                RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}], " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}], 
             RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}], ",", " ", "0", ",", 
            " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"-", 
               RowBox[{"(", 
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}], "/", "E0"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Cos", "[", "\[Phi]", "]"}], "/", 
                RowBox[{"Sqrt", "[", "2", "]"}]}], "+", 
               RowBox[{"1", "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Sqrt", "[", "8", "]"}], 
                  RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}]}], ")"}], 
             RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"E0", "/", 
              RowBox[{"(", 
               RowBox[{"E0", "+", 
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Alpha]f", "]"}], "+", 
               RowBox[{
                RowBox[{"Sqrt", "[", "2", "]"}], 
                RowBox[{"Cos", "[", "\[Phi]", "]"}], 
                RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}]}], ")"}]}], ",", " ",
             "0", ",", " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", 
          "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{"Cos", "[", "\[Alpha]f", "]"}], "-", 
             RowBox[{
              RowBox[{"Sqrt", "[", "2", "]"}], 
              RowBox[{"Cos", "[", "\[Phi]", "]"}], 
              RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}]}], ",", " ", 
            RowBox[{
             RowBox[{"Sqrt", "[", "8", "]"}], 
             RowBox[{"E0", "/", 
              RowBox[{"(", 
               RowBox[{"dE", " ", 
                RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}], " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}], 
             RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}], ",", " ", "0", ",", 
            " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", 
               RowBox[{"(", 
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}], "/", "E0"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Cos", "[", "\[Phi]", "]"}], "/", 
                RowBox[{"Sqrt", "[", "2", "]"}]}], "+", 
               RowBox[{"1", "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Sqrt", "[", "8", "]"}], 
                  RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}]}], ")"}], 
             RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"E0", "/", 
              RowBox[{"(", 
               RowBox[{"E0", "+", 
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Alpha]f", "]"}], "+", 
               RowBox[{
                RowBox[{"Sqrt", "[", "2", "]"}], 
                RowBox[{"Cos", "[", "\[Phi]", "]"}], 
                RowBox[{"Sin", "[", "\[Alpha]f", "]"}]}]}], ")"}]}], ",", " ",
             "0", ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "1", 
            ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"dE", " ", 
                RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"E0", "+", 
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"2", "\[Pi]"}], ")"}], "/", "\[Lambda]"}]}], ",", " ", 
            RowBox[{"E0", "/", 
             RowBox[{"(", 
              RowBox[{"E0", "+", 
               RowBox[{"dE", " ", 
                RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}]}], "}"}]}], 
         "\n", "}"}], "\[NoBreak]", ")"}]}], "]"}]}]}], "]"}]}]], "Input",
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearRSCavityMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "L", ",", "dE", ",", "\[Phi]", ",", "\[Lambda]", ",", "E0", ",", 
      "\[Alpha]", ",", "\[Gamma]p", ",", "\[Gamma]f", ",", "\[Gamma]i", ",", 
      "\[Eta]"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"dE", "=", 
      RowBox[{
       RowBox[{"elem", "[", 
        RowBox[{"[", "3", "]"}], "]"}], 
       RowBox[{
        RowBox[{"elem", "[", 
         RowBox[{"[", "10", "]"}], "]"}], "/", "1"}]}]}], ";", 
     RowBox[{"\[Phi]", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.99792458", " ", 
         RowBox[{"10", "^", "2"}]}], ")"}], "/", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "12", "]"}], "]"}]}]}], ";", "\n", 
     RowBox[{"E0", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"elem", "[", 
          RowBox[{"[", "21", "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "21", "]"}], "]"}], ",", "MLCEnergy"}], "]"}]}], ";", 
     RowBox[{"MLCSetEnergy", "[", 
      RowBox[{"E0", "+", 
       RowBox[{"dE", " ", 
        RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], "]"}], ";", "\n", 
     RowBox[{"\[Gamma]p", "=", 
      RowBox[{"(", 
       RowBox[{"dE", " ", 
        RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ")"}]}], ";", 
     RowBox[{"\[Gamma]i", "=", "E0"}], ";", 
     RowBox[{"\[Gamma]f", "=", 
      RowBox[{"E0", "+", 
       RowBox[{"dE", " ", 
        RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]}], ";", "\n", 
     RowBox[{"\[Alpha]", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"\[Eta]", "[", "\[Phi]", "]"}], "/", "8"}], "]"}], "/", 
        RowBox[{"Cos", "[", "\[Phi]", "]"}]}], " ", 
       RowBox[{"Log", "[", 
        RowBox[{"\[Gamma]f", "/", "\[Gamma]i"}], "]"}]}]}], ";", 
     RowBox[{
      RowBox[{"\[Eta]", "[", "\[Phi]", "]"}], "=", "1"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dE", "==", "0"}], ",", 
       RowBox[{"MLCLinearDriftMatrix", "[", "elem", "]"}], ",", "\n", 
       RowBox[{"(", "\[NoBreak]", 
        RowBox[{"{", "\n", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Cos", "[", "\[Alpha]", "]"}], "-", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"2", "/", 
                 RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], ")"}], "^", 
               RowBox[{"(", 
                RowBox[{"1", "/", "2"}], ")"}]}], " ", 
              RowBox[{"Cos", "[", "\[Phi]", "]"}], 
              RowBox[{"Sin", "[", "\[Alpha]", "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Sqrt", "[", "8", "]"}], "/", 
                RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "2"}], ")"}]}], " ", 
             RowBox[{"\[Gamma]i", "/", "\[Gamma]p"}], " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}], 
             RowBox[{"Sin", "[", "\[Alpha]", "]"}]}], ",", " ", "0", ",", " ",
             "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"-", "\[Gamma]p"}], "/", "\[Gamma]i"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Cos", "[", "\[Phi]", "]"}], "/", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"2", 
                  RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], "]"}]}], "+", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Eta]", "[", "\[Phi]", "]"}], "/", "8"}], ")"}], 
                 "^", 
                 RowBox[{"(", 
                  RowBox[{"1", "/", "2"}], ")"}]}], " ", 
                RowBox[{"1", "/", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]}], ")"}], 
             RowBox[{"Sin", "[", "\[Alpha]", "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"\[Gamma]i", "/", "\[Gamma]f"}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Alpha]", "]"}], "+", 
               RowBox[{
                RowBox[{"Sqrt", "[", 
                 RowBox[{"2", "/", 
                  RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], "]"}], 
                RowBox[{"Cos", "[", "\[Phi]", "]"}], 
                RowBox[{"Sin", "[", "\[Alpha]", "]"}]}]}], ")"}]}], ",", " ", 
            "0", ",", " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", 
          "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{"Cos", "[", "\[Alpha]", "]"}], "-", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"2", "/", 
                 RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], ")"}], "^", 
               RowBox[{"(", 
                RowBox[{"1", "/", "2"}], ")"}]}], " ", 
              RowBox[{"Cos", "[", "\[Phi]", "]"}], 
              RowBox[{"Sin", "[", "\[Alpha]", "]"}]}]}], ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Sqrt", "[", "8", "]"}], "/", 
                RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "2"}], ")"}]}], " ", 
             RowBox[{"\[Gamma]i", "/", "\[Gamma]p"}], " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}], 
             RowBox[{"Sin", "[", "\[Alpha]", "]"}]}], ",", " ", "0", ",", " ",
             "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "\[Gamma]p"}], "/", "\[Gamma]i"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Cos", "[", "\[Phi]", "]"}], "/", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"2", 
                  RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], "]"}]}], "+", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Eta]", "[", "\[Phi]", "]"}], "/", "8"}], ")"}], 
                 "^", 
                 RowBox[{"(", 
                  RowBox[{"1", "/", "2"}], ")"}]}], " ", 
                RowBox[{"1", "/", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}]}], ")"}], 
             RowBox[{"Sin", "[", "\[Alpha]", "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"\[Gamma]i", "/", "\[Gamma]f"}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Alpha]", "]"}], "+", 
               RowBox[{
                RowBox[{"Sqrt", "[", 
                 RowBox[{"2", "/", 
                  RowBox[{"\[Eta]", "[", "\[Phi]", "]"}]}], "]"}], 
                RowBox[{"Cos", "[", "\[Phi]", "]"}], 
                RowBox[{"Sin", "[", "\[Alpha]", "]"}]}]}], ")"}]}], ",", " ", 
            "0", ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "1", 
            ",", " ", "0"}], "}"}], ",", "\n", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"dE", " ", 
                RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"E0", "+", 
                RowBox[{"dE", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"2", "\[Pi]"}], ")"}], "/", "\[Lambda]"}]}], ",", " ", 
            RowBox[{"E0", "/", 
             RowBox[{"(", 
              RowBox[{"E0", "+", 
               RowBox[{"dE", " ", 
                RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}]}], "}"}]}], 
         "\n", "}"}], "\[NoBreak]", ")"}]}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.4760123964060097`*^9, 3.476012452983773*^9, {3.4760139339110003`*^9, 
   3.476014011629253*^9}, {3.4760140433165503`*^9, 3.4760140649414115`*^9}, {
   3.476014284752505*^9, 3.4760144190016456`*^9}, {3.4760145234541025`*^9, 
   3.4760146269914827`*^9}, {3.476014662419252*^9, 3.476014699112857*^9}, {
   3.4760147334310665`*^9, 3.476014824336816*^9}},
 Background->None],

Cell["\<\
TheFollowing Definition uses that taken from the MAD source code:\
\>", "Text",
 CellChangeTimes->{3.4487933801281595`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearMADCavityMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ENER", ",", "ENERGY", ",", 
      RowBox[{"EL", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", 
      RowBox[{"DELTAE", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "10", "]"}], "]"}]}], ",", 
      RowBox[{"PHI0", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "11", "]"}], "]"}]}], ",", 
      RowBox[{"FREQ", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "12", "]"}], "]"}]}], ",", 
      RowBox[{"ELOSS", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "13", "]"}], "]"}]}], ",", 
      RowBox[{"VOLTERR", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "14", "]"}], "]"}]}], ",", 
      RowBox[{"ALAGERR", "=", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "15", "]"}], "]"}]}], ",", "VRF", ",", "OMEGA", ",", 
      RowBox[{"CLIGHT", "=", 
       RowBox[{"2.99792458", " ", 
        RowBox[{"10", "^", "8"}]}]}], ",", "PHIRF", ",", 
      RowBox[{"DELTAS", "=", "0"}], ",", "DENERGY", ",", 
      RowBox[{"AMASS", "=", "0.000511"}], ",", "PC", ",", "GAMMA", ",", 
      "BETA", ",", "ETAS", ",", "GAMMAS", ",", "BETAS", ",", "FACT", ",", 
      "RE", ",", "RW"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"ENER", "=", 
      RowBox[{"ENERGY", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"elem", "[", 
           RowBox[{"[", "21", "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{"elem", "[", 
          RowBox[{"[", "21", "]"}], "]"}], ",", "MLCEnergy"}], "]"}]}]}], ";",
      "\n", 
     RowBox[{"VRF", "=", 
      RowBox[{
       RowBox[{"10", "^", 
        RowBox[{"-", "3"}]}], "*", "DELTAE"}]}], ";", "\n", 
     RowBox[{"VOLTERR", "=", 
      RowBox[{
       RowBox[{"10", "^", 
        RowBox[{"-", "3"}]}], "*", "VOLTERR"}]}], ";", "\n", 
     RowBox[{"ELOSS", "=", 
      RowBox[{
       RowBox[{"10", "^", 
        RowBox[{"-", "3"}]}], "*", "ELOSS"}]}], ";", "\n", 
     RowBox[{"OMEGA", "=", 
      RowBox[{"2", "\[Pi]", "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"10", "^", "6"}], "*", "FREQ"}], ")"}], "/", "CLIGHT"}]}]}],
      ";", "\n", 
     RowBox[{"PHIRF", "=", 
      RowBox[{"2", "\[Pi]", "*", "PHI0"}]}], ";", "\n", 
     RowBox[{"ALAGERR", "=", 
      RowBox[{"2", "\[Pi]", "*", "ALAGERR"}]}], ";", "\n", 
     RowBox[{"DENERGY", "=", 
      RowBox[{"VRF", "*", 
       RowBox[{"Cos", "[", "PHIRF", "]"}]}]}], ";", "\n", 
     RowBox[{"MLCSetEnergy", "[", 
      RowBox[{"DENERGY", "+", "ENERGY"}], "]"}], ";", "\n", 
     RowBox[{"PC", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"(", 
        RowBox[{"Abs", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ENERGY", "^", "2"}], "-", 
           RowBox[{"AMASS", "^", "2"}]}], ")"}]}], ")"}], "]"}]}], ";", "\n", 
     RowBox[{"GAMMA", "=", 
      RowBox[{"ENERGY", "/", "AMASS"}]}], ";", "\n", 
     RowBox[{"BETA", "=", 
      RowBox[{"PC", "/", "ENERGY"}]}], ";", "\n", 
     RowBox[{"ETAS", "=", 
      RowBox[{"BETA", "*", "GAMMA", "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", "DELTAS"}], ")"}]}]}], ";", "\n", 
     RowBox[{"GAMMAS", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"ETAS", "^", "2"}]}], ")"}], "]"}]}], ";", "\n", 
     RowBox[{"BETAS", "=", 
      RowBox[{"ETAS", "/", "GAMMAS"}]}], ";", "\n", "\n", 
     RowBox[{"RE", "=", 
      RowBox[{"IdentityMatrix", "[", "6", "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"6", ",", "5"}], "]"}], "]"}], "=", 
      RowBox[{"OMEGA", "*", "VRF", "*", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "PHIRF", "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"ENER", "+", "DENERGY"}], ")"}]}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "+", "DELTAS"}], ")"}]}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2"}], "]"}], "]"}], "=", 
      RowBox[{"ENER", "/", 
       RowBox[{"(", 
        RowBox[{"ENER", "+", "DENERGY"}], ")"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"4", ",", "4"}], "]"}], "]"}], "=", 
      RowBox[{"ENER", "/", 
       RowBox[{"(", 
        RowBox[{"ENER", "+", "DENERGY"}], ")"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"6", ",", "6"}], "]"}], "]"}], "=", 
      RowBox[{"ENER", "/", 
       RowBox[{"(", 
        RowBox[{"ENER", "+", "DENERGY"}], ")"}]}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "@", 
         RowBox[{"(", 
          RowBox[{"DENERGY", "/", "ENER"}], ")"}]}], "<", "0"}], " ", ",", 
       RowBox[{"FACT", "=", 
        RowBox[{"1", "-", 
         RowBox[{
          RowBox[{"1", "/", "2"}], "*", 
          RowBox[{"DENERGY", "/", "ENER"}]}]}]}], ",", 
       RowBox[{"FACT", "=", 
        RowBox[{
         RowBox[{"ENER", "/", "DENERGY"}], "*", 
         RowBox[{"Log", "[", 
          RowBox[{"1", "+", 
           RowBox[{"DENERGY", "/", "ENER"}]}], "]"}]}]}]}], "]"}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2"}], "]"}], "]"}], "=", 
      RowBox[{"EL", "*", "FACT"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"3", ",", "4"}], "]"}], "]"}], "=", 
      RowBox[{"EL", "*", "FACT"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RE", "[", 
       RowBox[{"[", 
        RowBox[{"5", ",", "6"}], "]"}], "]"}], "=", 
      RowBox[{"EL", "/", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"BETAS", "*", "GAMMAS"}], ")"}], "^", "2"}]}]}], ";", "\n", 
     RowBox[{"RW", "=", 
      RowBox[{"IdentityMatrix", "[", "6", "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RW", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"-", "DENERGY"}], "/", "EL"}], "/", "2"}], "/", "ENERGY"}]}],
      ";", "\n", 
     RowBox[{
      RowBox[{"RW", "[", 
       RowBox[{"[", 
        RowBox[{"4", ",", "3"}], "]"}], "]"}], "=", 
      RowBox[{"RW", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"RE", "=", 
      RowBox[{"RE", ".", "RW"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RW", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"+", "DENERGY"}], "/", "EL"}], "/", "2"}], "/", 
       RowBox[{"(", 
        RowBox[{"ENERGY", "+", "DENERGY"}], ")"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{"RW", "[", 
       RowBox[{"[", 
        RowBox[{"4", ",", "3"}], "]"}], "]"}], "=", 
      RowBox[{"RW", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"RE", "=", 
      RowBox[{"RW", ".", "RE"}]}], ";", "\n", 
     RowBox[{"(*", "\n", 
      RowBox[{
       RowBox[{"TE", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "6"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "6"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "6", "}"}]}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"6", ",", "5", ",", "5"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"OMEGA", "^", "2"}]}], "*", "VRF", "*", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Cos", "[", "PHIRF", "]"}], "/", "2"}], "/", 
           RowBox[{"(", 
            RowBox[{"ENER", "+", "DENERGY"}], ")"}]}], "/", 
          RowBox[{"(", 
           RowBox[{"1", "+", "DELTAS"}], ")"}]}]}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2", ",", "6"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"-", "EL"}], "/", 
         RowBox[{"(", 
          RowBox[{"2", "*", "BETA"}], ")"}]}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "6", ",", "2"}], "]"}], "]"}], "=", 
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2", ",", "6"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "4", ",", "6"}], "]"}], "]"}], "=", 
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2", ",", "6"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "6", ",", "4"}], "]"}], "]"}], "=", 
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "4", ",", "6"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"5", ",", "2", ",", "2"}], "]"}], "]"}], "=", 
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2", ",", "6"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"5", ",", "4", ",", "4"}], "]"}], "]"}], "=", 
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"5", ",", "2", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"TE", "[", 
         RowBox[{"[", 
          RowBox[{"5", ",", "6", ",", "6"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"TE", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2", ",", "6"}], "]"}], "]"}], "*", 
         RowBox[{"3", "/", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"BETAS", "*", "GAMMAS"}], ")"}], "^", "2"}]}]}]}], ";"}], 
      "*)"}], "\n", "RE"}]}], "\n", "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell["\<\
The following matrix definition is based on the WKB approximation of quantum \
mechanics and deals with non-relativistic particles. I think I got the \
definitions from the TRANSPORT manual.\
\>", "Text",
 CellChangeTimes->{3.4487933864249535`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Notation", "[", 
   RowBox[{
    TagBox[
     SubscriptBox["m", "SI"],
     "NotationTemplateTag",
     BaseStyle->"NotationTemplateStyle"], " ", "\[DoubleLongLeftRightArrow]", 
    " ", 
    TagBox["msi",
     "NotationTemplateTag",
     BaseStyle->"NotationTemplateStyle"]}], "]"}], ";", 
  RowBox[{"Notation", "[", 
   RowBox[{
    TagBox[
     SubscriptBox["c", "SI"],
     "NotationTemplateTag",
     BaseStyle->"NotationTemplateStyle"], " ", "\[DoubleLongLeftRightArrow]", 
    " ", 
    TagBox["csi",
     "NotationTemplateTag",
     BaseStyle->"NotationTemplateStyle"]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Subscript", "[", 
   RowBox[{"m", ",", " ", "SI"}], "]"}], "=", 
  RowBox[{
   RowBox[{"N", "[", "ElectronMass", "]"}], "/", "Kilogram"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Subscript", "[", 
   RowBox[{"c", ",", " ", "SI"}], "]"}], "=", 
  RowBox[{
   RowBox[{"N", "[", "SpeedOfLight", "]"}], "/", 
   RowBox[{"(", 
    RowBox[{"Meter", "/", "Second"}], ")"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearTRCavityMatrix", "[", "elem_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "L", ",", "dE", ",", "\[Phi]", ",", "\[Lambda]", ",", "E0", ",", 
      "\[Alpha]1", ",", "\[Alpha]2", ",", "Q", ",", "QL", ",", "I\[Eta]", ",",
       "\[Delta]\[Gamma]", ",", "\[Gamma]prime", ",", "\[Eta]i", ",", 
      "\[Eta]f", ",", "\[Eta]iprime", ",", "\[Eta]fprime", ",", "vi", ",", 
      "vf", ",", "\[Beta]i", ",", "\[Beta]f", ",", "\[Gamma]i", ",", 
      "\[Gamma]f", ",", "R11", ",", "R12", ",", "R21", ",", "R22", ",", "R55",
       ",", "R56", ",", "R65", ",", "R66"}], "}"}], ",", 
    RowBox[{
     RowBox[{"L", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"dE", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "10", "]"}], "]"}]}], ";", 
     RowBox[{"\[Phi]", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.99792458", " ", 
         RowBox[{"10", "^", "2"}]}], ")"}], "/", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "12", "]"}], "]"}]}]}], ";", 
     RowBox[{"E0", "=", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "20", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"Emev", "=", 
      RowBox[{"Convert", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"ElectronMass", " ", 
          RowBox[{
           RowBox[{"SpeedOfLight", "^", "2"}], "/", 
           RowBox[{"(", 
            RowBox[{"ElectronVolt", " ", "Mega"}], ")"}]}]}], "]"}], ",", 
        "1"}], "]"}]}], ";", "\n", 
     RowBox[{"Q", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"dE", " ", 
          RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ")"}], "/", "L"}], " ", 
       RowBox[{"\[Pi]", "/", "\[Lambda]"}], " ", 
       RowBox[{"1", "/", "Emev"}]}]}], ";", "\n", 
     RowBox[{"QL", "=", 
      RowBox[{"2", "Q"}]}], ";", "\n", 
     RowBox[{"\[Gamma]i", "=", 
      RowBox[{"E0", "/", "Emev"}]}], ";", 
     RowBox[{"\[Gamma]f", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"E0", "+", 
         RowBox[{"dE", " ", 
          RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], "/", "Emev"}]}], 
     ";", "\n", 
     RowBox[{"\[Delta]\[Gamma]", "=", 
      RowBox[{"\[Gamma]f", "-", "\[Gamma]i"}]}], ";", 
     RowBox[{"\[Gamma]prime", "=", 
      RowBox[{"\[Delta]\[Gamma]", "/", "L"}]}], ";", "\n", 
     RowBox[{"\[Beta]i", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]i", "^", "2"}]}]}], "]"}]}], ";", 
     RowBox[{"\[Beta]f", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{"1", "/", 
         RowBox[{"\[Gamma]f", "^", "2"}]}]}], "]"}]}], ";", "\n", 
     RowBox[{"\[Eta]i", "=", 
      RowBox[{"\[Beta]i", " ", "\[Gamma]i"}]}], ";", 
     RowBox[{"\[Eta]f", "=", 
      RowBox[{"\[Beta]f", " ", "\[Gamma]f"}]}], ";", "\n", 
     RowBox[{"\[Eta]iprime", "=", 
      RowBox[{
       RowBox[{"\[Gamma]i", "/", "\[Eta]i"}], " ", "\[Gamma]prime"}]}], ";", 
     RowBox[{"\[Eta]fprime", "=", 
      RowBox[{
       RowBox[{"\[Gamma]f", "/", "\[Gamma]f"}], " ", "\[Gamma]prime"}]}], ";",
      "\n", 
     RowBox[{"I\[Eta]", "=", 
      RowBox[{
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Eta]i", "^", 
           RowBox[{"(", 
            RowBox[{"3", "/", "2"}], ")"}]}], " ", "\[Gamma]f"}], ")"}]}], 
       " ", 
       RowBox[{"(", 
        RowBox[{"\[Delta]\[Gamma]", "-", 
         RowBox[{
          RowBox[{"3", "/", "4"}], " ", 
          RowBox[{"\[Gamma]i", "/", 
           RowBox[{"\[Eta]i", "^", "2"}]}], " ", 
          RowBox[{"\[Delta]\[Gamma]", "^", "2"}]}], "-", 
         RowBox[{
          RowBox[{"\[Delta]\[Gamma]", "^", "3"}], "/", 
          RowBox[{"(", 
           RowBox[{"4", 
            RowBox[{"\[Eta]i", "^", "2"}]}], ")"}]}], "+", 
         RowBox[{
          RowBox[{"7", "/", "8"}], " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Gamma]i", "^", "2"}], " ", 
             RowBox[{"\[Delta]\[Gamma]", "^", "3"}]}], ")"}], "/", 
           RowBox[{"\[Eta]i", "^", "4"}]}]}]}], ")"}]}]}], ";", 
     RowBox[{"\[Alpha]1", "=", 
      RowBox[{
       RowBox[{"Sqrt", "[", "Q", "]"}], "I\[Eta]"}]}], ";", 
     RowBox[{"\[Alpha]2", "=", 
      RowBox[{
       RowBox[{"Sqrt", "[", "QL", "]"}], "I\[Eta]"}]}], ";", "\n", 
     RowBox[{"R11", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Eta]f", "/", "\[Eta]i"}], ")"}], "^", 
         RowBox[{"(", 
          RowBox[{"1", "/", "4"}], ")"}]}], " ", 
        RowBox[{"Cosh", "[", "\[Alpha]1", "]"}]}], "-", 
       RowBox[{
        RowBox[{"1", "/", "4"}], " ", 
        RowBox[{"\[Eta]iprime", "/", "\[Eta]i"}], " ", 
        RowBox[{
         RowBox[{"\[Eta]i", "^", 
          RowBox[{"(", 
           RowBox[{"2", "/", "3"}], ")"}]}], "/", 
         RowBox[{"Sqrt", "[", "Q", "]"}]}], " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Eta]f", "/", "\[Eta]i"}], ")"}], "^", 
         RowBox[{"(", 
          RowBox[{"1", "/", "4"}], ")"}]}], " ", 
        RowBox[{"Sinh", "[", "\[Alpha]1", "]"}]}]}]}], ";", "\n", 
     RowBox[{"R12", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Eta]i", "^", 
         RowBox[{"(", 
          RowBox[{"2", "/", "3"}], ")"}]}], "/", 
        RowBox[{"Sqrt", "[", "Q", "]"}]}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]f", "/", "\[Eta]i"}], ")"}], "^", 
        RowBox[{"(", 
         RowBox[{"1", "/", "4"}], ")"}]}], " ", 
       RowBox[{"Sinh", "[", "\[Alpha]1", "]"}]}]}], ";", "\n", 
     RowBox[{"R21", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"1", "/", "4"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Eta]fprime", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Eta]f", "^", 
              RowBox[{"(", 
               RowBox[{"3", "/", "4"}], ")"}]}], " ", 
             RowBox[{"\[Eta]i", "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "4"}], ")"}]}]}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Eta]iprime", " ", 
             RowBox[{"\[Eta]i", "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "4"}], ")"}]}]}], ")"}], "/", 
           RowBox[{"\[Eta]f", "^", 
            RowBox[{"(", 
             RowBox[{"5", "/", "4"}], ")"}]}]}]}], ")"}], 
        RowBox[{"Cosh", "[", "\[Alpha]1", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Eta]f", "/", "\[Eta]i"}], ")"}], "^", 
            RowBox[{"(", 
             RowBox[{"1", "/", "4"}], ")"}]}], " ", 
           RowBox[{
            RowBox[{"Sqrt", "[", "Q", "]"}], "/", 
            RowBox[{"\[Eta]f", "^", 
             RowBox[{"(", 
              RowBox[{"3", "/", "2"}], ")"}]}]}]}], "-", 
          RowBox[{
           RowBox[{"1", "/", "16"}], " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Eta]fprime", " ", "\[Eta]iprime", " ", 
              RowBox[{"\[Eta]i", "^", 
               RowBox[{"(", 
                RowBox[{"1", "/", "4"}], ")"}]}]}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"\[Eta]f", "^", 
               RowBox[{"(", 
                RowBox[{"3", "/", "4"}], ")"}]}], " ", 
              RowBox[{"Sqrt", "[", "Q", "]"}]}], ")"}]}]}]}], ")"}], 
        RowBox[{"Sinh", "[", "\[Alpha]1", "]"}]}]}]}], ";", "\n", 
     RowBox[{"R22", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"1", "/", "4"}], " ", 
        RowBox[{
         RowBox[{"\[Eta]i", "^", 
          RowBox[{"(", 
           RowBox[{"3", "/", "2"}], ")"}]}], "/", 
         RowBox[{"Sqrt", "[", "Q", "]"}]}], " ", 
        RowBox[{"\[Eta]fprime", "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[Eta]f", "^", 
            RowBox[{"(", 
             RowBox[{"3", "/", "4"}], ")"}]}], " ", 
           RowBox[{"\[Eta]i", "^", 
            RowBox[{"(", 
             RowBox[{"1", "/", "4"}], ")"}]}]}], ")"}]}], " ", 
        RowBox[{"Sinh", "[", "\[Alpha]1", "]"}]}], "+", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Eta]i", "/", "\[Eta]f"}], ")"}], "^", 
         RowBox[{"(", 
          RowBox[{"5", "/", "4"}], ")"}]}], " ", 
        RowBox[{"Cosh", "[", "\[Alpha]1", "]"}]}]}]}], ";", "\n", 
     RowBox[{"R55", "=", 
      RowBox[{
       RowBox[{"\[Beta]f", "/", "\[Beta]i"}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]i", "/", "\[Eta]f"}], ")"}], "^", 
        RowBox[{"(", 
         RowBox[{"3", "/", "4"}], ")"}]}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Cosh", "[", "\[Alpha]2", "]"}], "+", 
         RowBox[{
          RowBox[{"3", "/", "4"}], " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Eta]fprime", " ", 
             RowBox[{"\[Eta]f", "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "2"}], ")"}]}]}], ")"}], "/", 
           RowBox[{"Sqrt", "[", "QL", "]"}]}], " ", 
          RowBox[{"Sinh", "[", "\[Alpha]2", "]"}]}]}], ")"}]}]}], ";", "\n", 
     RowBox[{"R56", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{"\[Beta]f", " ", "\[Lambda]"}], ")"}]}], "/", 
        RowBox[{"(", 
         RowBox[{"2", "\[Pi]"}], ")"}]}], 
       RowBox[{"L", "/", 
        RowBox[{"(", 
         RowBox[{"dE", " ", 
          RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ")"}]}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"3", "/", "4"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Eta]i", "/", "\[Eta]f"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "4"}], ")"}]}], " ", "\[Eta]fprime"}], "-", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Eta]i", "/", "\[Eta]f"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"3", "/", "4"}], ")"}]}], " ", "\[Eta]iprime"}]}], 
           ")"}], "\[Beta]i", " ", 
          RowBox[{"Cos", "[", "\[Alpha]2", "]"}]}], "-", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"9", "/", "16"}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Eta]iprime", " ", "\[Eta]fprime"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\[Eta]f", "^", 
                 RowBox[{"(", 
                  RowBox[{"1", "/", "4"}], ")"}]}], " ", 
                RowBox[{"\[Eta]i", "^", 
                 RowBox[{"(", 
                  RowBox[{"1", "/", "4"}], ")"}]}]}], ")"}]}], " ", 
             RowBox[{"\[Eta]i", "/", 
              RowBox[{"Sqrt", "[", "QL", "]"}]}]}], "+", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Eta]i", "/", "\[Eta]f"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "4"}], ")"}]}], " ", 
             RowBox[{
              RowBox[{"Sqrt", "[", "QL", "]"}], "/", 
              RowBox[{"\[Eta]f", "^", 
               RowBox[{"(", 
                RowBox[{"1", "/", "2"}], ")"}]}]}]}]}], ")"}], "\[Beta]i", 
          " ", 
          RowBox[{"Sin", "[", "\[Alpha]2", "]"}]}]}], ")"}]}]}], ";", "\n", 
     RowBox[{"R65", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Eta]i", "^", 
         RowBox[{"(", 
          RowBox[{"3", "/", "4"}], ")"}]}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Eta]f", "^", 
           RowBox[{"(", 
            RowBox[{"1", "/", "4"}], ")"}]}], " ", "\[Beta]i", " ", 
          "\[Beta]f"}], ")"}]}], " ", 
       RowBox[{"Sqrt", "[", "QL", "]"}], 
       RowBox[{"Sin", "[", "\[Alpha]2", "]"}]}]}], ";", "\n", 
     RowBox[{"R66", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]i", "/", "\[Eta]f"}], ")"}], "^", 
        RowBox[{"(", 
         RowBox[{"1", "/", "4"}], ")"}]}], " ", 
       RowBox[{"\[Beta]i", "/", "\[Beta]f"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Cos", "[", "\[Alpha]2", "]"}], "-", 
         RowBox[{
          RowBox[{"3", "/", "4"}], " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Eta]i", "^", 
              RowBox[{"(", 
               RowBox[{"1", "/", "2"}], ")"}]}], " ", "\[Eta]iprime"}], ")"}],
            "/", 
           RowBox[{"Sqrt", "[", "QL", "]"}]}], " ", 
          RowBox[{"Sin", "[", "\[Alpha]2", "]"}]}]}], ")"}]}]}], ";", "\n", 
     "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dE", "==", "0"}], ",", 
       RowBox[{"MLCLinearDriftMatrix", "[", "elem", "]"}], ",", "\n", 
       TagBox[
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {"R11", "R12", "0", "0", "0", "0"},
           {"R21", "R22", "0", "0", "0", "0"},
           {"0", "0", "R11", "R12", "0", "0"},
           {"0", "0", "R21", "R22", "0", "0"},
           {"0", "0", "0", "0", "R55", "R56"},
           {"0", "0", "0", "0", "R65", "R66"}
          }], "\[NoBreak]", ")"}],
        Function[BoxForm`e$, 
         MatrixForm[BoxForm`e$]]]}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearMatrix", "[", 
   RowBox[{"elem_", ",", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], ":=", 
  RowBox[{"Switch", "[", 
   RowBox[{
    RowBox[{"elem", "[", 
     RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Drift\>\"", ",", 
    RowBox[{"MLCLinearDriftMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Quadrupole\>\"", ",", 
    RowBox[{"MLCLinearThickQuadrupoleMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Sextupole\>\"", ",", 
    RowBox[{"MLCLinearSextupoleMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Octupole\>\"", ",", 
    RowBox[{"MLCLinearDriftMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<SectorBend\>\"", ",", 
    RowBox[{"MLCLinearSectorBendMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<RectBend\>\"", ",", 
    RowBox[{"MLCLinearRectBendMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Marker\>\"", ",", 
    RowBox[{"MLCLinearMarkerMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<MULTIPOLE\>\"", ",", 
    RowBox[{"MLCLinearMultipoleMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<BPM\>\"", ",", 
    RowBox[{"MLCLinearBPMMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Monitor\>\"", ",", 
    RowBox[{"MLCLinearBPMMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<IMonitor\>\"", ",", 
    RowBox[{"MLCLinearBPMMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Profile\>\"", ",", 
    RowBox[{"MLCLinearBPMMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Wire\>\"", ",", 
    RowBox[{"MLCLinearBPMMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<Kicker\>\"", ",", 
    RowBox[{"MLCLinearKickerMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<HKicker\>\"", ",", 
    RowBox[{"MLCLinearKickerMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<VKicker\>\"", ",", 
    RowBox[{"MLCLinearKickerMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}], ",", "\[IndentingNewLine]", 
    "\"\<RFC\>\"", ",", 
    RowBox[{"MLCLinearRFCCavityMatrix", "[", "elem", "]"}], ",", 
    "\[IndentingNewLine]", "\"\<LCAV\>\"", ",", 
    RowBox[{"MLCLinearRSCavityMatrix", "[", "elem", "]"}], ",", 
    "\[IndentingNewLine]", "\"\<WIGGLER\>\"", ",", 
    RowBox[{"MLCLinearThickWigglerMatrix", "[", "elem", "]"}], ",", 
    "\[IndentingNewLine]", "_", ",", 
    RowBox[{"MLCLinearDriftMatrix", "[", 
     RowBox[{"elem", ",", "\[Gamma]"}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.505719408079615*^9, 3.505719439439994*^9}, {
   3.572941297623766*^9, 3.5729413322332263`*^9}, 3.6023994848271675`*^9, {
   3.6060411000395975`*^9, 3.6060411033519287`*^9}, {3.697988024396344*^9, 
   3.6979880380103445`*^9}},
 Background->None]
}, Open  ]],

Cell[CellGroupData[{

Cell["Optics Commands", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCRMatrices", "[", 
   RowBox[{"lattice_", ",", " ", 
    RowBox[{"\[Gamma]_:", "Infinity"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"MLCLinearMatrix", "[", 
      RowBox[{"#1", ",", " ", "\[Gamma]"}], "]"}], " ", "&"}], " ", ")"}], 
   " ", "/@", " ", 
   RowBox[{"MLCElementList", "[", "lattice", "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCOneTurnRMatrix", "[", "rmatrices_", "]"}], ":=", 
  RowBox[{"Dot", "@@", 
   RowBox[{"Reverse", "[", "rmatrices", "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCStability", "[", "oneturnmatrix_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"oneturnmatrix", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
         RowBox[{"oneturnmatrix", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}], "<", "2"}], ",", 
      "True", ",", "False"}], "]"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"oneturnmatrix", "[", 
          RowBox[{"[", 
           RowBox[{"3", ",", "3"}], "]"}], "]"}], "+", 
         RowBox[{"oneturnmatrix", "[", 
          RowBox[{"[", 
           RowBox[{"4", ",", "4"}], "]"}], "]"}]}], "]"}], "<", "2"}], ",", 
      "True", ",", "False"}], "]"}]}], "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCFindPeriodicPhase", "[", "M_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ArcCos", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], "/", "2"}], "]"}], 
    ",", 
    RowBox[{"ArcCos", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "3"}], "]"}], "]"}], "+", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "4"}], "]"}], "]"}]}], ")"}], "/", "2"}], "]"}]}],
    "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCFindPeriodicTwiss", "[", "M_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\[Beta]x", ",", "\[Alpha]x", ",", "\[Gamma]x", ",", "\[Beta]y", ",", 
      "\[Alpha]y", ",", "\[Gamma]y", ",", "\[Mu]x", ",", "\[Mu]y"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Mu]x", ",", "\[Mu]y"}], "}"}], "=", 
      RowBox[{"MLCFindPeriodicPhase", "[", "M", "]"}]}], ";", 
     RowBox[{"\[Beta]x", "=", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
       RowBox[{"Sin", "[", "\[Mu]x", "]"}]}]}], ";", 
     RowBox[{"\[Alpha]x", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"M", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
         RowBox[{"M", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", " ", 
         RowBox[{"Sin", "[", "\[Mu]x", "]"}]}], ")"}]}]}], ";", 
     RowBox[{"\[Gamma]x", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"\[Alpha]x", "^", "2"}]}], ")"}], "/", "\[Beta]x"}]}], ";", 
     RowBox[{"\[Beta]y", "=", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", 
         RowBox[{"3", ",", "4"}], "]"}], "]"}], "/", 
       RowBox[{"Sin", "[", "\[Mu]y", "]"}]}]}], ";", 
     RowBox[{"\[Alpha]y", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"M", "[", 
          RowBox[{"[", 
           RowBox[{"3", ",", "3"}], "]"}], "]"}], "-", 
         RowBox[{"M", "[", 
          RowBox[{"[", 
           RowBox[{"4", ",", "4"}], "]"}], "]"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", " ", 
         RowBox[{"Sin", "[", "\[Mu]y", "]"}]}], ")"}]}]}], ";", 
     RowBox[{"\[Gamma]y", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"\[Alpha]y", "^", "2"}]}], ")"}], "/", "\[Beta]y"}]}], ";", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Abs", "[", "\[Beta]x", "]"}], ",", 
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{"M", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], "]"}], "\[Alpha]x"}], ",", 
         RowBox[{
          RowBox[{"Sign", "[", "\[Beta]x", "]"}], "\[Gamma]x"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Abs", "[", "\[Beta]y", "]"}], ",", 
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{"M", "[", 
            RowBox[{"[", 
             RowBox[{"3", ",", "4"}], "]"}], "]"}], "]"}], "\[Alpha]y"}], ",", 
         RowBox[{
          RowBox[{"Sign", "[", "\[Beta]y", "]"}], "\[Gamma]y"}]}], "}"}]}], 
      "}"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCFindPeriodicDispersion", "[", "M_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "6"}], "]"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "6"}], "]"}], "]"}]}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", " ", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "6"}], "]"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"4", ",", "4"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "6"}], "]"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "4"}], "]"}], "]"}], " ", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "6"}], "]"}], "]"}]}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"4", ",", "4"}], "]"}], "]"}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "3"}], "]"}], "]"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "4"}], "]"}], "]"}]}]}], ")"}]}], ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", " ", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "6"}], "]"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "3"}], "]"}], "]"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "6"}], "]"}], "]"}]}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ")"}], 
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"4", ",", "4"}], "]"}], "]"}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "3"}], "]"}], "]"}], 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "4"}], "]"}], "]"}]}]}], ")"}]}], ",", "0", ",", 
    "1"}], "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTwissVectorToMatrix", "[", "V_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"V", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"-", 
       RowBox[{"V", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"V", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", 
      RowBox[{"V", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTwissMatrixToVector", "[", "T_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"T", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
    RowBox[{"-", 
     RowBox[{"T", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
    RowBox[{"T", "[", 
     RowBox[{"[", 
      RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGenerateSinglePlaneRMatrices", "[", "M_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "4"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "3"}], "]"}], "]"}], ",", 
        RowBox[{"M", "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "4"}], "]"}], "]"}]}], "}"}]}], "}"}]}], 
   "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateTwissMatrix", "[", 
   RowBox[{"T_", ",", "R_"}], "]"}], ":=", 
  RowBox[{"R", ".", "T", ".", 
   RowBox[{"Transpose", "[", "R", "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReverseDot", "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
  RowBox[{"Dot", "[", 
   RowBox[{"b", ",", "a"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCCumulativeRMatrices", "[", "rmatrices_", "]"}], ":=", 
  RowBox[{"FoldList", "[", 
   RowBox[{"ReverseDot", ",", 
    RowBox[{"IdentityMatrix", "[", "6", "]"}], ",", "rmatrices"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTransportCompose", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"RA_", ",", "TA_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"RB_", ",", "TB_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"RB", ".", "RA"}], ",", 
    RowBox[{
     RowBox[{"RB", ".", "TA"}], "+", 
     RowBox[{"Transpose", "[", 
      RowBox[{"Expand", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", "RA", "]"}], ".", 
        RowBox[{"Transpose", "[", "TB", "]"}], ".", "RA"}], "]"}], "]"}]}]}], 
   "}"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCOneTurnRTMatrices", "[", 
   RowBox[{"rmatrices_", ",", "tmatrices_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Fold", "[", 
     RowBox[{"MLCTransportCompose", ",", 
      RowBox[{"First", "[", "#", "]"}], ",", 
      RowBox[{"Rest", "[", "#", "]"}]}], "]"}], "&"}], "[", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"rmatrices", ",", "tmatrices"}], "}"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCCumulativeRTMatrices", "[", 
   RowBox[{"rmatrices_", ",", "tmatrices_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"FoldList", "[", 
     RowBox[{"MLCTransportCompose", ",", 
      RowBox[{"First", "[", "#", "]"}], ",", 
      RowBox[{"Rest", "[", "#", "]"}]}], "]"}], "&"}], "[", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"rmatrices", ",", "tmatrices"}], "}"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTransport", "[", 
   RowBox[{"x_", ",", 
    RowBox[{"{", 
     RowBox[{"R_", ",", "T_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      UnderoverscriptBox["\[Sum]", 
       RowBox[{"k", "=", "1"}], "6"], 
      RowBox[{
       RowBox[{"R", "[", 
        RowBox[{"[", 
         RowBox[{"j", ",", "k"}], "]"}], "]"}], 
       RowBox[{"x", "[", 
        RowBox[{"[", "k", "]"}], "]"}]}]}], "+", 
     RowBox[{
      UnderoverscriptBox["\[Sum]", 
       RowBox[{"k", "=", "1"}], "6"], 
      RowBox[{
       UnderoverscriptBox["\[Sum]", 
        RowBox[{"l", "=", "1"}], "6"], 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"[", 
          RowBox[{"j", ",", "k", ",", "l"}], "]"}], "]"}], 
        RowBox[{"x", "[", 
         RowBox[{"[", "k", "]"}], "]"}], 
        RowBox[{"x", "[", 
         RowBox[{"[", "l", "]"}], "]"}]}]}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "1", ",", "6"}], "}"}]}], "]"}]}]], "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.572941449898992*^9, 3.5729414518661885`*^9}, 
   3.572941548221823*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTransport", "[", 
   RowBox[{"x_", ",", 
    RowBox[{"{", 
     RowBox[{"R_", ",", "T_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"R", "[", 
         RowBox[{"[", 
          RowBox[{"j", ",", "k"}], "]"}], "]"}], 
        RowBox[{"x", "[", 
         RowBox[{"[", "k", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", "6"}], "}"}]}], "]"}], "+", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"[", 
            RowBox[{"j", ",", "k", ",", "l"}], "]"}], "]"}], 
          RowBox[{"x", "[", 
           RowBox[{"[", "k", "]"}], "]"}], 
          RowBox[{"x", "[", 
           RowBox[{"[", "l", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"l", ",", "1", ",", "6"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", "6"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "1", ",", "6"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.572941449898992*^9, 3.5729414518661885`*^9}, {
  3.5729414913091326`*^9, 3.572941542959297*^9}}],

Cell["\<\
MLCReverseCumulativeRMatrices calculates a list of cumulative Rs, each cumR \
being that from a particular location TO the end of the line, rather than the \
cumR from the start to that point. The output list starts from S = 0. For any \
particular location s, \
MLCReverseCumulativeRMatrices[r][[s].MLCCumulativeRMatrices[r][[s] = \
MLCOneTurnRMatrix[r].\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCReverseCumulativeRMatrices", "[", "rmatrices_", "]"}], ":=", 
  RowBox[{"Reverse", "[", 
   RowBox[{"FoldList", "[", 
    RowBox[{"Dot", ",", 
     RowBox[{"IdentityMatrix", "[", "6", "]"}], ",", 
     RowBox[{"Reverse", "[", "rmatrices", "]"}]}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateTwissPhaseVector", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\[Beta]x_", ",", "\[Alpha]x_", ",", "\[Gamma]x_", ",", "\[Beta]y_", ",",
       "\[Alpha]y_", ",", "\[Gamma]y_", ",", "mux_", ",", "muy_"}], "}"}], 
    ",", "M_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "rx", ",", "ry", ",", "twissxout", ",", "twissyout", ",", "muxout", ",", 
      "muyout"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"rx", ",", "ry"}], "}"}], "=", 
      RowBox[{"MLCGenerateSinglePlaneRMatrices", "[", "M", "]"}]}], ";", "\n", 
     RowBox[{"twissxout", "=", 
      RowBox[{"MLCTwissMatrixToVector", "[", 
       RowBox[{"MLCPropagateTwissMatrix", "[", 
        RowBox[{
         RowBox[{"MLCTwissVectorToMatrix", "[", 
          RowBox[{"{", 
           RowBox[{"\[Beta]x", ",", "\[Alpha]x", ",", "\[Gamma]x"}], "}"}], 
          "]"}], ",", "rx"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"twissyout", "=", 
      RowBox[{"MLCTwissMatrixToVector", "[", 
       RowBox[{"MLCPropagateTwissMatrix", "[", 
        RowBox[{
         RowBox[{"MLCTwissVectorToMatrix", "[", 
          RowBox[{"{", 
           RowBox[{"\[Beta]y", ",", "\[Alpha]y", ",", "\[Gamma]y"}], "}"}], 
          "]"}], ",", "ry"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"muxout", "=", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Negative", "[", 
          RowBox[{
           RowBox[{"\[Beta]x", " ", 
            RowBox[{"rx", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "-", 
           RowBox[{"\[Alpha]x", " ", 
            RowBox[{"rx", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "]"}], ",", "\[Pi]", 
         ",", "0"}], "]"}], "+", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{"rx", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[Beta]x", " ", 
            RowBox[{"rx", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "-", 
           RowBox[{"\[Alpha]x", " ", 
            RowBox[{"rx", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], "]"}], "+", 
       "mux"}]}], ";", "\n", 
     RowBox[{"muyout", "=", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Negative", "[", 
          RowBox[{
           RowBox[{"\[Beta]y", " ", 
            RowBox[{"ry", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "-", 
           RowBox[{"\[Alpha]y", " ", 
            RowBox[{"ry", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "]"}], ",", "\[Pi]", 
         ",", "0"}], "]"}], "+", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{"ry", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[Beta]y", " ", 
            RowBox[{"ry", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "-", 
           RowBox[{"\[Alpha]y", " ", 
            RowBox[{"ry", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], "]"}], "+", 
       "muy"}]}], ";", "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"muxout", "=", 
        RowBox[{
         RowBox[{"ArcSin", "[", 
          RowBox[{
           RowBox[{"rx", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"\[Beta]x", " ", 
             RowBox[{"twissxout", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], "+", 
         "mux"}]}], ";", "\n", 
       RowBox[{"muyout", "=", 
        RowBox[{
         RowBox[{"ArcSin", "[", 
          RowBox[{
           RowBox[{"ry", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"\[Beta]y", " ", 
             RowBox[{"twissyout", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], "+", 
         "muy"}]}], ";"}], "*)"}], "\n", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"twissxout", ",", "twissyout", ",", "muxout", ",", "muyout"}], 
       "}"}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.4183916988776903`*^9, {3.4184505398926663`*^9, 3.4184505580646577`*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTwissOperator", "[", "M_", "]"}], ":=", 
  RowBox[{
   RowBox[{"MLCPropagateTwissPhaseVector", "[", 
    RowBox[{"#", ",", "M"}], "]"}], "&"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateTwiss", "[", 
   RowBox[{"v_", ",", "rmatrices_"}], "]"}], ":=", 
  RowBox[{"Rest", "[", 
   RowBox[{"ComposeList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"MLCTwissOperator", "[", "#", "]"}], "&"}], "/@", 
      "rmatrices"}], ",", "v"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateDispersion", "[", 
   RowBox[{"dispersionvector_", ",", "rmatrices_"}], "]"}], ":=", 
  RowBox[{"Rest", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Dot", "[", 
      RowBox[{"#", ",", "dispersionvector"}], "]"}], "&"}], "/@", 
    RowBox[{"MLCCumulativeRMatrices", "[", "rmatrices", "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGenerateTwissTable", "[", 
   RowBox[{
   "lattice_", ",", "twissvector_", ",", "phasevector_", ",", 
    "dispersionvector_", ",", "opts___"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Global`AssignVariables", "/.", 
      RowBox[{"{", "opts", "}"}]}], "/.", 
     RowBox[{"{", 
      RowBox[{"Global`AssignVariables", "\[Rule]", "True"}], "}"}]}], ",", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"MLCElems", "=", 
           RowBox[{
            RowBox[{"MLCElementList", "[", 
             RowBox[{"{", "lattice", "}"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
          RowBox[{"MLCS", "=", 
           RowBox[{"MADGetLengths", "[", 
            RowBox[{"{", "lattice", "}"}], "]"}]}], ",", 
          RowBox[{"MLCBETX", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"MLCALFX", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{"MLCGAMX", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ",", 
          RowBox[{"MLCBETY", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ",", 
          RowBox[{"MLCALFY", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], ",", 
          RowBox[{"MLCGAMY", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "6", "]"}], "]"}]}], ",", 
          RowBox[{"MLCMUX", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "7", "]"}], "]"}]}], ",", 
          RowBox[{"MLCMUY", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "8", "]"}], "]"}]}]}], "}"}], "&"}], "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"MLCPropagateTwiss", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"twissvector", ",", "phasevector"}], "}"}], "]"}], ",", 
             RowBox[{"MLCRMatrices", "[", 
              RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], ",", 
          "8"}], "]"}], "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"MLCDX", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"MLCDPX", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{"MLCDY", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ",", 
          RowBox[{"MLCDPY", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "5", "]"}], "]"}]}]}], "}"}], "&"}], "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"MLCPropagateDispersion", "[", 
         RowBox[{"dispersionvector", ",", 
          RowBox[{"MLCRMatrices", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], "]"}]}], 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"MLCElementList", "[", 
            RowBox[{"{", "lattice", "}"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"MADGetLengths", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "6", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "7", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "8", "]"}], "]"}]}], "}"}], "&"}], "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"MLCPropagateTwiss", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"twissvector", ",", "phasevector"}], "}"}], "]"}], ",", 
             RowBox[{"MLCRMatrices", "[", 
              RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], ",", 
          "8"}], "]"}], "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "5", "]"}], "]"}]}], "}"}], "&"}], "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"MLCPropagateDispersion", "[", 
         RowBox[{"dispersionvector", ",", 
          RowBox[{"MLCRMatrices", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], "]"}]}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4758498998810225`*^9, 3.4758499694435225`*^9}, {
  3.475906353080079*^9, 3.4759063552051744`*^9}},
 Background->None],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "MLCElems", ",", "MLCS", ",", "MLCBETX", ",", "MLCALFX", ",", "MLCGAMX", 
   ",", "MLCBETY", ",", "MLCALFY", ",", "MLCGAMY", ",", "MLCMUX", ",", 
   "MLCMUY", ",", "MLCDX", ",", "MLCDPX", ",", "MLCDY", ",", "MLCDPY"}], 
  "}"}]], "Input",
 CellChangeTimes->{{3.475906463628997*^9, 3.4759065079576893`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGeneratePeriodicTwissTable", "[", "lattice_", "]"}], ":=", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MLCElems", "=", 
         RowBox[{
          RowBox[{"MLCElementList", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
        RowBox[{"MLCS", "=", 
         RowBox[{"MADGetLengths", "[", 
          RowBox[{"{", "lattice", "}"}], "]"}]}], ",", 
        RowBox[{"MLCBETX", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"MLCALFX", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", 
        RowBox[{"MLCGAMX", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ",", 
        RowBox[{"MLCBETY", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}], ",", 
        RowBox[{"MLCALFY", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], ",", 
        RowBox[{"MLCGAMY", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "6", "]"}], "]"}]}], ",", 
        RowBox[{"MLCMUX", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "7", "]"}], "]"}]}], ",", 
        RowBox[{"MLCMUY", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "8", "]"}], "]"}]}]}], "}"}], "&"}], "[", 
     RowBox[{"Transpose", "[", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MLCPropagateTwiss", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"MLCFindPeriodicTwiss", "[", 
               RowBox[{"MLCOneTurnRMatrix", "[", 
                RowBox[{"MLCRMatrices", "[", 
                 RowBox[{"{", "lattice", "}"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"0.0", ",", "0.0"}], "}"}]}], "}"}], "]"}], ",", 
           RowBox[{"MLCRMatrices", "[", 
            RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], ",", "8"}], 
       "]"}], "]"}], "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MLCDX", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"MLCDPX", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", 
        RowBox[{"MLCDY", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}], ",", 
        RowBox[{"MLCDPY", "=", 
         RowBox[{"#", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}]}], "}"}], "&"}], "[", 
     RowBox[{"Transpose", "[", 
      RowBox[{"MLCPropagateDispersion", "[", 
       RowBox[{
        RowBox[{"MLCFindPeriodicDispersion", "[", 
         RowBox[{"MLCOneTurnRMatrix", "[", 
          RowBox[{"MLCRMatrices", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"MLCRMatrices", "[", 
         RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", "lattice_", "]"}], ":=", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MLCElems", "=", 
         RowBox[{
          RowBox[{"MLCElementList", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
        RowBox[{"MADGetLengths", "[", 
         RowBox[{"{", "lattice", "}"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "4", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "5", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "6", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "7", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "8", "]"}], "]"}]}], "}"}], "&"}], "[", 
     RowBox[{"Transpose", "[", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MLCPropagateTwiss", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"MLCFindPeriodicTwiss", "[", 
               RowBox[{"MLCOneTurnRMatrix", "[", 
                RowBox[{"MLCRMatrices", "[", 
                 RowBox[{"{", "lattice", "}"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"0.0", ",", "0.0"}], "}"}]}], "}"}], "]"}], ",", 
           RowBox[{"MLCRMatrices", "[", 
            RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], ",", "8"}], 
       "]"}], "]"}], "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "4", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], "}"}], "&"}], "[", 
     RowBox[{"Transpose", "[", 
      RowBox[{"MLCPropagateDispersion", "[", 
       RowBox[{
        RowBox[{"MLCFindPeriodicDispersion", "[", 
         RowBox[{"MLCOneTurnRMatrix", "[", 
          RowBox[{"MLCRMatrices", "[", 
           RowBox[{"{", "lattice", "}"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"MLCRMatrices", "[", 
         RowBox[{"{", "lattice", "}"}], "]"}]}], "]"}], "]"}], "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateRay", "[", 
   RowBox[{"v_", ",", "rmatrices_"}], "]"}], ":=", 
  RowBox[{"Rest", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Dot", "[", 
      RowBox[{"#", ",", "v"}], "]"}], "&"}], "/@", 
    RowBox[{"MLCCumulativeRMatrices", "[", "rmatrices", "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCTwissOperator", "[", "M_", "]"}], ":=", 
  RowBox[{
   RowBox[{"MLCPropagateTwissPhaseVector", "[", 
    RowBox[{"#", ",", "M"}], "]"}], "&"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateTwiss", "[", 
   RowBox[{"v_", ",", "rmatrices_"}], "]"}], ":=", 
  RowBox[{"Rest", "[", 
   RowBox[{"ComposeList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"MLCTwissOperator", "[", "#", "]"}], "&"}], "/@", 
      "rmatrices"}], ",", "v"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DotOperator", "[", "M_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Dot", "[", 
    RowBox[{"M", ",", "#"}], "]"}], "&"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCRetardNonParaxialRay", "[", 
   RowBox[{"v_", ",", "L_"}], "]"}], ":=", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"v", ",", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"[", "5", "]"}], "]"}], "-", 
     RowBox[{"L", "  ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "+", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "^", "2"}]}], ")"}], "/", 
       "2"}]}]}], ",", "5"}], "]"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "need", " ", "to", " ", "think", " ", "whether", " ", "this", " ", "is"}],
     " ", "-", 
    RowBox[{"L", " ", "or"}], " ", "+", "L"}], "*)"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateAndRetardOperator", "[", "arg_", "]"}], ":=", 
  RowBox[{
   RowBox[{"MLCRetardNonParaxialRay", "[", 
    RowBox[{
     RowBox[{"Dot", "[", 
      RowBox[{
       RowBox[{"arg", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "]"}], ",", 
     RowBox[{"arg", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"this", " ", "command", " ", "operates", " ", "R"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"arg", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "and", " ", "L"}], "=", 
     RowBox[{
      RowBox[{"arg", "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "on", " ", "a", " ", "ray", " ", 
      "v"}]}]}], "*)"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPropagateNonParaxialRay", "[", 
   RowBox[{"v_", ",", "rmatrices_", ",", "elemlengths_"}], "]"}], ":=", 
  RowBox[{"Rest", "[", 
   RowBox[{"ComposeList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"MLCPropagateAndRetardOperator", "[", "#", "]"}], "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"rmatrices", ",", "elemlengths"}], "}"}], "]"}]}], ",", "v"}],
     "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCBetaGamma", "[", 
   RowBox[{"beta_", ",", "alpha_"}], "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"beta", ",", "alpha", ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"alpha", "^", "2"}]}], ")"}], "/", "beta"}]}], 
   "}"}]}]], "Input",
 InitializationCell->True,
 Background->None]
}, Open  ]],

Cell[CellGroupData[{

Cell["Beam Distribution Commands", "Subsubsection"],

Cell["\<\
For each particle, which is drawn from distributions in each coordinate which \
are Gaussian, i.e. each particle has normalised coords e={G[Sqrt[Subscript[\
\[Epsilon], x]]],G[Sqrt[Subscript[\[Epsilon], \
x]]],G[Sqrt[Subscript[\[Epsilon], y]]],G[Sqrt[Subscript[\[Epsilon], y]]],G[\
\[Delta]p],G[ct]}, we generate the real coordinate according to the \
transformation below. This is basically the system used in MERLIN. Note that \
emittances are the sigma values, so if you truncate the distribution to a \
small number of sigmas then the measured emittances from the real particle \
distribution will be slightly smaller than the emittance value used to \
generate the distribution.\
\>", "Text",
 CellChangeTimes->{3.4487934469866786`*^9}],

Cell[BoxData[
 RowBox[{
  TagBox[
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"1", "0", "0", "0", "0", "Dx"},
      {"0", "1", "0", "0", "0", "Dpx"},
      {"0", "0", "1", "0", "0", "Dy"},
      {"0", "0", "0", "1", "0", "Dpy"},
      {"0", "0", "0", "0", "1", "0"},
      {"0", "0", "0", "0", "0", "1"}
     },
     GridBoxAlignment->{
      "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
       "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
   Function[BoxForm`e$, 
    MatrixForm[BoxForm`e$]]], ".", 
  TagBox[
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {
       SqrtBox["\[Beta]x"], "0", "0", "0", "0", "0"},
      {"0", 
       SqrtBox[
        FractionBox["1", "\[Beta]x"]], "0", "0", "0", "0"},
      {"0", "0", 
       SqrtBox["\[Beta]y"], "0", "0", "0"},
      {"0", "0", "0", 
       SqrtBox[
        FractionBox["1", "\[Beta]y"]], "0", "0"},
      {"0", "0", "0", "0", "1", "0"},
      {"0", "0", "0", "0", "0", "1"}
     },
     GridBoxAlignment->{
      "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
       "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
   Function[BoxForm`e$, 
    MatrixForm[BoxForm`e$]]], ".", 
  TagBox[
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"1", "0", "0", "0", "0", "0"},
      {
       RowBox[{"-", "\[Alpha]x"}], "1", "0", "0", "0", "0"},
      {"0", "0", "1", "0", "0", "0"},
      {"0", "0", 
       RowBox[{"-", "\[Alpha]y"}], "1", "0", "0"},
      {"0", "0", "0", "0", "1", "0"},
      {"0", "0", "0", "0", "0", "1"}
     },
     GridBoxAlignment->{
      "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
       "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
   Function[BoxForm`e$, 
    MatrixForm[BoxForm`e$]]], ".", "e"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGenerateBeamDistribution6D", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"emittancex_", ",", "emittancey_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"espread_", ",", "blength_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "\[Beta]x_", ",", "\[Alpha]x_", ",", "\[Beta]y_", ",", "\[Alpha]y_"}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"Dx_", ",", "Dpx_", ",", "Dy_", ",", "Dpy_"}], "}"}], ",", 
     "nparticles_", ",", "nsigma_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       TagBox[
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {
            SqrtBox["\[Beta]x"], "0", "0", "0", "0", "Dx"},
           {
            RowBox[{
             RowBox[{"-", "\[Alpha]x"}], " ", 
             SqrtBox[
              FractionBox["1", "\[Beta]x"]]}], 
            SqrtBox[
             FractionBox["1", "\[Beta]x"]], "0", "0", "0", "Dpx"},
           {"0", "0", 
            SqrtBox["\[Beta]y"], "0", "0", "Dy"},
           {"0", "0", 
            RowBox[{
             RowBox[{"-", "\[Alpha]y"}], " ", 
             SqrtBox[
              FractionBox["1", "\[Beta]y"]]}], 
            SqrtBox[
             FractionBox["1", "\[Beta]y"]], "0", "Dpy"},
           {"0", "0", "0", "0", "1", "0"},
           {"0", "0", "0", "0", "0", "1"}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
        Function[BoxForm`e$, 
         MatrixForm[BoxForm`e$]]], ".", "#"}], ")"}], "&"}], "/@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"TruncatedGaussianSample", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "emittancex", "]"}], ",", "nsigma"}], "]"}], 
        ",", 
        RowBox[{"TruncatedGaussianSample", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "emittancex", "]"}], ",", "nsigma"}], "]"}], 
        ",", 
        RowBox[{"TruncatedGaussianSample", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "emittancex", "]"}], ",", "nsigma"}], "]"}], 
        ",", 
        RowBox[{"TruncatedGaussianSample", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "emittancey", "]"}], ",", "nsigma"}], "]"}], 
        ",", 
        RowBox[{"TruncatedGaussianSample", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "espread", "]"}], ",", "nsigma"}], "]"}], ",", 
        RowBox[{"TruncatedGaussianSample", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "blength", "]"}], ",", "nsigma"}], "]"}]}], 
       "}"}], ",", 
      RowBox[{"{", "nparticles", "}"}]}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "a", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mypoints", "=", 
   RowBox[{"MLCGenerateBeamDistribution6D", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.01", ",", "0.01"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.01", ",", "0.01"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", "1000", ",", 
     "4"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"<<", "madtomma`madinput`madinput`"}]], "Input"],

Cell[BoxData[
 RowBox[{"mfsPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"mypoints", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
      RowBox[{"mypoints", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], "}"}], ",", 
   RowBox[{"PlotJoined", "->", "False"}]}], "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Plot Commands", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPlot", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", "ListPlot"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCPlotPeriodicOptics", "[", 
   RowBox[{"lattice_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"nslices", ",", "elemlist"}], "}"}], ",", 
    RowBox[{
     RowBox[{"nslices", "=", 
      RowBox[{
       RowBox[{"Slices", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Slices", "->", "1"}], "}"}]}]}], ";", 
     RowBox[{"elemlist", "=", 
      RowBox[{"MADSplitElements", "[", 
       RowBox[{"lattice", ",", "nslices"}], "]"}]}], ";", 
     RowBox[{"MLCGeneratePeriodicTwissTable", "[", "elemlist", "]"}], ";", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"MADDraw", "[", 
        RowBox[{"lattice", ",", 
         RowBox[{"Labels", "->", "False"}], ",", 
         RowBox[{"Lengths", "->", "False"}], ",", 
         RowBox[{"WidthScale", "->", 
          RowBox[{"Ceiling", "[", 
           RowBox[{"0.2`", " ", 
            RowBox[{"Max", "[", 
             RowBox[{"{", 
              RowBox[{"MLCBETX", ",", "MLCBETY", ",", 
               RowBox[{"10", " ", "MLCDX"}]}], "}"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"Thick", "->", "0.002`"}], ",", 
         RowBox[{"Imagesize", "->", "600"}], ",", 
         RowBox[{"Fontsize", "->", "10"}], ",", 
         RowBox[{"Bends", "->", "False"}], ",", 
         RowBox[{"Offset", "->", 
          RowBox[{"5.5`", " ", 
           RowBox[{"Ceiling", "[", 
            RowBox[{"0.2`", " ", 
             RowBox[{"Max", "[", 
              RowBox[{"{", 
               RowBox[{"MLCBETX", ",", "MLCBETY", ",", 
                RowBox[{"10", " ", "MLCDX"}]}], "}"}], "]"}]}], "]"}]}]}], 
         ",", 
         RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}], ",", 
       RowBox[{"mfsPlot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"MLCS", ",", "MLCBETX"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"MLCS", ",", "MLCBETY"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"MLCS", ",", 
             RowBox[{"10", " ", "MLCDX"}]}], "}"}]}], "}"}], ",", 
         RowBox[{"DisplayFunction", "->", "Identity"}], ",", "opts"}], "]"}], 
       ",", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"Text", "[", 
           RowBox[{"\"\<\!\(\*SubscriptBox[\(\[Beta]\), \(x\)]\)\>\"", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"MLCS", "[", 
               RowBox[{"[", 
                RowBox[{"First", "[", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Position", "[", 
                   RowBox[{"MLCS", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", 
                    RowBox[{
                    RowBox[{"Last", "[", "MLCS", "]"}], " ", "0.1`"}]}], 
                    "&"}], ")"}]}]}], "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"MLCBETX", "[", 
                RowBox[{"[", 
                 RowBox[{"First", "[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Position", "[", 
                    RowBox[{"MLCS", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", 
                    RowBox[{
                    RowBox[{"Last", "[", "MLCS", "]"}], " ", "0.1`"}]}], 
                    "&"}], ")"}]}]}], "]"}], "]"}], "]"}], "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"Max", "[", "MLCBETX", "]"}], " ", "0.1`"}]}]}], 
             "}"}]}], "]"}], ",", "Blue", ",", 
          RowBox[{"Text", "[", 
           RowBox[{"\"\<\!\(\*SubscriptBox[\(\[Beta]\), \(y\)]\)\>\"", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"MLCS", "[", 
               RowBox[{"[", 
                RowBox[{"First", "[", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Position", "[", 
                   RowBox[{"MLCS", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", 
                    RowBox[{
                    RowBox[{"Last", "[", "MLCS", "]"}], " ", "0.2`"}]}], 
                    "&"}], ")"}]}]}], "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"MLCBETY", "[", 
                RowBox[{"[", 
                 RowBox[{"First", "[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Position", "[", 
                    RowBox[{"MLCS", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", 
                    RowBox[{
                    RowBox[{"Last", "[", "MLCS", "]"}], " ", "0.2`"}]}], 
                    "&"}], ")"}]}]}], "]"}], "]"}], "]"}], "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"Max", "[", "MLCBETY", "]"}], " ", "0.1`"}]}]}], 
             "}"}]}], "]"}], ",", "Black", ",", 
          RowBox[{"Text", "[", 
           RowBox[{"\"\<\!\(\*SubscriptBox[\(\[Eta]\), \(x\)]\)\>\"", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"MLCS", "[", 
               RowBox[{"[", 
                RowBox[{"First", "[", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Position", "[", 
                   RowBox[{"MLCS", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", 
                    RowBox[{
                    RowBox[{"Last", "[", "MLCS", "]"}], " ", "0.3`"}]}], 
                    "&"}], ")"}]}]}], "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"10", " ", 
                RowBox[{"MLCDX", "[", 
                 RowBox[{"[", 
                  RowBox[{"First", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"MLCS", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", 
                    RowBox[{
                    RowBox[{"Last", "[", "MLCS", "]"}], " ", "0.3`"}]}], 
                    "&"}], ")"}]}]}], "]"}], "]"}], "]"}], "]"}], "]"}]}], 
               "+", 
               RowBox[{"Max", "[", "MLCDX", "]"}]}]}], "}"}]}], "]"}]}], 
         "}"}], "]"}], ",", 
       RowBox[{"ImageSize", "->", 
        RowBox[{"{", 
         RowBox[{"600", ",", "400"}], "}"}]}], ",", 
       RowBox[{"PlotRange", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "MLCS", "]"}], ",", 
            RowBox[{"Last", "[", "MLCS", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"5", " ", 
             RowBox[{"Floor", "[", 
              RowBox[{"0.2`", " ", 
               RowBox[{"Min", "[", 
                RowBox[{"{", 
                 RowBox[{"MLCBETX", ",", "MLCBETY", ",", 
                  RowBox[{"10", " ", "MLCDX"}]}], "}"}], "]"}]}], "]"}]}], 
            ",", 
            RowBox[{"6", " ", 
             RowBox[{"Ceiling", "[", 
              RowBox[{"0.2`", " ", 
               RowBox[{"Max", "[", 
                RowBox[{"{", 
                 RowBox[{"MLCBETX", ",", "MLCBETY", ",", 
                  RowBox[{"10", " ", "MLCDX"}]}], "}"}], "]"}]}], "]"}]}]}], 
           "}"}]}], "}"}]}], ",", 
       RowBox[{"Frame", "->", "True"}], ",", 
       RowBox[{"DisplayFunction", "->", "$DisplayFunction"}], ",", 
       RowBox[{"BaseStyle", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FontFamily", "->", "\"\<Times\>\""}], ",", 
          RowBox[{"FontSize", "->", "18"}]}], "}"}]}], ",", 
       RowBox[{"FrameLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<s [m]\>\"", ",", "\"\<Optical Functions [m]\>\""}], 
         "}"}]}]}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4487934863767996`*^9, 3.4487935136108737`*^9}},
 Background->None]
}, Closed]],

Cell[CellGroupData[{

Cell["Looking at Matrices", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCMatrixInspect", "[", "M_", "]"}], ":=", 
  RowBox[{"BarChart3D", "[", 
   RowBox[{"M", ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "2.360"}], ",", 
       RowBox[{"-", "2.220"}], ",", "0.975"}], "}"}]}], ",", 
    RowBox[{"XSpacing", "->", 
     RowBox[{"1", "/", "2"}]}], ",", 
    RowBox[{"YSpacing", "->", 
     RowBox[{"1", "/", "2"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Synchrotron Radiation Integrals - only works for circular machines\
\>", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"integralSRI1", "[", 
   RowBox[{
   "kx_", ",", "s_", ",", "h_", ",", "dx_", ",", "dpx_", ",", "\[Beta]2_", 
    ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kx", "==", "0"}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"h", " ", 
            RowBox[{"l", "^", "2"}]}], ")"}], "/", "2"}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"h", " ", 
            RowBox[{"(", 
             RowBox[{"1", "-", 
              RowBox[{"Cos", "[", 
               RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], ")"}], "/", 
          RowBox[{"kx", "^", "2"}]}]}], "]"}], "+", 
       RowBox[{"dpx", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"kx", "==", "0"}], ",", "l", ",", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], "+", 
       RowBox[{"dx", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"kx", " ", "l"}], "]"}], "+", 
          RowBox[{"h", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"kx", "==", "0"}], ",", "l", ",", 
             RowBox[{
              RowBox[{"Sin", "[", 
               RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], " ", 
           RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}], "/", 
     "\[Rho]"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}], ",", 
    RowBox[{"Compiled", "->", "True"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI1", "[", "latt_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L"}],
      "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"\[Rho]", "=", 
            RowBox[{"L", "/", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
           RowBox[{"n", "=", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
             RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
           RowBox[{"h", "=", 
            RowBox[{"1", "/", "\[Rho]"}]}], ";", 
           RowBox[{"kx", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
           RowBox[{"ky", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
           RowBox[{"integralSRI1", "[", 
            RowBox[{"kx", ",", "L", ",", "h", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "\[Rho]"}], 
            "]"}]}], ")"}], "&"}], "/@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"SR2Element", "[", "elem_", "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"elem", "[", 
        RowBox[{"[", "6", "]"}], "]"}], "/", 
       RowBox[{"elem", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ")"}], "^", "2"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI2", "[", "latt_", "]"}], ":=", 
  RowBox[{"Plus", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"SR2Element", "[", "#", "]"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
         "&"}]}], "]"}], ")"}]}], ")"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"SR3Element", "[", "elem_", "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"elem", "[", 
         RowBox[{"[", "6", "]"}], "]"}], "/", 
        RowBox[{"elem", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ")"}], "^", "3"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", 
      RowBox[{"elem", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI3", "[", "latt_", "]"}], ":=", 
  RowBox[{"Plus", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"SR3Element", "[", "#", "]"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
         "&"}]}], "]"}], ")"}]}], ")"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"integralSRI4", "[", 
   RowBox[{
   "kx_", ",", "s_", ",", "h_", ",", "dx_", ",", "dpx_", ",", "\[Beta]2_", 
    ",", "n_", ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"2", "n"}]}], ")"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"kx", "==", "0"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"h", " ", 
             RowBox[{"l", "^", "2"}]}], ")"}], "/", "2"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"h", " ", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], ")"}], "/", 
           RowBox[{"kx", "^", "2"}]}]}], "]"}], "+", 
        RowBox[{"dpx", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"kx", "==", "0"}], ",", "l", ",", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], "+", 
        RowBox[{"dx", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"kx", " ", "l"}], "]"}], "+", 
           RowBox[{"h", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"kx", "==", "0"}], ",", "l", ",", 
              RowBox[{
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}], "/", 
      RowBox[{"\[Rho]", "^", "3"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}], ",", 
    RowBox[{"Compiled", "->", "True"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI4", "[", "latt_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L"}],
      "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"\[Rho]", "=", 
            RowBox[{"L", "/", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
           RowBox[{"n", "=", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
             RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
           RowBox[{"h", "=", 
            RowBox[{"1", "/", "\[Rho]"}]}], ";", 
           RowBox[{"kx", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
           RowBox[{"ky", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
           RowBox[{"integralSRI4", "[", 
            RowBox[{"kx", ",", "L", ",", "h", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "10"}], "]"}], "]"}], ",", "n", ",", 
             "\[Rho]"}], "]"}]}], ")"}], "&"}], "/@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"integralSRI5H", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "kx_", ",", "s_", ",",
     "h_", ",", "dx_", ",", "dpx_", ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"dx", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"kx", "==", "0"}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"h", " ", 
                RowBox[{"l", "^", "2"}]}], ")"}], "/", "2"}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"h", " ", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], ")"}], "/", 
              RowBox[{"kx", "^", "2"}]}]}], "]"}], "+", 
           RowBox[{"dpx", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"kx", "==", "0"}], ",", "l", ",", 
              RowBox[{
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}]}], 
          ")"}], "^", "2"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"\[Beta]", " ", 
               RowBox[{
                RowBox[{"Cos", "[", 
                 RowBox[{"kx", " ", "l"}], "]"}], "^", "2"}]}], "-", 
              RowBox[{"2", " ", "\[Alpha]", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], " ", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], 
              "+", 
              RowBox[{"\[Gamma]", " ", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                  RowBox[{
                   RowBox[{"Sin", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], 
                "^", "2"}]}]}], ")"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"dpx", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"kx", "==", "0"}], ",", 
                RowBox[{"h", " ", "l"}], ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"h", " ", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}]}], ")"}], "/", "kx"}]}], 
               "]"}], "-", 
              RowBox[{"dx", " ", "kx", " ", 
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}]}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"dx", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"kx", "==", "0"}], ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"h", " ", 
                   RowBox[{"l", "^", "2"}]}], ")"}], "/", "2"}], ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"h", " ", 
                   RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], ")"}], "/", 
                 RowBox[{"kx", "^", "2"}]}]}], "]"}], "+", 
              RowBox[{"dpx", " ", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}]}], 
             ")"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                  RowBox[{
                   RowBox[{"Sin", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], 
               " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
                 RowBox[{"kx", " ", "\[Alpha]", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}]}], ")"}]}], "+", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Alpha]", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
                 RowBox[{"kx", " ", "\[Beta]", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}]}], ")"}]}]}], ")"}]}]}], 
          ")"}], "^", "2"}]}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Beta]", " ", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"kx", " ", "l"}], "]"}], "^", "2"}]}], "-", 
        RowBox[{"2", " ", "\[Alpha]", " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"kx", " ", "l"}], "]"}], " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"kx", "==", "0"}], ",", "l", ",", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], "+", 
        RowBox[{"\[Gamma]", " ", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", "l", ",", 
            RowBox[{
             RowBox[{"Sin", "[", 
              RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], "^", 
          "2"}]}]}], ")"}]}], "/", 
     RowBox[{
      RowBox[{"Abs", "[", "\[Rho]", "]"}], "^", "3"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}], ",", 
    RowBox[{"Compiled", "->", "True"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI5H", "[", 
   RowBox[{"{", 
    RowBox[{"elem_", ",", "input1_", ",", "input2_"}], "}"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L"}],
      "}"}], ",", "\n", 
    RowBox[{"Plus", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "=!=", "0"}], ",", 
            RowBox[{"integralSRI5H", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", "kx", ",", "L", 
              ",", "h", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", "\[Rho]"}], "]"}],
             ",", 
            RowBox[{"integralSRI5H2", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", "kx", ",", "L", 
              ",", "h", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", "\[Rho]"}], 
             "]"}]}], "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"elem", ",", "input1", ",", "input2"}], "}"}], "}"}]}], 
      ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI5", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "\[Rho]"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTable", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"MLCSRI5H", "[", "#", "]"}], ")"}], "&"}], "/@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}],
             ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Alpha]c", "[", "latt_", "]"}], ":=", 
  RowBox[{
   RowBox[{"MLCSRI1", "[", "latt", "]"}], "/", 
   RowBox[{"MADLength", "[", "latt", "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Epsilon]", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"1.4673594530853189*^-12", " ", 
   RowBox[{"energy", "^", "2"}], "*", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ValueQ", "[", "MLCI5", "]"}], ",", "MLCI5", ",", 
      RowBox[{"MLCSRI5", "[", "latt", "]"}]}], "]"}], "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "MLCI2", "]"}], ",", "MLCI2", ",", 
        RowBox[{"MLCSRI2", "[", "latt", "]"}]}], "]"}], "-", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "MLCI4", "]"}], ",", "MLCI4", ",", 
        RowBox[{"MLCSRI4", "[", "latt", "]"}]}], "]"}]}], 
     ")"}]}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI", "[", "latt_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"MLCI1", "=", 
     RowBox[{
      RowBox[{"MLCSRI1", "[", "latt", "]"}], " ", "Meter"}]}], ",", 
    RowBox[{"MLCI2", "=", 
     RowBox[{
      RowBox[{"MLCSRI2", "[", "latt", "]"}], "/", "Meter"}]}], ",", 
    RowBox[{"MLCI3", "=", 
     RowBox[{
      RowBox[{"MLCSRI3", "[", "latt", "]"}], "/", 
      RowBox[{"Meter", "^", "2"}]}]}], ",", 
    RowBox[{"MLCI4", "=", 
     RowBox[{
      RowBox[{"MLCSRI4", "[", "latt", "]"}], "/", "Meter"}]}], ",", 
    RowBox[{"MLCI5", "=", 
     RowBox[{
      RowBox[{"MLCSRI5", "[", "latt", "]"}], "/", "Meter"}]}]}], 
   "}"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Epsilon]", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"55", " ", "PlanckConstant", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"energy", " ", "ElectronVolt", " ", "Mega"}], ")"}], "^", 
         "2"}]}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{"2", " ", "\[Pi]", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"ElectronMass", "*", 
           RowBox[{"SpeedOfLight", "^", "2"}]}], ")"}], "^", "2"}], " ", "32", 
        RowBox[{"Sqrt", "[", "3", "]"}], "ElectronMass", " ", 
        "SpeedOfLight"}], ")"}]}], "*", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "MLCI5", "]"}], ",", "MLCI5", ",", 
        RowBox[{"MLCSRI5", "[", "latt", "]"}]}], "]"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ValueQ", "[", "MLCI2", "]"}], ",", "MLCI2", ",", 
           RowBox[{"MLCSRI2", "[", "latt", "]"}]}], "]"}], ")"}], "-", 
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ValueQ", "[", "MLCI4", "]"}], ",", "MLCI4", ",", 
           RowBox[{"MLCSRI4", "[", "latt", "]"}]}], "]"}], ")"}]}], ")"}]}]}],
     ",", 
    RowBox[{"Nano", " ", "Meter"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCU0", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"2", " ", "ClassicalElectronRadius", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"energy", "*", "Mega", " ", "ElectronVolt"}], ")"}], "^", 
        "4"}], " ", 
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ValueQ", "[", "MLCI2", "]"}], ",", "MLCI2", ",", 
          RowBox[{"MLCSRI2", "[", "latt", "]"}]}], "]"}], ")"}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{"3", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ElectronMass", " ", 
          RowBox[{"SpeedOfLight", "^", "2"}]}], ")"}], "^", "3"}]}], ")"}]}], 
    ",", 
    RowBox[{"ElectronVolt", " ", "Kilo"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCJx", "[", "latt_", "]"}], ":=", 
  RowBox[{"1", "-", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "MLCI4", "]"}], ",", "MLCI4", ",", 
       RowBox[{"MLCSRI4", "[", "latt", "]"}]}], "]"}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "MLCI2", "]"}], ",", "MLCI2", ",", 
       RowBox[{"MLCSRI2", "[", "latt", "]"}]}], "]"}], ")"}]}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCJ\[Epsilon]", "[", "latt_", "]"}], ":=", 
  RowBox[{"2", "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "MLCI4", "]"}], ",", "MLCI4", ",", 
       RowBox[{"MLCSRI4", "[", "latt", "]"}]}], "]"}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "MLCI2", "]"}], ",", "MLCI2", ",", 
       RowBox[{"MLCSRI2", "[", "latt", "]"}]}], "]"}], ")"}]}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCES", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"55", " ", "PlanckConstant", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"energy", " ", "ElectronVolt", " ", "Mega"}], ")"}], "^", 
         "2"}]}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{"2", " ", "\[Pi]", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"ElectronMass", "*", 
           RowBox[{"SpeedOfLight", "^", "2"}]}], ")"}], "^", "2"}], " ", "32", 
        RowBox[{"Sqrt", "[", "3", "]"}], "ElectronMass", " ", 
        "SpeedOfLight"}], ")"}]}], "*", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "MLCI3", "]"}], ",", "MLCI3", ",", 
        RowBox[{"MLCSRI3", "[", "latt", "]"}]}], "]"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ValueQ", "[", "MLCI2", "]"}], ",", "MLCI2", ",", 
            RowBox[{"MLCSRI2", "[", "latt", "]"}]}], "]"}], ")"}]}], "+", 
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ValueQ", "[", "MLCI4", "]"}], ",", "MLCI4", ",", 
           RowBox[{"MLCSRI4", "[", "latt", "]"}]}], "]"}], ")"}]}], ")"}]}]}],
     ",", "Joules"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Tau]x", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"3", " ", 
       RowBox[{"ElectronMass", "^", "3"}], " ", 
       RowBox[{"SpeedOfLight", "^", "5"}], " ", 
       RowBox[{"MADLength", "[", "latt", "]"}], " ", "Meter", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Plus", "@@", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "DIAMOND", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}],
               "&"}]}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", "Meter"}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{"2", " ", "\[Pi]", " ", "ClassicalElectronRadius", " ", 
       RowBox[{"MLCJx", "[", "latt", "]"}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"energy", " ", "Mega", " ", "ElectronVolt"}], ")"}], "^", 
        "3"}]}], ")"}]}], ",", 
    RowBox[{"Milli", " ", "Second"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Tau]y", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"3", " ", 
       RowBox[{"ElectronMass", "^", "3"}], " ", 
       RowBox[{"SpeedOfLight", "^", "5"}], " ", 
       RowBox[{"MADLength", "[", "latt", "]"}], " ", "Meter", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Plus", "@@", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "DIAMOND", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}],
               "&"}]}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", "Meter"}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{
      "2", " ", "\[Pi]", " ", "ClassicalElectronRadius", " ", "1", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"energy", " ", "Mega", " ", "ElectronVolt"}], ")"}], "^", 
        "3"}]}], ")"}]}], ",", 
    RowBox[{"Milli", " ", "Second"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Tau]\[Epsilon]", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"3", " ", 
       RowBox[{"ElectronMass", "^", "3"}], " ", 
       RowBox[{"SpeedOfLight", "^", "5"}], " ", 
       RowBox[{"MADLength", "[", "latt", "]"}], " ", "Meter", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Plus", "@@", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "DIAMOND", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}],
               "&"}]}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", "Meter"}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{"2", " ", "\[Pi]", " ", "ClassicalElectronRadius", " ", 
       RowBox[{"MLCJ\[Epsilon]", "[", "latt", "]"}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"energy", " ", "Mega", " ", "ElectronVolt"}], ")"}], "^", 
        "3"}]}], ")"}]}], ",", 
    RowBox[{"Milli", " ", "Second"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"MLC\[Epsilon]x", "[", 
    RowBox[{"latt_", ",", "energy_", ",", 
     RowBox[{"\[Kappa]_:", "0.01"}]}], "]"}], ":=", "  ", 
   RowBox[{
    RowBox[{"MLC\[Epsilon]", "[", 
     RowBox[{"latt", ",", "energy"}], "]"}], " ", "/", 
    RowBox[{"(", 
     RowBox[{"1", "+", "\[Kappa]"}], ")"}]}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"MLC\[Epsilon]y", "[", 
    RowBox[{"latt_", ",", "energy_", ",", 
     RowBox[{"\[Kappa]_:", "0.01"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"\[Kappa]", " ", 
      RowBox[{"MLC\[Epsilon]", "[", 
       RowBox[{"latt", ",", "energy"}], "]"}]}], " ", ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"1", "+", "\[Kappa]"}], ")"}]}]}]}]], "Input",
 InitializationCell->True,
 Background->None]
}, Closed]],

Cell[CellGroupData[{

Cell["BeamSizes", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Sigma]x", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]x", ",", "es"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[Epsilon]x", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MLC\[Epsilon]x", "[", 
         RowBox[{"latt", ",", "energy"}], "]"}], " ", 
        RowBox[{
         RowBox[{"10", "^", 
          RowBox[{"-", "9"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"Meter", " ", "Nano"}], ")"}]}]}], ")"}]}], ";", 
     RowBox[{"es", "=", 
      RowBox[{"MLCES", "[", 
       RowBox[{"latt", ",", "energy"}], "]"}]}], ";", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"\[Epsilon]x", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"es", "^", "2"}], " ", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}]}], "]"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"MLCGeneratePeriodicTwissTable", "[", "latt", "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"MLCPropagateDispersion", "[", 
             RowBox[{
              RowBox[{"MLCFindPeriodicDispersion", "[", 
               RowBox[{"MLCOneTurnRMatrix", "[", 
                RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
              RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
      ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Sigma]y", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[Epsilon]y", "}"}], ",", 
    RowBox[{
     RowBox[{"\[Epsilon]y", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MLC\[Epsilon]y", "[", 
         RowBox[{"latt", ",", "energy"}], "]"}], " ", 
        RowBox[{
         RowBox[{"10", "^", 
          RowBox[{"-", "9"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"Meter", " ", "Nano"}], ")"}]}]}], ")"}]}], ";", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{"\[Epsilon]y", " ", "#"}], "]"}], "&"}], "/@", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTable", "[", "latt", "]"}], "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Sigma]primex", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]x", ",", "es"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[Epsilon]x", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MLC\[Epsilon]x", "[", 
         RowBox[{"latt", ",", "energy"}], "]"}], " ", 
        RowBox[{
         RowBox[{"10", "^", 
          RowBox[{"-", "9"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"Meter", " ", "Nano"}], ")"}]}]}], ")"}]}], ";", 
     RowBox[{"es", "=", 
      RowBox[{"MLCES", "[", 
       RowBox[{"latt", ",", "energy"}], "]"}]}], ";", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"\[Epsilon]x", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"es", "^", "2"}], " ", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}]}], "]"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"MLCGeneratePeriodicTwissTable", "[", "latt", "]"}], "[", 
            RowBox[{"[", "5", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"MLCPropagateDispersion", "[", 
             RowBox[{
              RowBox[{"MLCFindPeriodicDispersion", "[", 
               RowBox[{"MLCOneTurnRMatrix", "[", 
                RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
              RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
      ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLC\[Sigma]primey", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[Epsilon]y", "}"}], ",", 
    RowBox[{
     RowBox[{"\[Epsilon]y", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MLC\[Epsilon]y", "[", 
         RowBox[{"latt", ",", "energy"}], "]"}], " ", 
        RowBox[{
         RowBox[{"10", "^", 
          RowBox[{"-", "9"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"Meter", " ", "Nano"}], ")"}]}]}], ")"}]}], ";", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{"\[Epsilon]y", " ", "#"}], "]"}], "&"}], "/@", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTable", "[", "latt", "]"}], "[", 
        RowBox[{"[", "8", "]"}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None]
}, Closed]],

Cell[CellGroupData[{

Cell["Chromaticity", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadDisp", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "L", ",", "pos", ",", "mat", ",", "\[Rho]", ",", "n", ",", 
      "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            "\"\<Quadrupole\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4"}], "]"}], "]"}], "<", "0"}], ",", "\n", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"QuadDispTableNeg", "[", 
            RowBox[{"k", ",", "L", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}]}], ")"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
           RowBox[{"QuadDispTablePos", "[", 
            RowBox[{"k", ",", "L", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}]}], ")"}]}], 
        "]"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}]}],
          "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadDispPrime", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "L", ",", "pos", ",", "mat", ",", "\[Rho]", ",", "n", ",", 
      "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            "\"\<Quadrupole\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4"}], "]"}], "]"}], "<", "0"}], ",", "\n", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"QuadDispPrimeTableNeg", "[", 
            RowBox[{"k", ",", "L", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}]}], ")"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
           RowBox[{"QuadDispPrimeTablePos", "[", 
            RowBox[{"k", ",", "L", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}]}], ")"}]}], 
        "]"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}]}],
          "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadGamma", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "L", ",", "tmat", ",", "pos", ",", "mat", ",", "\[Rho]", ",", 
      "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h"}], "}"}], ",", 
    "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            "\"\<Quadrupole\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4"}], "]"}], "]"}], "<", "0"}], ",", "\n", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"QuadGammaTableNeg", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
           RowBox[{"QuadGammaTablePos", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}]}], "]"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
           ")"}]}], "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBeta", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "L", ",", "tmat", ",", "pos", ",", "mat", ",", "\[Rho]", ",", 
      "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h"}], "}"}], ",", 
    "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            "\"\<Quadrupole\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4"}], "]"}], "]"}], "<", "0"}], ",", "\n", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"QuadBetaTableNeg", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
           RowBox[{"QuadBetaTablePos", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}]}], "]"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
           ")"}]}], "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftDisp", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "L", ",", "pos", ",", "mat", ",", "\[Rho]", ",", "n", ",", "kx", ",", 
      "ky", ",", "\[CurlyPhi]", ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", "\"\<Drift\>\""}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"L", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
         RowBox[{"DriftDispTable", "[", 
          RowBox[{"L", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Drift\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}]}],
          "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftDispPrime", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "L", ",", "pos", ",", "mat", ",", "\[Rho]", ",", "n", ",", "kx", ",", 
      "ky", ",", "\[CurlyPhi]", ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", "\"\<Drift\>\""}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"L", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
         RowBox[{"DriftDispPrimeTable", "[", 
          RowBox[{"L", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Drift\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}]}],
          "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftBeta", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h", 
      ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", "\"\<Drift\>\""}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"DriftBetaTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "L"}], "]"}]}], 
         ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Drift\>\""}], 
              "&"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftGamma", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "\[Rho]", ",", "L", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", "\"\<Drift\>\""}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"DriftGammaTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "L"}], "]"}]}], 
         ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Drift\>\""}], 
              "&"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleDisp", "[", "latt_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L", 
      ",", "\[CurlyPhi]", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"DipoleDispTable", "[", 
           RowBox[{"kx", ",", "L", ",", "h", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "\[Rho]"}], 
           "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}],
               "&"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleDispPrime", "[", "latt_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L", 
      ",", "\[CurlyPhi]", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"DipoleDispPrimeTable", "[", 
           RowBox[{"kx", ",", "L", ",", "h", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "10"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "\[Rho]"}], 
           "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MLCElementList", "[", "latt", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}],
               "&"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleBeta", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "L", ",", "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"DipoleBetaTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", "kx", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "L"}], "]"}]}], 
         ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"MLCElementList", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
           ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleGamma", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "L", ",", "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"DipoleGammaTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", "kx", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "10"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "L"}], "]"}]}], 
         ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"MLCElementList", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
           ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBetaY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "L", ",", "tmat", ",", "pos", ",", "mat", ",", "\[Rho]", ",", 
      "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h"}], "}"}], ",", 
    "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "7", ",", "8"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            "\"\<Quadrupole\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4"}], "]"}], "]"}], "<", "0"}], ",", "\n", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"QuadBetaYTableNeg", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
           RowBox[{"QuadBetaYTablePos", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}]}], "]"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
           ")"}]}], "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftBetaY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "L", ",", "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "7", ",", "8"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", "\"\<Drift\>\""}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"DriftBetaYTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "L"}], "]"}]}], 
         ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Drift\>\""}], 
              "&"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleBetaY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "L", ",", "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "7", ",", "8"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"\[CurlyPhi]", "=", 
           RowBox[{"k", " ", "h", " ", "0", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"Sin", "[", "\[Beta]", "]"}], "^", "2"}]}], ")"}], 
             "/", 
             RowBox[{"Cos", "[", "\[Beta]", "]"}]}]}]}], ";", 
          RowBox[{"DipoleBetaYTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", "ky", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "\[CurlyPhi]", ",",
             "h", ",", "L"}], "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"MLCElementList", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
           ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleGammaY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "L", ",", "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "7", ",", "8"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}]}], ";", 
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "*", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
           "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MLCPropagateDispersion", "[", 
        RowBox[{
         RowBox[{"MLCFindPeriodicDispersion", "[", 
          RowBox[{"MLCOneTurnRMatrix", "[", 
           RowBox[{"MLCRMatrices", "[", "latt", "]"}], "]"}], "]"}], ",", 
         RowBox[{"MLCRMatrices", "[", "latt", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], " ", 
            RowBox[{"\[Rho]", "^", "2"}]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"\[CurlyPhi]", "=", 
           RowBox[{"k", " ", "h", " ", "0", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"Sin", "[", "\[Beta]", "]"}], "^", "2"}]}], ")"}], 
             "/", 
             RowBox[{"Cos", "[", "\[Beta]", "]"}]}]}]}], ";", 
          RowBox[{"DipoleGammaYTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "3"}], "]"}], "]"}], ",", "ky", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "11"}], "]"}], "]"}], ",", "h", ",", "L"}], 
           "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"MLCElementList", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "===", 
                "\"\<SectorBend\>\""}], "&"}]}], "]"}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"mat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
           ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadGammaY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "L", ",", "tmat", ",", "pos", ",", "mat", ",", "\[Rho]", ",", 
      "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", ",", "h"}], "}"}], ",", 
    "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "7", ",", "8"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            "\"\<Quadrupole\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4"}], "]"}], "]"}], "<", "0"}], ",", "\n", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"-", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"QuadGammaYTableNeg", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"k", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
           RowBox[{"QuadGammaYTablePos", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "k", ",", "L"}], 
            "]"}]}], ")"}]}], "]"}], "&"}], "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
           ")"}]}], "}"}]}], "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftGammaY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "L", ",", "\[Rho]", ",", "n", ",", "kx", ",", "ky", ",", "\[CurlyPhi]", 
      ",", "h", ",", "k"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"tmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"MLCGeneratePeriodicTwissTableNoOut", "[", 
         RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "7", ",", "8"}], "}"}], "]"}], "]"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", "\"\<Drift\>\""}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", "1"}], ")"}], "//.", 
       RowBox[{"{", 
        RowBox[{"0", "->", 
         RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
          RowBox[{"DriftGammaYTable", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", "L"}], "]"}]}], 
         ")"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Drift\>\""}], 
              "&"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"tmat", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
            ")"}]}], "}"}]}], "]"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadDispTableNeg", "[", 
   RowBox[{"k_", ",", "s_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"dx", " ", 
      RowBox[{"Cosh", "[", 
       RowBox[{"k", " ", "L"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"dpx", " ", 
        RowBox[{"Sinh", "[", 
         RowBox[{"k", " ", "L"}], "]"}]}], ")"}], "/", "k"}]}], " ", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadDispPrimeTableNeg", "[", 
   RowBox[{"k_", ",", "s_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"dpx", " ", 
      RowBox[{"Cosh", "[", 
       RowBox[{"k", " ", "L"}], "]"}]}], "+", 
     RowBox[{"dx", " ", "k", " ", 
      RowBox[{"Sinh", "[", 
       RowBox[{"k", " ", "L"}], "]"}]}]}], " ", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadDispTablePos", "[", 
   RowBox[{"k_", ",", "s_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"dx", " ", 
      RowBox[{"Cos", "[", 
       RowBox[{"k", " ", "L"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"dpx", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"k", " ", "L"}], "]"}]}], ")"}], "/", "k"}]}], " ", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadDispPrimeTablePos", "[", 
   RowBox[{"k_", ",", "s_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"dpx", " ", 
      RowBox[{"Cos", "[", 
       RowBox[{"k", " ", "L"}], "]"}]}], "-", 
     RowBox[{"dx", " ", "k", " ", 
      RowBox[{"Sin", "[", 
       RowBox[{"k", " ", "L"}], "]"}]}]}], " ", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBetaTablePos", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Beta]", " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Alpha]", " ", 
           RowBox[{"Sin", "[", 
            RowBox[{"k", " ", "L"}], "]"}]}], ")"}], "/", "k"}]}], ")"}]}], 
     "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"k", " ", "L"}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "\[Alpha]"}], " ", 
           RowBox[{"Cos", "[", 
            RowBox[{"k", " ", "L"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Gamma]", " ", 
             RowBox[{"Sin", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ")"}], "/", "k"}]}], ")"}]}], 
       ")"}], "/", "k"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBetaTableNeg", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Cosh", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Beta]", " ", 
         RowBox[{"Cosh", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Alpha]", " ", 
           RowBox[{"Sinh", "[", 
            RowBox[{"k", " ", "L"}], "]"}]}], ")"}], "/", "k"}]}], ")"}]}], 
     "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sinh", "[", 
         RowBox[{"k", " ", "L"}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "\[Alpha]"}], " ", 
           RowBox[{"Cosh", "[", 
            RowBox[{"k", " ", "L"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Gamma]", " ", 
             RowBox[{"Sinh", "[", 
              RowBox[{"k", " ", "L"}], "]"}]}], ")"}], "/", "k"}]}], ")"}]}], 
       ")"}], "/", "k"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadGammaTablePos", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "+", 
        RowBox[{"k", " ", "\[Alpha]", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}]}], ")"}]}], "-", 
     RowBox[{"k", " ", 
      RowBox[{"Sin", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "\[Alpha]"}], " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "-", 
        RowBox[{"k", " ", "\[Beta]", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadGammaTableNeg", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Cosh", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", 
         RowBox[{"Cosh", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "-", 
        RowBox[{"k", " ", "\[Alpha]", " ", 
         RowBox[{"Sinh", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}]}], ")"}]}], "+", 
     RowBox[{"k", " ", 
      RowBox[{"Sinh", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "\[Alpha]"}], " ", 
         RowBox[{"Cosh", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "+", 
        RowBox[{"k", " ", "\[Beta]", " ", 
         RowBox[{"Sinh", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftDispTable", "[", 
   RowBox[{"s_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{"dx", "+", 
     RowBox[{"dpx", " ", "L"}]}], " ", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftDispPrimeTable", "[", 
   RowBox[{"s_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{"dpx", " ", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftBetaTable", "[", 
   RowBox[{"\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "s_"}], "]"}],
   ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"-", "L"}], " ", "\[Alpha]"}], "+", "\[Beta]", "+", 
     RowBox[{"L", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "\[Alpha]"}], "+", 
        RowBox[{"L", " ", "\[Gamma]"}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftGammaTable", "[", 
   RowBox[{"\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "s_"}], "]"}],
   ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{"\[Gamma]", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleDispTable", "[", 
   RowBox[{
   "kx_", ",", "s_", ",", "h_", ",", "dx_", ",", "dpx_", ",", "\[Beta]2_", 
    ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"kx", "==", "0"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"h", " ", 
           RowBox[{"l", "^", "2"}]}], ")"}], "/", "2"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"h", " ", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"Cos", "[", 
              RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], ")"}], "/", 
         RowBox[{"kx", "^", "2"}]}]}], "]"}], "+", 
      RowBox[{"dpx", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kx", "==", "0"}], ",", "l", ",", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], "+", 
      RowBox[{"dx", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"kx", " ", "l"}], "]"}], "+", 
         RowBox[{"h", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", "l", ",", 
            RowBox[{
             RowBox[{"Sin", "[", 
              RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], " ", 
          RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleDispPrimeTable", "[", 
   RowBox[{
   "kx_", ",", "s_", ",", "h_", ",", "dx_", ",", "dpx_", ",", "\[Beta]1_", 
    ",", "\[Beta]2_", ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"kx", "==", "0"}], ",", 
       RowBox[{"h", " ", "l"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", 
          RowBox[{"Sin", "[", 
           RowBox[{"kx", " ", "l"}], "]"}]}], ")"}], "/", "kx"}]}], "]"}], 
     "+", 
     RowBox[{"h", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"kx", "==", "0"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"h", " ", 
           RowBox[{"l", "^", "2"}]}], ")"}], "/", "2"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"h", " ", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"Cos", "[", 
              RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], ")"}], "/", 
         RowBox[{"kx", "^", "2"}]}]}], "]"}], " ", 
      RowBox[{"Tan", "[", "\[Beta]1", "]"}]}], "+", 
     RowBox[{"dpx", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"kx", " ", "l"}], "]"}], "+", 
        RowBox[{"h", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"kx", "==", "0"}], ",", "l", ",", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], " ", 
         RowBox[{"Tan", "[", "\[Beta]1", "]"}]}]}], ")"}]}], "+", 
     RowBox[{"dx", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "kx"}], " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
        RowBox[{"h", " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"kx", " ", "l"}], "]"}], " ", 
         RowBox[{"Tan", "[", "\[Beta]1", "]"}]}], "+", 
        RowBox[{"h", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"kx", " ", "l"}], "]"}], "+", 
           RowBox[{"h", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"kx", "==", "0"}], ",", "l", ",", 
              RowBox[{
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], " ", 
            RowBox[{"Tan", "[", "\[Beta]1", "]"}]}]}], ")"}], " ", 
         RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleBetaTable", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "kx_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[Beta]", " ", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"kx", " ", "l"}], "]"}], "^", "2"}]}], "-", 
      RowBox[{"2", " ", "\[Alpha]", " ", 
       RowBox[{"Cos", "[", 
        RowBox[{"kx", " ", "l"}], "]"}], " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kx", "==", "0"}], ",", "l", ",", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}]}], "+", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"kx", "==", "0"}], ",", "l", ",", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"kx", " ", "l"}], "]"}], "/", "kx"}]}], "]"}], "^", 
        "2"}]}]}], ")"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleBetaTable", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "kx_", ",", 
    "\[Beta]2_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Beta]", " ", 
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"kx", " ", "L"}], "]"}], "^", "2"}]}], "-", 
     RowBox[{"2", " ", 
      RowBox[{"Cos", "[", 
       RowBox[{"kx", " ", "L"}], "]"}], " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"kx", "==", "0"}], ",", "L", ",", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"kx", " ", "L"}], "]"}], "/", "kx"}]}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{"\[Alpha]", "-", 
        RowBox[{"h", " ", "\[Beta]", " ", 
         RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}], "+", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kx", "==", "0"}], ",", "L", ",", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"kx", " ", "L"}], "]"}], "/", "kx"}]}], "]"}], "^", "2"}], 
      " ", 
      RowBox[{"(", 
       RowBox[{"\[Gamma]", "+", 
        RowBox[{"h", " ", 
         RowBox[{"Tan", "[", "\[Beta]2", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", "\[Alpha]"}], "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleGammaTable", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", 
    "\[Beta]1_", ",", "\[Beta]2_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"h", "^", "2"}], " ", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kx", "==", "0"}], ",", "L", ",", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"kx", " ", "L"}], "]"}], "/", "kx"}]}], "]"}], "^", "2"}], 
      " ", 
      RowBox[{
       RowBox[{"Tan", "[", "\[Beta]1", "]"}], "^", "2"}], " ", 
      RowBox[{"(", 
       RowBox[{"\[Gamma]", "+", 
        RowBox[{"h", " ", 
         RowBox[{"Tan", "[", "\[Beta]2", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", "\[Alpha]"}], "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}]}], 
     "+", 
     RowBox[{"kx", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"kx", " ", "\[Beta]", " ", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"kx", " ", "L"}], "]"}], "^", "2"}]}], "+", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"2", " ", "kx", " ", "L"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Alpha]", "-", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tan", "[", "\[Beta]1", "]"}], "+", 
              RowBox[{"Tan", "[", "\[Beta]2", "]"}]}], ")"}]}]}], ")"}]}]}], 
       ")"}]}], "+", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"kx", " ", "L"}], "]"}], "^", "2"}], " ", 
      RowBox[{"(", 
       RowBox[{"\[Gamma]", "+", 
        RowBox[{"h", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Tan", "[", "\[Beta]1", "]"}], "+", 
           RowBox[{"Tan", "[", "\[Beta]2", "]"}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", "\[Alpha]"}], "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tan", "[", "\[Beta]1", "]"}], "+", 
              RowBox[{"Tan", "[", "\[Beta]2", "]"}]}], ")"}]}]}], ")"}]}]}], 
       ")"}]}], "+", 
     RowBox[{"2", " ", "h", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"kx", "==", "0"}], ",", "L", ",", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"kx", " ", "L"}], "]"}], "/", "kx"}]}], "]"}], " ", 
      RowBox[{"Tan", "[", "\[Beta]1", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"kx", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"kx", " ", "L"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Alpha]", "-", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"kx", " ", "L"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Gamma]", "+", 
           RowBox[{"h", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "2"}], " ", "\[Alpha]"}], "+", 
              RowBox[{"h", " ", "\[Beta]", " ", 
               RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}], "+", 
           RowBox[{"h", " ", 
            RowBox[{"Tan", "[", "\[Beta]1", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "\[Alpha]"}], "+", 
              RowBox[{"h", " ", "\[Beta]", " ", 
               RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], 
          ")"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBetaYTablePos", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Beta]", " ", 
      RowBox[{
       RowBox[{"Cosh", "[", 
        RowBox[{"k", " ", "L"}], "]"}], "^", "2"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", 
         RowBox[{
          RowBox[{"Sinh", "[", 
           RowBox[{"k", " ", "L"}], "]"}], "^", "2"}]}], "-", 
        RowBox[{"k", " ", "\[Alpha]", " ", 
         RowBox[{"Sinh", "[", 
          RowBox[{"2", " ", "k", " ", "L"}], "]"}]}]}], ")"}], "/", 
      RowBox[{"k", "^", "2"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBetaYTableNeg", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Beta]", " ", 
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"k", " ", "L"}], "]"}], "^", "2"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"k", " ", "L"}], "]"}], "^", "2"}]}], "-", 
        RowBox[{"k", " ", "\[Alpha]", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"2", " ", "k", " ", "L"}], "]"}]}]}], ")"}], "/", 
      RowBox[{"k", "^", "2"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftBetaYTable", "[", 
   RowBox[{"\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "s_"}], "]"}],
   ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"-", "2"}], " ", "L", " ", "\[Alpha]"}], "+", "\[Beta]", "+", 
     RowBox[{
      RowBox[{"L", "^", "2"}], " ", "\[Gamma]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s", ",", 
      RowBox[{"s", "/", "10"}]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleBetaYTable", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "ky_", ",", 
    "\[Beta]1_", ",", "\[Beta]2_", ",", "\[CurlyPhi]_", ",", "h_", ",", 
    "s_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Beta]", " ", 
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"ky", " ", "L"}], "]"}], "^", "2"}]}], "-", 
     RowBox[{"2", " ", 
      RowBox[{"Cos", "[", 
       RowBox[{"ky", " ", "L"}], "]"}], " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ky", "==", "0"}], ",", "L", ",", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"ky", " ", "L"}], "]"}], "/", "ky"}]}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{"\[Alpha]", "+", 
        RowBox[{"h", " ", "\[Beta]", " ", 
         RowBox[{"Tan", "[", 
          RowBox[{"\[Beta]2", "-", "\[CurlyPhi]"}], "]"}]}]}], ")"}]}], "+", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ky", "==", "0"}], ",", "L", ",", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"ky", " ", "L"}], "]"}], "/", "ky"}]}], "]"}], "^", "2"}], 
      " ", 
      RowBox[{"(", 
       RowBox[{"\[Gamma]", "+", 
        RowBox[{"h", " ", 
         RowBox[{"Tan", "[", 
          RowBox[{"\[Beta]2", "-", "\[CurlyPhi]"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", "\[Alpha]"}], "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"Tan", "[", 
             RowBox[{"\[Beta]2", "-", "\[CurlyPhi]"}], "]"}]}]}], ")"}]}]}], 
       ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadGammaYTablePos", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Gamma]", " ", 
      RowBox[{
       RowBox[{"Cosh", "[", 
        RowBox[{"k", " ", "L"}], "]"}], "^", "2"}]}], "+", 
     RowBox[{"k", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"k", " ", "\[Beta]", " ", 
         RowBox[{
          RowBox[{"Sinh", "[", 
           RowBox[{"k", " ", "L"}], "]"}], "^", "2"}]}], "-", 
        RowBox[{"\[Alpha]", " ", 
         RowBox[{"Sinh", "[", 
          RowBox[{"2", " ", "k", " ", "L"}], "]"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadGammaYTableNeg", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "k_", ",", "s_"}], 
   "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "+", 
        RowBox[{"k", " ", "\[Alpha]", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}]}], ")"}]}], "-", 
     RowBox[{"k", " ", 
      RowBox[{"Sin", "[", 
       RowBox[{"k", " ", "L"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "\[Alpha]"}], " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}], "-", 
        RowBox[{"k", " ", "\[Beta]", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"k", " ", "L"}], "]"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DriftGammaYTable", "[", 
   RowBox[{"\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "s_"}], "]"}],
   ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{"\[Gamma]", ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s", ",", 
      RowBox[{"s", "/", "10"}]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleGammaYTable", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "ky_", ",", 
    "\[Beta]1_", ",", "\[Beta]2_", ",", "h_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"h", "^", "2"}], " ", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ky", "==", "0"}], ",", "L", ",", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"ky", " ", "L"}], "]"}], "/", "ky"}]}], "]"}], "^", "2"}], 
      " ", 
      RowBox[{
       RowBox[{"Tan", "[", "\[Beta]1", "]"}], "^", "2"}], " ", 
      RowBox[{"(", 
       RowBox[{"\[Gamma]", "+", 
        RowBox[{"h", " ", 
         RowBox[{"Tan", "[", "\[Beta]2", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", "\[Alpha]"}], "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}]}], 
     "+", 
     RowBox[{"ky", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ky", " ", "\[Beta]", " ", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"ky", " ", "L"}], "]"}], "^", "2"}]}], "+", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"2", " ", "ky", " ", "L"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Alpha]", "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tan", "[", "\[Beta]1", "]"}], "+", 
              RowBox[{"Tan", "[", "\[Beta]2", "]"}]}], ")"}]}]}], ")"}]}]}], 
       ")"}]}], "+", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"ky", " ", "L"}], "]"}], "^", "2"}], " ", 
      RowBox[{"(", 
       RowBox[{"\[Gamma]", "+", 
        RowBox[{"h", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Tan", "[", "\[Beta]1", "]"}], "+", 
           RowBox[{"Tan", "[", "\[Beta]2", "]"}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", "\[Alpha]"}], "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tan", "[", "\[Beta]1", "]"}], "+", 
              RowBox[{"Tan", "[", "\[Beta]2", "]"}]}], ")"}]}]}], ")"}]}]}], 
       ")"}]}], "-", 
     RowBox[{"2", " ", "h", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ky", "==", "0"}], ",", "L", ",", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"ky", " ", "L"}], "]"}], "/", "ky"}]}], "]"}], " ", 
      RowBox[{"Tan", "[", "\[Beta]1", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ky", " ", 
         RowBox[{"Sin", "[", 
          RowBox[{"ky", " ", "L"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Alpha]", "+", 
           RowBox[{"h", " ", "\[Beta]", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"ky", " ", "L"}], "]"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Gamma]", "+", 
           RowBox[{"h", " ", 
            RowBox[{"Tan", "[", "\[Beta]1", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{"\[Alpha]", "+", 
              RowBox[{"h", " ", "\[Beta]", " ", 
               RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}], "+", 
           RowBox[{"h", " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "\[Alpha]"}], "+", 
              RowBox[{"h", " ", "\[Beta]", " ", 
               RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], 
          ")"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"L", ",", "0", ",", "s"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadK2", "[", "latt_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
      "&"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "4"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadChromX", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\[Beta]x", ",", "\[Gamma]", ",", "h", ",", "K2", ",", "\[Eta]x", ",", 
      "\[Eta]xprime", ",", "L"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[Beta]x", "=", 
      RowBox[{"QuadBeta", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Gamma]", "=", 
      RowBox[{"QuadGamma", "[", "latt", "]"}]}], ";", 
     RowBox[{"h", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"Length", "[", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], "]"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"hprime", "=", "h"}], ";", 
     RowBox[{"\[Gamma]", "=", 
      RowBox[{"QuadGamma", "[", "latt", "]"}]}], ";", 
     RowBox[{"K2", "=", 
      RowBox[{"QuadK2", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Eta]x", "=", 
      RowBox[{"QuadDisp", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Eta]xprime", "=", 
      RowBox[{"QuadDispPrime", "[", "latt", "]"}]}], ";", 
     RowBox[{"L", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"4", " ", "\[Pi]"}], ")"}]}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}], "-", 
               RowBox[{"2", " ", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "5", "]"}], "]"}], "^", "2"}]}], "-", 
               RowBox[{"2", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "7", "]"}], "]"}], " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "-", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "6", "]"}], "]"}], " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], "^", "2"}], "-", 
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "4", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}], ")"}]}], "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
        "\[Beta]x", ",", "\[Eta]x", ",", "\[Eta]xprime", ",", "\[Gamma]", ",",
          "h", ",", "hprime", ",", "K2"}], "}"}], "]"}]}]}]}], "\n", 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"BendChromX", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\[Beta]x", ",", "\[Gamma]", ",", "h", ",", "K2", ",", "\[Eta]x", ",", 
      "\[Eta]xprime", ",", "L"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[Beta]x", "=", 
      RowBox[{"DipoleBeta", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Gamma]", "=", 
      RowBox[{"DipoleGamma", "[", "latt", "]"}]}], ";", 
     RowBox[{"h", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "6"}], "]"}], "]"}]}], ";", 
     RowBox[{"hprime", "=", "h"}], ";", 
     RowBox[{"K2", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "4"}], "]"}], "]"}]}], ";", 
     RowBox[{"\[Eta]x", "=", 
      RowBox[{"DipoleDisp", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Eta]xprime", "=", 
      RowBox[{"DipoleDispPrime", "[", "latt", "]"}]}], ";", 
     RowBox[{"L", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"4", " ", "\[Pi]"}], ")"}]}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}], "-", 
               RowBox[{"2", " ", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "5", "]"}], "]"}], "^", "2"}]}], "-", 
               RowBox[{"2", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "7", "]"}], "]"}], " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "-", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "6", "]"}], "]"}], " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], "^", "2"}], "-", 
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "4", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}], ")"}]}], "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
        "\[Beta]x", ",", "\[Eta]x", ",", "\[Eta]xprime", ",", "\[Gamma]", ",",
          "h", ",", "hprime", ",", "K2"}], "}"}], "]"}]}]}]}], "\n", 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"TotalChromX", "[", "latt_", "]"}], ":=", 
  RowBox[{"Plus", "@@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QuadChromX", "[", "latt", "]"}], ",", 
      RowBox[{"BendChromX", "[", "latt", "]"}]}], "}"}], "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadChromY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\[Beta]y", ",", "\[Gamma]", ",", "h", ",", "K2", ",", "\[Eta]x", ",", 
      "\[Eta]xprime", ",", "L"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[Beta]y", "=", 
      RowBox[{"QuadBetaY", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Gamma]", "=", 
      RowBox[{"QuadGammaY", "[", "latt", "]"}]}], ";", 
     RowBox[{"h", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"Length", "[", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
             "&"}]}], "]"}], "]"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"hprime", "=", "h"}], ";", 
     RowBox[{"K2", "=", 
      RowBox[{"QuadK2", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Eta]x", "=", 
      RowBox[{"QuadDisp", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Eta]xprime", "=", 
      RowBox[{"QuadDispPrime", "[", "latt", "]"}]}], ";", 
     RowBox[{"L", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<Quadrupole\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"4", " ", "\[Pi]"}], ")"}]}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}], " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "5", "]"}], "]"}], " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "6", "]"}], "]"}], " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}], ")"}]}], ")"}]}],
        "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
        "\[Beta]y", ",", "\[Eta]x", ",", "\[Eta]xprime", ",", "\[Gamma]", ",",
          "h", ",", "hprime", ",", "K2"}], "}"}], "]"}]}]}]}], "\n", 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"BendChromY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\[Beta]y", ",", "\[Gamma]", ",", "h", ",", "K2", ",", "\[Eta]x", ",", 
      "\[Eta]xprime", ",", "L"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[Beta]y", "=", 
      RowBox[{"DipoleBetaY", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Gamma]", "=", 
      RowBox[{"DipoleGammaY", "[", "latt", "]"}]}], ";", 
     RowBox[{"h", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"Length", "[", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
             "&"}]}], "]"}], "]"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"hprime", "=", "h"}], ";", 
     RowBox[{"K2", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "4"}], "]"}], "]"}]}], ";", 
     RowBox[{"\[Eta]x", "=", 
      RowBox[{"DipoleDisp", "[", "latt", "]"}]}], ";", 
     RowBox[{"\[Eta]xprime", "=", 
      RowBox[{"DipoleDispPrime", "[", "latt", "]"}]}], ";", 
     RowBox[{"L", "=", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<SectorBend\>\""}], 
          "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"4", " ", "\[Pi]"}], ")"}]}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "7", "]"}], "]"}], " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "5", "]"}], "]"}], " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "6", "]"}], "]"}], " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}], ")"}]}], ")"}]}],
        "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
        "\[Beta]y", ",", "\[Eta]x", ",", "\[Eta]xprime", ",", "\[Gamma]", ",",
          "h", ",", "hprime", ",", "K2"}], "}"}], "]"}]}]}]}], "\n", 
   "]"}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"TotalChromY", "[", "latt_", "]"}], ":=", 
  RowBox[{"Plus", "@@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QuadChromY", "[", "latt", "]"}], ",", 
      RowBox[{"BendChromY", "[", "latt", "]"}]}], "}"}], "]"}]}]}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCChromaticity", "[", "latt_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"TotalChromX", "[", 
     RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], ",", 
    RowBox[{"TotalChromY", "[", 
     RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}]}], "}"}]}]], "Input",
 InitializationCell->True,
 Background->None]
}, Closed]],

Cell[CellGroupData[{

Cell["EndPackage Functions", "Subsubsection"],

Cell[BoxData[
 RowBox[{"End", "[", "]"}]], "Input",
 InitializationCell->True,
 Background->None],

Cell[BoxData[
 RowBox[{"EndPackage", "[", "]"}]], "Input",
 InitializationCell->True,
 Background->None]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Example Use - The SRS", "Section"],

Cell[BoxData[
 RowBox[{"Quit", "[", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$Path", "=", 
   RowBox[{"Append", "[", 
    RowBox[{
     RowBox[{"Drop", "[", 
      RowBox[{"$Path", ",", 
       RowBox[{"-", "1"}]}], "]"}], ",", "\"\<c:\\\\madinputv6\>\""}], 
    "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"<<", "MLC`MLC`"}]], "Input"],

Cell[CellGroupData[{

Cell["Creating Element Definitions", "Subsection"],

Cell[CellGroupData[{

Cell["Drifts", "Subsubsection"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D1", ",", "0.4725", ",", "\"\<D1\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D2", ",", "2.167", ",", "\"\<D2\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D3", ",", "0.3725", ",", "\"\<D3\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bends", "Subsubsection"],

Cell[BoxData[
 RowBox[{"sbend", "[", 
  RowBox[{"BD", ",", "2.188001", ",", "0.0", ",", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"2", " ", 
      RowBox[{"Pi", "/", "16"}]}], ")"}], "//", "N"}], ",", "\"\<BD\>\"", ",", 
   RowBox[{"E1", "->", "0.0"}], ",", 
   RowBox[{"E2", "->", "0.0"}], ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quads", "Subsubsection"],

Cell[BoxData[
 RowBox[{"quad", "[", 
  RowBox[{"Q1", ",", "0.3", ",", 
   RowBox[{"-", "1.5633944"}], ",", "\"\<Q1\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"quad", "[", 
  RowBox[{"Q2", ",", "0.5", ",", "1.2783629", ",", "\"\<Q2\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Creating Lines", "Subsection"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SRS", "=", 
  RowBox[{"{", 
   RowBox[{"D1", ",", "Q1", ",", "D2", ",", "Q2", ",", "D3", ",", "BD"}], 
   "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\<\"D1\"\>", ",", "\<\"Drift\"\>", ",", "0.4725`", 
      ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
      ",", "\<\"D1\"\>"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\<\"Q1\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.3`", ",", 
      RowBox[{"-", "1.56339`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
      ",", "\<\"Q1\"\>"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\<\"D2\"\>", ",", "\<\"Drift\"\>", ",", "2.167`", 
      ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
      ",", "\<\"D2\"\>"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\<\"Q2\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.5`", ",", 
      "1.27836`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"Q2\"\>"}],
      "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\<\"D3\"\>", ",", "\<\"Drift\"\>", ",", "0.3725`", 
      ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
      ",", "\<\"D3\"\>"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\<\"BD\"\>", ",", "\<\"SectorBend\"\>", ",", "2.188001`", ",", 
      "0.`", ",", "\<\"---\"\>", ",", "0.39269908169872414`", 
      ",", "\<\"BD\"\>"}], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.5729419252915263`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MADDraw", "[", "SRS", "]"}]], "Input"],

Cell[BoxData[
 GraphicsBox[{{
    {Thickness[0.001], Dashing[{0.01, 0.01}], 
     LineBox[{{0., 0.504}, {0., -0.504}}], {}}, 
    {Thickness[0.001], Dashing[{0.01, 0.01}], 
     LineBox[{{6.137069268596261, 0.0415149674618277}, {
      5.751324368772251, -0.8897556013095493}}], {}}, 
    {Thickness[0.001], Dashing[{0.01, 0.01}], 
     LineBox[{{6.137069268596261, 0.0415149674618277}, {
      5.751324368772251, -0.8897556013095493}}], {}}}, {{}, 
    {Thickness[0.001], 
     CircleBox[{3.812, -5.571698794240161}, 
      5.4316987942401616, {-5.105088062083414, -4.71238898038469}], 
     CircleBox[{3.812, -5.571698794240161}, 
      5.711698794240161, {-5.105088062083414, -4.71238898038469}], 
     LineBox[{{3.812, 0.13999999999999999`}, {3.812, -0.13999999999999999`}}],
      LineBox[{{5.997772499215369, -0.29477718237228095`}, {
      5.890621138153144, -0.5534634514754413}}], {}}}, {
    LineBox[{{3.4395, 0.}, {3.812, 0.}}], LineBox[{{0, 0}, {0.4725, 0.}}], 
    LineBox[{{0.7725, 0.}, {2.9395, 0.}}]}, {{{}, 
     {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], Thickness[
      Medium]}], 
      PolygonBox[{{0.4725, 0.}, {0.4725, 0.23519999999999996`}, {0.7725, 
       0.23519999999999996`}, {0.7725, -0.23519999999999996`}, {
       0.4725, -0.23519999999999996`}, {0.4725, 0.}}], 
      PolygonBox[{{0.4725, 0.}, {0.4725, 0.16799999999999998`}, {0.7725, 
       0.16799999999999998`}, {0.7725, -0.16799999999999998`}, {
       0.4725, -0.16799999999999998`}, {0.4725, 0.}}], {}}}, {{}, 
     {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], Thickness[
      Medium]}], 
      PolygonBox[{{2.9395, 0.}, {2.9395, 0.23519999999999996`}, {3.4395, 
       0.23519999999999996`}, {3.4395, -0.23519999999999996`}, {
       2.9395, -0.23519999999999996`}, {2.9395, 0.}}], 
      PolygonBox[{{2.9395, 0.}, {2.9395, 0.16799999999999998`}, {3.4395, 
       0.16799999999999998`}, {3.4395, -0.16799999999999998`}, {
       2.9395, -0.16799999999999998`}, {2.9395, 0.}}], {}}}}}]], "Output",
 CellChangeTimes->{3.5729419254005375`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCPlotPeriodicOptics", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{"SRS", ",", 
     RowBox[{"{", "3", "}"}]}], "]"}], ",", 
   RowBox[{"Slices", "->", "25"}], ",", 
   RowBox[{"Dashing", "->", "True"}], ",", 
   RowBox[{"Joined", "->", "True"}], ",", 
   RowBox[{"PlotRange", "->", "All"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"ListPlot", "::", "optx"}], "MessageName"], ":", 
  " ", "\<\"Unknown option \[NoBreak]\\!\\(Slices \[Rule] 25\\)\[NoBreak] in \
\[NoBreak]\\!\\(ListPlot[\\(\\(\\(\\({\\(\\({\\(\\({0.4725`, \
0.6889249206456233`}\\)\\), \\(\\({0.7725`, 0.8949756869571666`}\\)\\), \
\\(\\({2.9395`, 12.571570080767172`}\\)\\), \\(\\(\[LeftSkeleton] 13 \
\[RightSkeleton]\\)\\), \\(\\({15.812002000000001`, \
10.425722706064173`}\\)\\), \\(\\({18.000003`, 1.0608169331806918`}\\)\\)}\\)\
\\), \\(\\({\\(\[LeftSkeleton] 1 \[RightSkeleton]\\)}\\)\\), \
\\(\\({\\(\\({0.4725`, \\(\\(\[LeftSkeleton] 19 \
\[RightSkeleton]\\)\\)}\\)\\), \\(\\(\[LeftSkeleton] 16 \
\[RightSkeleton]\\)\\), \\(\\({\\(\[LeftSkeleton] 1 \
\[RightSkeleton]\\)}\\)\\)}\\)\\)}\\)\\), \\(\\(\[LeftSkeleton] 7 \
\[RightSkeleton]\\)\\)\\)\\)]\\)\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\
\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/optx\\\", ButtonNote -> \
\\\"ListPlot::optx\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.572941925492546*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Show", "::", "gcomb"}], "MessageName"], ":", 
  " ", "\<\"Could not combine the graphics objects in \
\[NoBreak]\\!\\(Show[\\(\\(\\*GraphicsBox[List[List[List[Thickness[0.001`], \
Dashing[List[0.01`, 0.01`]], LineBox[List[List[Skeleton[2]], \
List[Skeleton[2]]]], List[]], List[Thickness[0.001`], Dashing[List[0.01`, \
0.01`]], LineBox[List[List[Skeleton[2]], List[Skeleton[2]]]], List[]], \
List[Thickness[0.001`], Dashing[List[0.01`, 0.01`]], \
LineBox[List[List[Skeleton[2]], List[Skeleton[2]]]], List[]]], \
List[List[List[GrayLevel[1], List[], Thickness[0.001`], \
EdgeForm[Thickness[Skeleton[1]]], PolygonBox[List[Skeleton[4]]], \
GrayLevel[0], List[]]], List[List[GrayLevel[1], List[], Thickness[0.001`], \
EdgeForm[Thickness[Skeleton[1]]], PolygonBox[List[Skeleton[4]]], \
GrayLevel[0], List[]]], List[List[GrayLevel[1], List[], Thickness[0.001`], \
EdgeForm[Thickness[Skeleton[1]]], PolygonBox[List[Skeleton[4]]], \
GrayLevel[0], List[]]]], List[List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]], \
List[List[LineBox[List[Skeleton[2]]]]]], List[List[List[List[], \
Thickness[0.001`], GrayLevel[1], EdgeForm[List[Skeleton[2]]], \
PolygonBox[List[Skeleton[6]]], PolygonBox[List[Skeleton[6]]], List[]]], \
List[List[List[], Thickness[0.001`], GrayLevel[1], \
EdgeForm[List[Skeleton[2]]], PolygonBox[List[Skeleton[6]]], \
PolygonBox[List[Skeleton[6]]], List[]]], List[List[List[], Thickness[0.001`], \
GrayLevel[1], EdgeForm[List[Skeleton[2]]], PolygonBox[List[Skeleton[6]]], \
PolygonBox[List[Skeleton[6]]], List[]]], List[List[List[], Thickness[0.001`], \
GrayLevel[1], EdgeForm[List[Skeleton[2]]], PolygonBox[List[Skeleton[6]]], \
PolygonBox[List[Skeleton[6]]], List[]]], List[List[List[], Thickness[0.001`], \
GrayLevel[1], EdgeForm[List[Skeleton[2]]], PolygonBox[List[Skeleton[6]]], \
PolygonBox[List[Skeleton[6]]], List[]]], List[List[List[], Thickness[0.001`], \
GrayLevel[1], EdgeForm[List[Skeleton[2]]], PolygonBox[List[Skeleton[6]]], \
PolygonBox[List[Skeleton[6]]], List[]]]]], List[Rule[DisplayFunction, \
Identity]]], \\(\\(ListPlot[\\(\\(\[LeftSkeleton] 1 \
\[RightSkeleton]\\)\\)]\\)\\), \\*GraphicsBox[List[RGBColor[1, 0, 0], \
InsetBox[FormBox[\\\"\\\\\\\"\\\\\\\\!\\\\\\\\(\\\\\\\\*SubscriptBox[\\\\\\\\(\
\\\\[Beta]\\\\\\\\), \\\\\\\\(x\\\\\\\\)]\\\\\\\\)\\\\\\\"\\\", \
TraditionalForm], List[2.9395`, 13.877524371954866`]], RGBColor[0, 0, 1], \
InsetBox[FormBox[\\\"\\\\\\\"\\\\\\\\!\\\\\\\\(\\\\\\\\*SubscriptBox[\\\\\\\\(\
\\\\[Beta]\\\\\\\\), \\\\\\\\(y\\\\\\\\)]\\\\\\\\)\\\\\\\"\\\", \
TraditionalForm], List[3.812`, 4.0494316842411555`]], GrayLevel[0], \
InsetBox[FormBox[\\\"\\\\\\\"\\\\\\\\!\\\\\\\\(\\\\\\\\*SubscriptBox[\\\\\\\\(\
\\\\[Eta]\\\\\\\\), \\\\\\\\(x\\\\\\\\)]\\\\\\\\)\\\\\\\"\\\", \
TraditionalForm], List[6.000000999999999`, 4.235492571451057`]]]], \
\\(\\(ImageSize \[Rule] \\(\\({600, 400}\\)\\)\\)\\), \\(\\(PlotRange \[Rule] \
\\(\\({\\(\\({0.4725`, 18.000003`}\\)\\), \\(\\({0, 18}\\)\\)}\\)\\)\\)\\), \
\\(\\(Frame \[Rule] True\\)\\), \\(\\(DisplayFunction \[Rule] Identity\\)\\), \
\\(\\(BaseStyle \[Rule] \\(\\({\\(\\(FontFamily \[Rule] \\\"Times\\\"\\)\\), \
\\(\\(FontSize \[Rule] 18\\)\\)}\\)\\)\\)\\), \\(\\(FrameLabel \[Rule] \
\\(\\({\\\"s [m]\\\", \\\"Optical Functions [m]\\\"}\\)\\)\\)\\)\\)\\)]\\)\
\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/Show/gcomb\\\", ButtonNote -> \
\\\"Show::gcomb\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.572941925575555*^9}],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   GraphicsBox[{{
      {Thickness[0.001], Dashing[{0.01, 0.01}], 
       LineBox[{{0., 17.58}, {0., 15.42}}], {}}, 
      {Thickness[0.001], Dashing[{0.01, 0.01}], 
       LineBox[{{18.000003, 17.58}, {18.000003, 15.42}}], {}}, 
      {Thickness[0.001], Dashing[{0.01, 0.01}], 
       LineBox[{{18.000003, 17.58}, {18.000003, 15.42}}], {}}}, {
      {GrayLevel[1], {}, 
       {Thickness[0.001], EdgeForm[Thickness[Medium]], 
        PolygonBox[{{3.812, 16.8}, {6.000000999999999, 16.8}, {
         6.000000999999999, 16.2}, {3.812, 16.2}}], 
        {GrayLevel[0]}}}, 
      {GrayLevel[1], {}, 
       {Thickness[0.001], EdgeForm[Thickness[Medium]], 
        PolygonBox[{{9.812001, 16.8}, {12.000002, 16.8}, {12.000002, 16.2}, {
         9.812001, 16.2}}], 
        {GrayLevel[0]}}}, 
      {GrayLevel[1], {}, 
       {Thickness[0.001], EdgeForm[Thickness[Medium]], 
        PolygonBox[{{15.812002000000001`, 16.8}, {18.000003, 16.8}, {
         18.000003, 16.2}, {15.812002000000001`, 16.2}}], 
        {GrayLevel[0]}}}}, {LineBox[{{3.4395, 16.5}, {3.812, 16.5}}], 
      LineBox[{{9.439501, 16.5}, {9.812001, 16.5}}], 
      LineBox[{{15.439502000000001`, 16.5}, {15.812002000000001`, 16.5}}], 
      LineBox[{{0, 16.5}, {0.4725, 16.5}}], 
      LineBox[{{6.000000999999999, 16.5}, {6.472500999999999, 16.5}}], 
      LineBox[{{12.000002, 16.5}, {12.472502, 16.5}}], 
      LineBox[{{0.7725, 16.5}, {2.9395, 16.5}}], 
      LineBox[{{6.772500999999999, 16.5}, {8.939501, 16.5}}], 
      LineBox[{{12.772502000000001`, 16.5}, {14.939502000000001`, 
       16.5}}]}, {{{}, 
       {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], 
        Thickness[Medium]}], 
        PolygonBox[{{0.4725, 16.5}, {0.4725, 17.004}, {0.7725, 17.004}, {
         0.7725, 15.996}, {0.4725, 15.996}, {0.4725, 16.5}}], 
        PolygonBox[{{0.4725, 16.5}, {0.4725, 16.86}, {0.7725, 16.86}, {0.7725,
          16.14}, {0.4725, 16.14}, {0.4725, 16.5}}], {}}}, {{}, 
       {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], 
        Thickness[Medium]}], 
        PolygonBox[{{6.472500999999999, 16.5}, {6.472500999999999, 17.004}, {
         6.772500999999999, 17.004}, {6.772500999999999, 15.996}, {
         6.472500999999999, 15.996}, {6.472500999999999, 16.5}}], 
        PolygonBox[{{6.472500999999999, 16.5}, {6.472500999999999, 16.86}, {
         6.772500999999999, 16.86}, {6.772500999999999, 16.14}, {
         6.472500999999999, 16.14}, {6.472500999999999, 16.5}}], {}}}, {{}, 
       {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], 
        Thickness[Medium]}], 
        PolygonBox[{{12.472502, 16.5}, {12.472502, 17.004}, {
         12.772502000000001`, 17.004}, {12.772502000000001`, 15.996}, {
         12.472502, 15.996}, {12.472502, 16.5}}], 
        PolygonBox[{{12.472502, 16.5}, {12.472502, 16.86}, {
         12.772502000000001`, 16.86}, {12.772502000000001`, 16.14}, {
         12.472502, 16.14}, {12.472502, 16.5}}], {}}}, {{}, 
       {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], 
        Thickness[Medium]}], 
        PolygonBox[{{2.9395, 16.5}, {2.9395, 17.004}, {3.4395, 17.004}, {
         3.4395, 15.996}, {2.9395, 15.996}, {2.9395, 16.5}}], 
        PolygonBox[{{2.9395, 16.5}, {2.9395, 16.86}, {3.4395, 16.86}, {3.4395,
          16.14}, {2.9395, 16.14}, {2.9395, 16.5}}], {}}}, {{}, 
       {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], 
        Thickness[Medium]}], 
        PolygonBox[{{8.939501, 16.5}, {8.939501, 17.004}, {9.439501, 
         17.004}, {9.439501, 15.996}, {8.939501, 15.996}, {8.939501, 16.5}}], 
        PolygonBox[{{8.939501, 16.5}, {8.939501, 16.86}, {9.439501, 16.86}, {
         9.439501, 16.14}, {8.939501, 16.14}, {8.939501, 16.5}}], {}}}, {{}, 
       {GrayLevel[1], Thickness[0.001], EdgeForm[{RGBColor[1, 0, 0], 
        Thickness[Medium]}], 
        PolygonBox[{{14.939502000000001`, 16.5}, {14.939502000000001`, 
         17.004}, {15.439502000000001`, 17.004}, {15.439502000000001`, 
         15.996}, {14.939502000000001`, 15.996}, {14.939502000000001`, 
         16.5}}], 
        PolygonBox[{{14.939502000000001`, 16.5}, {14.939502000000001`, 
         16.86}, {15.439502000000001`, 16.86}, {15.439502000000001`, 16.14}, {
         14.939502000000001`, 16.14}, {14.939502000000001`, 16.5}}], {}}}}},
    DisplayFunction->Identity], ",", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0.4725`", ",", "0.6889249206456233`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.7725`", ",", "0.8949756869571666`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2.9395`", ",", "12.571570080767172`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3.4395`", ",", "13.059542911876882`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3.812`", ",", "10.425722706064132`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6.000000999999999`", ",", "1.0608169331806956`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6.472500999999999`", ",", "0.6889249206456257`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6.772500999999999`", ",", "0.8949756869571694`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"8.939501`", ",", "12.57157008076718`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9.439501`", ",", "13.059542911876889`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9.812001`", ",", "10.425722706064137`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.000002`", ",", "1.0608169331806985`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.472502`", ",", "0.6889249206456298`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.772502000000001`", ",", "0.8949756869571753`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"14.939502000000001`", ",", "12.571570080767227`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"15.439502000000001`", ",", "13.059542911876935`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"15.812002000000001`", ",", "10.425722706064173`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"18.000003`", ",", "1.0608169331806918`"}], "}"}]}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0.4725`", ",", "11.686623848459842`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.7725`", ",", "11.50795668614539`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2.9395`", ",", "2.5454567973860622`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3.4395`", ",", "2.326953046571902`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3.812`", ",", "2.8807692993951686`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6.000000999999999`", ",", "9.501299955419565`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6.472500999999999`", ",", "11.686623848459867`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6.772500999999999`", ",", "11.507956686145414`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"8.939501`", ",", "2.5454567973860627`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9.439501`", ",", "2.3269530465719006`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9.812001`", ",", "2.8807692993951663`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.000002`", ",", "9.501299955419558`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.472502`", ",", "11.686623848459858`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.772502000000001`", ",", "11.507956686145407`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"14.939502000000001`", ",", "2.545456797386065`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"15.439502000000001`", ",", "2.326953046571904`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"15.812002000000001`", ",", "2.8807692993951712`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"18.000003`", ",", "9.501299955419572`"}], "}"}]}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0.4725`", ",", "3.5499332475851975`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.7725`", ",", "3.8963950432324235`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2.9395`", ",", "8.298439736430675`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3.4395`", ",", "7.969789378232961`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3.812`", ",", "6.736515333330129`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6.000000999999999`", ",", "3.4056485978079882`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6.472500999999999`", ",", "3.5499332475851904`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6.772500999999999`", ",", "3.896395043232415`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"8.939501`", ",", "8.298439736430653`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9.439501`", ",", "7.9697893782329405`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9.812001`", ",", "6.736515333330111`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.000002`", ",", "3.4056485978079882`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.472502`", ",", "3.5499332475851935`"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12.772502000000001`", ",", "3.8963950432324213`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"14.939502000000001`", ",", "8.298439736430685`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"15.439502000000001`", ",", "7.9697893782329725`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"15.812002000000001`", ",", "6.736515333330139`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"18.000003`", ",", "3.405648597807993`"}], "}"}]}], "}"}]}],
       "}"}], ",", 
     RowBox[{"Joined", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "0", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteDashing", "[", 
           RowBox[{"{", "6", "}"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0", ",", "0"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0.5`", ",", "0.5`", ",", "0.5`"}], "]"}]}], "}"}]}], 
       "}"}]}], ",", 
     RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
     RowBox[{"Slices", "\[Rule]", "25"}], ",", 
     RowBox[{"Dashing", "\[Rule]", "True"}], ",", 
     RowBox[{"Joined", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
   GraphicsBox[{
     {RGBColor[1, 0, 0], 
      InsetBox["\<\"\\!\\(\\*SubscriptBox[\\(\[Beta]\\), \\(x\\)]\\)\"\>", \
{2.9395, 13.877524371954866}]}, 
     {RGBColor[0, 0, 1], 
      InsetBox["\<\"\\!\\(\\*SubscriptBox[\\(\[Beta]\\), \\(y\\)]\\)\"\>", \
{3.812, 4.0494316842411555}]}, 
     {GrayLevel[0], 
      InsetBox["\<\"\\!\\(\\*SubscriptBox[\\(\[Eta]\\), \\(x\\)]\\)\"\>", \
{6.000000999999999, 4.235492571451057}]}}], ",", 
   RowBox[{"ImageSize", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"600", ",", "400"}], "}"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0.4725`", ",", "18.000003`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "18"}], "}"}]}], "}"}]}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
   RowBox[{"BaseStyle", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"FontFamily", "\[Rule]", "\<\"Times\"\>"}], ",", 
      RowBox[{"FontSize", "\[Rule]", "18"}]}], "}"}]}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\<\"s [m]\"\>", ",", "\<\"Optical Functions [m]\"\>"}], 
     "}"}]}]}], "]"}]], "Output",
 CellChangeTimes->{3.572941925606558*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCPlotOptics", "[", 
  RowBox[{
   RowBox[{"{", "SRS", "}"}], ",", 
   RowBox[{"Slices", "->", "50"}], ",", 
   RowBox[{"PlotJoined", "->", "False"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MLCPlotOptics", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"\<\"D1\"\>", ",", "\<\"Drift\"\>", ",", "0.4725`", 
         ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
         ",", "\<\"D1\"\>"}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"\<\"Q1\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.3`", ",", 
         RowBox[{"-", "1.56339`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
         ",", "\<\"Q1\"\>"}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"\<\"D2\"\>", ",", "\<\"Drift\"\>", ",", "2.167`", 
         ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
         ",", "\<\"D2\"\>"}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"\<\"Q2\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.5`", ",", 
         "1.27836`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
         ",", "\<\"Q2\"\>"}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"\<\"D3\"\>", ",", "\<\"Drift\"\>", ",", "0.3725`", 
         ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
         ",", "\<\"D3\"\>"}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"\<\"BD\"\>", ",", "\<\"SectorBend\"\>", ",", "2.188001`", 
         ",", "0.`", ",", "\<\"---\"\>", ",", "0.39269908169872414`", 
         ",", "\<\"BD\"\>"}], "}"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"Slices", "\[Rule]", "50"}], ",", 
   RowBox[{"PlotJoined", "\[Rule]", "False"}]}], "]"}]], "Output",
 CellChangeTimes->{3.57294192562656*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCTwissFunctions", "[", 
    RowBox[{"SRS", ",", "100"}], "]"}], ";"}], "//", "Timing"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{3.572941925646562*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MLCGeneratePeriodicTwissTable", "[", 
    RowBox[{"MADSplitElements", "[", 
     RowBox[{"SRS", ",", "100"}], "]"}], "]"}], ";"}], "//", 
  "Timing"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.35880230000000001844284724938916042447`5.575455131581743", ",", "Null"}],
   "}"}]], "Output",
 CellChangeTimes->{3.5729419260205994`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MADInfo", "[", "SRS", "]"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 TagBox[
  TagBox[GridBox[{
     {
      StyleBox["\[Null]",
       ShowStringCharacters->False], 
      TagBox["\<\"Name\"\>",
       HoldForm], 
      TagBox["\<\"Element\"\>",
       HoldForm], 
      TagBox["\<\"Length\"\>",
       HoldForm], 
      TagBox["\<\"Focus\"\>",
       HoldForm], 
      TagBox["\<\"VAngle\"\>",
       HoldForm], 
      TagBox["\<\"HAngle\"\>",
       HoldForm], 
      TagBox["\<\"Type\"\>",
       HoldForm], 
      TagBox["\<\"Position\"\>",
       HoldForm]},
     {"1", "\<\"D1\"\>", "\<\"Drift\"\>", 
      "0.4725`", "\<\"---\"\>", "\<\"---\"\>", "\<\"---\"\>", "\<\"D1\"\>", 
      "0.4725`"},
     {"2", "\<\"Q1\"\>", "\<\"Quadrupole\"\>", "0.3`", 
      RowBox[{"-", "1.56339`"}], "\<\"---\"\>", "\<\"---\"\>", "\<\"Q1\"\>", 
      "0.7725`"},
     {"3", "\<\"D2\"\>", "\<\"Drift\"\>", 
      "2.167`", "\<\"---\"\>", "\<\"---\"\>", "\<\"---\"\>", "\<\"D2\"\>", 
      "2.9395`"},
     {"4", "\<\"Q2\"\>", "\<\"Quadrupole\"\>", "0.5`", 
      "1.27836`", "\<\"---\"\>", "\<\"---\"\>", "\<\"Q2\"\>", "3.4395`"},
     {"5", "\<\"D3\"\>", "\<\"Drift\"\>", 
      "0.3725`", "\<\"---\"\>", "\<\"---\"\>", "\<\"---\"\>", "\<\"D3\"\>", 
      "3.812`"},
     {"6", "\<\"BD\"\>", "\<\"SectorBend\"\>", "2.188001`", 
      "0.`", "\<\"---\"\>", "0.39269908169872414`", "\<\"BD\"\>", 
      "6.000000999999999`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Center}}, 
      "RowsIndexed" -> {}},
    GridBoxDividers->{
     "Columns" -> {False, True, {False}, False}, "ColumnsIndexed" -> {}, 
      "Rows" -> {False, True, {False}, False}, "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[2.0999999999999996`]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}],
   {OutputFormsDump`HeadedRows, OutputFormsDump`HeadedColumns}],
  Function[BoxForm`e$, 
   TableForm[
   BoxForm`e$, TableAlignments -> Center, 
    TableHeadings -> {
     Automatic, {
      "Name", "Element", "Length", "Focus", "VAngle", "HAngle", "Type", 
       "Position"}}]]]], "Print",
 CellChangeTimes->{3.5729419260436015`*^9}],

Cell[BoxData["\<\"Total Length = 6. m\"\>"], "Print",
 CellChangeTimes->{3.572941926059603*^9}]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"SRSC", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"SRS", ",", 
     RowBox[{"{", "16", "}"}]}], "]"}]}], ";"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"MADFlatten", "[", 
   RowBox[{"{", "SRSC", "}"}], "]"}], "//", "Length"}]], "Input"],

Cell[BoxData["96"], "Output",
 CellChangeTimes->{3.5729419260826054`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCFindPeriodicTwiss", "[", 
  RowBox[{"MLCOneTurnRMatrix", "[", 
   RowBox[{"MLCRMatrices", "[", 
    RowBox[{"{", "SRS", "}"}], "]"}], "]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "1.0608169331806936`", ",", "0.73731129631042`", ",", 
     "1.455131323213917`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"9.501299955419526`", ",", 
     RowBox[{"-", "2.1705055853288333`"}], ",", "0.6010855906813112`"}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.5729419261036077`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCOneTurnRMatrix", "[", 
   RowBox[{"MLCRMatrices", "[", 
    RowBox[{"{", "SRS", "}"}], "]"}], "]"}], "//", "MatrixForm"}]], "Input"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "0.30566124829773517`"}], "0.672705370513844`", "0.`", 
      "0.`", "0.`", "0.4241203169238611`"},
     {
      RowBox[{"-", "0.9227554965529403`"}], 
      RowBox[{"-", "1.2407769185979547`"}], "0.`", "0.`", "0.`", 
      "0.3826834323650898`"},
     {"0.`", "0.`", 
      RowBox[{"-", "1.7866584638973602`"}], "9.092001275778706`", "0.`", 
      "0.`"},
     {"0.`", "0.`", 
      RowBox[{"-", "0.5751919193130426`"}], "2.3673498599085177`", "0.`", 
      "0.`"},
     {
      RowBox[{"-", "0.2743878580016923`"}], 
      RowBox[{"-", "0.7836719001062433`"}], "0.`", "0.`", "1.`", 
      RowBox[{"-", "0.05580418131574283`"}]},
     {"0.`", "0.`", "0.`", "0.`", "0.`", "1.`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.57294192612461*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCFindPeriodicPhase", "[", 
  RowBox[{"MLCOneTurnRMatrix", "[", 
   RowBox[{"MLCRMatrices", "[", 
    RowBox[{"{", "SRS", "}"}], "]"}], "]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2.4546981920738395`", ",", "1.2762082483881871`"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.572941926143612*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MLCGenerateTwissTable", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"MADFlatten", "[", 
        RowBox[{"MADSplitElements", "[", 
         RowBox[{"SRS", ",", "10"}], "]"}], "]"}], "}"}], ",", 
      RowBox[{"MLCFindPeriodicTwiss", "[", "#", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"MLCFindPeriodicDispersion", "[", "#", "]"}]}], "]"}], "&"}], 
   "[", 
   RowBox[{"MLCOneTurnRMatrix", "[", 
    RowBox[{"MLCRMatrices", "[", 
     RowBox[{"{", "SRS", "}"}], "]"}], "]"}], "]"}], ";"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"mfsPlot", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"MLCS", ",", "MLCBETX"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"MLCS", ",", "MLCBETY"}], "}"}]}], "}"}], "]"}]], "Input"],

Cell[BoxData[
 GraphicsBox[{{}, 
   {RGBColor[1, 0, 0], AbsoluteThickness[2], AbsoluteDashing[{6}], 
    LineBox[CompressedData["
1:eJwt0gtQ03UcAPDxWLAXyGNBPnjJxsZuAUEiRn2/gIdn8hhC3JWiJMeYZkBU
asSBlaLUGaLGUvCGA6NOoo1juUygFiU2NoxHoDTcBP6wIQ0UfIxrtP/qe/e7
3/3u+/t9vr9X6L6SnYWuFAol0dHI3j58xMyN+RoSijN20get8N9YDYaOobjA
mXnolq2NMoRrwL9m0SU/5v7/+T6YWGj9waSwwCv00ebSl/WQaHm062KhGXqc
8wdB+P7E7JnMWdh7bTvTVTACyro9+ZriGVh1rh+DPjisEfxCgMza+tuO+HEo
q+J5D6QRAE5vAr4TlaW2MQhgt28zlfsbIaVd/MkElQAGmaabYChXebqAQ4AL
hYx7UBIwbJAcIOAxb3etZvkeFMhp5qwRAuaz1EHH5yZhSKvQq8UzMFnu7xCn
wM9WFlESPAu3SW50GtLdxZuqKGYY6CeDACHVIBEyLPDrMgnOwAdin0gbzsGP
Di1LPQtzqamslub70HSUq6lutUJvZlundWUJkhcL+vN2PARXPe9qd5Yd4uSd
8U80jyAgk3lCxqciN5vafGaLDTjGrt2bjzIx0D3XS9jxD7BP5fydU++Lx98Y
uj55joJn7WK3cmkA2js+fKAQueKprfVvf5ayAQ8zwnmVTHf8KOqd+q26UFwg
y/VR0fbV5aaEDA7uv/7e2cBjHqg8KRlpCefjQNj400qLB6a26yvEdj6+WJOU
Py3yRJ3OohpURGIDef9XPdEoHY6XJwjQhdzOBhq6HWjUsKUCLHJ6NPx+qmhk
5YYAdU6PhpFawRedWgHGOj06Lm5OHo2VC/C806MjcSN6u0uaAFdfIz0GqmTr
VZt+j8RCp8fAj0vrJRVBkdiyOJi+7xYDE/0u7kk+zcdJboxn23omKusap664
8TGMfE4JE41z52zqIzx8s26+AlRMvBla3bTfGoFNjt9T48LCg7Glf3YVReDd
lW8cIgtvhmQ3qkxcDCK5Cyw0mZ9/IMrjYp7YEQQLOz93G6u9w8HGht4QxQte
mOT9R3rZ6xwcv0Ue0AtPviXNfnI7HOV31N6fBq9BPcfcq3smDEfTjDHS1TW4
tqG2WfRTEDJ7PHJa7vrgFmJjXPHwc5gUE3VI2eOLy9Hvdqmz2HioOffLbpkf
RlVTf84AH7zCrrymrfJH8S66x0vbGGg8cfmvsb1sPEZbGvjWk4psW799Gp5F
oa+v9tL5VXj14FLIw+AAlJhC6Pr4x1A1sS6FQgnES4Zo4bqnC/AvqvO7Jw==

     "]], 
    {RGBColor[0, 0, 1], AbsoluteThickness[2], LineBox[CompressedData["
1:eJwt0g1Q02UcB/C9MthbgpsuQV7GXrCOOEjPu2k93xWcC+WUCvJUxOCWGXZY
7aaSQnaiIIe7wksNFYQhBh1OjmqRboFJQ8Y7CEoCjoZvwUQmEBpr/9Xv7rnn
nvs9z+f3vEVkZL+tZdBotLXeRvULffseKGIvkj1/XevZ/lEk/hubSVPnr7zP
+iNhKVsWc0fWTGpNKuE9tez/vI1EG2JvN16S4XXuQOWe1zqIJqsqezJUDqtv
fg95Hv9NxyGDHOmNb/EZL/cTTQhrVkdXwONbP0iipybv/65ToMxV3bJ+9RCp
vZZqzHmgAPF5w6SpZM2K4nQlxHXr7uaIRknL4VtNlgoleFSae5e01Yksmn4l
6DQqHORZ0tYUx4wSs1HbDM1PHeTLQplsKycKE8nm0PxHY6Q7sfyTUr8ojOWI
vOKfZMncaLLRrcQtihtwEudwktHQrUSnnYpxcqpox6ThrBLXn1LgPfLpj46g
x5uV+MWrJZvvE/tx8XgQS4nyLxTNR6pdxCNvUV3KkeGNqUx72vppMhBv330+
WIqVFQ2r55pnyMWbG+d62sOgeIdd+bVqnkzE1XcLfw6GhJUqjK7/hxw8Z9XO
zC1F/pbeK2MnaNj84r6GwmIRFuo/f2LaxEBu5dBVmz4Qe3myqFw+C8P7+5g7
dwnwmCpnYyOlbR39xHF/7LqiK5Ec5iBjTaBOksZCp3To79yHHJx02tqriplY
Vaje4dzkD/9qmWrCyUApdf8/+eNmgkjdmskAndrO8gA8tB8oMLAZ2OnzArBK
oUvn3aCj3ecFwJLlvrHfRMerPo+L3l4x56iZjtM+jwvtsQpdkoMOTwrl8fBS
9iFXyisMaH0eD6a+IMPpswwYp3qSMrp4uJ7VOlvlYWBMEev/fQgfAWuzXSFa
JqTUc37Ix8EEln6hnYn3v5o4QH7gI7ygoChRxUK59/cU0gV4wnweQ69hYeTZ
d15RALd5e6Z0ORuhFPetAPJqk7yuhI20D7wxLkB+x5TeKPDDmdLfwk1xQohi
pO+xi/ww1EUdUIgem7qli8dBxW3zC8fCFoHN2du8IYGLgQ2jsSc9i3Bk0H7+
glsAvpXzrnEkEDXnIuJc/ECoY2P0l61BMC+bYOVsWQx9ZeopS9lifDyqaZ12
iFErzm1syxOh1bUyb9sFCUaPVv0xmC6GXXNZ0WAMhnjevuAkS6B/dNU6fycU
ibvd4dNhSzGWFS2XrIhA3nDwmzSaBCN+8Zk1tEj8C8RTrfo=
      "]]}}, {}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->True,
  AxesLabel->{None, None},
  AxesOrigin->{0, 0},
  Method->{},
  PlotRange->{{0, 6.000000999999997}, {0, 13.897862111659908`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{0.12000001999999993`, 0.12000001999999993`}, {
   0.2779572422331982, 0.2779572422331982}}]], "Output",
 CellChangeTimes->{3.5729419262016172`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Last", "[", 
  RowBox[{
   RowBox[{"MLCMUX", "/", 
    RowBox[{"(", 
     RowBox[{"2", " ", "Pi"}], ")"}]}], "-", "MLCMUX"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"-", "2.06402084100655`"}]], "Output",
 CellChangeTimes->{3.5729419262146187`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCSRI", "[", "SRS", "]"}], "*", "16"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"2.7709054209941306`", " ", "Meter"}], ",", 
   FractionBox["1.1276965139743274`", "Meter"], ",", 
   FractionBox["0.20239725003442444`", 
    SuperscriptBox["Meter", "2"]], ",", 
   FractionBox["0.08925785408140936`", "Meter"], ",", 
   FractionBox["0.01906053897571271`", "Meter"]}], "}"}]], "Output",
 CellChangeTimes->{3.572941926384636*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLC\[Epsilon]", "[", 
  RowBox[{"SRSC", ",", "2000"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"107.74395551165485`", " ", "Meter", " ", "Nano"}]], "Output",
 CellChangeTimes->{3.572941926477645*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLC\[Epsilon]x", "[", 
  RowBox[{"SRSC", ",", "2000", ",", "0.01"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"106.67718367490579`", " ", "Meter", " ", "Nano"}]], "Output",
 CellChangeTimes->{3.5729419265006475`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLC\[Alpha]c", "[", "SRSC", "]"}]], "Input"],

Cell[BoxData["0.028863593324756655`"], "Output",
 CellChangeTimes->{3.5729419266706643`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCU0", "[", 
  RowBox[{"SRSC", ",", "2000"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"15.877160842507315`", " ", "ElectronVolt", " ", "Kilo"}]], "Output",
 CellChangeTimes->{3.572941926695667*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCES", "[", 
  RowBox[{"SRSC", ",", "2000"}], "]"}]], "Input"],

Cell[BoxData["5.067164557363318`*^-7"], "Output",
 CellChangeTimes->{3.5729419267146688`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCJx", "[", "SRSC", "]"}]], "Input"],

Cell[BoxData["0.9208494014343993`"], "Output",
 CellChangeTimes->{3.5729419267326703`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MLCJ\[Epsilon]", "[", "SRSC", "]"}]], "Input"],

Cell[BoxData["2.079150598565601`"], "Output",
 CellChangeTimes->{3.572941926754673*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"\[Xi]x", ",", "\[Xi]y"}], "}"}], "=", 
  RowBox[{"MLCChromaticity", "[", "SRSC", "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "10.379333073319597`"}], ",", 
   RowBox[{"-", "5.223909581511573`"}]}], "}"}]], "Output",
 CellChangeTimes->{3.5729419311301103`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCLinearDriftMatrix", "[", 
   RowBox[{"D1", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}], ".", 
  RowBox[{"{", 
   RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "1"}], 
   "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1.4725`", ",", "1.`", ",", "0.`", ",", "0.`", ",", "0.`", ",", "1.`"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.572941931215119*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perform Basic Optics Plots", "Subsection"],

Cell[CellGroupData[{

Cell["Beta Functions and Dispersion", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plot1", "=", 
   RowBox[{"MADDraw", "[", 
    RowBox[{"SRS", ",", 
     RowBox[{"Labels", "->", "False"}], ",", 
     RowBox[{"Lengths", "->", "False"}], ",", 
     RowBox[{"WidthScale", "->", "5"}], ",", 
     RowBox[{"Thick", "->", "0.002"}], ",", 
     RowBox[{"Imagesize", "->", "600"}], ",", 
     RowBox[{"Fontsize", "->", "10"}], ",", 
     RowBox[{"Bends", "->", "False"}], ",", 
     RowBox[{"Offset", "->", "30"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plot2", "=", 
   RowBox[{"mfsPlot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"MLCS", ",", "MLCBETX"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"MLCS", ",", "MLCBETY"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"MLCS", ",", 
         RowBox[{"10", " ", "MLCDY"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{"plot2", ",", "plot1", ",", 
   RowBox[{"Graphics", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Text", "[", 
       RowBox[{"\"\<Bx\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"21", ",", "24"}], "}"}]}], "]"}], ",", 
      RowBox[{"Text", "[", 
       RowBox[{"\"\<By\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"19", ",", "36"}], "}"}]}], "]"}], ",", 
      RowBox[{"Text", "[", 
       RowBox[{"\"\<10*Dx\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"8", ",", "2"}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
   RowBox[{"ImageSize", "->", 
    RowBox[{"{", 
     RowBox[{"600", ",", "400"}], "}"}]}], ",", 
   RowBox[{"PlotRange", "->", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"First", "[", "MLCS", "]"}], ",", 
        RowBox[{"Last", "[", "MLCS", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "40"}], "}"}]}], "}"}]}], ",", 
   RowBox[{"Frame", "->", "True"}], ",", 
   RowBox[{"DisplayFunction", "->", "$DisplayFunction"}], ",", 
   RowBox[{"BaseStyle", "->", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"FontFamily", "->", "\"\<Times\>\""}], ",", 
      RowBox[{"FontSize", "->", "18"}]}], "}"}]}], ",", 
   RowBox[{"FrameLabel", "->", 
    RowBox[{"{", 
     RowBox[{"\"\<s [m]\>\"", ",", "\"\<Optical Functions [m]\>\""}], 
     "}"}]}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Phase Advance and Tunes", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plot3", "=", 
   RowBox[{"MADDraw", "[", 
    RowBox[{"SRS", ",", 
     RowBox[{"Labels", "->", "False"}], ",", 
     RowBox[{"Lengths", "->", "False"}], ",", 
     RowBox[{"WidthScale", "->", "2"}], ",", 
     RowBox[{"Thick", "->", "0.002"}], ",", 
     RowBox[{"Imagesize", "->", "600"}], ",", 
     RowBox[{"Fontsize", "->", "10"}], ",", 
     RowBox[{"Bends", "->", "False"}], ",", 
     RowBox[{"Offset", "->", "6"}]}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plot4", "=", 
   RowBox[{"mfsPlot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"MLCS", ",", "MLCMUX"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"MLCS", ",", "MLCMUY"}], "}"}]}], "}"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{"plot3", ",", "plot4", ",", 
   RowBox[{"ImageSize", "->", 
    RowBox[{"{", 
     RowBox[{"600", ",", "400"}], "}"}]}], ",", 
   RowBox[{"PlotRange", "->", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"First", "[", "MLCS", "]"}], ",", 
        RowBox[{"Last", "[", "MLCS", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "8"}], "}"}]}], "}"}]}], ",", 
   RowBox[{"Frame", "->", "True"}], ",", 
   RowBox[{"DisplayFunction", "->", "$DisplayFunction"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"axistunex", "=", 
  RowBox[{"Last", "[", "MLCMUX", "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"axistuney", "=", 
  RowBox[{"Last", "[", "MLCMUY", "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"6", " ", "axistunex"}], ",", 
   RowBox[{"6", " ", "axistuney"}]}], "}"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "MLCBETX", "]"}], ",", 
   RowBox[{"Mean", "[", "MLCBETY", "]"}]}], "}"}]], "Input"],

Cell[BoxData[
 RowBox[{"mfsPlot", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"MLCS", ",", "MLCBETX"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"MLCS", ",", "MLCBETY"}], "}"}]}], "}"}], "]"}]], "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing Non-Paraxial Transport", "Section"],

Cell[CellGroupData[{

Cell["Creating Element Definitions", "Subsection"],

Cell[CellGroupData[{

Cell["Drifts", "Subsubsection"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D1", ",", "1", ",", "\"\<D1\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D2", ",", "1", ",", "\"\<D2\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quads", "Subsubsection"],

Cell[BoxData[
 RowBox[{"quad", "[", 
  RowBox[{"Q1", ",", "20", ",", "0.22", ",", "\"\<Q1\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"quad", "[", 
  RowBox[{"Q2", ",", "0.5", ",", 
   RowBox[{"-", "1"}], ",", "\"\<Q2\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Creating Lines", "Subsection"],

Cell[BoxData[
 RowBox[{"testline", ":=", 
  RowBox[{"{", 
   RowBox[{"D1", ",", "D1", ",", "D1", ",", "D1", ",", "D1"}], 
   "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"MADDraw", "[", "testline", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MLCGetElementLengths", "[", "testline", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MLCPropagateNonParaxialRay", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0.01", ",", "0", ",", "0", ",", "0.1", ",", "0"}], 
    "}"}], ",", 
   RowBox[{"MLCRMatrices", "[", "testline", "]"}], ",", 
   RowBox[{"MLCGetElementLengths", "[", "testline", "]"}]}], "]"}]], "Input"],

Cell[CellGroupData[{

Cell["Create Initial Distributions", "Subsubsection"],

Cell["\<\
Define desired bunch length (in picoseconds) - this is the RMS value - i.e. \
the Standard Deviation calculated from a set of samples will be this value.\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bunchlength", ":=", "0.2"}], ";"}]], "Input"],

Cell["\<\
Define energy spread (relative energy spread) - again, this is the rms value \
as above.\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"percent", ":=", 
   RowBox[{"10", "^", 
    RowBox[{"-", "2"}]}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"energyspread", ":=", 
  RowBox[{"0.0", " ", "percent"}]}]], "Input"],

Cell["Define energy chirp per/mm", "Text"],

Cell[BoxData[
 RowBox[{"energychirp", ":=", 
  RowBox[{"0.0", " ", 
   RowBox[{"percent", "/", "mm"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{"numberofparticles", ":=", 
  RowBox[{"10", "^", "3"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"normalisedemittance", ":=", 
  RowBox[{"5", " ", "mm", " ", "mrad"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"erlenergy", ":=", "2"}]], "Input"],

Cell[BoxData[
 RowBox[{"erlgamma", ":=", 
  RowBox[{"erlenergy", "/", 
   RowBox[{"Convert", "[", 
    RowBox[{
     RowBox[{"N", "[", 
      RowBox[{"ElectronMass", " ", 
       RowBox[{
        RowBox[{"c", "^", "2"}], "/", "MeV"}]}], "]"}], ",", "1"}], 
    "]"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{"emittance", ":=", 
  RowBox[{"normalisedemittance", " ", "/", "erlgamma"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"betxinitial", ",", "alfxinitial", ",", "gamxinitial"}], "}"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"betyinitial", ",", "alfyinitial", ",", "gamyinitial"}], "}"}]}],
    "}"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"MLCBetaGamma", "[", 
     RowBox[{"10", ",", "0"}], "]"}], ",", 
    RowBox[{"MLCBetaGamma", "[", 
     RowBox[{"10", ",", "0"}], "]"}]}], "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sigmaxinitial", "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"emittance", " ", "betxinitial"}], "]"}]}], ";", 
  RowBox[{"sigmayinitial", "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"emittance", " ", "betyinitial"}], "]"}]}], ";", 
  RowBox[{"sigmaxpinitial", "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"emittance", " ", "gamxinitial"}], "]"}]}], ";", 
  RowBox[{"sigmaypinitial", "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"emittance", " ", "gamxinitial"}], "]"}]}], ";"}]], "Input"],

Cell["Gaussian input distribution of particles:", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"glongdistribution", "=", 
   RowBox[{
    RowBox[{"Subscript", "[", 
     RowBox[{"c", ",", " ", "SI"}], "]"}], 
    RowBox[{"GaussianEnsemble", "[", 
     RowBox[{"numberofparticles", ",", "0", ",", 
      RowBox[{"bunchlength", " ", 
       RowBox[{"10", "^", 
        RowBox[{"-", "12"}]}]}], ",", "6"}], "]"}]}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ginputdistribution", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"GaussianEnsemble", "[", 
       RowBox[{
       "numberofparticles", ",", "0", ",", "sigmaxinitial", ",", "6"}], "]"}],
       ",", 
      RowBox[{"GaussianEnsemble", "[", 
       RowBox[{
       "numberofparticles", ",", "0", ",", "sigmaxpinitial", ",", "6"}], 
       "]"}], ",", 
      RowBox[{"GaussianEnsemble", "[", 
       RowBox[{
       "numberofparticles", ",", "0", ",", "sigmayinitial", ",", "6"}], "]"}],
       ",", 
      RowBox[{"GaussianEnsemble", "[", 
       RowBox[{
       "numberofparticles", ",", "0", ",", "sigmaypinitial", ",", "6"}], 
       "]"}], ",", "glongdistribution", ",", 
      RowBox[{
       RowBox[{"GaussianEnsemble", "[", 
        RowBox[{
        "numberofparticles", ",", "0", ",", "energyspread", ",", "6"}], "]"}],
        "+", 
       RowBox[{"energychirp", " ", "glongdistribution"}]}]}], "}"}], "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"mfsPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ginputdistribution", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "5"}], "]"}], "]"}], ",", 
      RowBox[{"ginputdistribution", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "6"}], "]"}], "]"}]}], "}"}], "}"}], ",", 
   RowBox[{"PlotJoined", "->", "False"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"10", "^", "15"}], "/", 
    RowBox[{"Subscript", "[", 
     RowBox[{"c", ",", " ", "SI"}], "]"}]}], " ", 
   RowBox[{"ginputdistribution", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "5"}], "]"}], "]"}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perform Tracking and Plot Results", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trackinglattice", "=", 
   RowBox[{"MADSplitElements", "[", 
    RowBox[{"testline", ",", "5"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trackingdata", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"MLCPropagateNonParaxialRay", "[", 
      RowBox[{"#", ",", 
       RowBox[{"MLCRMatrices", "[", "trackinglattice", "]"}], ",", 
       RowBox[{"MLCGetElementLengths", "[", "trackinglattice", "]"}]}], "]"}],
      "&"}], "/@", "ginputdistribution"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trackingdataparaxial", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"MLCPropagateRay", "[", 
      RowBox[{"#", ",", 
       RowBox[{"MLCRMatrices", "[", "trackinglattice", "]"}]}], "]"}], "&"}], 
    "/@", "ginputdistribution"}]}], ";"}]], "Input"],

Cell[BoxData[""], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Histogram", "[", 
   RowBox[{
    RowBox[{"1000", " ", 
     RowBox[{"trackingdata", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1", ",", "2"}], "]"}], "]"}]}], ",", 
    RowBox[{"BarStyle", "->", "Red"}], ",", 
    RowBox[{"Frame", "->", "True"}], ",", 
    RowBox[{"GridLines", "->", "None"}], ",", 
    RowBox[{"BaseStyle", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"FontFamily", "->", "\"\<Courier\>\""}], ",", 
       RowBox[{"FontSize", "->", "14"}]}], "}"}]}], ",", 
    RowBox[{"FrameLabel", "->", 
     RowBox[{"{", 
      RowBox[{"\"\<t [fs]\>\"", ",", "\"\<Frequency\>\"", ",", 
       RowBox[{"\"\<Divergence: \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"10", "^", "3"}], " ", 
          RowBox[{"StandardDeviation", "[", 
           RowBox[{"trackingdata", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1", ",", "2"}], "]"}], "]"}], "]"}]}], 
         "]"}], "<>", "\"\< mrad\>\""}], ",", "\"\<\>\""}], "}"}]}]}], "]"}], 
  "*)"}]], "Code",
 Background->None],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Histogram", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"10", "^", "15"}], " ", 
        RowBox[{"trackingdata", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"-", "1"}], ",", "5"}], "]"}], "]"}]}], ")"}], "/", 
      RowBox[{"Subscript", "[", 
       RowBox[{"c", ",", " ", "SI"}], "]"}]}], ",", 
     RowBox[{"BarStyle", "->", "Red"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}], ",", 
   RowBox[{"Histogram", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"10", "^", "15"}], " ", 
        RowBox[{"trackingdataparaxial", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"-", "1"}], ",", "5"}], "]"}], "]"}]}], ")"}], "/", 
      RowBox[{"Subscript", "[", 
       RowBox[{"c", ",", " ", "SI"}], "]"}]}], ",", 
     RowBox[{"BarStyle", "->", "Blue"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}], ",", 
   RowBox[{"Frame", "->", "True"}], ",", 
   RowBox[{"GridLines", "->", "None"}], ",", 
   RowBox[{"BaseStyle", "->", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"FontFamily", "->", "\"\<Courier\>\""}], ",", 
      RowBox[{"FontSize", "->", "14"}]}], "}"}]}], ",", 
   RowBox[{"FrameLabel", "->", 
    RowBox[{"{", 
     RowBox[{"\"\<t [fs]\>\"", ",", "\"\<Frequency\>\"", ",", 
      RowBox[{"\"\<Bunch Length: \>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"10", "^", "15"}], " ", 
           RowBox[{"StandardDeviation", "[", 
            RowBox[{"trackingdata", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"-", "1"}], ",", "5"}], "]"}], "]"}], "]"}]}], ")"}], 
         "/", 
         RowBox[{"Subscript", "[", 
          RowBox[{"c", ",", " ", "SI"}], "]"}]}], "]"}], "<>", "\"\</\>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"10", "^", "15"}], " ", 
           RowBox[{"StandardDeviation", "[", 
            RowBox[{"trackingdataparaxial", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"-", "1"}], ",", "5"}], "]"}], "]"}], "]"}]}], ")"}], 
         "/", 
         RowBox[{"Subscript", "[", 
          RowBox[{"c", ",", " ", "SI"}], "]"}]}], "]"}], "<>", 
       "\"\< fs\>\""}], ",", "\"\<\>\""}], "}"}]}], ",", 
   RowBox[{"DisplayFunction", "->", "$DisplayFunction"}], ",", 
   RowBox[{"ImageSize", "->", 
    RowBox[{"{", 
     RowBox[{"400", ",", "Automatic"}], "}"}]}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{",", 
  RowBox[{"AspectRatio", "->", "0.4`"}], ",", 
  RowBox[{"Frame", "->", "True"}], ",", 
  RowBox[{"GridLines", "->", "None"}], ",", 
  RowBox[{"BaseStyle", "->", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"FontFamily", "->", "\"\<Courier\>\""}], ",", 
     RowBox[{"FontSize", "->", "14"}]}], "}"}]}], ",", 
  RowBox[{"FrameLabel", "->", 
   RowBox[{"{", 
    RowBox[{"\"\<t [fs]\>\"", ",", "\"\<Frequency\>\"", ",", 
     RowBox[{"\"\<Bunch Length: \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"10", "^", "15"}], " ", 
          RowBox[{"StandardDeviation", "[", 
           RowBox[{"trackingdata", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "n", ",", "5"}], "]"}], "]"}], "]"}]}], 
         ")"}], "/", 
        RowBox[{"Subscript", "[", 
         RowBox[{"c", ",", " ", "SI"}], "]"}]}], "]"}], "<>", "\"\< fs\>\""}],
      ",", "\"\<\>\""}], "}"}]}], ",", 
  RowBox[{"DisplayFunction", "->", "$DisplayFunction"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"GraphicsRow", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Histogram", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"10", "^", "15"}], " ", 
             RowBox[{"trackingdata", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "n", ",", "5"}], "]"}], "]"}]}], ")"}], 
           "/", 
           RowBox[{"Subscript", "[", 
            RowBox[{"c", ",", " ", "SI"}], "]"}]}], ",", 
          RowBox[{"BarStyle", "->", "Red"}], ",", 
          RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}], ",", 
        RowBox[{"Histogram", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"10", "^", "15"}], " ", 
             RowBox[{"trackingdataparaxial", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "n", ",", "5"}], "]"}], "]"}]}], ")"}], 
           "/", 
           RowBox[{"Subscript", "[", 
            RowBox[{"c", ",", " ", "SI"}], "]"}]}], ",", 
          RowBox[{"BarStyle", "->", "Blue"}], ",", 
          RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}]}], "]"}], 
      ",", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"MADDraw", "[", 
         RowBox[{"trackinglattice", ",", 
          RowBox[{"Bends", "->", "False"}], ",", 
          RowBox[{"WidthScale", "->", "0.2`"}], ",", 
          RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Graphics", "[", 
           RowBox[{"{", 
            RowBox[{"Blue", ",", 
             RowBox[{"Line", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "1"}], "}"}]}], "}"}], "]"}]}], "}"}], 
           "]"}], "&"}], "[", 
         RowBox[{
          RowBox[{"MADGetLengths", "[", "trackinglattice", "]"}], "[", 
          RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "}"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"n", ",", "1", ",", 
     RowBox[{"Length", "[", 
      RowBox[{"MADGetLengths", "[", "trackinglattice", "]"}], "]"}]}], 
    "}"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Show", "[", "%", "]"}]], "Input"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Testing Phase Advance Calculations", "Section"],

Cell[CellGroupData[{

Cell["Additional MAD Functions", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADWriteInitialConditions", "[", 
   RowBox[{
   "ref_", ",", "lname_", ",", "lbetx_", ",", "lalfx_", ",", "lbety_", ",", 
    "lalfy_", ",", "ldx_", ",", "ldpx_", ",", "ldy_", ",", "ldpy_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{"datafile", ",", "\n", 
      RowBox[{"lname", "<>", "\"\<: beta0, &\\n\nbetx=\>\"", "<>", 
       RowBox[{"ToString", "[", "lbetx", "]"}], "<>", "\"\<,alfx=\>\"", "<>", 
       RowBox[{"ToString", "[", "lalfx", "]"}], "<>", "\"\<,&;\\n\nbety=\>\"",
        "<>", 
       RowBox[{"ToString", "[", "lbety", "]"}], "<>", "\"\<,alfy=\>\"", "<>", 
       RowBox[{"ToString", "[", "lalfy", "]"}], "<>", "\"\<,&;\\n\ndx=\>\"", "<>", 
       RowBox[{"ToString", "[", "ldx", "]"}], "<>", "\"\<,dpx=\>\"", "<>", 
       RowBox[{"ToString", "[", "ldpx", "]"}], "<>", "\"\<,&;\\n\ndy=\>\"", "<>", 
       RowBox[{"ToString", "[", "ldy", "]"}], "<>", "\"\<,dpy=\>\"", "<>", 
       RowBox[{"ToString", "[", "ldpy", "]"}], "<>", "\"\<;\\n\>\""}]}], 
     "]"}], ";", "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCreateTwissData", "[", 
   RowBox[{"ref_", ",", "deltap_", ",", "startlabel_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{"datafile", ",", "\n", 
      RowBox[{
      "\"\<print,full;\\n\nselect,flag=optics,full;\\n\noptics,Beta0=\>\"", "<>",
        "startlabel", "<>", 
       "\"\<,filename=\\\"twissoptics.txt\\\",deltap=\>\"", "<>", 
       RowBox[{"ToString", "[", "deltap", "]"}], "<>", 
       "\"\<,&\\n\ncolumns=name,s,l,betx,alfx,bety,alfy,mux,muy;\\n\>\""}]}], 
     "]"}], ";", "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCreateDispersionData", "[", 
   RowBox[{"ref_", ",", "deltap_", ",", "startlabel_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{"datafile", ",", "\n", 
      RowBox[{
      "\"\<print,full;\\n\nselect,flag=optics,full;\\n\noptics,Beta0=\>\"", "<>",
        "startlabel", "<>", 
       "\"\<,filename=\\\"dispersionoptics.txt\\\",deltap=\>\"", "<>", 
       RowBox[{"ToString", "[", "deltap", "]"}], "<>", 
       "\"\<,&\\n\ncolumns=name,s,dx,dpx,dy,dpy;\\n\>\""}]}], "]"}], ";", 
    "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCreateOrbitData", "[", 
   RowBox[{"ref_", ",", "deltap_", ",", "startlabel_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{"datafile", ",", "\n", 
      RowBox[{
      "\"\<print,full;\\n\nselect,flag=optics,full;\\n\noptics,Beta0=\>\"", "<>",
        "startlabel", "<>", 
       "\"\<,filename=\\\"orbitoptics.txt\\\",deltap=\>\"", "<>", 
       RowBox[{"ToString", "[", "deltap", "]"}], "<>", 
       "\"\<,&\\n\ncolumns=name,s,x,y;\\n\>\""}]}], "]"}], ";", "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCallFile", "[", 
   RowBox[{"ref_", ",", "filename_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{"datafile", ",", "\n", 
      RowBox[{"\"\<call,\>\"", "<>", 
       RowBox[{"ToString", "[", "filename", "]"}], "<>", "\"\<\\n\>\""}]}], 
     "]"}], ";", "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADMyTwiss", "[", "ref_", "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{
     "datafile", ",", "\n", "\"\<print,#s/#e;\\n\ntwiss,save;\\n\>\""}], 
     "]"}], ";", "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCreateOpticsData", "[", 
   RowBox[{"ref_", ",", "deltap_", ",", "startlabel_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"MADCreateTwissData", "[", 
     RowBox[{"ref", ",", "deltap", ",", "startlabel"}], "]"}], ";", 
    RowBox[{"MADCreateDispersionData", "[", 
     RowBox[{"ref", ",", "deltap", ",", "startlabel"}], "]"}], ";", 
    RowBox[{"MADCreateOrbitData", "[", 
     RowBox[{"ref", ",", "deltap", ",", "startlabel"}], "]"}], ";"}], 
   ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADReadOpticsData", "[", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"mfsInterpret", "[", 
     RowBox[{"tfsRead", "[", "\"\<twissoptics.txt\>\"", "]"}], "]"}], ";", 
    RowBox[{"mfsInterpret", "[", 
     RowBox[{"tfsRead", "[", "\"\<dispersionoptics.txt\>\"", "]"}], "]"}], 
    ";", 
    RowBox[{"mfsInterpret", "[", 
     RowBox[{"tfsRead", "[", "\"\<orbitoptics.txt\>\"", "]"}], "]"}], ";"}], 
   ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSave", "[", 
   RowBox[{"ref_", ",", "filename_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"datafile", "=", 
     RowBox[{"OpenAppend", "[", 
      RowBox[{"ToString", "[", 
       RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
    RowBox[{"WriteString", "[", 
     RowBox[{"datafile", ",", "\n", 
      RowBox[{
      "\"\<save,filename=\>\"", "<>", "filename", "<>", "\"\<;\\n\\n\>\""}]}],
      "]"}], ";", "\n", 
    RowBox[{"Close", "[", "datafile", "]"}], ";"}], "]"}]}]], "Input"],

Cell["\<\
errorstring[seed_]:=\"EOPT,SEED=\"<>ToString[seed]<>\",add;\\n
select,error,Pattern=\\\"BTSBPM.*\\\";\\n
ealign,mrex=0.2E-3*tgauss(2),mrey=0.2E-3*tgauss(2);\\n
select,error,clear;\\n
select,error,Pattern=\\\"FQ.*\\\";\\n
ealign,dx=0.2E-3*tgauss(2),dy=0.2E-3*tgauss(2);\\n
ealign,dpsi=0.4E-3*tgauss(2),dphi=0.4E-3*tgauss(2),dtheta=0.4E-3*tgauss(2);\\n
efield,dklr(2)=0.005*tgauss(1);\\n
select,error,clear;\\n
select,error,Pattern=\\\"DQ.*\\\";\\n
ealign,dx=0.2E-3*tgauss(2),dy=0.2E-3*tgauss(2);\\n
ealign,dpsi=0.4E-3*tgauss(2),dphi=0.4E-3*tgauss(2),dtheta=0.4E-3*tgauss(2);\\n
efield,dklr(2)=0.005*tgauss(1);\\n
select,error,clear;\\n
select,error,Pattern=\\\"PBEND.*\\\";\\n
ealign,dx=0.2E-3*tgauss(2),dy=0.2E-3*tgauss(2);\\n
ealign,ds=0.2E-3*tgauss(2);\\n
ealign,dpsi=0.4E-3*tgauss(2),dphi=0.4E-3*tgauss(2),dtheta=0.4E-3*tgauss(2);\\n
efield,dbl=4.3332E-5*tgauss(1),dblr=0.001*tgauss(1);\\n
select,error,clear;\\n
select,error,Pattern=\\\"FK\\\";\\n
ealign,dx=0.2E-3*tgauss(2),dy=0.2E-3*tgauss(2);\\n
ealign,ds=0.2E-3*tgauss(2);\\n
ealign,dpsi=0.4E-3*tgauss(2),dphi=0.4E-3*tgauss(2),dtheta=0.4E-3*tgauss(2);\\n
efield,dblr=0.0125*tgauss(1);\\n
select,error,clear;\\n
select,error,Pattern=\\\"PS\\\";\\n
ealign,dx=0.2E-3*tgauss(2),dy=0.2E-3*tgauss(2);\\n
ealign,ds=0.2E-3*tgauss(2);\\n
ealign,dpsi=0.4E-3*tgauss(2),dphi=0.4E-3*tgauss(2),dtheta=0.4E-3*tgauss(2);\\n
efield,dblr=0.0005*tgauss(1);\\n
select,error,clear;\\n
select,error,Pattern=\\\"MS\\\";\\n
ealign,dx=0.2E-3*tgauss(2),dy=0.2E-3*tgauss(2);\\n
ealign,ds=0.2E-3*tgauss(2);\\n
ealign,dpsi=0.4E-3*tgauss(2),dphi=0.4E-3*tgauss(2),dtheta=0.4E-3*tgauss(2);\\n
efield,dblr=0.0005*tgauss(1);\\n
select,error,clear;\\n
select,optics,full;\\n
optics,betx=12.1286,bety=2.94717,filename=optics.txt,columns=s,x,y,px,py;\\n\"\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"errorstring", "[", "seed_", "]"}], ":=", 
  RowBox[{"\"\<EOPT,SEED=\>\"", "<>", 
   RowBox[{"ToString", "[", "seed", "]"}], "<>", 
   "\"\<,add;\\n\nselect,error,Pattern=\\\"FK\\\";\\n\nefield,dblr=0.0125;\\n\
\nselect,error,clear;\\n\nselect,optics,full;\\n\n\
optics,betx=12.1286,bety=2.94717,filename=optics.txt,columns=s,x,y,px,py;\\n\>\
\""}]}]], "Input"],

Cell[BoxData[
 RowBox[{"errorstring", "[", "1", "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Creating Element Definitions", "Subsection"],

Cell[CellGroupData[{

Cell["Drifts", "Subsubsection"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D1", ",", "1", ",", "\"\<D1\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"drift", "[", 
  RowBox[{"D2", ",", "1", ",", "\"\<D2\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quads", "Subsubsection"],

Cell[BoxData[
 RowBox[{"quad", "[", 
  RowBox[{"Q1", ",", "20", ",", "0.22", ",", "\"\<Q1\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"quad", "[", 
  RowBox[{"Q2", ",", "0.5", ",", 
   RowBox[{"-", "1"}], ",", "\"\<Q2\>\"", ",", 
   RowBox[{"XAp", "->", "0.035"}], ",", 
   RowBox[{"YAp", "->", "0.01"}]}], "]"}]], "Input"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Creating Lines", "Subsection"],

Cell[BoxData[
 RowBox[{"testline", ":=", 
  RowBox[{"{", 
   RowBox[{"D1", ",", "D2"}], "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"MADDraw", "[", "testline", "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Optics Comparison", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"betxi", ",", "alfxi", ",", "betyi", ",", "alfyi"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{"20", ",", 
     RowBox[{"-", "2"}], ",", "2", ",", "0"}], "}"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"btstwissinitial", ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"MLCBetaGamma", "[", 
      RowBox[{"betxi", ",", "alfxi"}], "]"}], ",", 
     RowBox[{"MLCBetaGamma", "[", 
      RowBox[{"betyi", ",", "alfyi"}], "]"}]}], "}"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"btsdispinitial", ":=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], "}"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MLCGenerateTwissTable", "[", 
   RowBox[{
    RowBox[{"MADSplitElements", "[", 
     RowBox[{
      RowBox[{"{", "testline", "}"}], ",", "100"}], "]"}], ",", 
    "btstwissinitial", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0"}], "}"}], ",", "btsdispinitial"}], "]"}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"latticename", "=", "\"\<lattice\>\""}]], "Input"],

Cell[BoxData[
 RowBox[{"MADWrite", "[", 
  RowBox[{"latticename", ",", "testline", ",", 
   RowBox[{"Slice", "->", "10"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MADWriteInitialConditions", "[", 
  RowBox[{
  "latticename", ",", "\"\<btsstart\>\"", ",", "betxi", ",", "alfxi", ",", 
   "betyi", ",", "alfyi", ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0"}], 
  "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MADCreateOpticsData", "[", 
  RowBox[{"latticename", ",", "0", ",", "\"\<btsstart\>\""}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MADSave", "[", 
  RowBox[{"latticename", ",", "\"\<savedfile.mff\>\""}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RunMAD", "[", "\"\<lattice.mff\>\"", "]"}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"MADReadOpticsData", "[", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GAMX", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"ALFX", "^", "2"}]}], ")"}], "/", "BETX"}], "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GAMY", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"ALFY", "^", "2"}]}], ")"}], "/", "BETY"}], "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"plot1", "=", 
   RowBox[{"MADDraw", "[", 
    RowBox[{"testline", ",", 
     RowBox[{"Labels", "->", "False"}], ",", 
     RowBox[{"Lengths", "->", "False"}], ",", 
     RowBox[{"WidthScale", "->", "20"}], ",", 
     RowBox[{"Thick", "->", "0.002`"}], ",", 
     RowBox[{"Bends", "->", "False"}], ",", 
     RowBox[{"Offset", "->", "10"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}]}], ";", 
  RowBox[{"plot2", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"MLCS", ",", "MLCBETX"}], "}"}], "]"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}], ",", 
     RowBox[{"Joined", "->", "False"}], ",", 
     RowBox[{"PlotStyle", "->", 
      RowBox[{"{", 
       RowBox[{"Red", ",", 
        RowBox[{"AbsolutePointSize", "[", "5", "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"plot3", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"S", ",", "BETX"}], "}"}], "]"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}], ",", 
     RowBox[{"Joined", "->", "False"}], ",", 
     RowBox[{"PlotStyle", "->", 
      RowBox[{"{", 
       RowBox[{"Blue", ",", 
        RowBox[{"AbsolutePointSize", "[", "5", "]"}]}], "}"}]}]}], "]"}]}], 
  ";", 
  RowBox[{"plota", "=", 
   RowBox[{"Show", "[", 
    RowBox[{"plot3", ",", "plot2", ",", "plot1", ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"Last", "[", "MLCS", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "60"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"Frame", "->", "True"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}], ",", 
     RowBox[{"BaseStyle", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FontFamily", "->", "\"\<Times\>\""}], ",", 
        RowBox[{"FontSize", "->", "18"}]}], "}"}]}], ",", 
     RowBox[{"FrameLabel", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<s [m]\>\"", ",", "\"\<Optical Functions [m]\>\""}], 
       "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"plot4", "=", 
   RowBox[{"MADDraw", "[", 
    RowBox[{"testline", ",", 
     RowBox[{"Labels", "->", "False"}], ",", 
     RowBox[{"Lengths", "->", "False"}], ",", 
     RowBox[{"WidthScale", "->", "100"}], ",", 
     RowBox[{"Thick", "->", "0.002`"}], ",", 
     RowBox[{"Bends", "->", "False"}], ",", 
     RowBox[{"Offset", "->", "0"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}]}], "]"}]}], ";", 
  RowBox[{"plot5", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"MLCS", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"360", " ", "MLCMUX"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}], ",", 
     RowBox[{"Joined", "->", "False"}], ",", 
     RowBox[{"PlotStyle", "->", 
      RowBox[{"{", 
       RowBox[{"Red", ",", 
        RowBox[{"AbsolutePointSize", "[", "4", "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"plot6", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"S", ",", 
        RowBox[{"360", " ", "MUX"}]}], "}"}], "]"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}], ",", 
     RowBox[{"Joined", "->", "False"}], ",", 
     RowBox[{"PlotStyle", "->", 
      RowBox[{"{", 
       RowBox[{"Blue", ",", 
        RowBox[{"AbsolutePointSize", "[", "8", "]"}]}], "}"}]}]}], "]"}]}], 
  ";", 
  RowBox[{"plotb", "=", 
   RowBox[{"Show", "[", 
    RowBox[{"plot6", ",", "plot5", ",", "plot4", ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"Last", "[", "MLCS", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"50", "+", 
           RowBox[{"360", " ", 
            RowBox[{"Max", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"MLCMUX", "/", 
                RowBox[{"(", 
                 RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ",", "MUX"}], "}"}], 
             "]"}]}]}]}], "}"}]}], "}"}]}], ",", 
     RowBox[{"Frame", "->", "True"}], ",", 
     RowBox[{"DisplayFunction", "->", "Identity"}], ",", 
     RowBox[{"BaseStyle", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FontFamily", "->", "\"\<Times\>\""}], ",", 
        RowBox[{"FontSize", "->", "18"}]}], "}"}]}], ",", 
     RowBox[{"FrameLabel", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<s [m]\>\"", ",", "\"\<Phase Advance [deg]\>\""}], 
       "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"GraphicsRow", "[", 
    RowBox[{"{", 
     RowBox[{"plota", ",", "plotb"}], "}"}], "]"}], ",", 
   RowBox[{"DisplayFunction", "->", "$DisplayFunction"}], ",", 
   RowBox[{"ImageSize", "->", "800"}]}], "]"}]}], "Input"]
}, Closed]]
}, Closed]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1441, 945},
WindowMargins->{{166, Automatic}, {Automatic, 0}},
InputAliases->{"intt" -> RowBox[{"\[Integral]", 
     RowBox[{"\[SelectionPlaceholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "dintt" -> RowBox[{
     SubsuperscriptBox[
     "\[Integral]", "\[SelectionPlaceholder]", "\[Placeholder]"], 
     RowBox[{"\[Placeholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "sumt" -> RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "prodt" -> RowBox[{
     UnderoverscriptBox["\[Product]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "dt" -> RowBox[{
     SubscriptBox["\[PartialD]", "\[Placeholder]"], " ", 
     "\[SelectionPlaceholder]"}], "notation" -> RowBox[{"Notation", "[", 
     RowBox[{
       TagBox["\[SelectionPlaceholder]", "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftRightArrow]", " ", 
       TagBox["\[Placeholder]", "NotationTemplateTag"]}], "]"}], "notation>" -> 
  RowBox[{"Notation", "[", 
     RowBox[{
       TagBox["\[SelectionPlaceholder]", "NotationTemplateTag"], " ", 
       "\[DoubleLongRightArrow]", " ", 
       TagBox["\[Placeholder]", "NotationTemplateTag"]}], "]"}], "notation<" -> 
  RowBox[{"Notation", "[", 
     RowBox[{
       TagBox["\[SelectionPlaceholder]", "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftArrow]", " ", 
       TagBox["\[Placeholder]", "NotationTemplateTag"]}], "]"}], "symb" -> 
  RowBox[{"Symbolize", "[", 
     TagBox["\[SelectionPlaceholder]", "NotationTemplateTag"], "]"}], 
  "infixnotation" -> RowBox[{"InfixNotation", "[", 
     RowBox[{
       TagBox["\[SelectionPlaceholder]", "NotationTemplateTag"], ",", 
       "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
     RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
       TagBox["\[Placeholder]", "NotationTemplateTag"]}], "]"}], "pattwraper" -> 
  TagBox["\[SelectionPlaceholder]", "NotationPatternTag"], "madeboxeswraper" -> 
  TagBox["\[SelectionPlaceholder]", "NotationMadeBoxesTag"]},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 20, 0, 101, "Title"],
Cell[602, 24, 64, 3, 91, "Subtitle"],
Cell[669, 29, 81, 3, 91, "Subtitle"],
Cell[753, 34, 36, 0, 33, "Subsubtitle"],
Cell[CellGroupData[{
Cell[814, 38, 31, 0, 70, "Section"],
Cell[CellGroupData[{
Cell[870, 42, 31, 0, 70, "Subsection"],
Cell[904, 44, 353, 6, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1294, 55, 44, 0, 70, "Subsection"],
Cell[1341, 57, 334, 6, 70, "Text"],
Cell[CellGroupData[{
Cell[1700, 67, 36, 0, 70, "Subsubsection"],
Cell[1739, 69, 66, 0, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1842, 74, 36, 0, 70, "Subsubsection"],
Cell[1881, 76, 226, 4, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2144, 85, 36, 0, 70, "Subsubsection"],
Cell[2183, 87, 175, 3, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2395, 95, 36, 0, 70, "Subsubsection"],
Cell[2434, 97, 285, 5, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2756, 107, 40, 0, 70, "Subsubsection"],
Cell[2799, 109, 153, 3, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2989, 117, 36, 0, 70, "Subsubsection"],
Cell[3028, 119, 307, 5, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3372, 129, 36, 0, 70, "Subsubsection"],
Cell[3411, 131, 220, 4, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3668, 140, 36, 0, 70, "Subsubsection"],
Cell[3707, 142, 193, 4, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3937, 151, 37, 0, 70, "Subsubsection"],
Cell[3977, 153, 90, 2, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4104, 160, 37, 0, 70, "Subsubsection"],
Cell[4144, 162, 208, 4, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4389, 171, 37, 0, 70, "Subsubsection"],
Cell[4429, 173, 130, 3, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4596, 181, 37, 0, 70, "Subsubsection"],
Cell[4636, 183, 59, 0, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4732, 188, 37, 0, 70, "Subsubsection"],
Cell[4772, 190, 239, 5, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5048, 200, 37, 0, 70, "Subsubsection"],
Cell[5088, 202, 95, 2, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5220, 209, 37, 0, 70, "Subsubsection"],
Cell[5260, 211, 321, 5, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5618, 221, 37, 0, 70, "Subsubsection"],
Cell[5658, 223, 136, 3, 70, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5831, 231, 37, 0, 70, "Subsubsection"],
Cell[5871, 233, 140, 3, 70, "Text"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[6060, 242, 60, 0, 70, "Subsection"],
Cell[6123, 244, 832, 13, 70, "Text"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[7004, 263, 42, 0, 56, "Section"],
Cell[CellGroupData[{
Cell[7071, 267, 35, 0, 49, "Subsection"],
Cell[7109, 269, 99, 2, 30, "Input"],
Cell[7211, 273, 98, 2, 30, "Input"],
Cell[7312, 277, 107, 3, 30, "Text"],
Cell[7422, 282, 168, 3, 30, "Input"],
Cell[7593, 287, 168, 4, 30, "Input"],
Cell[7764, 293, 91, 2, 30, "Text"],
Cell[7858, 297, 66, 1, 30, "Input"],
Cell[7927, 300, 64, 1, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8028, 306, 74, 0, 49, "Subsection"],
Cell[8105, 308, 80, 1, 70, "Input"],
Cell[8188, 311, 80, 1, 70, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[8305, 317, 46, 0, 41, "Subsection"],
Cell[8354, 319, 194, 7, 70, "Input"],
Cell[8551, 328, 322, 10, 70, "Input"],
Cell[8876, 340, 90, 2, 70, "Input"],
Cell[8969, 344, 321, 10, 70, "Input"],
Cell[9293, 356, 90, 2, 70, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[9420, 363, 50, 0, 41, "Subsection"],
Cell[9473, 365, 5096, 149, 70, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[14618, 520, 34, 0, 70, "Section"],
Cell[CellGroupData[{
Cell[14677, 524, 42, 0, 39, "Subsubsection"],
Cell[14722, 526, 469, 11, 30, "Input",
 InitializationCell->True],
Cell[15194, 539, 160, 5, 30, "Input",
 InitializationCell->True],
Cell[15357, 546, 176, 6, 30, "Input",
 InitializationCell->True],
Cell[15536, 554, 165, 6, 30, "Input",
 InitializationCell->True],
Cell[15704, 562, 171, 6, 30, "Input",
 InitializationCell->True],
Cell[15878, 570, 222, 7, 30, "Input",
 InitializationCell->True],
Cell[16103, 579, 171, 6, 30, "Input",
 InitializationCell->True],
Cell[16277, 587, 175, 6, 30, "Input",
 InitializationCell->True],
Cell[16455, 595, 172, 6, 30, "Input",
 InitializationCell->True],
Cell[16630, 603, 169, 6, 30, "Input",
 InitializationCell->True],
Cell[16802, 611, 172, 6, 30, "Input",
 InitializationCell->True],
Cell[16977, 619, 182, 6, 30, "Input",
 InitializationCell->True],
Cell[17162, 627, 181, 6, 30, "Input",
 InitializationCell->True],
Cell[17346, 635, 175, 6, 30, "Input",
 InitializationCell->True],
Cell[17524, 643, 174, 6, 30, "Input",
 InitializationCell->True],
Cell[17701, 651, 178, 6, 30, "Input",
 InitializationCell->True],
Cell[17882, 659, 183, 6, 30, "Input",
 InitializationCell->True],
Cell[18068, 667, 176, 6, 30, "Input",
 InitializationCell->True],
Cell[18247, 675, 175, 6, 31, "Input",
 InitializationCell->True],
Cell[18425, 683, 172, 6, 31, "Input",
 InitializationCell->True],
Cell[18600, 691, 174, 6, 31, "Input",
 InitializationCell->True],
Cell[18777, 699, 174, 6, 31, "Input",
 InitializationCell->True],
Cell[18954, 707, 166, 6, 31, "Input",
 InitializationCell->True],
Cell[19123, 715, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[19286, 722, 168, 6, 31, "Input",
 InitializationCell->True],
Cell[19457, 730, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[19620, 737, 171, 6, 31, "Input",
 InitializationCell->True],
Cell[19794, 745, 171, 6, 31, "Input",
 InitializationCell->True],
Cell[19968, 753, 176, 6, 31, "Input",
 InitializationCell->True],
Cell[20147, 761, 173, 6, 31, "Input",
 InitializationCell->True],
Cell[20323, 769, 173, 6, 31, "Input",
 InitializationCell->True],
Cell[20499, 777, 183, 6, 31, "Input",
 InitializationCell->True],
Cell[20685, 785, 174, 6, 31, "Input",
 InitializationCell->True],
Cell[20862, 793, 158, 5, 31, "Input",
 InitializationCell->True],
Cell[21023, 800, 173, 6, 31, "Input",
 InitializationCell->True],
Cell[21199, 808, 181, 6, 31, "Input",
 InitializationCell->True],
Cell[21383, 816, 179, 6, 31, "Input",
 InitializationCell->True],
Cell[21565, 824, 167, 6, 31, "Input",
 InitializationCell->True],
Cell[21735, 832, 168, 6, 31, "Input",
 InitializationCell->True],
Cell[21906, 840, 173, 6, 31, "Input",
 InitializationCell->True],
Cell[22082, 848, 387, 9, 31, "Input",
 InitializationCell->True],
Cell[22472, 859, 285, 7, 31, "Input",
 InitializationCell->True],
Cell[22760, 868, 186, 6, 31, "Input",
 InitializationCell->True],
Cell[22949, 876, 166, 6, 31, "Input",
 InitializationCell->True],
Cell[23118, 884, 167, 6, 31, "Input",
 InitializationCell->True],
Cell[23288, 892, 168, 6, 31, "Input",
 InitializationCell->True],
Cell[23459, 900, 159, 5, 31, "Input",
 InitializationCell->True],
Cell[23621, 907, 174, 6, 31, "Input",
 InitializationCell->True],
Cell[23798, 915, 181, 6, 31, "Input",
 InitializationCell->True],
Cell[23982, 923, 177, 6, 31, "Input",
 InitializationCell->True],
Cell[24162, 931, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[24325, 938, 181, 6, 31, "Input",
 InitializationCell->True],
Cell[24509, 946, 155, 5, 31, "Input",
 InitializationCell->True],
Cell[24667, 953, 172, 6, 31, "Input",
 InitializationCell->True],
Cell[24842, 961, 167, 6, 31, "Input",
 InitializationCell->True],
Cell[25012, 969, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[25175, 976, 155, 5, 31, "Input",
 InitializationCell->True],
Cell[25333, 983, 158, 5, 31, "Input",
 InitializationCell->True],
Cell[25494, 990, 155, 5, 31, "Input",
 InitializationCell->True],
Cell[25652, 997, 158, 5, 31, "Input",
 InitializationCell->True],
Cell[25813, 1004, 155, 5, 31, "Input",
 InitializationCell->True],
Cell[25971, 1011, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[26134, 1018, 155, 5, 31, "Input",
 InitializationCell->True],
Cell[26292, 1025, 164, 6, 31, "Input",
 InitializationCell->True],
Cell[26459, 1033, 156, 5, 31, "Input",
 InitializationCell->True],
Cell[26618, 1040, 155, 5, 31, "Input",
 InitializationCell->True],
Cell[26776, 1047, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[26939, 1054, 164, 6, 31, "Input",
 InitializationCell->True],
Cell[27106, 1062, 154, 5, 31, "Input",
 InitializationCell->True],
Cell[27263, 1069, 153, 5, 31, "Input",
 InitializationCell->True],
Cell[27419, 1076, 153, 5, 31, "Input",
 InitializationCell->True],
Cell[27575, 1083, 165, 6, 31, "Input",
 InitializationCell->True],
Cell[27743, 1091, 153, 5, 31, "Input",
 InitializationCell->True],
Cell[27899, 1098, 158, 5, 31, "Input",
 InitializationCell->True],
Cell[28060, 1105, 158, 5, 31, "Input",
 InitializationCell->True],
Cell[28221, 1112, 170, 6, 31, "Input",
 InitializationCell->True],
Cell[28394, 1120, 165, 6, 31, "Input",
 InitializationCell->True],
Cell[28562, 1128, 165, 6, 31, "Input",
 InitializationCell->True],
Cell[28730, 1136, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[28893, 1143, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[29056, 1150, 168, 6, 31, "Input",
 InitializationCell->True],
Cell[29227, 1158, 168, 6, 31, "Input",
 InitializationCell->True],
Cell[29398, 1166, 166, 6, 31, "Input",
 InitializationCell->True],
Cell[29567, 1174, 165, 6, 31, "Input",
 InitializationCell->True],
Cell[29735, 1182, 165, 6, 31, "Input",
 InitializationCell->True],
Cell[29903, 1190, 165, 6, 31, "Input",
 InitializationCell->True],
Cell[30071, 1198, 167, 6, 31, "Input",
 InitializationCell->True],
Cell[30241, 1206, 167, 6, 31, "Input",
 InitializationCell->True],
Cell[30411, 1214, 171, 6, 31, "Input",
 InitializationCell->True],
Cell[30585, 1222, 170, 6, 31, "Input",
 InitializationCell->True],
Cell[30758, 1230, 171, 6, 31, "Input",
 InitializationCell->True],
Cell[30932, 1238, 174, 6, 31, "Input",
 InitializationCell->True],
Cell[31109, 1246, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[31272, 1253, 195, 6, 31, "Input",
 InitializationCell->True],
Cell[31470, 1261, 196, 6, 31, "Input",
 InitializationCell->True],
Cell[31669, 1269, 199, 6, 31, "Input",
 InitializationCell->True],
Cell[31871, 1277, 185, 5, 31, "Input",
 InitializationCell->True],
Cell[32059, 1284, 1356, 44, 292, "Input",
 InitializationCell->True],
Cell[33418, 1330, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[33581, 1337, 160, 5, 31, "Input",
 InitializationCell->True],
Cell[33744, 1344, 185, 6, 31, "Input",
 InitializationCell->True],
Cell[33932, 1352, 120, 3, 31, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[34089, 1360, 47, 0, 39, "Subsubsection"],
Cell[34139, 1362, 207, 4, 70, "Text"],
Cell[34349, 1368, 638, 20, 70, "Input",
 InitializationCell->True],
Cell[34990, 1390, 217, 6, 70, "Input",
 InitializationCell->True],
Cell[35210, 1398, 218, 6, 70, "Input",
 InitializationCell->True],
Cell[35431, 1406, 106, 1, 70, "Text"],
Cell[35540, 1409, 447, 13, 70, "Input",
 InitializationCell->True],
Cell[35990, 1424, 178, 4, 70, "Text"],
Cell[36171, 1430, 423, 12, 70, "Input",
 InitializationCell->True],
Cell[36597, 1444, 180, 4, 70, "Text"],
Cell[36780, 1450, 184, 4, 70, "Text"],
Cell[36967, 1456, 171, 4, 70, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[37175, 1465, 41, 0, 33, "Subsubsection"],
Cell[37219, 1467, 463, 14, 70, "Input",
 InitializationCell->True],
Cell[37685, 1483, 267, 8, 70, "Input",
 InitializationCell->True],
Cell[37955, 1493, 612, 19, 70, "Input",
 InitializationCell->True],
Cell[38570, 1514, 310, 10, 70, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[38917, 1529, 51, 0, 33, "Subsubsection"],
Cell[38971, 1531, 169, 5, 31, "Input",
 InitializationCell->True],
Cell[39143, 1538, 174, 5, 31, "Input",
 InitializationCell->True],
Cell[39320, 1545, 525, 16, 31, "Input",
 InitializationCell->True],
Cell[39848, 1563, 138, 4, 31, "Input",
 InitializationCell->True],
Cell[39989, 1569, 1140, 34, 151, "Input",
 InitializationCell->True],
Cell[41132, 1605, 292, 8, 31, "Input",
 InitializationCell->True],
Cell[41427, 1615, 289, 8, 31, "Input",
 InitializationCell->True],
Cell[41719, 1625, 286, 8, 31, "Input",
 InitializationCell->True],
Cell[42008, 1635, 249, 7, 31, "Input",
 InitializationCell->True],
Cell[42260, 1644, 2593, 65, 83, "Input",
 InitializationCell->True],
Cell[44856, 1711, 4334, 116, 112, "Input"],
Cell[49193, 1829, 3421, 89, 212, "Input",
 InitializationCell->True],
Cell[52617, 1920, 5778, 147, 212, "Input",
 InitializationCell->True],
Cell[58398, 2069, 2069, 59, 72, "Input",
 InitializationCell->True],
Cell[60470, 2130, 6209, 173, 182, "Input",
 InitializationCell->True],
Cell[66682, 2305, 1628, 46, 52, "Input",
 InitializationCell->True],
Cell[68313, 2353, 1186, 32, 52, "Input",
 InitializationCell->True],
Cell[69502, 2387, 1663, 46, 72, "Input",
 InitializationCell->True],
Cell[71168, 2435, 1908, 53, 112, "Input",
 InitializationCell->True],
Cell[73079, 2490, 2735, 70, 112, "Input",
 InitializationCell->True],
Cell[75817, 2562, 2992, 84, 207, "Input",
 InitializationCell->True],
Cell[78812, 2648, 47, 0, 30, "Text"],
Cell[78862, 2650, 3087, 87, 209, "Code"],
Cell[81952, 2739, 6911, 175, 232, "Input"],
Cell[88866, 2916, 8998, 222, 292, "Input",
 InitializationCell->True],
Cell[97867, 3140, 133, 3, 30, "Text"],
Cell[98003, 3145, 10139, 290, 905, "Input",
 InitializationCell->True],
Cell[108145, 3437, 258, 5, 30, "Text"],
Cell[108406, 3444, 660, 22, 46, "Input",
 InitializationCell->True],
Cell[109069, 3468, 212, 6, 46, "Input",
 InitializationCell->True],
Cell[109284, 3476, 263, 8, 46, "Input",
 InitializationCell->True],
Cell[109550, 3486, 13622, 376, 654, "Input",
 InitializationCell->True],
Cell[123175, 3864, 3412, 71, 411, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[126624, 3940, 40, 0, 39, "Subsubsection"],
Cell[126667, 3942, 442, 13, 30, "Input",
 InitializationCell->True],
Cell[127112, 3957, 218, 6, 30, "Input",
 InitializationCell->True],
Cell[127333, 3965, 979, 30, 30, "Input",
 InitializationCell->True],
Cell[128315, 3997, 812, 28, 30, "Input",
 InitializationCell->True],
Cell[129130, 4027, 2941, 87, 164, "Input",
 InitializationCell->True],
Cell[132074, 4116, 4973, 163, 88, "Input",
 InitializationCell->True],
Cell[137050, 4281, 583, 20, 30, "Input",
 InitializationCell->True],
Cell[137636, 4303, 475, 16, 30, "Input",
 InitializationCell->True],
Cell[138114, 4321, 1288, 43, 30, "Input",
 InitializationCell->True],
Cell[139405, 4366, 242, 7, 30, "Input",
 InitializationCell->True],
Cell[139650, 4375, 213, 7, 30, "Input",
 InitializationCell->True],
Cell[139866, 4384, 287, 8, 30, "Input",
 InitializationCell->True],
Cell[140156, 4394, 589, 19, 46, "Input",
 InitializationCell->True],
Cell[140748, 4415, 475, 13, 46, "Input",
 InitializationCell->True],
Cell[141226, 4430, 482, 13, 46, "Input",
 InitializationCell->True],
Cell[141711, 4445, 1142, 36, 62, "Text",
 InitializationCell->True],
Cell[142856, 4483, 1303, 39, 46, "Input",
 InitializationCell->True],
Cell[144162, 4524, 379, 7, 49, "Text"],
Cell[144544, 4533, 357, 9, 30, "Input",
 InitializationCell->True],
Cell[144904, 4544, 4722, 131, 183, "Input",
 InitializationCell->True],
Cell[149629, 4677, 239, 7, 31, "Input",
 InitializationCell->True],
Cell[149871, 4686, 381, 12, 31, "Input",
 InitializationCell->True],
Cell[150255, 4700, 408, 12, 31, "Input",
 InitializationCell->True],
Cell[150666, 4714, 5621, 148, 232, "Input",
 InitializationCell->True],
Cell[156290, 4864, 348, 7, 70, "Input"],
Cell[156641, 4873, 3190, 87, 70, "Input",
 InitializationCell->True],
Cell[159834, 4962, 2725, 74, 70, "Input",
 InitializationCell->True],
Cell[162562, 5038, 371, 12, 70, "Input",
 InitializationCell->True],
Cell[162936, 5052, 239, 7, 70, "Input",
 InitializationCell->True],
Cell[163178, 5061, 381, 12, 70, "Input",
 InitializationCell->True],
Cell[163562, 5075, 209, 7, 70, "Input",
 InitializationCell->True],
Cell[163774, 5084, 840, 27, 70, "Input",
 InitializationCell->True],
Cell[164617, 5113, 806, 24, 70, "Input",
 InitializationCell->True],
Cell[165426, 5139, 529, 15, 70, "Input",
 InitializationCell->True],
Cell[165958, 5156, 348, 12, 70, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[166343, 5173, 51, 0, 70, "Subsubsection"],
Cell[166397, 5175, 751, 12, 70, "Text"],
Cell[167151, 5189, 2606, 73, 70, "Input",
 InitializationCell->True],
Cell[169760, 5264, 3155, 85, 70, "Input",
 InitializationCell->True],
Cell[172918, 5351, 62, 1, 70, "Input"],
Cell[172983, 5354, 469, 13, 70, "Input"],
Cell[173455, 5369, 71, 1, 70, "Input"],
Cell[173529, 5372, 392, 12, 70, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[173958, 5389, 38, 0, 70, "Subsubsection"],
Cell[173999, 5391, 171, 5, 70, "Input",
 InitializationCell->True],
Cell[174173, 5398, 8346, 206, 70, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[182556, 5609, 44, 0, 70, "Subsubsection"],
Cell[182603, 5611, 494, 15, 70, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[183134, 5631, 99, 2, 70, "Subsubsection"],
Cell[183236, 5635, 1730, 51, 70, "Input",
 InitializationCell->True],
Cell[184969, 5688, 3477, 96, 70, "Input",
 InitializationCell->True],
Cell[188449, 5786, 530, 17, 70, "Input",
 InitializationCell->True],
Cell[188982, 5805, 561, 18, 70, "Input",
 InitializationCell->True],
Cell[189546, 5825, 569, 18, 70, "Input",
 InitializationCell->True],
Cell[190118, 5845, 561, 18, 70, "Input",
 InitializationCell->True],
Cell[190682, 5865, 1896, 55, 70, "Input",
 InitializationCell->True],
Cell[192581, 5922, 3488, 96, 70, "Input",
 InitializationCell->True],
Cell[196072, 6020, 6717, 178, 70, "Input",
 InitializationCell->True],
Cell[202792, 6200, 3205, 88, 70, "Input",
 InitializationCell->True],
Cell[206000, 6290, 2688, 75, 70, "Input",
 InitializationCell->True],
Cell[208691, 6367, 240, 7, 70, "Input",
 InitializationCell->True],
Cell[208934, 6376, 810, 23, 70, "Input",
 InitializationCell->True],
Cell[209747, 6401, 741, 23, 70, "Input",
 InitializationCell->True],
Cell[210491, 6426, 1482, 42, 70, "Input",
 InitializationCell->True],
Cell[211976, 6470, 899, 27, 70, "Input",
 InitializationCell->True],
Cell[212878, 6499, 543, 16, 70, "Input",
 InitializationCell->True],
Cell[213424, 6517, 552, 16, 70, "Input",
 InitializationCell->True],
Cell[213979, 6535, 1481, 42, 70, "Input",
 InitializationCell->True],
Cell[215463, 6579, 1361, 38, 70, "Input",
 InitializationCell->True],
Cell[216827, 6619, 1328, 38, 70, "Input",
 InitializationCell->True],
Cell[218158, 6659, 1379, 38, 70, "Input",
 InitializationCell->True],
Cell[219540, 6699, 403, 12, 70, "Input",
 InitializationCell->True],
Cell[219946, 6713, 459, 14, 70, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[220442, 6732, 34, 0, 70, "Subsubsection"],
Cell[220479, 6734, 1884, 53, 70, "Input",
 InitializationCell->True],
Cell[222366, 6789, 896, 27, 70, "Input",
 InitializationCell->True],
Cell[223265, 6818, 1889, 53, 70, "Input",
 InitializationCell->True],
Cell[225157, 6873, 901, 27, 70, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[226095, 6905, 37, 0, 70, "Subsubsection"],
Cell[226135, 6907, 3752, 105, 70, "Input",
 InitializationCell->True],
Cell[229890, 7014, 3767, 105, 70, "Input",
 InitializationCell->True],
Cell[233660, 7121, 3810, 108, 70, "Input",
 InitializationCell->True],
Cell[237473, 7231, 3807, 108, 70, "Input",
 InitializationCell->True],
Cell[241283, 7341, 2546, 73, 70, "Input",
 InitializationCell->True],
Cell[243832, 7416, 2556, 73, 70, "Input",
 InitializationCell->True],
Cell[246391, 7491, 2619, 75, 70, "Input",
 InitializationCell->True],
Cell[249013, 7568, 2631, 75, 70, "Input",
 InitializationCell->True],
Cell[251647, 7645, 3423, 95, 70, "Input",
 InitializationCell->True],
Cell[255073, 7742, 3551, 98, 70, "Input",
 InitializationCell->True],
Cell[258627, 7842, 4245, 116, 70, "Input",
 InitializationCell->True],
Cell[262875, 7960, 4365, 119, 70, "Input",
 InitializationCell->True],
Cell[267243, 8081, 3810, 108, 70, "Input",
 InitializationCell->True],
Cell[271056, 8191, 2631, 75, 70, "Input",
 InitializationCell->True],
Cell[273690, 8268, 4745, 128, 70, "Input",
 InitializationCell->True],
Cell[278438, 8398, 4726, 128, 70, "Input",
 InitializationCell->True],
Cell[283167, 8528, 3813, 108, 70, "Input",
 InitializationCell->True],
Cell[286983, 8638, 2633, 75, 70, "Input",
 InitializationCell->True],
Cell[289619, 8715, 582, 18, 70, "Input",
 InitializationCell->True],
Cell[290204, 8735, 538, 16, 70, "Input",
 InitializationCell->True],
Cell[290745, 8753, 580, 18, 70, "Input",
 InitializationCell->True],
Cell[291328, 8773, 536, 16, 70, "Input",
 InitializationCell->True],
Cell[291867, 8791, 1324, 43, 70, "Input",
 InitializationCell->True],
Cell[293194, 8836, 1330, 43, 70, "Input",
 InitializationCell->True],
Cell[294527, 8881, 1130, 35, 70, "Input",
 InitializationCell->True],
Cell[295660, 8918, 1136, 35, 70, "Input",
 InitializationCell->True],
Cell[296799, 8955, 358, 11, 70, "Input",
 InitializationCell->True],
Cell[297160, 8968, 311, 9, 70, "Input",
 InitializationCell->True],
Cell[297474, 8979, 574, 18, 70, "Input",
 InitializationCell->True],
Cell[298051, 8999, 338, 10, 70, "Input",
 InitializationCell->True],
Cell[298392, 9011, 1614, 48, 70, "Input",
 InitializationCell->True],
Cell[300009, 9061, 2653, 77, 70, "Input",
 InitializationCell->True],
Cell[302665, 9140, 1147, 35, 70, "Input",
 InitializationCell->True],
Cell[303815, 9177, 1627, 49, 70, "Input",
 InitializationCell->True],
Cell[305445, 9228, 3970, 112, 70, "Input",
 InitializationCell->True],
Cell[309418, 9342, 868, 27, 70, "Input",
 InitializationCell->True],
Cell[310289, 9371, 865, 27, 70, "Input",
 InitializationCell->True],
Cell[311157, 9400, 535, 16, 70, "Input",
 InitializationCell->True],
Cell[311695, 9418, 1784, 52, 70, "Input",
 InitializationCell->True],
Cell[313482, 9472, 842, 26, 70, "Input",
 InitializationCell->True],
Cell[314327, 9500, 1131, 35, 70, "Input",
 InitializationCell->True],
Cell[315461, 9537, 377, 11, 70, "Input",
 InitializationCell->True],
Cell[315841, 9550, 3866, 108, 70, "Input",
 InitializationCell->True],
Cell[319710, 9660, 450, 15, 70, "Input",
 InitializationCell->True],
Cell[320163, 9677, 4004, 109, 70, "Input",
 InitializationCell->True],
Cell[324170, 9788, 4181, 116, 70, "Input",
 InitializationCell->True],
Cell[328354, 9906, 339, 10, 70, "Input",
 InitializationCell->True],
Cell[328696, 9918, 2926, 83, 70, "Input",
 InitializationCell->True],
Cell[331625, 10003, 3255, 93, 70, "Input",
 InitializationCell->True],
Cell[334883, 10098, 339, 10, 70, "Input",
 InitializationCell->True],
Cell[335225, 10110, 355, 10, 70, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[335617, 10125, 45, 0, 70, "Subsubsection"],
Cell[335665, 10127, 97, 3, 70, "Input",
 InitializationCell->True],
Cell[335765, 10132, 104, 3, 70, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[335918, 10141, 40, 0, 70, "Section"],
Cell[335961, 10143, 52, 1, 70, "Input"],
Cell[336016, 10146, 246, 8, 70, "Input"],
Cell[336265, 10156, 52, 1, 70, "Input"],
Cell[CellGroupData[{
Cell[336342, 10161, 50, 0, 70, "Subsection"],
Cell[CellGroupData[{
Cell[336417, 10165, 31, 0, 70, "Subsubsection"],
Cell[336451, 10167, 187, 4, 70, "Input"],
Cell[336641, 10173, 186, 4, 70, "Input"],
Cell[336830, 10179, 187, 4, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[337054, 10188, 30, 0, 70, "Subsubsection"],
Cell[337087, 10190, 392, 10, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[337516, 10205, 30, 0, 70, "Subsubsection"],
Cell[337549, 10207, 220, 5, 70, "Input"],
Cell[337772, 10214, 201, 4, 70, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[338022, 10224, 36, 0, 70, "Subsection"],
Cell[CellGroupData[{
Cell[338083, 10228, 148, 4, 70, "Input"],
Cell[338234, 10234, 1406, 33, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[339677, 10272, 62, 1, 70, "Input"],
Cell[339742, 10275, 2070, 36, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[341849, 10316, 346, 9, 70, "Input"],
Cell[342198, 10327, 1113, 19, 70, "Message"],
Cell[343314, 10348, 3864, 60, 70, "Message"],
Cell[347181, 10410, 13072, 288, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[360290, 10703, 194, 5, 70, "Input"],
Cell[360487, 10710, 1675, 38, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[362199, 10753, 147, 4, 70, "Input"],
Cell[362349, 10759, 120, 3, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[362506, 10767, 208, 6, 70, "Input"],
Cell[362717, 10775, 183, 5, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[362937, 10785, 62, 1, 70, "Input"],
Cell[CellGroupData[{
Cell[363024, 10790, 2284, 61, 70, "Print"],
Cell[365311, 10853, 95, 1, 70, "Print"]
}, Open  ]]
}, Open  ]],
Cell[365433, 10858, 157, 5, 70, "Input"],
Cell[CellGroupData[{
Cell[365615, 10867, 119, 3, 70, "Input"],
Cell[365737, 10872, 73, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[365847, 10878, 184, 4, 70, "Input"],
Cell[366034, 10884, 376, 11, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[366447, 10900, 170, 4, 70, "Input"],
Cell[366620, 10906, 1298, 34, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[367955, 10945, 184, 4, 70, "Input"],
Cell[368142, 10951, 154, 4, 70, "Output"]
}, Open  ]],
Cell[368311, 10958, 618, 17, 70, "Input"],
Cell[CellGroupData[{
Cell[368954, 10979, 227, 7, 70, "Input"],
Cell[369184, 10988, 3184, 59, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[372405, 11052, 166, 5, 70, "Input"],
Cell[372574, 11059, 105, 2, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[372716, 11066, 85, 2, 70, "Input"],
Cell[372804, 11070, 396, 9, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[373237, 11084, 95, 2, 70, "Input"],
Cell[373335, 11088, 127, 2, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[373499, 11095, 109, 2, 70, "Input"],
Cell[373611, 11099, 129, 2, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[373777, 11106, 68, 1, 70, "Input"],
Cell[373848, 11109, 92, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[373977, 11115, 87, 2, 70, "Input"],
Cell[374067, 11119, 134, 2, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[374238, 11126, 87, 2, 70, "Input"],
Cell[374328, 11130, 93, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[374458, 11136, 61, 1, 70, "Input"],
Cell[374522, 11139, 90, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[374649, 11145, 70, 1, 70, "Input"],
Cell[374722, 11148, 87, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[374846, 11154, 151, 4, 70, "Input"],
Cell[375000, 11160, 190, 5, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[375227, 11170, 242, 7, 70, "Input"],
Cell[375472, 11179, 177, 5, 70, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[375698, 11190, 48, 0, 70, "Subsection"],
Cell[CellGroupData[{
Cell[375771, 11194, 54, 0, 70, "Subsubsection"],
Cell[375828, 11196, 545, 13, 70, "Input"],
Cell[376376, 11211, 469, 14, 70, "Input"],
Cell[376848, 11227, 1405, 40, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[378290, 11272, 48, 0, 70, "Subsubsection"],
Cell[378341, 11274, 486, 12, 70, "Input"],
Cell[378830, 11288, 362, 11, 70, "Input"],
Cell[379195, 11301, 577, 16, 70, "Input"],
Cell[379775, 11319, 93, 2, 70, "Input"],
Cell[379871, 11323, 93, 2, 70, "Input"],
Cell[379967, 11327, 136, 4, 70, "Input"],
Cell[380106, 11333, 148, 4, 70, "Input"],
Cell[380257, 11339, 227, 7, 70, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[380545, 11353, 49, 0, 70, "Section"],
Cell[CellGroupData[{
Cell[380619, 11357, 50, 0, 70, "Subsection"],
Cell[CellGroupData[{
Cell[380694, 11361, 31, 0, 70, "Subsubsection"],
Cell[380728, 11363, 182, 4, 70, "Input"],
Cell[380913, 11369, 182, 4, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[381132, 11378, 30, 0, 70, "Subsubsection"],
Cell[381165, 11380, 195, 4, 70, "Input"],
Cell[381363, 11386, 212, 5, 70, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[381624, 11397, 36, 0, 70, "Subsection"],
Cell[381663, 11399, 143, 4, 70, "Input"],
Cell[381809, 11405, 67, 1, 70, "Input"],
Cell[381879, 11408, 80, 1, 70, "Input"],
Cell[381962, 11411, 313, 7, 70, "Input"],
Cell[CellGroupData[{
Cell[382300, 11422, 53, 0, 70, "Subsubsection"],
Cell[382356, 11424, 177, 3, 70, "Text"],
Cell[382536, 11429, 80, 2, 70, "Input"],
Cell[382619, 11433, 112, 3, 70, "Text"],
Cell[382734, 11438, 119, 4, 70, "Input"],
Cell[382856, 11444, 92, 2, 70, "Input"],
Cell[382951, 11448, 42, 0, 70, "Text"],
Cell[382996, 11450, 116, 3, 70, "Input"],
Cell[383115, 11455, 90, 2, 70, "Input"],
Cell[383208, 11459, 105, 2, 70, "Input"],
Cell[383316, 11463, 58, 1, 70, "Input"],
Cell[383377, 11466, 281, 9, 70, "Input"],
Cell[383661, 11477, 111, 2, 70, "Input"],
Cell[383775, 11481, 470, 15, 70, "Input"],
Cell[384248, 11498, 516, 13, 70, "Input"],
Cell[384767, 11513, 57, 0, 70, "Text"],
Cell[384827, 11515, 370, 10, 70, "Input"],
Cell[385200, 11527, 1009, 28, 70, "Input"],
Cell[386212, 11557, 412, 12, 70, "Input"],
Cell[386627, 11571, 305, 9, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[386969, 11585, 58, 0, 70, "Subsubsection"],
Cell[387030, 11587, 157, 4, 70, "Input"],
Cell[387190, 11593, 363, 9, 70, "Input"],
Cell[387556, 11604, 283, 8, 70, "Input"],
Cell[387842, 11614, 26, 0, 70, "Input"],
Cell[387871, 11616, 1097, 29, 70, "Code"],
Cell[388971, 11647, 2703, 72, 70, "Input"],
Cell[391677, 11721, 1055, 27, 70, "Input"],
Cell[392735, 11750, 2395, 65, 70, "Input"],
Cell[395133, 11817, 57, 1, 70, "Input"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[395251, 11825, 53, 0, 70, "Section"],
Cell[CellGroupData[{
Cell[395329, 11829, 49, 0, 70, "Subsubsection"],
Cell[395381, 11831, 1316, 25, 70, "Input"],
Cell[396700, 11858, 822, 19, 70, "Input"],
Cell[397525, 11879, 815, 19, 70, "Input"],
Cell[398343, 11900, 790, 18, 70, "Input"],
Cell[399136, 11920, 584, 15, 70, "Input"],
Cell[399723, 11937, 487, 13, 70, "Input"],
Cell[400213, 11952, 517, 12, 70, "Input"],
Cell[400733, 11966, 465, 12, 70, "Input"],
Cell[401201, 11980, 560, 15, 70, "Input"],
Cell[401764, 11997, 1800, 41, 70, "Text"],
Cell[403567, 12040, 395, 8, 70, "Input"],
Cell[403965, 12050, 64, 1, 70, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[404066, 12056, 50, 0, 70, "Subsection"],
Cell[CellGroupData[{
Cell[404141, 12060, 31, 0, 70, "Subsubsection"],
Cell[404175, 12062, 182, 4, 70, "Input"],
Cell[404360, 12068, 182, 4, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[404579, 12077, 30, 0, 70, "Subsubsection"],
Cell[404612, 12079, 195, 4, 70, "Input"],
Cell[404810, 12085, 212, 5, 70, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[405071, 12096, 36, 0, 70, "Subsection"],
Cell[405110, 12098, 106, 3, 70, "Input"],
Cell[405219, 12103, 67, 1, 70, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[405323, 12109, 39, 0, 70, "Subsection"],
Cell[405365, 12111, 243, 7, 70, "Input"],
Cell[405611, 12120, 285, 8, 70, "Input"],
Cell[405899, 12130, 173, 5, 70, "Input"],
Cell[406075, 12137, 329, 10, 70, "Input"],
Cell[406407, 12149, 73, 1, 70, "Input"],
Cell[406483, 12152, 141, 3, 70, "Input"],
Cell[406627, 12157, 240, 5, 70, "Input"],
Cell[406870, 12164, 130, 2, 70, "Input"],
Cell[407003, 12168, 113, 2, 70, "Input"],
Cell[407119, 12172, 95, 2, 70, "Input"],
Cell[407217, 12176, 65, 1, 70, "Input"],
Cell[407285, 12179, 219, 8, 70, "Input"],
Cell[407507, 12189, 219, 8, 70, "Input"],
Cell[407729, 12199, 5121, 142, 70, "Input"]
}, Closed]]
}, Closed]]
}, Open  ]]
}
]
*)

