(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    221692,       4891]
NotebookOptionsPosition[    217152,       4740]
NotebookOutlinePosition[    217550,       4757]
CellTagsIndexPosition[    217507,       4754]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"nb", "=", 
   RowBox[{"EvaluationNotebook", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SelectionMove", "[", 
   RowBox[{"nb", ",", "Next", ",", "Cell"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NotebookDelete", "[", "nb", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"CellPrint", "[", 
  RowBox[{"Cell", "[", 
   RowBox[{
    RowBox[{"\"\<Print[\\\"GPT Input - Last Updated: \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"DateString", "[", "]"}], "]"}], "<>", "\"\<\\\"]\>\""}], ",", 
    "\"\<Input\>\"", ",", 
    RowBox[{"InitializationCell", "\[Rule]", "True"}], ",", 
    RowBox[{"GeneratedCell", "\[Rule]", "False"}]}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.554617315389185*^9, 3.5546173713225126`*^9}, {
  3.5546174014224257`*^9, 3.5546174347730045`*^9}, {3.554617663331087*^9, 
  3.5546176818317976`*^9}, {3.5546177645068474`*^9, 3.554617767491337*^9}, {
  3.5546180436154027`*^9, 3.5546180774428787`*^9}}],

Cell["Print[\"GPT Input - Last Updated: Fri 19 Oct 2012 12:12:42\"]", "Input",
 InitializationCell->True,
 GeneratedCell->False,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.5596339622969513`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Units`\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Needs", "[", "\"\<PhysicalConstants`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.559633963797018*^9, 3.5596340187994823`*^9}}],

Cell[CellGroupData[{

Cell["BaseFiles", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.499066724434828*^9, 3.499066725934828*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PadNumberString", "[", "str_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sign", "[", "str", "]"}], "===", "1"}], ",", "\"\<\>\"", 
       ",", "\"\<-\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "str", "]"}], "<", "10"}], "&&", 
        RowBox[{
         RowBox[{"Abs", "[", "str", "]"}], "\[GreaterEqual]", "1"}]}], ",", 
       RowBox[{"\"\<0\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Abs", "[", "str", "]"}], "]"}]}], ",", 
       RowBox[{"ToString", "[", 
        RowBox[{"Abs", "[", "str", "]"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5015714580025625`*^9, 3.5015715091435146`*^9}, {
  3.501571630144289*^9, 3.50157164044123*^9}}],

Cell[CellGroupData[{

Cell["HeadBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.506940605369475*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HeadBlock", "[", "numpart_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "\"\<# Basic beam parameters\nEo = 0 ; \\t\\t\\t# Energy [eV]\nE1 = \
8.35e6;\ngamma = -q*E1/(m*c^2) + 1 ;     # corresponding gamma\nbeta  = \
sqrt(1-gamma^-2) ;      # corresponding beta \nvz    = beta*c ;  \n\ninitrad \
= \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "$initrad", "]"}], "]"}], "<>", 
     "\"\<e-3 ; \\t\\t# Bunch radius (NOT rms) [m]\nQtot = -\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "BunchCharge", "]"}], "]"}], "<>", 
     "\"\<e-12 ;\\t\\t# Bunch charge [C]\ntemit = \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "$laserpulselength", "]"}], "]"}], "<>", 
     "\"\<e-12 ;\\t\\t# Laser pulse [s]\n\n# Simulation parameters\nnumpart = \
\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "numpart", "]"}], "]"}], "<>", 
     "\"\<;\\t\\t# Number of particles\n\n# Start bunch\n\
setparticles(\\\"beam\\\",numpart,me,qe,Qtot) ;\n\
setrxydist(\\\"beam\\\",\\\"u\\\",0.5*initrad,initrad) ;\>\"", "<>", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ValueQ", "[", "$laseroffset", "]"}], "&&", 
        RowBox[{
         RowBox[{"Abs", "[", "$laseroffset", "]"}], ">", "0"}]}], ",", "\n", 
       RowBox[{"\"\<settransform(\\\"wcs\\\",\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"NumberRight", "[", 
          RowBox[{
           RowBox[{
            SuperscriptBox["10", 
             RowBox[{"-", "3"}]], "$laseroffset"}], ",", "8"}], "]"}], "]"}], 
        "<>", "\"\<,0,0,1,0,0,0,1,0,\\\"beam\\\");\\n\>\""}], ",", 
       "\[IndentingNewLine]", "\"\<\\n\>\""}], "]"}], "<>", "\n", 
     "\"\<setphidist(\\\"beam\\\",\\\"u\\\",0,2*pi) ;\nsettdist(\\\"beam\\\",\
\\\"u\\\",0,temit) ;\>\"", "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"$spacecharge", "\[Equal]", "True"}], ",", 
       "\"\<\n\n# Space-charge\n\
spacecharge3Dmesh(\\\"BeamScale\\\",1e-2,1e+2,\\\"Cathode\\\",\\\"Boundaries\\\
\",\\\"AAAAAA\\\",\\\"MeshBoxAccuracy\\\",0.02,\\\"RestMaxGamma\\\",300000) ;\
\\n\\n\>\"", ",", "\"\<\>\""}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499071866637953*^9, 3.499071912794203*^9}, {
   3.4991491189431677`*^9, 3.4991491190212655`*^9}, {3.4996031308625317`*^9, 
   3.4996031310500317`*^9}, 3.499687548887823*^9, {3.4997739215550475`*^9, 
   3.4997739441800475`*^9}, {3.500277476720048*^9, 3.500277481751298*^9}, {
   3.5014894654763913`*^9, 3.5014895053360214`*^9}, {3.506766736310725*^9, 
   3.506766766014801*^9}, {3.5067667964689007`*^9, 3.506766878768409*^9}, {
   3.506766933395157*^9, 3.5067669446298914`*^9}, {3.5067669811154337`*^9, 
   3.5067669812091866`*^9}, {3.5068547598399897`*^9, 
   3.5068547644182615`*^9}, {3.5328764055842705`*^9, 3.532876424832981*^9}, {
   3.5376313939014215`*^9, 3.5376314303699403`*^9}, {3.537631460851323*^9, 
   3.5376314610072374`*^9}, {3.537692503592868*^9, 3.537692518539486*^9}, {
   3.537692577607518*^9, 3.5376925884153123`*^9}, {3.5376930454453163`*^9, 
   3.53769304619497*^9}, {3.5377122683489437`*^9, 3.5377122721753044`*^9}, {
   3.537712306003459*^9, 3.5377123061752553`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HeadBlock", "[", "numpart_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "\"\<# Basic beam parameters\nEo = 0 ; \\t\\t\\t# Energy [eV]\nE1 = \
8.35e6;\ngamma = -q*E1/(m*c^2) + 1 ;     # corresponding gamma\nbeta  = \
sqrt(1-gamma^-2) ;      # corresponding beta \nvz    = beta*c ;  \n\ninitrad \
= \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "$initrad", "]"}], "]"}], "<>", 
     "\"\<e-3 ; \\t\\t# Bunch radius (NOT rms) [m]\nQtot = -\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "BunchCharge", "]"}], "]"}], "<>", 
     "\"\<e-12 ;\\t\\t# Bunch charge [C]\ntemit = \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "$laserpulselength", "]"}], "]"}], "<>", 
     "\"\<e-12 ;\\t\\t# Laser pulse [s]\n\n# Start bunch\n\>\"", "<>", 
     RowBox[{"StringJoin", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<setstartpar(\\\"beam\\\",\>\"", "<>", 
          RowBox[{"StringDrop", "[", 
           RowBox[{
            RowBox[{"StringDrop", "[", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"NumberRight", "[", "#", "]"}], "]"}], ",", 
              RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}], "<>", 
          "\"\<) ;\\n\>\""}], "&"}], ",", "numpart"}], "]"}]}], "<>", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"$spacecharge", "\[Equal]", "True"}], ",", 
       "\"\<\n\n# Space-charge\n\
spacecharge3Dmesh(\\\"BeamScale\\\",1e-2,1e+2,\\\"Cathode\\\",\\\"Boundaries\\\
\",\\\"AAAAAA\\\",\\\"MeshBoxAccuracy\\\",0.02,\\\"RestMaxGamma\\\",300000) ;\
\\n\\n\>\"", ",", "\"\<\>\""}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499071866637953*^9, 3.499071912794203*^9}, {
   3.4991491189431677`*^9, 3.4991491190212655`*^9}, {3.4996031308625317`*^9, 
   3.4996031310500317`*^9}, 3.499687548887823*^9, {3.4997739215550475`*^9, 
   3.4997739441800475`*^9}, {3.500277476720048*^9, 3.500277481751298*^9}, {
   3.5014894654763913`*^9, 3.5014895053360214`*^9}, {3.506766736310725*^9, 
   3.506766766014801*^9}, {3.5067667964689007`*^9, 3.506766878768409*^9}, {
   3.506766933395157*^9, 3.5067669446298914`*^9}, {3.5067669811154337`*^9, 
   3.5067669812091866`*^9}, {3.5068547598399897`*^9, 
   3.5068547644182615`*^9}, {3.5328764055842705`*^9, 3.532876424832981*^9}, {
   3.5376313939014215`*^9, 3.5376314303699403`*^9}, {3.537631460851323*^9, 
   3.5376314610072374`*^9}, {3.537692503592868*^9, 3.537692518539486*^9}, {
   3.537692577607518*^9, 3.5376925884153123`*^9}, {3.5376930454453163`*^9, 
   3.53769304619497*^9}, {3.5377122683489437`*^9, 3.5377122721753044`*^9}, {
   3.537712306003459*^9, 3.5377123061752553`*^9}, {3.540721687616651*^9, 
   3.540721688131144*^9}, {3.540721799947644*^9, 3.540721811827758*^9}, {
   3.5407220532029753`*^9, 3.540722064397098*^9}, {3.5407222034817324`*^9, 
   3.5407222398080635`*^9}, {3.540722271597501*^9, 3.540722283337298*^9}, {
   3.5546165481794987`*^9, 3.5546165561478405`*^9}, 3.5546195987478523`*^9, {
   3.554623530015311*^9, 3.5546235342807174`*^9}, {3.5546236650865197`*^9, 
   3.554623675742224*^9}, 3.554632967144334*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HeadBlock", "[", 
   RowBox[{"numpart_", ",", "DISTFILE"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "\"\<# Basic beam parameters\nEo = 0 ; \\t\\t\\t# Energy [eV]\nE1 = \
8.35e6;\ngamma = -q*E1/(m*c^2) + 1 ;     # corresponding gamma\nbeta  = \
sqrt(1-gamma^-2) ;      # corresponding beta \nvz    = beta*c ;  \ninitrad = \
\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "$initrad", "]"}], "]"}], "<>", 
     "\"\<e-3 ; \\t\\t# Bunch radius (NOT rms) [m]\nQtot = -\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "BunchCharge", "]"}], "]"}], "<>", 
     "\"\<e-12 ;\\t\\t# Bunch charge [C]\ntemit = \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", "$laserpulselength", "]"}], "]"}], "<>", 
     "\"\<e-12 ;\\t\\t# Laser pulse [s]\n\n#time=6.546848972493966/vz;\n\
position=5.2;\nsetfile(\\\"beam\\\",\\\"cresting_bc_out.gdf\\\");\\n\>\"", "<>",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"$spacecharge", "===", "True"}], ",", 
       "\"\<\n# Space-charge\nspacecharge3Dmesh() ;\\n\\n\>\"", ",", 
       "\"\<\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499071866637953*^9, 3.499071912794203*^9}, {
   3.4991491189431677`*^9, 3.4991491190212655`*^9}, {3.4996031308625317`*^9, 
   3.4996031310500317`*^9}, 3.499687548887823*^9, {3.4997739215550475`*^9, 
   3.4997739441800475`*^9}, {3.500277476720048*^9, 3.500277481751298*^9}, {
   3.5006358345040135`*^9, 3.50063586463943*^9}, {3.5006359228793645`*^9, 
   3.500635948937361*^9}, {3.5006360020531807`*^9, 3.5006360156602044`*^9}, {
   3.500636126187977*^9, 3.50063613632685*^9}, {3.500638663999367*^9, 
   3.500638666217734*^9}, {3.5006392335728025`*^9, 3.500639235541213*^9}, 
   3.5006393444286437`*^9, {3.50063993424858*^9, 3.500639936654414*^9}, 
   3.500640586198404*^9, {3.504968317514086*^9, 3.5049683198891926`*^9}, 
   3.505034412775548*^9, {3.50503971868607*^9, 3.505039718998578*^9}, 
   3.506854772496645*^9, {3.5070354648861523`*^9, 3.5070354654174194`*^9}, {
   3.5328638736123533`*^9, 3.5328638742519245`*^9}, {3.532874679216567*^9, 
   3.532874681305091*^9}, {3.5376314447297115`*^9, 3.5376314560959153`*^9}, {
   3.53763162078893*^9, 3.537631632498146*^9}, 3.537692526910841*^9, {
   3.5376925926322265`*^9, 3.537692592866499*^9}, 3.537693058251912*^9, 
   3.55403046949389*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["BoosterBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.5069405995255375`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoosterBlock", "[", 
   RowBox[{
   "Buncherphase_", ",", "BC1Field_", ",", "BC1Phase_", ",", "BC2Field_", ",",
     "BC2Phase_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "\"\<# Set-up\n\
map1D_E(\\\"wcs\\\",\\\"I\\\",\\\"alice_onaxis.gdf\\\",\\\"z\\\",\\\"Ez\\\",\>\
\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{"GunVoltage", "/", "350"}], "]"}], "]"}], "<>", 
     "\"\<) ;\n\
map1D_B(\\\"wcs\\\",\\\"z\\\",0.23,\\\"JLab_sol_smooth.gdf\\\",\\\"z\\\",\\\"\
Bz\\\",\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{
        RowBox[{"85", "$sol01"}], ",", "8"}], "]"}], "]"}], "<>", 
     "\"\<*1e-4) ;\n\
map1D_TM(\\\"wcs\\\",\\\"z\\\",1.3,\\\"bun_ELBE.gdf\\\",\\\"z\\\",\\\"Ez\\\",\
\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{
        RowBox[{"1000", 
         RowBox[{"(", 
          RowBox[{"1.586", "/", "0.03"}], ")"}], "*", 
         SqrtBox["$buncherpower"]}], ",", "8"}], "]"}], "]"}], "<>", 
     "\"\<,\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{"Buncherphase", ",", "8"}], "]"}], "]"}], "<>", 
     "\"\<*pi/180,2*pi*1.3e9) ;\\n\>\"", "<>", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ValueQ", "[", "$corrfield", "]"}], "&&", 
        RowBox[{
         RowBox[{"Abs", "[", "$corrfield", "]"}], ">", "0"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<rectmagnet(\\\"wcs\\\",\\\"z\\\",1.6744, 0.2,0.01,\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"NumberRight", "[", 
          RowBox[{
           RowBox[{
            SuperscriptBox["10", 
             RowBox[{"-", "3"}]], "$corrfield"}], ",", "8"}], "]"}], "]"}], 
        "<>", "\"\<,0,0,0);\\n\>\""}], ",", "\"\<\>\""}], "]"}], "<>", "\n", 
     "\"\<map1D_B(\\\"wcs\\\",\\\"z\\\",1.67,\\\"JLab_sol_smooth.gdf\\\",\\\"\
z\\\",\\\"Bz\\\",\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{
        RowBox[{"85", "$sol02"}], ",", "8"}], "]"}], "]"}], "<>", 
     "\"\<*1e-4) ;\n\
map1D_TM(\\\"wcs\\\",\\\"z\\\",2.85,\\\"teslacav13.gdf\\\",\\\"z\\\",\\\"Ez\\\
\",\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{"BC1Field", ",", "8"}], "]"}], "]"}], "<>", "\"\<*1e6,\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{"BC1Phase", ",", "4"}], "]"}], "]"}], "<>", 
     "\"\<*pi/180,2*pi*1.3e9) ;\n\
map1D_TM(\\\"wcs\\\",\\\"z\\\",4.2,\\\"teslacav13.gdf\\\",\\\"z\\\",\\\"Ez\\\"\
,\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{"BC2Field", ",", "8"}], "]"}], "]"}], "<>", "\"\<*1e6,\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "[", 
       RowBox[{"BC2Phase", ",", "4"}], "]"}], "]"}], "<>", 
     "\"\<*pi/180,2*pi*1.3e9) ;\\n\>\""}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499071923106703*^9, 3.499071947919203*^9}, 
   3.4990769926188464`*^9, {3.4991491247068*^9, 3.499149124784898*^9}, {
   3.4991491965257206`*^9, 3.499149196666297*^9}, {3.499619435025427*^9, 
   3.49961951963426*^9}, {3.499619606133707*^9, 3.4996196370553837`*^9}, {
   3.4996853131846976`*^9, 3.4996853185284476`*^9}, {3.4996855176846976`*^9, 
   3.4996855726534476`*^9}, 3.499685632669073*^9, {3.4996868322471976`*^9, 
   3.499686840200323*^9}, {3.4996869715284476`*^9, 3.4996869725284476`*^9}, {
   3.500275013110673*^9, 3.500275019595048*^9}, {3.5014895208361206`*^9, 
   3.5014895435706406`*^9}, {3.5014895823677645`*^9, 
   3.5014896171336117`*^9}, {3.5014897961816325`*^9, 
   3.5014898065879493`*^9}, {3.501504096514205*^9, 3.5015041244675093`*^9}, {
   3.501834165179716*^9, 3.501834166226598*^9}, {3.506850150661251*^9, 
   3.506850157223961*^9}, 3.5068505080945635`*^9, 3.532863915605966*^9, {
   3.5328736743092165`*^9, 3.532873705075981*^9}, {3.532874063242261*^9, 
   3.5328740667023525`*^9}, {3.5328754639872527`*^9, 3.532875514813199*^9}, {
   3.5398592017185135`*^9, 3.5398592063279476`*^9}, {3.539931133538435*^9, 
   3.5399311604137793`*^9}, 3.5399312710714455`*^9, {3.554534340031448*^9, 
   3.5545343513310165`*^9}, {3.5545347890376215`*^9, 3.554534790044575*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["DipoleBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.5069405893845882`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"$LATTICE", "=", "$LATTICEFEL"}]], "Input",
 CellChangeTimes->{{3.576243923414465*^9, 3.576243927001465*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"drift95\"\>", ",", "\<\"Drift\"\>", ",", 
     "1.5870999999999924`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift95\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3QUAD01\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.177`", 
     ",", "23.4226`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3MAGQUAD01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift96\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.17609999999999815`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift96\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3EBPM01\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3DIAEBPM01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift97\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.045000000000001705`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift97\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3HCOR01\"\>", ",", "\<\"HKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "0", 
     ",", "\<\"ST3MAGHCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3VCOR01\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"ST3MAGVCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift99\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.22109999999999985`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift99\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3QUAD02\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.177`", 
     ",", 
     RowBox[{"-", "37.573`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3MAGQUAD02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift100\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.5673999999999921`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift100\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3QUAD03\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.177`", 
     ",", "40.8118`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3MAGQUAD03\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift101\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.1530999999999949`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift101\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3EBPM02\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3DIAEBPM02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift102\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.045000000000001705`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift102\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3HCOR02\"\>", ",", "\<\"HKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "0", 
     ",", "\<\"ST3MAGHCOR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3VCOR02\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"ST3MAGVCOR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift104\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.247099999999989`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift104\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3QUAD04\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.177`", 
     ",", 
     RowBox[{"-", "15.7607`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3MAGQUAD04\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift105\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.24170000000000158`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift105\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST3OTR01\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST3DIAOTR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift106\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.44949999999999335`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift106\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2EBPM01\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAEBPM01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift107\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.09900000000000375`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift107\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2DIP01\"\>", ",", "\<\"SectorBend\"\>", ",", "0.512`", ",",
      "0.`", ",", "\<\"---\"\>", ",", "1.0471976`", 
     ",", "\<\"AR2MAGDIP01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift108\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.09899999999999665`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift108\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2EBPM02\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAEBPM02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift109\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.24540000000000362`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift109\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2SEXT01\"\>", ",", "\<\"Sextupole\"\>", ",", "0.18`", ",", 
     "0.`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGSEXT01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift110\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.21459999999999013`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift110\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2OTR01\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAOTR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift111\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.14740000000000464`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift111\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2QUAD01\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", "33.5506`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGQUAD01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift112\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.5150000000000006`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift112\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2VCOR01\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGVCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift113\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.15899999999999892`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift113\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2QUAD02\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", 
     RowBox[{"-", "17.7871`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGQUAD02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift114\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.3475000000000037`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift114\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2EBPM03\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAEBPM03\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift115\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.09899999999999665`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift115\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2DIP02\"\>", ",", "\<\"SectorBend\"\>", ",", "0.512`", ",",
      "0.`", ",", "\<\"---\"\>", ",", "1.0471976`", 
     ",", "\<\"AR2MAGDIP02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift116\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.09900000000000375`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift116\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2EBPM04\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAEBPM04\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift117\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.3474999999999966`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift117\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2QUAD03\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", 
     RowBox[{"-", "17.7871`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGQUAD03\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift118\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.15900000000000603`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift118\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2VCOR02\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGVCOR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift119\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.5150000000000006`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift119\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2QUAD04\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", "33.5506`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGQUAD04\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift120\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.20649999999999835`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift120\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2OTR02\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAOTR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift121\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.15549999999999642`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift121\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2SEXT02\"\>", ",", "\<\"Sextupole\"\>", ",", "0.18`", ",", 
     "0.`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2MAGSEXT02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift122\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.2453000000000003`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift122\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2EBPM05\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAEBPM05\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift123\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.09900000000000375`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift123\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2DIP03\"\>", ",", "\<\"SectorBend\"\>", ",", "0.512`", ",",
      "0.`", ",", "\<\"---\"\>", ",", "1.0471976`", 
     ",", "\<\"AR2MAGDIP03\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift124\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.09899999999999665`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift124\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"AR2EBPM06\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"AR2DIAEBPM06\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift125\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.44950000000000045`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift125\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4OTR01\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4DIAOTR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift126\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.282199999999996`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift126\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4QUAD01\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", 
     RowBox[{"-", "25.8265`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGQUAD01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift127\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.34660000000000224`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift127\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4QUAD02\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", "27.2452`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGQUAD02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift128\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.18120000000000402`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift128\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4EBPM01\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4DIAEBPM01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift129\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.045000000000001705`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift129\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4HCOR01\"\>", ",", "\<\"HKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "0", 
     ",", "\<\"ST4MAGHCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4VCOR01\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGVCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift131\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.2277999999999949`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift131\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4QUAD03\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.196`", 
     ",", 
     RowBox[{"-", "2.8118`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGQUAD03\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift132\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.20080000000000098`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift132\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4DUMP01\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4DIADUMP01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift133\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.21170000000000755`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift133\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4QUAD04\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.177`", 
     ",", "18.8921`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGQUAD04\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift134\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.27300000000001035`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift134\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4QUAD05\"\>", ",", "\<\"Quadrupole\"\>", ",", "0.177`", 
     ",", 
     RowBox[{"-", "23.1287`"}], ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGQUAD05\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift135\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.15349999999999397`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift135\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4EBPM02\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4DIAEBPM02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift136\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.045000000000001705`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift136\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4HCOR02\"\>", ",", "\<\"HKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "0", 
     ",", "\<\"ST4MAGHCOR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4VCOR02\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"ST4MAGVCOR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift138\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.28000000000000114`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift138\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4OTR02\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST4DIAOTR02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift139\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.34260000000000446`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift139\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4DIP01\"\>", ",", "\<\"SectorBend\"\>", ",", "0.211`", ",",
      "0.`", ",", "\<\"---\"\>", ",", 
     RowBox[{"-", "0.083110916`"}], ",", "\<\"ST4MAGDIP01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift140\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.4636999999999887`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift140\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4DIP02\"\>", ",", "\<\"SectorBend\"\>", ",", "0.43`", ",", 
     "0.`", ",", "\<\"---\"\>", ",", "0.166221832`", 
     ",", "\<\"ST4MAGDIP02\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift141\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.4636999999999887`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift141\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST4DIP03HIGH\"\>", ",", "\<\"SectorBend\"\>", ",", "0.211`", 
     ",", "0.`", ",", "\<\"---\"\>", ",", 
     RowBox[{"-", "0.083110916`"}], ",", "\<\"ST4MAGDIP03\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift142\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.7279999999999944`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift142\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST1OTR01\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST1DIAOTR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift143\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.2839999999999918`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift143\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST1HCOR01\"\>", ",", "\<\"HKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "0", 
     ",", "\<\"ST1MAGHCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST1VCOR01\"\>", ",", "\<\"VKicker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "0", ",", "\<\"---\"\>", 
     ",", "\<\"ST1MAGVCOR01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift145\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.3171000000000106`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift145\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST1EBPM01\"\>", ",", "\<\"BPM\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST1DIAEBPM01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift146\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.5674999999999812`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift146\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"TCAVITY1D\"\>", ",", "\<\"LCAV\"\>", ",", "1.0362`", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"CAVITY1\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift147\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.3126000000000033`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift147\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"TCAVITY2D\"\>", ",", "\<\"LCAV\"\>", ",", "1.0362`", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"CAVITY2\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift148\"\>", ",", "\<\"Drift\"\>", ",", 
     "2.3962999999999965`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift148\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST1OTR02LOW\"\>", ",", "\<\"Marker\"\>", ",", "0", 
     ",", "\<\"---\"\>", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"ST1DIAOTR02LOW\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift149\"\>", ",", "\<\"Drift\"\>", ",", 
     "0.4889999999999901`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift149\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"ST1DIP01LOW\"\>", ",", "\<\"SectorBend\"\>", ",", "0.211`", 
     ",", "0.`", ",", "\<\"---\"\>", ",", "0.34906585`", 
     ",", "\<\"ST1MAGDIP01\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"drift150\"\>", ",", "\<\"Drift\"\>", ",", 
     "1.2644999999999982`", ",", "\<\"---\"\>", ",", "\<\"---\"\>", 
     ",", "\<\"---\"\>", ",", "\<\"drift150\"\>"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.576243927706465*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"DipoleBlock", "[", 
   RowBox[{"injector_:", "True"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", "dipolefield", "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"$dipolefield", "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"dipolefield", " ", "=", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"lat", "=", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}]}], ",", 
                 RowBox[{"en", "=", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}]}], "}"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{"en", ",", 
                 RowBox[{"{", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "lat", "]"}], ",", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "===", " ", 
                    "\"\<SectorBend\>\""}], " ", "||", " ", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "===", " ", 
                    "\"\<RectBend\>\""}]}], " ", "&"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", " ", "1"}], "]"}], "]"}], "]"}], 
                  "}"}]}], "]"}]}], "]"}], "&"}], "/@", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Split", "[", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY2A\>\""}], "&&", 
                   RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY1D\>\""}]}],
                   "&"}]}], "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Split", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY2A\>\""}], "&&", 
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY1D\>\""}]}],
                     "&"}]}], "]"}], "]"}], "===", "4"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\"", ",", 
                   "\"\<LC12Energy\>\"", ",", "\"\<BCEnergy\>\""}], "}"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY2A\>\""}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY1D\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\"", ",", 
                    "\"\<BCEnergy\>\""}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\""}], 
                    "}"}]}], "]"}], ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY1D\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<LC12Energy\>\"", ",", "\"\<BCEnergy\>\""}], 
                    "}"}], ",", 
                    RowBox[{"{", "\"\<BCEnergy\>\"", "}"}]}], "]"}]}], 
                  "]"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"dipolefield", "=", "$dipolefield"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "===", "\"\<SectorBend\>\""}], "||", 
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "===", "\"\<RectBend\>\""}]}], "&"}]}], "]"}], "]"}], "=!=", 
          RowBox[{"Length", "[", "dipolefield", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Length Dipoles \>\"", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"Select", "[", 
              RowBox[{
               RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   "===", "\"\<SectorBend\>\""}], "||", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   "===", "\"\<RectBend\>\""}]}], "&"}]}], "]"}], "]"}], ",", 
            "\"\< - Length Bfield \>\"", ",", 
            RowBox[{"Length", "[", "dipolefield", "]"}]}], "]"}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<# dipoles\\n\>\"", "<>", 
          RowBox[{"StringJoin", "@@", "\n", 
           RowBox[{"MapIndexed", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"maindip", "=", 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], ",", "offset"}], "}"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"offset", "=", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{"injector", ",", 
                    RowBox[{"-", "5.2"}], ",", "0"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "+", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "3"}], 
                    "\[RightDoubleBracket]"}]}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"\"\<bnd\>\"", "<>", 
                  RowBox[{"maindip", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                  "\"\< = 2*\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     "<", "0.001"}], ",", "0", ",", 
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "/", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}], "/",
                     "2"}], "]"}]}], "]"}], "]"}], "]"}], "<>", 
                  "\"\<*tan(\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "[", 
                    RowBox[{"Abs", "[", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "]"}], "<>", 
                  "\"\</2) ;\\t# distance between intersect and edge of dip1\n\
ccs( \>\"", "<>", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "-", "1"}], "]"}], "<>", 
                    "\"\<\\\"\>\""}], ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], 
                  "<>", "\"\<, 0, 0, \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "maindip", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "-", "offset"}], ",", "10"}], 
                    "]"}], "]"}], "<>", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"\"\<+bnd\>\"", "<>", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"\"\<+bnd\>\"", "<>", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<+bnd\>\"", "<>", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}], "]"}], "<>", 
                  "\"\<, cos(\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "[", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                    "]"}], "<>", "\"\<), 0, -sin(\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "[", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                    "]"}], "<>", "\"\<), 0, 1, 0, \\\"bend\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], "<>", 
                  "\"\<\\\" ) ;\n\>\"", "<>", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     ">", "0.001"}], ",", 
                    RowBox[{"\"\<sectormagnet\>\"", "<>", "\"\<( \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "-", "1"}], "]"}], "<>", 
                    "\"\<\\\"\>\""}], ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], 
                    "<>", "\"\<, \>\"", "<>", "\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<\\\"\>\"", 
                    "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "/", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "]"}], "]"}], "<>", "\"\<, \>\"", "<>", 
                    "\[IndentingNewLine]", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"NumberQ", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     ",", "\[IndentingNewLine]", 
                    RowBox[{"Abs", "@", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<currentToField[\>\"", "<>", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<,\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    "maindip", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<]\>\""}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<BCEnergy\>\""}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Abs", "@", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    "\"\<Convert[ElectronMass*SpeedOfLight*$BetaInjector \
$GammaInjector/ElectronCharge/\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "/", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "]"}], "]"}], "<>", "\"\</Meter/Tesla,1]\>\""}], 
                    "]"}]}], ",", 
                    RowBox[{"Abs", "@", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    "\"\<Convert[ElectronMass*SpeedOfLight*$BetaLinac \
$GammaLinac/ElectronCharge/\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "/", 
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "]"}], "]"}], "<>", "\"\</Meter/Tesla,1]\>\""}], 
                    "]"}]}]}], "]"}]}], "\[IndentingNewLine]", "]"}], 
                    "\[IndentingNewLine]", "]"}], "]"}], 
                    "\[IndentingNewLine]", "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "\[Equal]", "\"\<RectBend\>\""}], ",", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "/", 
                    "2"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "5", 
                    "\[RightDoubleBracket]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "5", 
                    "\[RightDoubleBracket]"}], "]"}], "]"}]}], "]"}], "<>", 
                    "\"\<, \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "\[Equal]", "\"\<RectBend\>\""}], ",", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "/", 
                    "2"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "]"}], "]"}]}], "]"}], "<>", 
                    "\"\<, \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "12", 
                    "\[RightDoubleBracket]"}], ",", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "9"}]]}], "]"}], "]"}], "]"}], "<>", 
                    "\"\<, \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "10", 
                    "\[RightDoubleBracket]"}], ">", "0"}], ",", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "10", 
                    "\[RightDoubleBracket]"}], ",", "0.01"}], "]"}], ",", 
                    "\"\<0\>\""}], "]"}], "]"}], "]"}], "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "11", 
                    "\[RightDoubleBracket]"}], ">", "0"}], ",", 
                    RowBox[{"0", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    RowBox[{"maindip", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "11", 
                    "\[RightDoubleBracket]"}], ",", "0.01"}], "]"}]}], ",", 
                    "\"\<0\>\""}], "]"}], "]"}], "]"}], "<>", 
                    "\"\< ) ;\\n\>\""}], ",", "\"\<\>\""}], "]"}]}]}]}], 
               "]"}], "&"}], ",", 
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Prepend", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "]"}], "&"}], "@", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], 
                    "||", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<RectBend\>\""}]}], 
                    "&"}]}], "]"}], ",", "dipolefield", ",", 
                   RowBox[{"Sort", "@", 
                    RowBox[{
                    RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    "\"\<SectorBend\>\""}], "]"}], ",", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    "\"\<RectBend\>\""}], "]"}]}], "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "-",
                     "1"}], "\[RightDoubleBracket]"}]}]}], "}"}], "]"}]}], 
               ",", "2", ",", "1"}], "]"}]}], "]"}]}]}]}], 
        "\[IndentingNewLine]", "]"}]}], ",", "\"\<\>\""}], "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499071966372328*^9, 3.499071992653578*^9}, {
   3.499076541560733*^9, 3.499076559044157*^9}, {3.4990768160892124`*^9, 
   3.499076829342952*^9}, {3.4990768660912457`*^9, 3.4990768920055056`*^9}, {
   3.4990769275829744`*^9, 3.4990769842511897`*^9}, {3.499084026548355*^9, 
   3.4990840273757644`*^9}, {3.4990932174398785`*^9, 3.499093217595991*^9}, {
   3.499094617233738*^9, 3.499094617842575*^9}, {3.499147268020568*^9, 
   3.4991472748150935`*^9}, {3.499149640028643*^9, 3.4991496418092775`*^9}, {
   3.4991498977832823`*^9, 3.4991500121187544`*^9}, {3.4991500535887923`*^9, 
   3.499150124126906*^9}, {3.499150247646703*^9, 3.499150327931447*^9}, {
   3.4991503689172773`*^9, 3.4991504205244355`*^9}, {3.4991504660555696`*^9, 
   3.49915046682093*^9}, {3.4991504997001877`*^9, 3.499150499981341*^9}, {
   3.499150609115486*^9, 3.4991506611287537`*^9}, {3.499150692242997*^9, 
   3.4991507411479645`*^9}, {3.4991512397412167`*^9, 3.49915127123033*^9}, {
   3.499526265422015*^9, 3.499526265750136*^9}, {3.499579807750836*^9, 
   3.499579816750721*^9}, {3.49958107734396*^9, 3.4995810776252065`*^9}, {
   3.4995811348744736`*^9, 3.499581135061971*^9}, {3.499589199271248*^9, 
   3.499589240364472*^9}, 3.4995892825826817`*^9, {3.4995893871750927`*^9, 
   3.4995894002843*^9}, {3.4995894616428895`*^9, 3.499589530126388*^9}, 
   3.4995896019379687`*^9, {3.499589657812254*^9, 3.4995896936555448`*^9}, {
   3.499589809419688*^9, 3.499589813654009*^9}, {3.4995964657719855`*^9, 
   3.499596465896984*^9}, {3.499596989030913*^9, 3.4995969891402864`*^9}, 
   3.499600250848536*^9, {3.499601413029937*^9, 3.499601417915732*^9}, {
   3.499601515396742*^9, 3.4996015160857644`*^9}, {3.499601954648406*^9, 
   3.4996019598686256`*^9}, {3.499620681876822*^9, 3.499620741204567*^9}, {
   3.499713888591073*^9, 3.499713892216073*^9}, {3.4997139818566976`*^9, 
   3.499713982528573*^9}, {3.4998657550264826`*^9, 3.4998657733702326`*^9}, {
   3.4998662532921076`*^9, 3.4998662659483576`*^9}, {3.500635376895602*^9, 
   3.500635389252841*^9}, 3.5006365031696978`*^9, {3.500639003987482*^9, 
   3.500639008361726*^9}, {3.500640062898221*^9, 3.500640065522767*^9}, 
   3.500640928139306*^9, {3.5007062575629625`*^9, 3.5007062660145187`*^9}, {
   3.500715316412578*^9, 3.5007153275198913`*^9}, {3.504333274112712*^9, 
   3.5043332743627167`*^9}, 3.504333370942696*^9, 3.5049687811404753`*^9, 
   3.50505538791783*^9, {3.532699694416334*^9, 3.532699696476682*^9}, {
   3.5327005923781443`*^9, 3.5327006598963833`*^9}, {3.532700750284733*^9, 
   3.532700762549237*^9}, {3.5327008204301867`*^9, 3.5327008350255723`*^9}, {
   3.532708481032584*^9, 3.5327085064676113`*^9}, {3.5327086048847094`*^9, 
   3.532708609574196*^9}, {3.5327086767798123`*^9, 3.532708680382332*^9}, 
   3.5327811672377453`*^9, {3.532782181752735*^9, 3.5327821819710464`*^9}, {
   3.535436479762781*^9, 3.535436480169031*^9}, {3.5377109132392907`*^9, 
   3.5377109312153788`*^9}, {3.5377109994339294`*^9, 3.537711001292447*^9}, {
   3.5377126190154066`*^9, 3.537712643675913*^9}, 3.5377126752707224`*^9, {
   3.5377127167515993`*^9, 3.5377127607000885`*^9}, {3.5377128034928603`*^9, 
   3.5377129046024976`*^9}, 3.537712950409505*^9, {3.5377132511302443`*^9, 
   3.537713301341471*^9}, {3.5377865329313073`*^9, 3.5377865498888755`*^9}, {
   3.537857939252308*^9, 3.537857942509782*^9}, {3.537857980711068*^9, 
   3.537858062537568*^9}, {3.5378589235923605`*^9, 3.5378589314946938`*^9}, {
   3.5378589771628313`*^9, 3.5378589905171623`*^9}, {3.5378594059704866`*^9, 
   3.537859434101884*^9}, 3.53785967830696*^9, {3.537872951842945*^9, 
   3.537872953280141*^9}, {3.5381235565632863`*^9, 3.538123562423622*^9}, {
   3.5381235953724265`*^9, 3.5381236435175805`*^9}, {3.538145534020194*^9, 
   3.5381455539706507`*^9}, 3.538309002218458*^9, {3.538309039613869*^9, 
   3.53830905903823*^9}, {3.53831529877577*^9, 3.5383152989319696`*^9}, {
   3.5383841172682676`*^9, 3.5383841211120176`*^9}, {3.5384018444899225`*^9, 
   3.5384019428649225`*^9}, {3.5384029240680475`*^9, 
   3.5384029344899225`*^9}, {3.5388379219264927`*^9, 
   3.5388379307859807`*^9}, {3.5388381518669357`*^9, 
   3.5388381520231876`*^9}, {3.5388383145096426`*^9, 3.5388383292129555`*^9}, 
   3.538838424948556*^9, {3.5399386453533354`*^9, 3.539938647040857*^9}, {
   3.5535177296542635`*^9, 3.5535177379161854`*^9}, {3.576243316724465*^9, 
   3.5762433336164646`*^9}, {3.5762433653424644`*^9, 3.5762433656944647`*^9}, 
   3.576243596686465*^9, 3.576244119650465*^9, 3.576245028094465*^9, {
   3.576245075541465*^9, 3.576245082780465*^9}, {3.5766813313743877`*^9, 
   3.5766813913553877`*^9}, 3.5767659627947407`*^9, {3.5767662758597403`*^9, 
   3.5767662760227404`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["QuadBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.5069405730715666`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuadBlock", "[", 
   RowBox[{"injector_:", "True"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"bfieldsort", ",", "quadfield"}], "*)"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"$quadfield", "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"quadfield", " ", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"lat", "=", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}]}], ",", 
                 RowBox[{"en", "=", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    "\"\<Abs[\>\"", "<>", "#", "<>", 
                    "\"\<\[LeftDoubleBracket]1,4\[RightDoubleBracket]]\>\""}],
                     "]"}], ">", "0"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"en", "===", "\"\<BCEnergy\>\""}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Convert", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    "\"\<\>\"", "<>", "#", "<>", 
                    "\"\<\[LeftDoubleBracket]1,4\[RightDoubleBracket]\>\""}], 
                    "]"}], "*", "$GammaInjector", " ", "ElectronMass", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SpeedOfLight", "/", "ElectronCharge"}], "/", 
                    "Tesla"}], "/", "Meter"}]}], ",", "1"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Convert", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    "\"\<\>\"", "<>", "#", "<>", 
                    "\"\<\[LeftDoubleBracket]1,4\[RightDoubleBracket]\>\""}], 
                    "]"}], "*", "$GammaLinac", " ", "ElectronMass", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SpeedOfLight", "/", "ElectronCharge"}], "/", 
                    "Tesla"}], "/", "Meter"}]}], ",", "1"}], "]"}]}], "]"}], 
                   ",", "\[IndentingNewLine]", "0"}], "]"}], " ", "&"}], " ", 
                "/@", " ", 
                RowBox[{
                 RowBox[{"Select", "[", 
                  RowBox[{
                   RowBox[{"MADFlatten", "[", "lat", "]"}], ",", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "===", " ", 
                    "\"\<Quadrupole\>\""}], "&"}]}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}]}], "]"}], 
             "&"}], "/@", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Split", "[", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY2A\>\""}], "&&", 
                   RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY1D\>\""}]}],
                   "&"}]}], "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Split", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY2A\>\""}], "&&", 
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY1D\>\""}]}],
                     "&"}]}], "]"}], "]"}], "===", "4"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\"", ",", 
                   "\"\<LC12Energy\>\"", ",", "\"\<BCEnergy\>\""}], "}"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY2A\>\""}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY1D\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\"", ",", 
                    "\"\<BCEnergy\>\""}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\""}], 
                    "}"}]}], "]"}], ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY1D\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<LC12Energy\>\"", ",", "\"\<BCEnergy\>\""}], 
                    "}"}], ",", 
                    RowBox[{"{", "\"\<BCEnergy\>\"", "}"}]}], "]"}]}], 
                  "]"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"quadfield", "=", "$quadfield"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"bfieldsort", "=", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   "===", "\"\<Quadrupole\>\""}], "&"}]}], "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             "quadfield"}], "}"}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ">", "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"no", "=", 
                RowBox[{
                "#2", "\[LeftDoubleBracket]", "1", 
                 "\[RightDoubleBracket]"}]}], ",", "bndedge", ",", "offset"}],
               "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1", ",", "2"}], 
                  "\[RightDoubleBracket]"}], "=!=", "\"\<Quadrupole\>\""}], 
                ",", 
                RowBox[{
                 RowBox[{"offset", "=", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"bndedge", "=", 
                  RowBox[{"\"\<bnd\>\"", "<>", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], ",", 
                RowBox[{
                 RowBox[{"offset", "=", "0"}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"injector", ",", 
                   RowBox[{"bndedge", "=", "\"\<5.2\>\""}], ",", 
                   RowBox[{"bndedge", "=", "\"\<\>\""}]}], "]"}]}]}], "]"}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Block", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"name", "=", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "]"}], ">", "0"}], "&&", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     ">", "0"}]}], ",", 
                    RowBox[{"\"\<quadrupole( \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"no", ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"no", "-", "1"}], "]"}], "<>", "\"\<\\\"\>\""}], 
                    ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], "<>", 
                    "\"\<, \\\"z\\\", \>\"", "<>", "bndedge", "<>", 
                    "\"\<+\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "-", "offset", "-", 
                    FractionBox[
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], 
                    "2"]}], ",", "10"}], "]"}], "]"}], "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     ">", "0"}], ",", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "*", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ",",
                     "6"}], "]"}], "]"}], ",", "\"\<0\>\""}], "]"}], "<>", 
                    "\"\< ) ;\\n\>\""}], ",", "\"\<\>\""}], "]"}]}], "]"}], 
                 "&"}], ",", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<Quadrupole\>\""}], "&"}]}], "]"}]}], 
               "]"}]}]}], "]"}], "&"}], ",", 
          RowBox[{"Split", "[", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{
                   RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], ",", 
                   "0"}], "]"}]}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<SectorBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<RectBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<Quadrupole\>\""}]}], "&"}]}], "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#2", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
              "\"\<Quadrupole\>\""}], "&"}]}], "]"}]}], "]"}]}]}], ",", 
      "\"\<\>\""}], "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499072180231703*^9, 3.499072196903578*^9}, {
   3.4990946475662994`*^9, 3.4990947112443843`*^9}, {3.4990947441059604`*^9, 
   3.4990947642444086`*^9}, {3.499094917234168*^9, 3.499095135650468*^9}, {
   3.4990951909297266`*^9, 3.499095215829591*^9}, {3.4991472461843667`*^9, 
   3.4991472565089226`*^9}, {3.4991483337146363`*^9, 
   3.4991483388066263`*^9}, {3.4991484068143644`*^9, 
   3.4991484091416845`*^9}, {3.4995251181554503`*^9, 3.4995251324677672`*^9}, 
   3.499525286840791*^9, {3.499579175118309*^9, 3.499579175743301*^9}, {
   3.4995794270213346`*^9, 3.4995794270994587`*^9}, 3.4996039520307684`*^9, {
   3.500635342901477*^9, 3.5006353640384493`*^9}, {3.500635395954808*^9, 
   3.500635396189142*^9}, 3.500636478845777*^9, {3.5006389929893827`*^9, 
   3.500639001269202*^9}, {3.5006400804889307`*^9, 3.500640082441718*^9}, {
   3.5006401676457424`*^9, 3.5006401692079725`*^9}, 3.5006409368565493`*^9, {
   3.50070627904335*^9, 3.5007062809804907`*^9}, {3.500715285387088*^9, 
   3.5007153106167793`*^9}, {3.5043569189224415`*^9, 3.504356925813243*^9}, 
   3.504941616278715*^9, {3.5049647998398447`*^9, 3.504964810918253*^9}, {
   3.5049649022330904`*^9, 3.5049649167647123`*^9}, 3.504965044674237*^9, {
   3.5049651176452*^9, 3.5049651272081285`*^9}, 3.5049687837030573`*^9, {
   3.5049689346766376`*^9, 3.50496897255285*^9}, {3.5049690228200836`*^9, 
   3.5049690492271786`*^9}, {3.504969235341564*^9, 3.5049693946425176`*^9}, {
   3.5050324620537357`*^9, 3.50503246513194*^9}, {3.505033035224659*^9, 
   3.5050330372090845`*^9}, 3.5058232802748027`*^9, 3.5066916292876678`*^9, {
   3.5378156000670943`*^9, 3.5378156142842627`*^9}, {3.5378160091848106`*^9, 
   3.5378160135497303`*^9}, 3.5378160688595023`*^9, 3.5378164550769777`*^9, 
   3.53781671910787*^9, {3.5378171577043858`*^9, 3.5378171607442403`*^9}, 
   3.5545586763685603`*^9, 3.5762436612624645`*^9, {3.576244090192465*^9, 
   3.576244111777465*^9}, {3.576244998584465*^9, 3.5762450214304647`*^9}, 
   3.576681836652388*^9, 3.5767659041657405`*^9, {3.5767662340187407`*^9, 
   3.57676624561174*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["SextBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.5069405730715666`*^9, {3.5070303765202045`*^9, 3.507030377067097*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SextBlock", "[", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"bfieldsort", ",", "quadfield"}], "*)"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"$sextfield", "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"sextfield", " ", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"lat", "=", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}]}], ",", 
                 RowBox[{"en", "=", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}]}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{
                    "\"\<Abs[\>\"", "<>", "#", "<>", 
                    "\"\<\[LeftDoubleBracket]1,4\[RightDoubleBracket]]\>\""}],
                     "]"}], ">", "0"}], ",", 
                   RowBox[{"Abs", "@", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", "#", "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", " ", "4"}], "]"}], "]"}]}], ",", "0"}], 
                  "]"}], " ", "&"}], " ", "/@", " ", 
                RowBox[{
                 RowBox[{"Select", "[", 
                  RowBox[{
                   RowBox[{"MADFlatten", "[", "lat", "]"}], ",", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "===", " ", 
                    "\"\<Sextupole\>\""}], "&"}]}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}]}], "]"}], 
             "&"}], "/@", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Split", "[", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY2A\>\""}], "&&", 
                   RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY1D\>\""}]}],
                   "&"}]}], "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Split", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY2A\>\""}], "&&", 
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<TCAVITY1D\>\""}]}],
                     "&"}]}], "]"}], "]"}], "===", "4"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\"", ",", 
                   "\"\<LC12Energy\>\"", ",", "\"\<BCEnergy\>\""}], "}"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY2A\>\""}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY1D\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\"", ",", 
                    "\"\<BCEnergy\>\""}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<BCEnergy\>\"", ",", "\"\<LC12Energy\>\""}], 
                    "}"}]}], "]"}], ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
                    ",", "\"\<TCAVITY1D\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<LC12Energy\>\"", ",", "\"\<BCEnergy\>\""}], 
                    "}"}], ",", 
                    RowBox[{"{", "\"\<BCEnergy\>\"", "}"}]}], "]"}]}], 
                  "]"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"sextfield", "=", "$sextfield"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"bfieldsort", "=", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   "===", "\"\<Sextupole\>\""}], "&"}]}], "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             "sextfield"}], "}"}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ">", "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"no", "=", 
                RowBox[{
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "+", "1"}]}], ",", "bndedge", ",", "offset"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1", ",", "2"}], 
                  "\[RightDoubleBracket]"}], "=!=", "\"\<Sextupole\>\""}], 
                ",", 
                RowBox[{
                 RowBox[{"offset", "=", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"bndedge", "=", 
                  RowBox[{"\"\<bnd\>\"", "<>", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], ",", 
                RowBox[{
                 RowBox[{"offset", "=", "0"}], ";", 
                 RowBox[{"bndedge", "=", "\"\<5.2\>\""}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Block", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"name", "=", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "]"}], ">", "0"}], "&&", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     ">", "0"}]}], ",", 
                    RowBox[{"\"\<sextupole( \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"no", ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"no", "-", "1"}], "]"}], "<>", "\"\<\\\"\>\""}], 
                    ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], "<>", 
                    "\"\<, \\\"z\\\", \>\"", "<>", "bndedge", "<>", 
                    "\"\<+\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "-", "offset", "-", 
                    FractionBox[
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], 
                    "2"]}], ",", "8"}], "]"}], "]"}], "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     ">", "0"}], ",", 
                    RowBox[{"(*", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "*", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<currentToField[\>\"", "<>", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                    "\"\<,\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "<>", "\"\<]\>\""}], "]"}]}], ",", "6"}], "]"}], 
                    "]"}], "*)"}], 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{"bfieldsort", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "===", "name"}], "&"}]}], 
                    "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], ",", "\"\<0\>\""}], "]"}], "<>", 
                    "\"\< ) ;\\n\>\""}], ",", "\"\<\>\""}], "]"}]}], "]"}], 
                 "&"}], ",", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<Sextupole\>\""}], "&"}]}], "]"}]}], "]"}]}]}],
             "]"}], "&"}], ",", 
          RowBox[{"Split", "[", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{
                   RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], ",", 
                   "0"}], "]"}]}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<SectorBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<RectBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<Sextupole\>\""}]}], "&"}]}], "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#2", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
              "\"\<Sextupole\>\""}], "&"}]}], "]"}]}], "]"}]}]}], ",", 
      "\"\<\>\""}], "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499072180231703*^9, 3.499072196903578*^9}, {
   3.4990946475662994`*^9, 3.4990947112443843`*^9}, {3.4990947441059604`*^9, 
   3.4990947642444086`*^9}, {3.499094917234168*^9, 3.499095135650468*^9}, {
   3.4990951909297266`*^9, 3.499095215829591*^9}, {3.4991472461843667`*^9, 
   3.4991472565089226`*^9}, {3.4991483337146363`*^9, 
   3.4991483388066263`*^9}, {3.4991484068143644`*^9, 
   3.4991484091416845`*^9}, {3.4995251181554503`*^9, 3.4995251324677672`*^9}, 
   3.499525286840791*^9, {3.499579175118309*^9, 3.499579175743301*^9}, {
   3.4995794270213346`*^9, 3.4995794270994587`*^9}, 3.4996039520307684`*^9, {
   3.500635342901477*^9, 3.5006353640384493`*^9}, {3.500635395954808*^9, 
   3.500635396189142*^9}, 3.500636478845777*^9, {3.5006389929893827`*^9, 
   3.500639001269202*^9}, {3.5006400804889307`*^9, 3.500640082441718*^9}, {
   3.5006401676457424`*^9, 3.5006401692079725`*^9}, 3.5006409368565493`*^9, {
   3.50070627904335*^9, 3.5007062809804907`*^9}, {3.500715285387088*^9, 
   3.5007153106167793`*^9}, {3.5043569189224415`*^9, 3.504356925813243*^9}, 
   3.504941616278715*^9, {3.5049647998398447`*^9, 3.504964810918253*^9}, {
   3.5049649022330904`*^9, 3.5049649167647123`*^9}, 3.504965044674237*^9, {
   3.5049651176452*^9, 3.5049651272081285`*^9}, 3.5049687837030573`*^9, {
   3.5049689346766376`*^9, 3.50496897255285*^9}, {3.5049690228200836`*^9, 
   3.5049690492271786`*^9}, {3.504969235341564*^9, 3.5049693946425176`*^9}, {
   3.5050324620537357`*^9, 3.50503246513194*^9}, {3.505033035224659*^9, 
   3.5050330372090845`*^9}, 3.5058232802748027`*^9, 3.5066916292876678`*^9, {
   3.507030381567241*^9, 3.507030398770917*^9}, 3.507030434584563*^9, {
   3.507031366270626*^9, 3.507031392115203*^9}, 3.5070326153887215`*^9, {
   3.507033101654281*^9, 3.5070331019042892`*^9}, 3.576243668421465*^9, 
   3.5762441281414647`*^9, 3.576681845646388*^9, {3.5767652193537407`*^9, 
   3.57676522037574*^9}, 3.5767658967377405`*^9, 3.576994580003168*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"bfieldsort", "=", 
  RowBox[{"Select", "[", 
   RowBox[{
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "===", "\"\<Sextupole\>\""}], "&"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
       "sextfield"}], "}"}], "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}], ">", "0"}], "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{3.576994529772134*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"\<\"AR1SEXT01\"\>", ",", "\[Infinity]"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.57699451956993*^9, 3.576994530333723*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["LCAVBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.506940566993247*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LCAVBlock", "[", "lcav_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"bfieldsort", ",", 
      RowBox[{"i", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bfieldsort", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "===", "\"\<LCAV\>\""}], "&"}]}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           "lcav"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"no", "=", 
                RowBox[{
                "#2", "\[LeftDoubleBracket]", "1", 
                 "\[RightDoubleBracket]"}]}], ",", "bndedge", ",", "offset", 
               ",", "field", ",", "phase"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1", ",", "2"}], 
                   "\[RightDoubleBracket]"}], "=!=", "\"\<LCAV\>\""}], "&&", 
                 RowBox[{
                  RowBox[{"Position", "[", 
                   RowBox[{"#", ",", "\"\<LCAV\>\""}], "]"}], "=!=", 
                  RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"offset", "=", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"bndedge", "=", 
                  RowBox[{"\"\<bnd\>\"", "<>", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}], ";"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"offset", "=", "0"}], ";", 
                 RowBox[{"bndedge", "=", "\"\<5.2\>\""}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Block", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"name", "=", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"field", ",", "phase"}], "}"}], "=", 
                    RowBox[{"bfieldsort", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
                    RowBox[{"i", "++"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"\"\<map1D_TM( \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"no", ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", "no", "]"}], "<>", 
                    "\"\<\\\"\>\""}], ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], 
                    "<>", "\"\<, \\\"z\\\", \>\"", "<>", "bndedge", "<>", 
                    "\"\<+\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "-", "offset", "-", 
                    FractionBox[
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], 
                    "2"]}], ",", "5"}], "]"}], "]"}], "<>", 
                    "\"\<, \\\"teslacav13.gdf\\\",\\\"z\\\",\\\"Ez\\\",\>\"", 
                    "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", "field", "]"}], "]"}], "<>", 
                    "\"\<,\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", "phase", "]"}], "]"}], "<>", 
                    "\"\<*pi/180,2*pi*1.3e9) ;\\n\>\""}]}]}], "]"}], "&"}], 
                ",", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<LCAV\>\""}], "&"}]}], "]"}]}], "]"}]}]}], 
            "]"}], "&"}], ",", 
          RowBox[{"Split", "[", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{
                   RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], ",", 
                   "0"}], "]"}]}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<SectorBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<RectBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<LCAV\>\""}]}], "&"}]}], "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#2", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
              "\"\<LCAV\>\""}], "&"}]}], "]"}]}], "]"}]}]}], ",", 
      "\"\<\>\""}], "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499072180231703*^9, 3.499072196903578*^9}, {
   3.4990946475662994`*^9, 3.4990947112443843`*^9}, {3.4990947441059604`*^9, 
   3.4990947642444086`*^9}, {3.499094917234168*^9, 3.499095135650468*^9}, {
   3.4990951909297266`*^9, 3.499095215829591*^9}, {3.4991472461843667`*^9, 
   3.4991472565089226`*^9}, {3.4991483337146363`*^9, 
   3.4991483388066263`*^9}, {3.4991484068143644`*^9, 
   3.4991484091416845`*^9}, {3.4995251181554503`*^9, 3.4995251324677672`*^9}, 
   3.499525286840791*^9, {3.499579175118309*^9, 3.499579175743301*^9}, {
   3.4995794270213346`*^9, 3.4995794270994587`*^9}, 3.4996039520307684`*^9, {
   3.4996196718364115`*^9, 3.4996197170392466`*^9}, {3.499619760163971*^9, 
   3.4996198298666496`*^9}, {3.49961987913196*^9, 3.499620000287434*^9}, {
   3.499620037193448*^9, 3.4996200554433312`*^9}, {3.499620090911854*^9, 
   3.4996201479271145`*^9}, {3.499621037905793*^9, 3.4996210382182913`*^9}, 
   3.499621117374035*^9, {3.499683995481573*^9, 3.499684030981573*^9}, {
   3.499684061637823*^9, 3.4996840619659476`*^9}, {3.499686851856573*^9, 
   3.499686855731573*^9}, 3.4996869794346976`*^9, {3.499771048039423*^9, 
   3.499771049726923*^9}, {3.500636473924752*^9, 3.5006364742371984`*^9}, {
   3.5006390140638657`*^9, 3.500639018188153*^9}, {3.5006400926274576`*^9, 
   3.500640106562549*^9}, 3.5049687849062204`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["ScreenBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.506940581228077*^9}],

Cell["\<\
|| (#[[2, 1, 2]] === \"SectorBend\" || #[[2, 1, 2]] === \"RectBend\")\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{3.5377861055320153`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ScreenBlock", "[", 
   RowBox[{"spacing_", ",", 
    RowBox[{"startingoffset_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"StringJoin", "@@", "\n", 
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"maindip", "=", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
              ",", "offset"}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"offset", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
                RowBox[{"#", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "2"}], 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<SectorBend\>\""}], 
                    "&&", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "2"}], 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<RectBend\>\""}]}], 
                   ")"}], ",", 
                  RowBox[{
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "+", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "3"}], 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}]}], 
                 "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"\"\<screen( \>\"", "<>", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  ">", "1"}], ",", 
                RowBox[{"\"\<\\\"bend\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "-", "1"}], "]"}], "<>", 
                 "\"\<\\\"\>\""}], ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], "<>", 
              "\"\<, \\\"I\\\",\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"NumberRight", "[", 
                RowBox[{
                 RowBox[{"Round", "[", 
                  RowBox[{"startingoffset", ",", "0.01"}], "]"}], ",", "5"}], 
                "]"}], "]"}], "<>", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
                "\"\<\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "2"}], 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<SectorBend\>\""}], 
                    "&&", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "2"}], 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<RectBend\>\""}]}], 
                   ")"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<+bnd\>\"", "<>", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<+bnd\>\"", "<>", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", 
                 "]"}]}], "\[IndentingNewLine]", "]"}], "<>", "\"\<, \>\"", "<>",
               "\[IndentingNewLine]", 
              RowBox[{"ToString", "[", 
               RowBox[{"NumberRight", "[", 
                RowBox[{
                 RowBox[{"offset", "-", "startingoffset"}], ",", "5"}], "]"}],
                "]"}], "<>", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
                RowBox[{"\"\<-bnd\>\"", "<>", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ",", "1", ",", "1"}], 
                  "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "2"}], 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<SectorBend\>\""}], 
                    "&&", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "2"}], 
                    "\[RightDoubleBracket]"}], "=!=", "\"\<RectBend\>\""}]}], 
                   ")"}], ",", "\[IndentingNewLine]", "\"\<\>\"", ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<-bnd\>\"", "<>", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", 
                 "]"}]}], "\[IndentingNewLine]", "]"}], "<>", "\"\<,\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"NumberRight", "[", 
                RowBox[{
                 RowBox[{"Round", "[", 
                  RowBox[{"spacing", ",", "0.01"}], "]"}], ",", "5"}], "]"}], 
               "]"}], "<>", 
              RowBox[{"If", "[", 
               RowBox[{"$WCS", ",", "\"\<,\\\"wcs\\\"\>\"", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ">", "1"}], ",", 
                  RowBox[{"\"\<,\\\"bend\>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "-", "1"}], "]"}], "<>", 
                   "\"\<\\\"\>\""}], ",", "\"\<,\\\"wcs\\\"\>\""}], "]"}]}], 
               "]"}], "<>", "\"\<);\\n\>\""}]}]}], "]"}], "&"}], ",", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Prepend", "[", 
              RowBox[{"#", ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              "]"}], "&"}], "@", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"Select", "[", 
                  RowBox[{
                   RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], 
                    "||", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<RectBend\>\""}]}], 
                    "&"}]}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], 
                  "\[LeftDoubleBracket]", 
                  RowBox[{"{", 
                   RowBox[{"-", "1"}], "}"}], "\[RightDoubleBracket]"}]}], 
                "]"}], ",", 
               RowBox[{"Sort", "@", 
                RowBox[{
                 RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    "\"\<SectorBend\>\""}], "]"}], ",", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                    "\"\<RectBend\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "2"}], "}"}], "}"}]}], "]"}], 
                   "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "-", 
                  "1"}], "\[RightDoubleBracket]"}]}]}], "}"}], "]"}]}], ",", 
           "2", ",", "1"}], "]"}]}], "]"}]}], ",", "\"\<\>\""}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499071966372328*^9, 3.499071992653578*^9}, {
   3.499076541560733*^9, 3.499076559044157*^9}, {3.4990768160892124`*^9, 
   3.499076829342952*^9}, {3.4990768660912457`*^9, 3.4990768920055056`*^9}, {
   3.4990769275829744`*^9, 3.4990769842511897`*^9}, {3.499084026548355*^9, 
   3.4990840273757644`*^9}, {3.4990932174398785`*^9, 3.499093217595991*^9}, {
   3.499094617233738*^9, 3.499094617842575*^9}, {3.499147268020568*^9, 
   3.4991472748150935`*^9}, {3.499149640028643*^9, 3.4991496418092775`*^9}, {
   3.4991498977832823`*^9, 3.4991500121187544`*^9}, {3.4991500535887923`*^9, 
   3.499150124126906*^9}, {3.499150247646703*^9, 3.499150327931447*^9}, {
   3.4991503689172773`*^9, 3.4991504205244355`*^9}, {3.4991504660555696`*^9, 
   3.49915046682093*^9}, {3.4991504997001877`*^9, 3.499150499981341*^9}, {
   3.499150609115486*^9, 3.4991506611287537`*^9}, {3.499150692242997*^9, 
   3.4991507411479645`*^9}, {3.4991512397412167`*^9, 3.49915127123033*^9}, {
   3.499526265422015*^9, 3.499526265750136*^9}, {3.499579807750836*^9, 
   3.499579816750721*^9}, {3.49958107734396*^9, 3.4995810776252065`*^9}, {
   3.4995811348744736`*^9, 3.499581135061971*^9}, {3.499589199271248*^9, 
   3.499589240364472*^9}, 3.4995892825826817`*^9, {3.4995893871750927`*^9, 
   3.4995894002843*^9}, {3.4995894616428895`*^9, 3.499589530126388*^9}, 
   3.4995896019379687`*^9, {3.499589657812254*^9, 3.4995896936555448`*^9}, {
   3.499589809419688*^9, 3.499589813654009*^9}, {3.4995964657719855`*^9, 
   3.499596465896984*^9}, {3.499596989030913*^9, 3.4995969891402864`*^9}, 
   3.499600250848536*^9, {3.499601413029937*^9, 3.499601417915732*^9}, {
   3.499601515396742*^9, 3.4996015160857644`*^9}, {3.499601954648406*^9, 
   3.4996019598686256`*^9}, {3.499620681876822*^9, 3.499620741204567*^9}, {
   3.499713888591073*^9, 3.499713892216073*^9}, {3.4997139818566976`*^9, 
   3.499713982528573*^9}, {3.4997560727737975`*^9, 3.4997561635550475`*^9}, {
   3.4997562000237975`*^9, 3.4997562958050475`*^9}, {3.4997564968362975`*^9, 
   3.499756523101923*^9}, {3.499756553351923*^9, 3.4997565541800475`*^9}, {
   3.4997567147737975`*^9, 3.499756716289423*^9}, {3.4997567473050475`*^9, 
   3.499756752195673*^9}, {3.4997568942112975`*^9, 3.499756894758173*^9}, 
   3.4997569436800475`*^9, {3.499757044789423*^9, 3.499757069758173*^9}, {
   3.500363210312806*^9, 3.500363398886104*^9}, {3.5006341384533916`*^9, 
   3.5006341628554244`*^9}, {3.500634219876819*^9, 3.500634249965369*^9}, {
   3.50063428114748*^9, 3.500634283303357*^9}, {3.5006343186878667`*^9, 
   3.5006343245618515`*^9}, {3.500636483829291*^9, 3.5006364840323806`*^9}, {
   3.5006389395298724`*^9, 3.5006389524963813`*^9}, 3.5006394703912487`*^9, {
   3.500639617787649*^9, 3.5006396263799143`*^9}, {3.5006396603427944`*^9, 
   3.500639660483395*^9}, 3.5006398754774876`*^9, 3.5006400722716007`*^9, 
   3.500640186439369*^9, 3.504968782093631*^9, {3.506953596660183*^9, 
   3.506953612332559*^9}, 3.5070324880721474`*^9, {3.5070348606480675`*^9, 
   3.507034860929326*^9}, {3.5070349306659327`*^9, 3.507034966448328*^9}, 
   3.537705236793703*^9, 3.537705319396247*^9, 3.537705378697034*^9, {
   3.537776033577574*^9, 3.537776060240076*^9}, {3.537776099681279*^9, 
   3.537776103012147*^9}, {3.537776136290742*^9, 3.537776138004355*^9}, {
   3.5377761746600947`*^9, 3.5377762394658227`*^9}, {3.5377762851569767`*^9, 
   3.5377762852971816`*^9}, 3.5377860430789137`*^9, {3.5399452710013638`*^9, 
   3.539945296548566*^9}, 3.553592876942067*^9, {3.554026483727637*^9, 
   3.5540265270714717`*^9}, {3.5540265650422335`*^9, 
   3.5540266603187237`*^9}, {3.554026735446114*^9, 3.554026735633542*^9}, {
   3.554030285105013*^9, 3.5540304110353575`*^9}, {3.554030580516762*^9, 
   3.5540306093016243`*^9}, 3.554468123505376*^9, {3.5544695584802256`*^9, 
   3.5544696092087593`*^9}, {3.5544698074954796`*^9, 3.5544698334409*^9}, {
   3.5544704082591715`*^9, 3.5544704144717846`*^9}, {3.5544704565967073`*^9, 
   3.554470505284847*^9}, {3.554470538147567*^9, 3.5544706127422066`*^9}, 
   3.554470665957407*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["OutputBlock", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.5069405628212385`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"OutputBlock", "[", "text_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"no", "=", "1"}], "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"bndedge", ",", "offset"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"StringMatchQ", "[", 
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}], ",", "\"\<*YAG*\>\""}], 
                   "]"}]}], "&&", 
                 RowBox[{"!", 
                  RowBox[{"StringMatchQ", "[", 
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}], ",", "\"\<*OTR*\>\""}], 
                   "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"offset", "=", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"bndedge", "=", 
                  RowBox[{"bndedge", "=", 
                   RowBox[{"\"\<bnd\>\"", "<>", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}]}], ",", 
                RowBox[{
                 RowBox[{"offset", "=", "0"}], ";", 
                 RowBox[{"bndedge", "=", "\"\<5.2\>\""}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1", ",", "2"}], 
                   "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], "||", 
                 RowBox[{
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1", ",", "2"}], 
                   "\[RightDoubleBracket]"}], "===", "\"\<RectBend\>\""}]}], 
                ",", 
                RowBox[{
                 RowBox[{"no", "++"}], ";"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Block", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"name", "=", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"\"\<screen( \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"no", ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"no", "-", "1"}], "]"}], "<>", "\"\<\\\"\>\""}], 
                    ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], "<>", 
                    "\"\<, \\\"I\\\", \>\"", "<>", "bndedge", "<>", 
                    "\"\<+\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "-", "offset"}], ",", "5"}], 
                    "]"}], "]"}], "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "$WCS", ",", "\"\<,\\\"wcs\\\"\>\"", ",", "\"\<\>\""}], 
                    "]"}], "<>", "\"\<) ;\\n\>\""}]}], "]"}], "&"}], ",", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*YAG*\>\""}], "]"}], "||", 
                    RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*OTR*\>\""}], "]"}]}], "&"}]}], "]"}]}], "]"}]}]}], 
            "]"}], "&"}], ",", 
          RowBox[{"Split", "[", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{
                   RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], ",", 
                   "0"}], "]"}]}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<SectorBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<RectBend\>\""}], "||", 
                RowBox[{"(", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*YAG*\>\""}], "]"}], "||", 
                   RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*OTR*\>\""}], "]"}]}], ")"}], 
                 RowBox[{"(*", 
                  RowBox[{"&&", 
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<Marker\>\""}]}], "*)"}], ")"}]}], "&"}]}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"StringMatchQ", "[", 
                RowBox[{
                 RowBox[{"#2", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                 "\"\<*YAG*\>\""}], "]"}], "||", 
               RowBox[{"StringMatchQ", "[", 
                RowBox[{
                 RowBox[{"#2", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                 "\"\<*OTR*\>\""}], "]"}]}], ")"}], "&"}]}], "]"}]}], "]"}]}],
        ",", "\"\<\>\""}], "]"}], "<>", "text"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4991473644715977`*^9, 3.49914737454624*^9}, {
   3.4991479563607197`*^9, 3.4991479571573195`*^9}, {3.4991484964396296`*^9, 
   3.499148505327182*^9}, {3.499149271390464*^9, 3.4991492717184753`*^9}, {
   3.499168739878578*^9, 3.499168776037952*^9}, {3.4991688171331196`*^9, 
   3.4991688172893157`*^9}, {3.4991691460194173`*^9, 3.499169147940628*^9}, {
   3.4991691832565436`*^9, 3.4991692203999524`*^9}, {3.499600789029147*^9, 
   3.4996007912634935`*^9}, {3.4996046433388443`*^9, 
   3.4996046434950933`*^9}, {3.4996099552110977`*^9, 
   3.4996099742891006`*^9}, {3.5006390204690084`*^9, 3.5006390244839396`*^9}, 
   3.5049687860468817`*^9, {3.532702398902977*^9, 3.532702399121643*^9}, 
   3.53270255613945*^9, 3.576222497346465*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"OutputBlockFEL", "[", "text_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"no", "=", "1"}], "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"bndedge", ",", "offset"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"StringMatchQ", "[", 
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}], ",", "\"\<*YAG*\>\""}], 
                   "]"}]}], "&&", 
                 RowBox[{"!", 
                  RowBox[{"StringMatchQ", "[", 
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}], ",", "\"\<*OTR*\>\""}], 
                   "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"offset", "=", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"bndedge", "=", 
                  RowBox[{"bndedge", "=", 
                   RowBox[{"\"\<bnd\>\"", "<>", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}]}], ",", 
                RowBox[{
                 RowBox[{"offset", "=", "0"}], ";", 
                 RowBox[{"bndedge", "=", "\"\<\>\""}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1", ",", "2"}], 
                   "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], "||", 
                 RowBox[{
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1", ",", "2"}], 
                   "\[RightDoubleBracket]"}], "===", "\"\<RectBend\>\""}]}], 
                ",", 
                RowBox[{
                 RowBox[{"no", "++"}], ";"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Block", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"name", "=", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"\"\<screen( \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"no", ">", "1"}], ",", 
                    RowBox[{"\"\<\\\"bend\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"no", "-", "1"}], "]"}], "<>", "\"\<\\\"\>\""}], 
                    ",", "\"\<\\\"wcs\\\"\>\""}], "]"}], "<>", 
                    "\"\<, \\\"I\\\", \>\"", "<>", "bndedge", "<>", 
                    "\"\<+\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"NumberRight", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "-", "offset"}], ",", "5"}], 
                    "]"}], "]"}], "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "$WCS", ",", "\"\<,\\\"wcs\\\"\>\"", ",", "\"\<\>\""}], 
                    "]"}], "<>", "\"\<) ;\\n\>\""}]}], "]"}], "&"}], ",", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*YAG*\>\""}], "]"}], "||", 
                    RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*OTR*\>\""}], "]"}]}], "&"}]}], "]"}]}], "]"}]}]}], 
            "]"}], "&"}], ",", 
          RowBox[{"Split", "[", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "$LATTICE", "]"}], ",", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{
                   RowBox[{"MADGetLengths", "[", "$LATTICE", "]"}], ",", 
                   "0"}], "]"}]}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<SectorBend\>\""}], "||", 
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<RectBend\>\""}], "||", 
                RowBox[{"(", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*YAG*\>\""}], "]"}], "||", 
                   RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    "\"\<*OTR*\>\""}], "]"}]}], ")"}], 
                 RowBox[{"(*", 
                  RowBox[{"&&", 
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<Marker\>\""}]}], "*)"}], ")"}]}], "&"}]}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"StringMatchQ", "[", 
                RowBox[{
                 RowBox[{"#2", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                 "\"\<*YAG*\>\""}], "]"}], "||", 
               RowBox[{"StringMatchQ", "[", 
                RowBox[{
                 RowBox[{"#2", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                 "\"\<*OTR*\>\""}], "]"}]}], ")"}], "&"}]}], "]"}]}], "]"}]}],
        ",", "\"\<\>\""}], "]"}], "<>", "text"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4991473644715977`*^9, 3.49914737454624*^9}, {
   3.4991479563607197`*^9, 3.4991479571573195`*^9}, {3.4991484964396296`*^9, 
   3.499148505327182*^9}, {3.499149271390464*^9, 3.4991492717184753`*^9}, {
   3.499168739878578*^9, 3.499168776037952*^9}, {3.4991688171331196`*^9, 
   3.4991688172893157`*^9}, {3.4991691460194173`*^9, 3.499169147940628*^9}, {
   3.4991691832565436`*^9, 3.4991692203999524`*^9}, {3.499600789029147*^9, 
   3.4996007912634935`*^9}, {3.4996046433388443`*^9, 
   3.4996046434950933`*^9}, {3.4996099552110977`*^9, 
   3.4996099742891006`*^9}, {3.5006390204690084`*^9, 3.5006390244839396`*^9}, 
   3.5049687860468817`*^9, {3.532702398902977*^9, 3.532702399121643*^9}, 
   3.53270255613945*^9, 3.576222497346465*^9, {3.576236143541465*^9, 
   3.5762361438614645`*^9}, 3.5762362118734646`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["WriteGPTFile", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.506940554164711*^9, 3.5069405557741375`*^9}}],

Cell[CellGroupData[{

Cell["Generated Distribution", "Subsubsection",
 CellChangeTimes->{{3.5546167796528053`*^9, 3.554616783926511*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "WriteGPTFile", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "WriteGPTFileInjector", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5546167314992557`*^9, 3.554616733628281*^9}, {
  3.554618341683996*^9, 3.5546183447463784`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WriteGPTFileInjector", "[", 
   RowBox[{
   "Buncherphase_", ",", "BC1Field_", ",", "BC1Phase_", ",", "BC2Field_", ",",
     "BC2Phase_", ",", "lcav_", ",", "numpart_Integer", ",", "text_", ",", 
    "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "file", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NewFile", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"{", 
          RowBox[{"NewFile", "\[Rule]", "True"}], "}"}]}], ")"}], "===", 
       "True"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"OpenWrite", "[", "\"\<Cresting_BC.in\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"file", ",", "\[IndentingNewLine]", 
         RowBox[{"StringJoin", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"HeadBlock", "[", "numpart", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"BoosterBlock", "[", 
            RowBox[{
            "Buncherphase", ",", "BC1Field", ",", "BC1Phase", ",", "BC2Field",
              ",", "BC2Phase"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DipoleBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"QuadBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"SextBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"LCAVBlock", "[", "lcav", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
           "OutputBlock", "[", 
            "\"\<\nns = 1.0e-9 ;\ndzmax = 10e-3 ;\ndtmax = dzmax/c ;\n\n\
screen(\\\"wcs\\\",\\\"I\\\",0.1,5.1,0.1,\\\"wcs\\\");\nscreen(\\\"wcs\\\",\\\
\"I\\\",5.2,\\\"wcs\\\");\n#tout(0,6.546848972493966/vz, 1*ns,\\\"wcs\\\" ) ;\
\n\>\"", "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Close", "[", "file", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Import", "[", 
        RowBox[{"\"\<!cresting_BC.bat\>\"", ",", "\"\<Table\>\""}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"GetGPTdata", "[", "EmitBooster", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"UpdateGamma", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"UpdateGamma", "\[Rule]", "True"}], "}"}]}], ")"}], "===",
           "True"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"$BetaInjector", "=", 
           RowBox[{
            RowBox[{"avgBz", "\[LeftDoubleBracket]", 
             RowBox[{"Ordering", "[", "avgt", "]"}], 
             "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
            RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"$GammaInjector", "=", 
           RowBox[{
            RowBox[{"avgG", "\[LeftDoubleBracket]", 
             RowBox[{"Ordering", "[", "avgt", "]"}], 
             "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
            RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"BCEnergy", "=", 
           RowBox[{"Convert", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"$GammaInjector", "-", "1"}], ")"}], " ", 
              "ElectronMass", " ", 
              RowBox[{
               RowBox[{
                SuperscriptBox["SpeedOfLight", "2"], "/", "Mega"}], "/", 
               "ElectronVolt"}]}], ",", "1"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.506850310728873*^9, 3.506850363902449*^9}, {
   3.5068505828782063`*^9, 3.5068505830657125`*^9}, {3.5068506329423084`*^9, 
   3.506850635411137*^9}, {3.506954546315571*^9, 3.506954613302089*^9}, {
   3.5070315615737505`*^9, 3.507031562276898*^9}, {3.5328742063840847`*^9, 
   3.5328742074127607`*^9}, 3.537529019034297*^9, {3.537532522159297*^9, 
   3.537532522456172*^9}, {3.5375995884183197`*^9, 3.537599588605586*^9}, 
   3.53762360433543*^9, {3.537711087924384*^9, 3.5377110932969074`*^9}, 
   3.5377111596569395`*^9, {3.5377113137109184`*^9, 3.5377113141169815`*^9}, {
   3.5377118199619055`*^9, 3.5377118249752192`*^9}, {3.537712329117803*^9, 
   3.5377123313823843`*^9}, {3.537799144399797*^9, 3.537799152068306*^9}, {
   3.5395291898735113`*^9, 3.5395292101237707`*^9}, 3.5540297067460394`*^9, 
   3.5544671097362547`*^9, {3.5546167696651707`*^9, 3.5546167704635553`*^9}, {
   3.5546183349498796`*^9, 3.5546183375747786`*^9}, {3.554618631452914*^9, 
   3.5546186315779085`*^9}, {3.554634068133322*^9, 3.554634068258324*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WriteGPTFile", "[", 
   RowBox[{
   "Buncherphase_", ",", "BC1Field_", ",", "BC1Phase_", ",", "BC2Field_", ",",
     "BC2Phase_", ",", "lcav_", ",", "numpart_Integer", ",", "text_", ",", 
    "opts___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "file", ",", "$FULLLATTICE", ",", "machinespacecharge", ",", 
      "spacecharge"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$spacecharge", "=", 
      RowBox[{
       RowBox[{"SpaceCharge", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"SpaceCharge", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$FULLLATTICE", "=", 
      RowBox[{"MADFlatten", "[", "$LATTICE", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "RUN", " ", "GPT", " ", "UP", " ", "TO", " ", "THE", " ", "BOOSTER"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"$LATTICE", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"WriteGPTFileInjector", "[", 
      RowBox[{
      "Buncherphase", ",", "BC1Field", ",", "BC1Phase", ",", "BC2Field", ",", 
       "BC2Phase", ",", "lcav", ",", "numpart", ",", "text", ",", "opts"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "$GammaInjector", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"$LATTICE", "=", "$FULLLATTICE"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"machinespacecharge", "=", 
          RowBox[{
           RowBox[{"MachineSpaceCharge", "/.", 
            RowBox[{"{", "opts", "}"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{"MachineSpaceCharge", "\[Rule]", "$spacecharge"}], 
            "}"}]}]}], ")"}], "=!=", 
        RowBox[{"(", 
         RowBox[{"spacecharge", "=", "$spacecharge"}], ")"}]}], ",", 
       RowBox[{"$spacecharge", "=", "machinespacecharge"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"file", "=", 
      RowBox[{"OpenWrite", "[", "\"\<Running_BC.in\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"file", ",", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"HeadBlock", "[", 
          RowBox[{"numpart", ",", "DISTFILE"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"DipoleBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"QuadBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"SextBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"LCAVBlock", "[", "lcav", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"OutputBlock", "[", "text", "]"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "file", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Import", "[", 
      RowBox[{"\"\<!Running_BC.bat\>\"", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$LATTICE", "=", "$FULLLATTICE"}], ";", "\[IndentingNewLine]", 
     RowBox[{"$spacecharge", "=", "spacecharge"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4984970994970613`*^9, 3.4984971357921314`*^9}, {
   3.4984972516271286`*^9, 3.4984974487199783`*^9}, {3.498497773767006*^9, 
   3.4984977942415485`*^9}, {3.498497833831911*^9, 3.4984978341442614`*^9}, {
   3.498498861744526*^9, 3.4984988730672135`*^9}, {3.4984990969284587`*^9, 
   3.4984991121555214`*^9}, 3.498499369079014*^9, {3.498499450899096*^9, 
   3.4984994899896984`*^9}, {3.4985032955371585`*^9, 3.498503296942734*^9}, {
   3.498503371610001*^9, 3.4985034176347733`*^9}, {3.498503480963736*^9, 
   3.4985035067482285`*^9}, {3.4985038809903812`*^9, 3.4985038971544933`*^9}, 
   3.4985047234139485`*^9, 3.4985466429172134`*^9, 3.498548793975298*^9, {
   3.498550329588945*^9, 3.4985503454972672`*^9}, 3.498550428832522*^9, 
   3.4985610411604786`*^9, 3.498816368414095*^9, {3.498819915109642*^9, 
   3.4988199178881683`*^9}, {3.499066748325453*^9, 3.499066748544203*^9}, 
   3.499071864997328*^9, {3.499071915419203*^9, 3.499071986622328*^9}, 
   3.499072178716078*^9, {3.499147351679145*^9, 3.499147361160242*^9}, {
   3.4991485237270703`*^9, 3.4991486202561984`*^9}, {3.4991491834052567`*^9, 
   3.4991491906996098`*^9}, 3.499149308861884*^9, {3.499169316819743*^9, 
   3.4991693334389973`*^9}, {3.49962017275508*^9, 3.499620190676841*^9}, {
   3.500275027313798*^9, 3.500275033360673*^9}, {3.500635418294697*^9, 
   3.500635423090743*^9}, {3.5006354892980504`*^9, 3.500635634944753*^9}, {
   3.5006357958700657`*^9, 3.500635823318447*^9}, {3.5006359660906467`*^9, 
   3.5006359961791964`*^9}, {3.5006360939591722`*^9, 
   3.5006360981147037`*^9}, {3.500636182068944*^9, 3.500636201706175*^9}, 
   3.5006362575246525`*^9, {3.500636311421588*^9, 3.5006363664901953`*^9}, {
   3.500636439024534*^9, 3.5006364446485624`*^9}, {3.500636543475232*^9, 
   3.500636546334113*^9}, {3.500638845639849*^9, 3.5006388662144184`*^9}, {
   3.500638901192748*^9, 3.500638904785877*^9}, {3.5006391803163824`*^9, 
   3.5006391829565506`*^9}, {3.50063926717637*^9, 3.500639275893614*^9}, {
   3.50063933394608*^9, 3.500639352739707*^9}, {3.500639735220478*^9, 
   3.5006397355485463`*^9}, {3.5006415532968855`*^9, 3.500641559108381*^9}, {
   3.5006416151768155`*^9, 3.5006416203321743`*^9}, {3.500641675681984*^9, 
   3.500641705692422*^9}, {3.5006446679617033`*^9, 3.5006446732420406`*^9}, {
   3.5006447180780416`*^9, 3.500644734856392*^9}, {3.5006454493422823`*^9, 
   3.5006454534353247`*^9}, 3.500705296788191*^9, {3.5007099071510983`*^9, 
   3.5007099405823927`*^9}, {3.5007104505189805`*^9, 
   3.5007104514719286`*^9}, {3.5007105298480043`*^9, 3.500710531050906*^9}, 
   3.501244918375988*^9, {3.5018349235595694`*^9, 3.501834938309664*^9}, {
   3.5049683338116913`*^9, 3.5049683386712837`*^9}, {3.504968378938713*^9, 
   3.5049684110026493`*^9}, 3.5049696759465933`*^9, {3.5068503755121956`*^9, 
   3.506850382074906*^9}, {3.506954688288864*^9, 3.5069546938671675`*^9}, {
   3.507031564464468*^9, 3.5070315690739903`*^9}, {3.508046687050491*^9, 
   3.508046786350543*^9}, {3.508046962856191*^9, 3.5080469667156897`*^9}, {
   3.5080470696408587`*^9, 3.508047088188327*^9}, {3.5328738656741247`*^9, 
   3.5328738786884346`*^9}, {3.532874004311595*^9, 3.532874005075309*^9}, {
   3.532874465532507*^9, 3.5328744713460846`*^9}, {3.5328939043323984`*^9, 
   3.5328939104147997`*^9}, 3.5377107237797594`*^9, {3.537710809146654*^9, 
   3.537710868478676*^9}, {3.5377112390578346`*^9, 3.537711242681164*^9}, 
   3.5377113119148717`*^9, 3.5377115016555233`*^9, 3.5377117085445204`*^9, {
   3.5377118279113655`*^9, 3.53771183086313*^9}, {3.5377122090325394`*^9, 
   3.5377122128432827`*^9}, {3.5377130349330387`*^9, 3.537713035667075*^9}, {
   3.5546167235936823`*^9, 3.5546167245329585`*^9}, {3.5546184481330023`*^9, 
   3.5546184628198442`*^9}, {3.554618541660062*^9, 3.5546186081414585`*^9}, {
   3.5546353479135227`*^9, 3.554635348085391*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Input Distribution", "Subsubsection",
 CellChangeTimes->{{3.5546167879497433`*^9, 3.5546167918007746`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WriteGPTFileInjector", "[", 
   RowBox[{
   "Buncherphase_", ",", "BC1Field_", ",", "BC1Phase_", ",", "BC2Field_", ",",
     "BC2Phase_", ",", "lcav_", ",", "numpart_List", ",", "text_", ",", 
    "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "file", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NewFile", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"{", 
          RowBox[{"NewFile", "\[Rule]", "True"}], "}"}]}], ")"}], "===", 
       "True"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"OpenWrite", "[", "\"\<Cresting_BC.in\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"file", ",", "\[IndentingNewLine]", 
         RowBox[{"StringJoin", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"HeadBlock", "[", "numpart", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"BoosterBlock", "[", 
            RowBox[{
            "Buncherphase", ",", "BC1Field", ",", "BC1Phase", ",", "BC2Field",
              ",", "BC2Phase"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DipoleBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"QuadBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"SextBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"LCAVBlock", "[", "lcav", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
           "OutputBlock", "[", 
            "\"\<\nns = 1.0e-9 ;\ndzmax = 10e-3 ;\ndtmax = dzmax/c ;\n\n\
screen(\\\"wcs\\\",\\\"I\\\",0.1,5.1,0.1,\\\"wcs\\\");\nscreen(\\\"wcs\\\",\\\
\"I\\\",5.2,\\\"wcs\\\");\n#tout(0,6.546848972493966/vz, 1*ns,\\\"wcs\\\" ) ;\
\n\>\"", "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Close", "[", "file", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Import", "[", 
        RowBox[{"\"\<!cresting_BC.bat\>\"", ",", "\"\<Table\>\""}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"GetGPTdata", "[", "EmitBooster", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"UpdateGamma", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"UpdateGamma", "\[Rule]", "True"}], "}"}]}], ")"}], "===",
           "True"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"$BetaInjector", "=", 
           RowBox[{
            RowBox[{"avgBz", "\[LeftDoubleBracket]", 
             RowBox[{"Ordering", "[", "avgt", "]"}], 
             "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
            RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"$GammaInjector", "=", 
           RowBox[{
            RowBox[{"avgG", "\[LeftDoubleBracket]", 
             RowBox[{"Ordering", "[", "avgt", "]"}], 
             "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
            RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"BCEnergy", "=", 
           RowBox[{"Convert", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"$GammaInjector", "-", "1"}], ")"}], " ", 
              "ElectronMass", " ", 
              RowBox[{
               RowBox[{
                SuperscriptBox["SpeedOfLight", "2"], "/", "Mega"}], "/", 
               "ElectronVolt"}]}], ",", "1"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.506850310728873*^9, 3.506850363902449*^9}, {
   3.5068505828782063`*^9, 3.5068505830657125`*^9}, {3.5068506329423084`*^9, 
   3.506850635411137*^9}, {3.506954546315571*^9, 3.506954613302089*^9}, {
   3.5070315615737505`*^9, 3.507031562276898*^9}, {3.5328742063840847`*^9, 
   3.5328742074127607`*^9}, 3.537529019034297*^9, {3.537532522159297*^9, 
   3.537532522456172*^9}, {3.5375995884183197`*^9, 3.537599588605586*^9}, 
   3.53762360433543*^9, {3.537711087924384*^9, 3.5377110932969074`*^9}, 
   3.5377111596569395`*^9, {3.5377113137109184`*^9, 3.5377113141169815`*^9}, {
   3.5377118199619055`*^9, 3.5377118249752192`*^9}, {3.537712329117803*^9, 
   3.5377123313823843`*^9}, {3.537799144399797*^9, 3.537799152068306*^9}, {
   3.5395291898735113`*^9, 3.5395292101237707`*^9}, 3.5540297067460394`*^9, 
   3.5544671097362547`*^9, {3.5546167637477317`*^9, 3.554616764624389*^9}, {
   3.5546168017884097`*^9, 3.5546168022893567`*^9}, {3.5546183304969254`*^9, 
   3.554618330825038*^9}, {3.5546340616488223`*^9, 3.5546340617738247`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WriteGPTFile", "[", 
   RowBox[{
   "Buncherphase_", ",", "BC1Field_", ",", "BC1Phase_", ",", "BC2Field_", ",",
     "BC2Phase_", ",", "lcav_", ",", "numpart_List", ",", "text_", ",", 
    "opts___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "file", ",", "$FULLLATTICE", ",", "machinespacecharge", ",", 
      "spacecharge"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$spacecharge", "=", 
      RowBox[{
       RowBox[{"SpaceCharge", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"SpaceCharge", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$FULLLATTICE", "=", 
      RowBox[{"MADFlatten", "[", "$LATTICE", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "RUN", " ", "GPT", " ", "UP", " ", "TO", " ", "THE", " ", "BOOSTER"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"$LATTICE", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"WriteGPTFileInjector", "[", 
      RowBox[{
      "Buncherphase", ",", "BC1Field", ",", "BC1Phase", ",", "BC2Field", ",", 
       "BC2Phase", ",", "lcav", ",", "numpart", ",", "text", ",", "opts"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "$GammaInjector", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"$LATTICE", "=", "$FULLLATTICE"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"machinespacecharge", "=", 
          RowBox[{
           RowBox[{"MachineSpaceCharge", "/.", 
            RowBox[{"{", "opts", "}"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{"MachineSpaceCharge", "\[Rule]", "$spacecharge"}], 
            "}"}]}]}], ")"}], "=!=", 
        RowBox[{"(", 
         RowBox[{"spacecharge", "=", "$spacecharge"}], ")"}]}], ",", 
       RowBox[{"$spacecharge", "=", "machinespacecharge"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"file", "=", 
      RowBox[{"OpenWrite", "[", "\"\<Running_BC.in\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"file", ",", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"HeadBlock", "[", 
          RowBox[{"numpart", ",", "DISTFILE"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"DipoleBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"QuadBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"SextBlock", "[", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"LCAVBlock", "[", "lcav", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"OutputBlock", "[", "text", "]"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "file", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Import", "[", 
      RowBox[{"\"\<!Running_BC.bat\>\"", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$LATTICE", "=", "$FULLLATTICE"}], ";", "\[IndentingNewLine]", 
     RowBox[{"$spacecharge", "=", "spacecharge"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4984970994970613`*^9, 3.4984971357921314`*^9}, {
   3.4984972516271286`*^9, 3.4984974487199783`*^9}, {3.498497773767006*^9, 
   3.4984977942415485`*^9}, {3.498497833831911*^9, 3.4984978341442614`*^9}, {
   3.498498861744526*^9, 3.4984988730672135`*^9}, {3.4984990969284587`*^9, 
   3.4984991121555214`*^9}, 3.498499369079014*^9, {3.498499450899096*^9, 
   3.4984994899896984`*^9}, {3.4985032955371585`*^9, 3.498503296942734*^9}, {
   3.498503371610001*^9, 3.4985034176347733`*^9}, {3.498503480963736*^9, 
   3.4985035067482285`*^9}, {3.4985038809903812`*^9, 3.4985038971544933`*^9}, 
   3.4985047234139485`*^9, 3.4985466429172134`*^9, 3.498548793975298*^9, {
   3.498550329588945*^9, 3.4985503454972672`*^9}, 3.498550428832522*^9, 
   3.4985610411604786`*^9, 3.498816368414095*^9, {3.498819915109642*^9, 
   3.4988199178881683`*^9}, {3.499066748325453*^9, 3.499066748544203*^9}, 
   3.499071864997328*^9, {3.499071915419203*^9, 3.499071986622328*^9}, 
   3.499072178716078*^9, {3.499147351679145*^9, 3.499147361160242*^9}, {
   3.4991485237270703`*^9, 3.4991486202561984`*^9}, {3.4991491834052567`*^9, 
   3.4991491906996098`*^9}, 3.499149308861884*^9, {3.499169316819743*^9, 
   3.4991693334389973`*^9}, {3.49962017275508*^9, 3.499620190676841*^9}, {
   3.500275027313798*^9, 3.500275033360673*^9}, {3.500635418294697*^9, 
   3.500635423090743*^9}, {3.5006354892980504`*^9, 3.500635634944753*^9}, {
   3.5006357958700657`*^9, 3.500635823318447*^9}, {3.5006359660906467`*^9, 
   3.5006359961791964`*^9}, {3.5006360939591722`*^9, 
   3.5006360981147037`*^9}, {3.500636182068944*^9, 3.500636201706175*^9}, 
   3.5006362575246525`*^9, {3.500636311421588*^9, 3.5006363664901953`*^9}, {
   3.500636439024534*^9, 3.5006364446485624`*^9}, {3.500636543475232*^9, 
   3.500636546334113*^9}, {3.500638845639849*^9, 3.5006388662144184`*^9}, {
   3.500638901192748*^9, 3.500638904785877*^9}, {3.5006391803163824`*^9, 
   3.5006391829565506`*^9}, {3.50063926717637*^9, 3.500639275893614*^9}, {
   3.50063933394608*^9, 3.500639352739707*^9}, {3.500639735220478*^9, 
   3.5006397355485463`*^9}, {3.5006415532968855`*^9, 3.500641559108381*^9}, {
   3.5006416151768155`*^9, 3.5006416203321743`*^9}, {3.500641675681984*^9, 
   3.500641705692422*^9}, {3.5006446679617033`*^9, 3.5006446732420406`*^9}, {
   3.5006447180780416`*^9, 3.500644734856392*^9}, {3.5006454493422823`*^9, 
   3.5006454534353247`*^9}, 3.500705296788191*^9, {3.5007099071510983`*^9, 
   3.5007099405823927`*^9}, {3.5007104505189805`*^9, 
   3.5007104514719286`*^9}, {3.5007105298480043`*^9, 3.500710531050906*^9}, 
   3.501244918375988*^9, {3.5018349235595694`*^9, 3.501834938309664*^9}, {
   3.5049683338116913`*^9, 3.5049683386712837`*^9}, {3.504968378938713*^9, 
   3.5049684110026493`*^9}, 3.5049696759465933`*^9, {3.5068503755121956`*^9, 
   3.506850382074906*^9}, {3.506954688288864*^9, 3.5069546938671675`*^9}, {
   3.507031564464468*^9, 3.5070315690739903`*^9}, {3.508046687050491*^9, 
   3.508046786350543*^9}, {3.508046962856191*^9, 3.5080469667156897`*^9}, {
   3.5080470696408587`*^9, 3.508047088188327*^9}, {3.5328738656741247`*^9, 
   3.5328738786884346`*^9}, {3.532874004311595*^9, 3.532874005075309*^9}, {
   3.532874465532507*^9, 3.5328744713460846`*^9}, {3.5328939043323984`*^9, 
   3.5328939104147997`*^9}, 3.5377107237797594`*^9, {3.537710809146654*^9, 
   3.537710868478676*^9}, {3.5377112390578346`*^9, 3.537711242681164*^9}, 
   3.5377113119148717`*^9, 3.5377115016555233`*^9, 3.5377117085445204`*^9, {
   3.5377118279113655`*^9, 3.53771183086313*^9}, {3.5377122090325394`*^9, 
   3.5377122128432827`*^9}, {3.5377130349330387`*^9, 3.537713035667075*^9}, 
   3.554616707563372*^9, {3.554618470132017*^9, 3.5546184982870054`*^9}, {
   3.5546186700136867`*^9, 3.5546186716698627`*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["GetGPTData", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{3.5069405442581444`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetGPTData", "[", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Off", "[", 
      RowBox[{"Transpose", "::", "\"\<nmtx\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Off", "[", 
      RowBox[{"Set", "::", "\"\<shape\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Check", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", "\"\<Table\>\""}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"datanumbers", "=", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"data", ",", "5"}], "]"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "14"}], "&&", 
             RowBox[{"And", "@@", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"NumberQ", "[", "#", "]"}], "&"}], ",", "#"}], 
               "]"}]}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Drop", "[", 
               RowBox[{"data", ",", "4"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "14"}], 
               "&"}]}], "]"}], "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}]}], "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Map", "[", 
           RowBox[{"Symbol", ",", 
            RowBox[{
             RowBox[{"Select", "[", 
              RowBox[{
               RowBox[{"Drop", "[", 
                RowBox[{"data", ",", "4"}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "14"}], 
                "&"}]}], "]"}], "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}]}], "]"}], "]"}], "=", 
         RowBox[{"Transpose", "[", "datanumbers", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"On", "[", 
         RowBox[{"Transpose", "::", "\"\<nmtx\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"On", "[", 
         RowBox[{"Set", "::", "\"\<shape\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Mean", "[", "x", "]"}]}], ",", "5"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4984983109621534`*^9, 3.498498332467451*^9}, {
  3.4984984077281837`*^9, 3.498498433543911*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"meanfunc", "[", "in_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "in", "]"}], ">", "0"}], ",", 
    RowBox[{"Mean", "[", "in", "]"}], ",", "0"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4997608296800475`*^9, 3.499760849726923*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "GetGPTdata", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5007106547310715`*^9, 3.5007106582616663`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetGPTdata", "[", "Time", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"testdata", ",", "timedata", ",", "data"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", " ", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"True", "&&", 
         RowBox[{
          RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}]}], ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<booster_out.txt\>\"", ",", " ", "Record"}], "]"}], 
          ",", 
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", " ", "Record"}], 
           "]"}]}], "]"}], ",", 
        RowBox[{"ReadList", "[", 
         RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", " ", "Record"}], "]"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"GetGPTdata", "[", 
      RowBox[{"Time", ",", "data"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5007058870223727`*^9, 3.5007058945678473`*^9}, {
   3.500710359973289*^9, 3.5007103871557426`*^9}, {3.500712121864971*^9, 
   3.5007121299103527`*^9}, 3.5328940595116034`*^9, {3.539933861354601*^9, 
   3.5399338636046295`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetGPTdata", "[", 
    RowBox[{"Time", ",", "data_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "testdata", ",", "timedata", ",", "timedatareal", ",", 
       "timedatarealsorted", ",", "labels", ",", "timedatarealsort"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"testdata", "=", 
       RowBox[{"Rest", "[", 
        RowBox[{"Split", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"data", ",", 
            RowBox[{
             RowBox[{"#", "=!=", 
              RowBox[{"{", "}"}]}], "&"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"StringMatchQ", "[", 
               RowBox[{"#2", ",", "\"\<time*\>\""}], "]"}]}], "&&", 
             RowBox[{"!", 
              RowBox[{"StringMatchQ", "[", 
               RowBox[{"#2", ",", "\"\<position*\>\""}], "]"}]}], "&&", 
             RowBox[{"!", 
              RowBox[{"StringMatchQ", "[", 
               RowBox[{"#2", ",", "\"\<@logo*\>\""}], "]"}]}]}], ")"}], 
           "&"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"labels", "=", 
       RowBox[{
        RowBox[{"ImportString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"testdata", ",", 
             RowBox[{
              RowBox[{"StringMatchQ", "[", 
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                ",", "\"\<time*\>\""}], "]"}], "&"}]}], "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
          "\"\<Table\>\""}], "]"}], "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"timedata", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"testdata", ",", 
         RowBox[{
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            "\"\<time*\>\""}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"timedatareal", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"First", "[", 
           RowBox[{"ImportString", "[", 
            RowBox[{
             RowBox[{"StringJoin", "[", "#", "]"}], ",", "\"\<Table\>\""}], 
            "]"}], "]"}], "&"}], ",", "timedata"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"timedatarealsorted", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"Length", "[", "labels", "]"}], "+", "2"}]}], "]"}], 
           ",", 
           RowBox[{"Length", "[", "labels", "]"}]}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"timedatarealsort", "=", 
          RowBox[{"Sort", "[", 
           RowBox[{"timedatareal", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "<", 
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
             "&"}]}], "]"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"timet", "=", 
       RowBox[{"timedatarealsort", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "timedata", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Clear", "[", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"Sequence", " ", "@@", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{"#", ",", "\"\<t\>\""}], "]"}], "&"}], ",", 
              "labels"}], "]"}]}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Map", "[", 
            RowBox[{"Symbol", ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"StringJoin", "[", 
                 RowBox[{"#", ",", "\"\<t\>\""}], "]"}], "&"}], ",", 
               "labels"}], "]"}]}], "]"}], "]"}], " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"timedatarealsorted", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "All", ",", "i"}], "\[RightDoubleBracket]"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "labels", "]"}]}], "}"}]}], "]"}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5007053965352993`*^9, 3.5007054557586803`*^9}, {
   3.500705732972845*^9, 3.5007057529535103`*^9}, {3.500705846123715*^9, 
   3.5007058469985523`*^9}, {3.5007060684730644`*^9, 3.500706070191495*^9}, {
   3.5007106312041893`*^9, 3.5007106340474114`*^9}, 3.500710685756562*^9, {
   3.500712030553797*^9, 3.500712035240427*^9}, 3.5007120759984856`*^9, {
   3.5050518759282312`*^9, 3.5050518998350935`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetGPTdata", "[", "Position", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"testdata", ",", "positiondata", ",", "data"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", " ", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"True", "&&", 
         RowBox[{
          RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}]}], ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<booster_out.txt\>\"", ",", " ", "Record"}], "]"}], 
          ",", 
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", " ", "Record"}], 
           "]"}]}], "]"}], ",", 
        RowBox[{"ReadList", "[", 
         RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", " ", "Record"}], "]"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"GetGPTdata", "[", 
      RowBox[{"Position", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.500705903753642*^9, 3.500705911705291*^9}, {
   3.5007103373681107`*^9, 3.5007103522091055`*^9}, 3.500710385593533*^9, 
   3.5007121899929495`*^9, 3.532894057530924*^9, {3.537711509823633*^9, 
   3.537711530376658*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetGPTdata", "[", 
    RowBox[{"Position", ",", "data_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "testdata", ",", "positiondata", ",", "positiondatareal", ",", 
       "positiondatarealsorted", ",", "labels", ",", "positiondatarealsort"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"testdata", "=", 
       RowBox[{"Rest", "[", 
        RowBox[{"Split", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"data", ",", 
            RowBox[{
             RowBox[{"#", "=!=", 
              RowBox[{"{", "}"}]}], "&"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"StringMatchQ", "[", 
               RowBox[{"#2", ",", "\"\<time*\>\""}], "]"}]}], "&&", 
             RowBox[{"!", 
              RowBox[{"StringMatchQ", "[", 
               RowBox[{"#2", ",", "\"\<position*\>\""}], "]"}]}], "&&", 
             RowBox[{"!", 
              RowBox[{"StringMatchQ", "[", 
               RowBox[{"#2", ",", "\"\<@logo*\>\""}], "]"}]}]}], ")"}], 
           "&"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"labels", "=", 
       RowBox[{
        RowBox[{"ImportString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"testdata", ",", 
             RowBox[{
              RowBox[{"StringMatchQ", "[", 
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                ",", "\"\<position*\>\""}], "]"}], "&"}]}], "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
          "\"\<Table\>\""}], "]"}], "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"$GPTVerbose", ",", 
        RowBox[{"Print", "[", "labels", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"positiondata", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"testdata", ",", 
         RowBox[{
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            "\"\<position*\>\""}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"positiondatareal", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"First", "[", 
           RowBox[{"ImportString", "[", 
            RowBox[{
             RowBox[{"StringJoin", "[", "#", "]"}], ",", "\"\<Table\>\""}], 
            "]"}], "]"}], "&"}], ",", "positiondata"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"positiondatarealsorted", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"Length", "[", "labels", "]"}], "+", "2"}]}], "]"}], 
           ",", 
           RowBox[{"Length", "[", "labels", "]"}]}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"positiondatarealsort", "=", 
          RowBox[{"Sort", "[", 
           RowBox[{"positiondatareal", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "<", 
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
             "&"}]}], "]"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"positionp", "=", 
       RowBox[{"positiondatarealsort", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "positiondata", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Clear", "[", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"Sequence", " ", "@@", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{"#", ",", "\"\<p\>\""}], "]"}], "&"}], ",", 
              "labels"}], "]"}]}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Map", "[", 
            RowBox[{"Symbol", ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"StringJoin", "[", 
                 RowBox[{"#", ",", "\"\<p\>\""}], "]"}], "&"}], ",", 
               "labels"}], "]"}]}], "]"}], "]"}], " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"positiondatarealsorted", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "All", ",", "i"}], "\[RightDoubleBracket]"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "labels", "]"}]}], "}"}]}], "]"}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5007053965352993`*^9, 3.5007054557586803`*^9}, {
   3.500705732972845*^9, 3.5007057529535103`*^9}, {3.500705846123715*^9, 
   3.5007058469985523`*^9}, {3.5007060684730644`*^9, 3.500706070191495*^9}, {
   3.5007106312041893`*^9, 3.5007106340474114`*^9}, 3.500710685756562*^9, {
   3.500712030553797*^9, 3.500712035240427*^9}, 3.5007120759984856`*^9, {
   3.5007121527342405`*^9, 3.500712227314146*^9}, {3.503224827437389*^9, 
   3.5032248393915443`*^9}, {3.5050517414716644`*^9, 3.505051743299836*^9}, {
   3.5050518105359325`*^9, 3.505051863099778*^9}, {3.50505190167889*^9, 
   3.5050519058664975`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetGPTdata", "[", "Emit", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"testdata", ",", "positiondata", ",", "data"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"data", " ", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"True", "&&", 
            RowBox[{
             RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}]}], ",", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Import", "[", 
              RowBox[{
              "\"\<booster_out_emit.txt\>\"", ",", " ", "\"\<Table\>\""}], 
              "]"}], ",", 
             RowBox[{"Import", "[", 
              RowBox[{
              "\"\<cresting_BC_emit.txt\>\"", ",", " ", "\"\<Table\>\""}], 
              "]"}]}], "]"}], ",", 
           RowBox[{"Import", "[", 
            RowBox[{
            "\"\<cresting_BC_emit.txt\>\"", ",", " ", "\"\<Table\>\""}], 
            "]"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"datanumbers", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"data", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], " ", "==", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "&&", " ", 
           RowBox[{"And", " ", "@@", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"NumberQ", "[", "#", "]"}], " ", "&"}], ",", " ", 
              "#"}], "]"}]}]}], " ", "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Clear", "[", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Sequence", " ", "@@", " ", 
         RowBox[{"data", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Map", "[", 
         RowBox[{"Symbol", ",", " ", 
          RowBox[{"data", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], " ", "=", " ", 
       RowBox[{"Transpose", "[", "datanumbers", "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5007053965352993`*^9, 3.5007054557586803`*^9}, {
   3.50070568227913*^9, 3.500705772981043*^9}, {3.500710373548894*^9, 
   3.5007103786416984`*^9}, 3.532894052228318*^9, {3.5377115126036015`*^9, 
   3.5377115273936577`*^9}, {3.5394259232800875`*^9, 3.5394259310770626`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetGPTdata", "[", "EmitBooster", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"testdata", ",", "positiondata", ",", "data"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"data", " ", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"\"\<cresting_BC_emit.txt\>\"", ",", " ", "\"\<Table\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"datanumbers", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"data", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], " ", "==", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "&&", " ", 
           RowBox[{"And", " ", "@@", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"NumberQ", "[", "#", "]"}], " ", "&"}], ",", " ", 
              "#"}], "]"}]}]}], " ", "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Clear", "[", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Sequence", " ", "@@", " ", 
         RowBox[{"data", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Map", "[", 
         RowBox[{"Symbol", ",", " ", 
          RowBox[{"data", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], " ", "=", " ", 
       RowBox[{"Transpose", "[", "datanumbers", "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5007053965352993`*^9, 3.5007054557586803`*^9}, {
   3.50070568227913*^9, 3.500705772981043*^9}, {3.500710373548894*^9, 
   3.5007103786416984`*^9}, 3.532894052228318*^9, {3.5377111371516895`*^9, 
   3.537711154315652*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetGPTdata", "[", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data", ",", "testdata", ",", "timedata", ",", "positiondata", ",", 
      "datanumbers"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", " ", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"True", "&&", 
         RowBox[{
          RowBox[{"Length", "[", "$LATTICE", "]"}], ">", "1"}]}], ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<booster_out.txt\>\"", ",", " ", "Record"}], "]"}], 
          ",", 
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", " ", "Record"}], 
           "]"}]}], "]"}], ",", 
        RowBox[{"ReadList", "[", 
         RowBox[{"\"\<cresting_BC_out.txt\>\"", ",", " ", "Record"}], "]"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"GetGPTdata", "[", 
      RowBox[{"Time", ",", "data"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"GetGPTdata", "[", 
      RowBox[{"Position", ",", "data"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"GetGPTdata", "[", "Emit", "]"}], ";"}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.499757970726923*^9, 3.4997579976175475`*^9}, {
   3.499758037226923*^9, 3.499758067945673*^9}, {3.4997581133675475`*^9, 
   3.4997581789612975`*^9}, {3.4997582323675475`*^9, 
   3.4997583322737975`*^9}, {3.4997583666800475`*^9, 3.499758457633173*^9}, {
   3.4997603895237975`*^9, 3.4997604554612975`*^9}, {3.4997605066800475`*^9, 
   3.499760529351923*^9}, {3.4997608561487975`*^9, 3.4997608576487975`*^9}, {
   3.499760921226923*^9, 3.499760946164423*^9}, {3.499761061664423*^9, 
   3.4997610659300475`*^9}, {3.499762627101923*^9, 3.499762639164423*^9}, {
   3.499762776070673*^9, 3.499762791539423*^9}, {3.4997711398675475`*^9, 
   3.499771161320673*^9}, {3.4998638671967163`*^9, 3.4998638764360557`*^9}, {
   3.4998640039576993`*^9, 3.4998640063965096`*^9}, {3.4998641024773235`*^9, 
   3.4998641043214273`*^9}, {3.4998642317365117`*^9, 3.499864233908804*^9}, {
   3.500361219863763*^9, 3.5003612335040393`*^9}, {3.5006415101949596`*^9, 
   3.5006415280824933`*^9}, {3.500644772365534*^9, 3.500644789300107*^9}, 
   3.500644960770472*^9, {3.500645057066329*^9, 3.5006450622216883`*^9}, 
   3.500705395410508*^9, 3.500705689277831*^9, {3.5007057342382345`*^9, 
   3.5007057447519083`*^9}, {3.5007058150826025`*^9, 3.500705839890497*^9}, {
   3.500710367362542*^9, 3.500710383109619*^9}, {3.500712296191985*^9, 
   3.5007123106736717`*^9}, {3.5328939902502117`*^9, 
   3.5328939957399683`*^9}, {3.5377115163518734`*^9, 3.537711522645847*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["SortedData Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.506940534210948*^9, 3.506940538664215*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "\[Gamma]v", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5018460624902334`*^9, 3.501846064990249*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Gamma]v", "[", "\[Gamma]_", "]"}], ":=", 
  FractionBox[
   RowBox[{"299792458", " ", 
    SqrtBox[
     RowBox[{" ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", 
        SuperscriptBox["\[Gamma]", "2"]}], ")"}]}]]}], 
   RowBox[{" ", "\[Gamma]"}]]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5018459769115605`*^9, 3.501846057162074*^9}, {
  3.5018461064592648`*^9, 3.501846118771844*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SortedData", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAttributes", "[", 
   RowBox[{"SortedData", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SortedData", "[", 
   RowBox[{"datain_", ",", 
    RowBox[{"scale_:", "1"}], ",", 
    RowBox[{"offset_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "g", ",", "d"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "g", ",", "d"}], "}"}], "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Sort", "[", "#", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"offset", "+", 
              RowBox[{"Accumulate", "[", 
               RowBox[{
                RowBox[{"Differences", "[", 
                 RowBox[{"Sort", "@", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{"t", ",", "0"}], "]"}]}], "]"}], "*", 
                RowBox[{"\[Gamma]v", "[", "g", "]"}]}], "]"}]}], ",", 
             RowBox[{"scale", "*", "d"}]}], "}"}], "]"}]}]}], "]"}], "&"}], 
      ",", "datain"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.501846184459764*^9, 3.501846270116562*^9}, {
   3.501846305569914*^9, 3.5018463961642437`*^9}, {3.501846456930258*^9, 
   3.501846513961873*^9}, {3.501846553149624*^9, 3.5018465542590055`*^9}, {
   3.5018466632440777`*^9, 3.5018466735097685`*^9}, {3.5018468561046877`*^9, 
   3.5018468706516557`*^9}, {3.503993775105009*^9, 3.5039937891991196`*^9}, 
   3.504596355952111*^9, {3.506940519179217*^9, 3.5069405272576003`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SortedBunchLength", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAttributes", "[", 
   RowBox[{"SortedBunchLength", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SortedBunchLength", "[", 
   RowBox[{"datain_", ",", 
    RowBox[{"scale_:", "1"}], ",", 
    RowBox[{"offset_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "g", ",", "d"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "g", ",", "d"}], "}"}], "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Sort", "[", "#", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"offset", "+", 
              RowBox[{"Accumulate", "[", 
               RowBox[{
                RowBox[{"Differences", "[", 
                 RowBox[{"Sort", "@", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{"t", ",", "0"}], "]"}]}], "]"}], "*", 
                RowBox[{"\[Gamma]v", "[", "g", "]"}]}], "]"}]}], ",", 
             RowBox[{"scale", "*", 
              RowBox[{"\[Gamma]v", "[", "g", "]"}], "*", "d"}]}], "}"}], 
           "]"}]}]}], "]"}], "&"}], ",", "datain"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.501846184459764*^9, 3.501846270116562*^9}, {
   3.501846305569914*^9, 3.5018463961642437`*^9}, {3.501846456930258*^9, 
   3.501846513961873*^9}, {3.501846553149624*^9, 3.5018465542590055`*^9}, {
   3.5018466632440777`*^9, 3.5018466735097685`*^9}, {3.5018468561046877`*^9, 
   3.5018468706516557`*^9}, {3.503993775105009*^9, 3.5039937891991196`*^9}, {
   3.504275973547245*^9, 3.5042760171585736`*^9}, {3.5043328891834464`*^9, 
   3.504332897074223*^9}, {3.5045209836825953`*^9, 3.5045209866045456`*^9}, 
   3.5045963579677877`*^9, {3.5069405166635113`*^9, 3.5069405260856876`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SortedMeanData", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAttributes", "[", 
   RowBox[{"SortedMeanData", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SortedMeanData", "[", 
   RowBox[{"datain_", ",", 
    RowBox[{"scale_:", "1"}], ",", 
    RowBox[{"offset_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "g", ",", "d"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "g", ",", "d"}], "}"}], "=", 
           RowBox[{"Map", "[", 
            RowBox[{"Mean", ",", 
             RowBox[{"Transpose", "[", "#", "]"}], ",", 
             RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"offset", "+", 
              RowBox[{"Accumulate", "[", 
               RowBox[{
                RowBox[{"Differences", "[", 
                 RowBox[{"Sort", "@", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{"t", ",", "0"}], "]"}]}], "]"}], "*", 
                RowBox[{"\[Gamma]v", "[", "g", "]"}]}], "]"}]}], ",", 
             RowBox[{"scale", "*", "d"}]}], "}"}], "]"}]}]}], "]"}], "&"}], 
      ",", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"datain", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}], ">", "4"}], "&"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Mean", "[", 
           RowBox[{
           "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "]"}], "<", 
          RowBox[{"Mean", "[", 
           RowBox[{
           "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "]"}]}], "&"}]}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.501846184459764*^9, 3.501846270116562*^9}, {
   3.501846305569914*^9, 3.5018463961642437`*^9}, {3.501846456930258*^9, 
   3.501846513961873*^9}, {3.501846553149624*^9, 3.5018465542590055`*^9}, {
   3.5018466632440777`*^9, 3.5018466735097685`*^9}, {3.5018468561046877`*^9, 
   3.5018468706516557`*^9}, {3.503993775105009*^9, 3.5039937891991196`*^9}, {
   3.50451588507207*^9, 3.5045159636678324`*^9}, {3.504520834710032*^9, 
   3.5045208868519917`*^9}, {3.5045209890264826`*^9, 
   3.5045210205897903`*^9}, {3.5045317113165913`*^9, 
   3.5045317829434247`*^9}, {3.5045318179755716`*^9, 3.504531820022499*^9}, {
   3.504531866945575*^9, 3.504531868195607*^9}, {3.504531980182849*^9, 
   3.5045320277778172`*^9}, 3.5045963264044795`*^9, {3.506940514835328*^9, 
   3.5069405237574883`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SortedStandardDeviationData", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAttributes", "[", 
   RowBox[{"SortedStandardDeviationData", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SortedStandardDeviationData", "[", 
   RowBox[{"datain_", ",", 
    RowBox[{"scale_:", "1"}], ",", 
    RowBox[{"offset_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "g", ",", "d"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "g", ",", "d"}], "}"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{"Mean", ",", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"Map", "[", 
                RowBox[{"Mean", ",", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"StandardDeviation", "[", "#", "]"}], "&"}], ",", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "3", 
                  "\[RightDoubleBracket]"}]}], "]"}]}], "}"}], "&"}], "[", 
            RowBox[{"Transpose", "[", "#", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"offset", "+", 
              RowBox[{"Accumulate", "[", 
               RowBox[{
                RowBox[{"Differences", "[", 
                 RowBox[{"Sort", "@", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{"t", ",", "0"}], "]"}]}], "]"}], "*", 
                RowBox[{"\[Gamma]v", "[", "g", "]"}]}], "]"}]}], ",", 
             RowBox[{"scale", "*", "d"}]}], "}"}], "]"}]}]}], "]"}], "&"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"datain", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], ">", "4"}], "&"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "<", 
           RowBox[{"Mean", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.501846184459764*^9, 3.501846270116562*^9}, {
   3.501846305569914*^9, 3.5018463961642437`*^9}, {3.501846456930258*^9, 
   3.501846513961873*^9}, {3.501846553149624*^9, 3.5018465542590055`*^9}, {
   3.5018466632440777`*^9, 3.5018466735097685`*^9}, {3.5018468561046877`*^9, 
   3.5018468706516557`*^9}, {3.503993775105009*^9, 3.5039937891991196`*^9}, {
   3.50451588507207*^9, 3.5045159636678324`*^9}, {3.504520834710032*^9, 
   3.5045208868519917`*^9}, {3.5045209890264826`*^9, 
   3.5045210205897903`*^9}, {3.5045317113165913`*^9, 
   3.5045317829434247`*^9}, {3.5045318179755716`*^9, 3.504531820022499*^9}, {
   3.504531866945575*^9, 3.504531868195607*^9}, {3.504531980182849*^9, 
   3.5045320277778172`*^9}, {3.50453211265499*^9, 3.504532204422964*^9}, {
   3.5045323027536063`*^9, 3.5045323108788147`*^9}, 3.5045441639270782`*^9, 
   3.5045442949304314`*^9, {3.5046086149016557`*^9, 3.5046086427304926`*^9}, {
   3.5048577198910923`*^9, 3.5048577259224963`*^9}, {3.5048578031900992`*^9, 
   3.5048578050182714`*^9}, {3.5048688006122513`*^9, 
   3.5048688036748295`*^9}, {3.506684355242406*^9, 3.506684360336319*^9}, {
   3.506684443167094*^9, 3.5066844476516128`*^9}, {3.506684522372754*^9, 
   3.506684526263503*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SortedStandardDeviationBunchLength", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAttributes", "[", 
   RowBox[{"SortedStandardDeviationBunchLength", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SortedStandardDeviationBunchLength", "[", 
   RowBox[{"datain_", ",", 
    RowBox[{"scale_:", "1"}], ",", 
    RowBox[{"offset_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "g", ",", "d"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "g", ",", "d"}], "}"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{"Mean", ",", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"Map", "[", 
                RowBox[{"Mean", ",", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"StandardDeviation", "[", "#", "]"}], "&"}], ",", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "3", 
                  "\[RightDoubleBracket]"}]}], "]"}]}], "}"}], "&"}], "[", 
            RowBox[{"Transpose", "[", "#", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"offset", "+", 
              RowBox[{"Accumulate", "[", 
               RowBox[{
                RowBox[{"Differences", "[", 
                 RowBox[{"Sort", "@", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{"t", ",", "0"}], "]"}]}], "]"}], "*", 
                RowBox[{"\[Gamma]v", "[", "g", "]"}]}], "]"}]}], ",", 
             RowBox[{"scale", "*", 
              RowBox[{"\[Gamma]v", "[", "g", "]"}], "*", "d"}]}], "}"}], 
           "]"}]}]}], "]"}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"datain", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], ">", "4"}], "&"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "<", 
           RowBox[{"Mean", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.501846184459764*^9, 3.501846270116562*^9}, {
   3.501846305569914*^9, 3.5018463961642437`*^9}, {3.501846456930258*^9, 
   3.501846513961873*^9}, {3.501846553149624*^9, 3.5018465542590055`*^9}, {
   3.5018466632440777`*^9, 3.5018466735097685`*^9}, {3.5018468561046877`*^9, 
   3.5018468706516557`*^9}, {3.503993775105009*^9, 3.5039937891991196`*^9}, {
   3.50451588507207*^9, 3.5045159636678324`*^9}, {3.504520834710032*^9, 
   3.5045208868519917`*^9}, {3.5045209890264826`*^9, 
   3.5045210205897903`*^9}, {3.5045317113165913`*^9, 
   3.5045317829434247`*^9}, {3.5045318179755716`*^9, 3.504531820022499*^9}, {
   3.504531866945575*^9, 3.504531868195607*^9}, {3.504531980182849*^9, 
   3.5045320277778172`*^9}, {3.50453211265499*^9, 3.504532204422964*^9}, {
   3.5045323027536063`*^9, 3.5045323108788147`*^9}, 3.5045441639270782`*^9, 
   3.5045442949304314`*^9, {3.5046086149016557`*^9, 3.5046086427304926`*^9}, {
   3.5048577198910923`*^9, 3.5048577259224963`*^9}, {3.5048578031900992`*^9, 
   3.5048578050182714`*^9}, {3.5048688006122513`*^9, 
   3.5048688036748295`*^9}, {3.504869200778745*^9, 3.5048692112008867`*^9}, {
   3.506684343523281*^9, 3.506684353054836*^9}, {3.5066844508548403`*^9, 
   3.5066844528392787`*^9}, {3.5066845131068325`*^9, 3.5066845188101397`*^9}}]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1904, 911},
WindowMargins->{{0, Automatic}, {0, Automatic}},
ShowSelection->True,
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (November 20, 2012)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 1019, 22, 92, "Input"],
Cell[1579, 44, 198, 4, 31, "Input",
 InitializationCell->True],
Cell[1780, 50, 270, 5, 52, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[2075, 59, 121, 2, 79, "Section",
 InitializationCell->True],
Cell[2199, 63, 997, 27, 72, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3221, 94, 100, 2, 43, "Subsection",
 InitializationCell->True],
Cell[3324, 98, 3431, 65, 583, "Input",
 InitializationCell->True],
Cell[6758, 165, 3391, 62, 412, "Input",
 InitializationCell->True],
Cell[10152, 229, 2560, 45, 372, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[12749, 279, 105, 2, 43, "Subsection",
 InitializationCell->True],
Cell[12857, 283, 4470, 97, 339, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[17364, 385, 104, 2, 35, "Subsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[17493, 391, 132, 2, 31, "Input"],
Cell[17628, 395, 21924, 434, 552, "Output"]
}, Open  ]],
Cell[39567, 832, 31715, 625, 795, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[71319, 1462, 102, 2, 43, "Subsection",
 InitializationCell->True],
Cell[71424, 1466, 18397, 398, 551, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[89858, 1869, 153, 3, 43, "Subsection",
 InitializationCell->True],
Cell[90014, 1874, 17918, 389, 511, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[107957, 2267, 836, 24, 31, "Input"],
Cell[108796, 2293, 188, 4, 31, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[109033, 2303, 100, 2, 43, "Subsection",
 InitializationCell->True],
Cell[109136, 2307, 8308, 175, 363, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[117481, 2487, 102, 2, 35, "Subsection",
 InitializationCell->True],
Cell[117586, 2491, 164, 4, 30, "Text",
 InitializationCell->True],
Cell[117753, 2497, 14910, 290, 432, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[132700, 2792, 104, 2, 43, "Subsection",
 InitializationCell->True],
Cell[132807, 2796, 8375, 184, 232, "Input",
 InitializationCell->True],
Cell[141185, 2982, 8451, 185, 232, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[149673, 3172, 129, 2, 43, "Subsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[149827, 3178, 115, 1, 34, "Subsubsection"],
Cell[149945, 3181, 331, 7, 52, "Input",
 InitializationCell->True],
Cell[150279, 3190, 4950, 103, 627, "Input",
 InitializationCell->True],
Cell[155232, 3295, 7207, 130, 472, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[162476, 3430, 113, 1, 34, "Subsubsection"],
Cell[162592, 3433, 4949, 103, 627, "Input",
 InitializationCell->True],
Cell[167544, 3538, 7124, 129, 472, "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[174717, 3673, 103, 2, 43, "Subsection",
 InitializationCell->True],
Cell[174823, 3677, 2914, 75, 232, "Input",
 InitializationCell->True],
Cell[177740, 3754, 341, 9, 31, "Input",
 InitializationCell->True],
Cell[178084, 3765, 164, 3, 31, "Input",
 InitializationCell->True],
Cell[178251, 3770, 1321, 33, 92, "Input",
 InitializationCell->True],
Cell[179575, 3805, 5549, 140, 252, "Input",
 InitializationCell->True],
Cell[185127, 3947, 1325, 33, 92, "Input",
 InitializationCell->True],
Cell[186455, 3982, 5973, 147, 272, "Input",
 InitializationCell->True],
Cell[192431, 4131, 2782, 71, 132, "Input",
 InitializationCell->True],
Cell[195216, 4204, 1964, 49, 132, "Input",
 InitializationCell->True],
Cell[197183, 4255, 2764, 53, 132, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[199984, 4313, 135, 2, 36, "Subsection",
 InitializationCell->True],
Cell[200122, 4317, 179, 4, 31, "Input",
 InitializationCell->True],
Cell[200304, 4323, 470, 14, 58, "Input",
 InitializationCell->True],
Cell[200777, 4339, 2015, 49, 152, "Input",
 InitializationCell->True],
Cell[202795, 4390, 2264, 54, 152, "Input",
 InitializationCell->True],
Cell[205062, 4446, 3136, 77, 152, "Input",
 InitializationCell->True],
Cell[208201, 4525, 4391, 104, 152, "Input",
 InitializationCell->True],
Cell[212595, 4631, 4529, 105, 152, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
