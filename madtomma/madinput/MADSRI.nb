(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 6.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[     52044,       1557]
NotebookOptionsPosition[     47711,       1421]
NotebookOutlinePosition[     48085,       1437]
CellTagsIndexPosition[     48042,       1434]
WindowFrame->Normal
ContainsDynamic->False*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"BeginPackage", "[", 
  RowBox[{"\"\<MADSRI`\>\"", ",", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Madtomma`MADInput`MADInput`\>\"", ",", "\"\<Madtomma`Mfs`Mfs`\>\"", 
     ",", "\"\<Accelerator`ConstantsUnits`\>\"", ",", "\"\<Units`\>\"", ",", 
     "\"\<PhysicalConstants`\>\""}], "}"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3901984973962736`*^9, 3.39019850305227*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSRI", "::", "usage"}], "=", 
   "\"\<MADSRI[Lattice]\\nCalculates SRI using data from the MAD code\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSRI1", "::", "usage"}], "=", 
   "\"\<MADSRI1[Lattice]\\nCalculates SRI 1 using data from the MAD \
code\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSRI2", "::", "usage"}], "=", 
   "\"\<MADSRI2[Lattice]\\nCalculates SRI 2 using data from the MAD \
code\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSRI3", "::", "usage"}], "=", 
   "\"\<MADSRI3[Lattice]\\nCalculates SRI 3 using data from the MAD \
code\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSRI4", "::", "usage"}], "=", 
   "\"\<MADSRI4[Lattice]\\nCalculates SRI 4 using data from the MAD \
code\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSRI5", "::", "usage"}], "=", 
   "\"\<MADSRI5[Lattice]\\nCalculates SRI 5 using data from the MAD \
code\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MAD\[Alpha]c", "::", "usage"}], "=", 
   "\"\<MAD\[Alpha]c[Lattice]\\nCalculates Momentum Compaction\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MAD\[Epsilon]", "::", "usage"}], "=", 
   "\"\<MAD\[Epsilon][Lattice, Energy (GeV)]\\nCalculates Emittance\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADU0", "::", "usage"}], "=", 
   "\"\<MADU0[Lattice, Energy (GeV)]\\nCalculates U0\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADJx", "::", "usage"}], "=", 
   "\"\<MADJx[Lattice]\\nCalculates Jx\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADJ\[Epsilon]", "::", "usage"}], "=", 
  "\"\<MADJ\[Epsilon][Lattice]\\nCalculates J\[Epsilon]\>\""}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADES", "::", "usage"}], "=", 
   "\"\<MADES[Lattice, Energy (GeV)]\\nCalculates Energy Spread\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MAD\[Tau]x", "::", "usage"}], "=", 
   "\"\<MAD\[Tau]x[Lattice, Energy (GeV)]\\nCalculates Damping Time \[Tau]x\>\
\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Tau]y", "::", "usage"}], "=", 
  "\"\<MAD\[Tau]y[Lattice, Energy (GeV)]\\nCalculates Damping Time \
\[Tau]y\>\""}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Tau]\[Epsilon]", "::", "usage"}], "=", 
  "\"\<MAD\[Tau]\[Epsilon][Lattice, Energy (GeV)]\\nCalculates Damping Time \
\[Tau]\[Epsilon]\>\""}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MAD\[Epsilon]x", "::", "usage"}], "=", 
   "\"\<MAD\[Epsilon]x[Lattice, Energy (GeV), \[Kappa]]\\nCalculates \
Horizontal Emittance\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Epsilon]y", "::", "usage"}], "=", 
  "\"\<MAD\[Epsilon]y[Lattice, Energy (GeV), \[Kappa]]\\nCalculates Vertical \
Emittance\>\""}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SRI1", "::", "usage"}], "=", "\"\<SRI 1\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SRI2", "::", "usage"}], "=", "\"\<SRI 2\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SRI3", "::", "usage"}], "=", "\"\<SRI 3\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SRI4", "::", "usage"}], "=", "\"\<SRI 4\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SRI5", "::", "usage"}], "=", "\"\<SRI 5\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], "  "}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ALFX", ":=", "Global`ALFX"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"BETX", ":=", "Global`BETX"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"DX", ":=", "Global`DX"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"DPX", ":=", "Global`DPX"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADFlatten", "[", "x_", "]"}], ":=", 
  RowBox[{"Madtomma`MADInput`MADInput`MADFlatten", "[", "x", "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADExtraList", "[", "lattice_", "]"}], ":=", 
  RowBox[{"ToExpression", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"MADFlatten", "[", "lattice", "]"}], "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADStripUnusedExtraFields", "[", "extralist_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Drop", "[", 
     RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", "extralist"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElementList", "[", "lattice_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MADFlatten", "[", "lattice", "]"}], ",", 
      RowBox[{"MADStripUnusedExtraFields", "[", 
       RowBox[{"MADExtraList", "[", "lattice", "]"}], "]"}]}], "}"}], 
    "]"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"integralSRI1", "[", 
   RowBox[{
   "kx_", ",", "s_", ",", "h_", ",", "dx_", ",", "dpx_", ",", "\[Beta]2_", 
    ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kx", "==", "0"}], ",", 
         FractionBox[
          RowBox[{"h", " ", 
           SuperscriptBox["l", "2"]}], "2"], ",", 
         FractionBox[
          RowBox[{"h", " ", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"Cos", "[", 
              RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], 
          SuperscriptBox["kx", "2"]]}], "]"}], "+", 
       RowBox[{"dpx", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"kx", "==", "0"}], ",", "l", ",", 
          FractionBox[
           RowBox[{"Sin", "[", 
            RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}], "+", 
       RowBox[{"dx", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"kx", " ", "l"}], "]"}], "+", 
          RowBox[{"h", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"kx", "==", "0"}], ",", "l", ",", 
             FractionBox[
              RowBox[{"Sin", "[", 
               RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}], " ", 
           RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}], "/", 
     "\[Rho]"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}], ",", 
    RowBox[{"Compiled", "\[Rule]", "True"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI1", "[", 
   RowBox[{"latt_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "-", "1"}], 
       ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{"\[Rho]", "=", 
            RowBox[{"L", "/", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}]}], ";", 
           RowBox[{"n", "=", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"#", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}]}], " ", 
             SuperscriptBox["\[Rho]", "2"]}]}], ";", 
           RowBox[{"h", "=", 
            RowBox[{"1", "/", "\[Rho]"}]}], ";", 
           RowBox[{"kx", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
           RowBox[{"ky", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
           RowBox[{"integralSRI1", "[", 
            RowBox[{"kx", ",", "L", ",", "h", ",", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",",
              
             RowBox[{
             "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",",
              
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "11"}], "\[RightDoubleBracket]"}], ",", 
             "\[Rho]"}], "]"}]}], ")"}], "&"}], "/@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADElementList", "[", 
               RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"dx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
            ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"dpx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SR2Element", "[", "elem_", "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"elem", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}],
        "/", 
       RowBox[{
       "elem", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
      ")"}], "2"], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", 
      RowBox[{
      "elem", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
     "}"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI2", "[", "latt_", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"Plus", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"SR2Element", "[", "#", "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], ")"}]}], ")"}]}], 
    ")"}], "/", "Meter"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SR3Element", "[", "elem_", "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{"Abs", "[", 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{
        "elem", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], "/", 
        RowBox[{
        "elem", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       ")"}], "3"], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", 
      RowBox[{
      "elem", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
     "}"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI3", "[", "latt_", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"Plus", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"SR3Element", "[", "#", "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], ")"}]}], ")"}]}], 
    ")"}], "/", 
   SuperscriptBox["Meter", "2"]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"integralSRI4", "[", 
   RowBox[{
   "kx_", ",", "s_", ",", "h_", ",", "dx_", ",", "dpx_", ",", "\[Beta]2_", 
    ",", "n_", ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"2", "n"}]}], ")"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"kx", "==", "0"}], ",", 
          FractionBox[
           RowBox[{"h", " ", 
            SuperscriptBox["l", "2"]}], "2"], ",", 
          FractionBox[
           RowBox[{"h", " ", 
            RowBox[{"(", 
             RowBox[{"1", "-", 
              RowBox[{"Cos", "[", 
               RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], 
           SuperscriptBox["kx", "2"]]}], "]"}], "+", 
        RowBox[{"dpx", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"kx", "==", "0"}], ",", "l", ",", 
           FractionBox[
            RowBox[{"Sin", "[", 
             RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}], "+", 
        RowBox[{"dx", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"kx", " ", "l"}], "]"}], "+", 
           RowBox[{"h", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"kx", "==", "0"}], ",", "l", ",", 
              FractionBox[
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}], " ", 
            RowBox[{"Tan", "[", "\[Beta]2", "]"}]}]}], ")"}]}]}], ")"}], "/", 
      
      SuperscriptBox["\[Rho]", "3"]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}], ",", 
    RowBox[{"Compiled", "\[Rule]", "True"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI4", "[", 
   RowBox[{"latt_", ",", "dx_", ",", "dpx_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "-", "1"}], 
       ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"L", "=", 
            RowBox[{"#", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{"\[Rho]", "=", 
            RowBox[{"L", "/", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}]}], ";", 
           RowBox[{"n", "=", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"#", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}]}], " ", 
             SuperscriptBox["\[Rho]", "2"]}]}], ";", 
           RowBox[{"h", "=", 
            RowBox[{"1", "/", "\[Rho]"}]}], ";", 
           RowBox[{"kx", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
           RowBox[{"ky", "=", 
            RowBox[{"h", " ", 
             RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
           RowBox[{"integralSRI4", "[", 
            RowBox[{"kx", ",", "L", ",", "h", ",", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",",
              
             RowBox[{
             "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",",
              
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "11"}], "\[RightDoubleBracket]"}], ",", "n", 
             ",", "\[Rho]"}], "]"}]}], ")"}], "&"}], "/@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADElementList", "[", 
               RowBox[{"MADFlatten", "[", "latt", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"dx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
            ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"dpx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"integralSRI5H", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Beta]_", ",", "\[Gamma]_", ",", "kx_", ",", "s_", ",",
     "h_", ",", "dx_", ",", "dpx_", ",", "\[Rho]_"}], "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"dx", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"kx", "==", "0"}], ",", 
             FractionBox[
              RowBox[{"h", " ", 
               SuperscriptBox["l", "2"]}], "2"], ",", 
             FractionBox[
              RowBox[{"h", " ", 
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"Cos", "[", 
                  RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], 
              SuperscriptBox["kx", "2"]]}], "]"}], "+", 
           RowBox[{"dpx", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"kx", "==", "0"}], ",", "l", ",", 
              FractionBox[
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}]}], ")"}], 
         "2"], "+", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"\[Beta]", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", 
                 RowBox[{"kx", " ", "l"}], "]"}], "2"]}], "-", 
              RowBox[{"2", " ", "\[Alpha]", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], " ", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                 FractionBox[
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}], "+", 
              RowBox[{"\[Gamma]", " ", 
               SuperscriptBox[
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                  FractionBox[
                   RowBox[{"Sin", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}], "2"]}]}],
              ")"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"dpx", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"kx", "==", "0"}], ",", 
                RowBox[{"h", " ", "l"}], ",", 
                FractionBox[
                 RowBox[{"h", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}], "kx"]}], "]"}], "-", 
              RowBox[{"dx", " ", "kx", " ", 
               RowBox[{"Sin", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}]}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"dx", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"kx", "==", "0"}], ",", 
                FractionBox[
                 RowBox[{"h", " ", 
                  SuperscriptBox["l", "2"]}], "2"], ",", 
                FractionBox[
                 RowBox[{"h", " ", 
                  RowBox[{"(", 
                   RowBox[{"1", "-", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}]}], ")"}]}], 
                 SuperscriptBox["kx", "2"]]}], "]"}], "+", 
              RowBox[{"dpx", " ", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                 FractionBox[
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}]}], ")"}],
             " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"kx", "==", "0"}], ",", "l", ",", 
                  FractionBox[
                   RowBox[{"Sin", "[", 
                    RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
                 RowBox[{"kx", " ", "\[Alpha]", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}]}], ")"}]}], "+", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"kx", " ", "l"}], "]"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Alpha]", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}], "+", 
                 RowBox[{"kx", " ", "\[Beta]", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"kx", " ", "l"}], "]"}]}]}], ")"}]}]}], ")"}]}]}], 
          ")"}], "2"]}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Beta]", " ", 
         SuperscriptBox[
          RowBox[{"Cos", "[", 
           RowBox[{"kx", " ", "l"}], "]"}], "2"]}], "-", 
        RowBox[{"2", " ", "\[Alpha]", " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"kx", " ", "l"}], "]"}], " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"kx", "==", "0"}], ",", "l", ",", 
           FractionBox[
            RowBox[{"Sin", "[", 
             RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}]}], "+", 
        RowBox[{"\[Gamma]", " ", 
         SuperscriptBox[
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"kx", "==", "0"}], ",", "l", ",", 
            FractionBox[
             RowBox[{"Sin", "[", 
              RowBox[{"kx", " ", "l"}], "]"}], "kx"]}], "]"}], "2"]}]}], 
       ")"}]}], "/", 
     SuperscriptBox[
      RowBox[{"Abs", "[", "\[Rho]", "]"}], "3"]}], ",", 
    RowBox[{"{", 
     RowBox[{"l", ",", "0", ",", "s"}], "}"}], ",", 
    RowBox[{"Compiled", "\[Rule]", "True"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI5H", "[", "input_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "kx", ",", "ky", ",", "\[Rho]", ",", " ", "h", ",", " ", "n", ",", "L"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Plus", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"#", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
          RowBox[{"\[Rho]", "=", 
           RowBox[{"L", "/", 
            RowBox[{"#", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}]}]}], ";", 
          RowBox[{"n", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}]}], " ", 
            SuperscriptBox["\[Rho]", "2"]}]}], ";", 
          RowBox[{"h", "=", 
           RowBox[{"1", "/", "\[Rho]"}]}], ";", 
          RowBox[{"kx", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"1", "-", "n"}], "]"}]}]}], ";", 
          RowBox[{"ky", "=", 
           RowBox[{"h", " ", 
            RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", 
          RowBox[{"integralSRI5H", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            
            RowBox[{
            "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
            
            RowBox[{
            "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], ",", 
            "kx", ",", "L", ",", "h", ",", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], ",", 
            
            RowBox[{
            "#", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], ",", 
            "\[Rho]"}], "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"{", "input", "}"}]}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI5", "[", 
   RowBox[{
   "latt_", ",", "alfx_", ",", "betx_", ",", "gamx_", ",", "dx_", ",", 
    "dpx_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "\[Beta]", ",", "\[Beta]prime", ",", "\[Eta]", ",", 
      "\[Eta]prime", ",", "pos", ",", "mat", ",", "tpos", ",", "tmat", ",", 
      "\[Rho]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
           "\"\<SectorBend\>\""}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "-", "1"}], 
       ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"MADSRI5H", "[", "#", "]"}], ")"}], "&"}], "/@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MADFlatten", "[", "latt", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"alfx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"betx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"gamx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"dx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], ")"}], 
            ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Extract", "[", 
                RowBox[{"dpx", ",", "#"}], "]"}], "&"}], "/@", "pos"}], 
             ")"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Alpha]c", "[", "latt_", "]"}], ":=", 
  RowBox[{
   RowBox[{"MADSRI1", "[", "latt", "]"}], "/", 
   RowBox[{"MADLength", "[", "latt", "]"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Epsilon]", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     FractionBox[
      RowBox[{"55", " ", "PlanckConstant", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"NumberQ", "[", "energy", "]"}], "===", "True"}], ",", 
           RowBox[{"energy", " ", "ElectronVolt", " ", "Giga"}], ",", 
           "energy"}], "]"}], ")"}], "2"]}], 
      RowBox[{"2", " ", "\[Pi]", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"ElectronMass", "*", 
          SuperscriptBox["SpeedOfLight", "2"]}], ")"}], "2"], " ", "32", 
       SqrtBox["3"], "ElectronMass", " ", "SpeedOfLight"}]], "*", 
     FractionBox[
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "SRI5", "]"}], ",", "SRI5", ",", 
        RowBox[{"MADSRI5", "[", "latt", "]"}]}], "]"}], 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ValueQ", "[", "SRI2", "]"}], ",", "SRI2", ",", 
          RowBox[{"MADSRI2", "[", "latt", "]"}]}], "]"}], ")"}], "-", 
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ValueQ", "[", "SRI4", "]"}], ",", "SRI4", ",", 
          RowBox[{"MADSRI4", "[", "latt", "]"}]}], "]"}], ")"}]}]]}], ",", 
    RowBox[{"Nano", " ", "Meter"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADU0", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    FractionBox[
     RowBox[{"2", " ", "ClassicalElectronRadius", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NumberQ", "[", "energy", "]"}], "===", "True"}], ",", 
          RowBox[{"energy", " ", "ElectronVolt", " ", "Giga"}], ",", 
          "energy"}], "]"}], ")"}], "4"], " ", 
      RowBox[{"(", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ValueQ", "[", "SRI2", "]"}], ",", "SRI2", ",", 
         RowBox[{"MADSRI2", "[", "latt", "]"}]}], "]"}], ")"}]}], 
     RowBox[{"3", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"ElectronMass", " ", 
         SuperscriptBox["SpeedOfLight", "2"]}], ")"}], "3"]}]], ",", 
    RowBox[{"ElectronVolt", " ", "Kilo"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADJx", "[", "latt_", "]"}], ":=", 
  RowBox[{"1", "-", 
   FractionBox[
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "SRI4", "]"}], ",", "SRI4", ",", 
       RowBox[{"MADSRI4", "[", "latt", "]"}]}], "]"}], ")"}], 
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "SRI2", "]"}], ",", "SRI2", ",", 
       RowBox[{"MADSRI2", "[", "latt", "]"}]}], "]"}], ")"}]]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADJ\[Epsilon]", "[", "latt_", "]"}], ":=", 
  RowBox[{"2", "+", 
   FractionBox[
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "SRI4", "]"}], ",", "SRI4", ",", 
       RowBox[{"MADSRI4", "[", "latt", "]"}]}], "]"}], ")"}], 
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "SRI2", "]"}], ",", "SRI2", ",", 
       RowBox[{"MADSRI2", "[", "latt", "]"}]}], "]"}], ")"}]]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADES", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"ToFundamentalSI", "[", 
   RowBox[{
    FractionBox[
     RowBox[{"55", " ", "PlanckConstant", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NumberQ", "[", "energy", "]"}], "===", "True"}], ",", 
          RowBox[{"energy", " ", "ElectronVolt", " ", "Giga"}], ",", 
          "energy"}], "]"}], ")"}], "2"]}], 
     RowBox[{"2", " ", "\[Pi]", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"ElectronMass", "*", 
         SuperscriptBox["SpeedOfLight", "2"]}], ")"}], "2"], " ", "32", 
      SqrtBox["3"], "ElectronMass", " ", "SpeedOfLight"}]], "*", 
    FractionBox[
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "SRI3", "]"}], ",", "SRI3", ",", 
       RowBox[{"MADSRI3", "[", "latt", "]"}]}], "]"}], 
     RowBox[{
      RowBox[{"2", " ", 
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ValueQ", "[", "SRI2", "]"}], ",", "SRI2", ",", 
          RowBox[{"MADSRI2", "[", "latt", "]"}]}], "]"}], ")"}]}], "+", 
      RowBox[{"(", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ValueQ", "[", "SRI4", "]"}], ",", "SRI4", ",", 
         RowBox[{"MADSRI4", "[", "latt", "]"}]}], "]"}], ")"}]}]]}], 
   "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Tau]x", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"3", " ", 
       SuperscriptBox["ElectronMass", "3"], 
       SuperscriptBox["SpeedOfLight", "5"], " ", 
       RowBox[{"MADLength", "[", "latt", "]"}], " ", "Meter", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Plus", "@@", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "DIAMOND", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", "Meter"}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{"2", " ", "\[Pi]", " ", "ClassicalElectronRadius", " ", 
       RowBox[{"MADJx", "[", "latt", "]"}], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"NumberQ", "[", "energy", "]"}], "===", "True"}], ",", 
           RowBox[{"energy", " ", "ElectronVolt", " ", "Giga"}], ",", 
           "energy"}], "]"}], ")"}], "3"]}], ")"}]}], ",", 
    RowBox[{"Milli", " ", "Second"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Tau]y", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"3", " ", 
       SuperscriptBox["ElectronMass", "3"], 
       SuperscriptBox["SpeedOfLight", "5"], " ", 
       RowBox[{"MADLength", "[", "latt", "]"}], " ", "Meter", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Plus", "@@", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "DIAMOND", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", "Meter"}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{
      "2", " ", "\[Pi]", " ", "ClassicalElectronRadius", " ", "1", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"NumberQ", "[", "energy", "]"}], "===", "True"}], ",", 
           RowBox[{"energy", " ", "ElectronVolt", " ", "Giga"}], ",", 
           "energy"}], "]"}], ")"}], "3"]}], ")"}]}], ",", 
    RowBox[{"Milli", " ", "Second"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MAD\[Tau]\[Epsilon]", "[", 
   RowBox[{"latt_", ",", "energy_"}], "]"}], ":=", 
  RowBox[{"Convert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"3", " ", 
       SuperscriptBox["ElectronMass", "3"], 
       SuperscriptBox["SpeedOfLight", "5"], " ", 
       RowBox[{"MADLength", "[", "latt", "]"}], " ", "Meter", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Plus", "@@", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "DIAMOND", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "&"}]}], "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", "Meter"}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{"2", " ", "\[Pi]", " ", "ClassicalElectronRadius", " ", 
       RowBox[{"MADJ\[Epsilon]", "[", "latt", "]"}], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"NumberQ", "[", "energy", "]"}], "===", "True"}], ",", 
           RowBox[{"energy", " ", "ElectronVolt", " ", "Giga"}], ",", 
           "energy"}], "]"}], ")"}], "3"]}], ")"}]}], ",", 
    RowBox[{"Milli", " ", "Second"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"MAD\[Epsilon]x", "[", 
    RowBox[{"latt_", ",", "energy_", ",", 
     RowBox[{"\[Kappa]_:", "0.01"}]}], "]"}], ":=", " ", 
   FractionBox[
    RowBox[{" ", 
     RowBox[{"MAD\[Epsilon]", "[", 
      RowBox[{"latt", ",", "energy"}], "]"}], " "}], 
    RowBox[{"1", "+", "\[Kappa]"}]]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"MAD\[Epsilon]y", "[", 
    RowBox[{"latt_", ",", "energy_", ",", 
     RowBox[{"\[Kappa]_:", "0.01"}]}], "]"}], ":=", 
   FractionBox[
    RowBox[{"\[Kappa]", " ", 
     RowBox[{"MAD\[Epsilon]", "[", 
      RowBox[{"latt", ",", "energy"}], "]"}], " "}], 
    RowBox[{"1", "+", "\[Kappa]"}]]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"MADSRI", ",", "HoldFirst"}], "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI1", "[", "lattice_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MADWrite", "[", 
     RowBox[{"\"\<MADSRI\>\"", ",", 
      RowBox[{"Unevaluated", "[", "lattice", "]"}], ",", 
      RowBox[{"Slice", "\[Rule]", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"MADStringWrite", "[", 
     RowBox[{
     "\"\<MADSRI.mff\>\"", ",", 
      "\"\<select,optics,full;\\noptics,filename=MADSRI.optics.txt,columns=s,\
alfx,betx,dx,dpx;\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"RunMAD", "[", "\"\<MADSRI.mff\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"mfsInterpret", "[", "\"\<MADSRI.optics.txt\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"SRI1", "=", 
     RowBox[{
      RowBox[{"MADSRI1", "[", 
       RowBox[{"lattice", ",", "DX", ",", "DPX"}], "]"}], " ", "Meter"}]}]}], 
   ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI4", "[", "lattice_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MADWrite", "[", 
     RowBox[{"\"\<MADSRI\>\"", ",", 
      RowBox[{"Unevaluated", "[", "lattice", "]"}], ",", 
      RowBox[{"Slice", "\[Rule]", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"MADStringWrite", "[", 
     RowBox[{
     "\"\<MADSRI.mff\>\"", ",", 
      "\"\<select,optics,full;\\noptics,filename=MADSRI.optics.txt,columns=s,\
alfx,betx,dx,dpx;\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"RunMAD", "[", "\"\<MADSRI.mff\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"mfsInterpret", "[", "\"\<MADSRI.optics.txt\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"SRI4", "=", 
     RowBox[{
      RowBox[{"MADSRI4", "[", 
       RowBox[{"lattice", ",", "DX", ",", "DPX"}], "]"}], "/", "Meter"}]}]}], 
   ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI5", "[", "lattice_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MADWrite", "[", 
     RowBox[{"\"\<MADSRI\>\"", ",", 
      RowBox[{"Unevaluated", "[", "lattice", "]"}], ",", 
      RowBox[{"Slice", "\[Rule]", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"MADStringWrite", "[", 
     RowBox[{
     "\"\<MADSRI.mff\>\"", ",", 
      "\"\<select,optics,full;\\noptics,filename=MADSRI.optics.txt,columns=s,\
alfx,betx,dx,dpx;\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"RunMAD", "[", "\"\<MADSRI.mff\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"mfsInterpret", "[", "\"\<MADSRI.optics.txt\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"GAMX", "=", 
     FractionBox[
      RowBox[{"1", "+", 
       SuperscriptBox["ALFX", "2"]}], "BETX"]}], ";", "\[IndentingNewLine]", 
    RowBox[{"SRI5", "=", 
     RowBox[{
      RowBox[{"MADSRI5", "[", 
       RowBox[{
       "lattice", ",", "ALFX", ",", "BETX", ",", "GAMX", ",", "DX", ",", 
        "DPX"}], "]"}], "/", "Meter"}]}]}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI", "[", "lattice_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MADWrite", "[", 
     RowBox[{"\"\<MADSRI\>\"", ",", 
      RowBox[{"Unevaluated", "[", "lattice", "]"}], ",", 
      RowBox[{"Slice", "\[Rule]", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"MADStringWrite", "[", 
     RowBox[{
     "\"\<MADSRI.mff\>\"", ",", 
      "\"\<select,optics,full;\\noptics,filename=MADSRI.optics.txt,columns=s,\
alfx,betx,dx,dpx;\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"RunMAD", "[", "\"\<MADSRI.mff\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"mfsInterpret", "[", "\"\<MADSRI.optics.txt\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"GAMX", "=", 
     FractionBox[
      RowBox[{"1", "+", 
       SuperscriptBox["ALFX", "2"]}], "BETX"]}], ";", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"SRI1", "=", 
       RowBox[{
        RowBox[{"MADSRI1", "[", 
         RowBox[{"lattice", ",", "DX", ",", "DPX"}], "]"}], " ", "Meter"}]}], 
      ",", 
      RowBox[{"SRI2", "=", 
       RowBox[{"MADSRI2", "[", "lattice", "]"}]}], ",", 
      RowBox[{"SRI3", "=", 
       RowBox[{"MADSRI3", "[", "lattice", "]"}]}], ",", 
      RowBox[{"SRI4", "=", 
       RowBox[{
        RowBox[{"MADSRI4", "[", 
         RowBox[{"lattice", ",", "DX", ",", "DPX"}], "]"}], "/", "Meter"}]}], 
      ",", 
      RowBox[{"SRI5", "=", 
       RowBox[{
        RowBox[{"MADSRI5", "[", 
         RowBox[{
         "lattice", ",", "ALFX", ",", "BETX", ",", "GAMX", ",", "DX", ",", 
          "DPX"}], "]"}], "/", "Meter"}]}]}], "}"}]}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSRI", "[", 
   RowBox[{"lattice_", ",", "ALFX_", ",", "BETX_", ",", "DX_", ",", "DPX_"}], 
   "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GAMX", "=", 
     FractionBox[
      RowBox[{"1", "+", 
       SuperscriptBox["ALFX", "2"]}], "BETX"]}], ";", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"SRI1", "=", 
       RowBox[{
        RowBox[{"MADSRI1", "[", 
         RowBox[{"lattice", ",", "DX", ",", "DPX"}], "]"}], " ", "Meter"}]}], 
      ",", 
      RowBox[{"SRI2", "=", 
       RowBox[{"MADSRI2", "[", "lattice", "]"}]}], ",", 
      RowBox[{"SRI3", "=", 
       RowBox[{"MADSRI3", "[", "lattice", "]"}]}], ",", 
      RowBox[{"SRI4", "=", 
       RowBox[{
        RowBox[{"MADSRI4", "[", 
         RowBox[{"lattice", ",", "DX", ",", "DPX"}], "]"}], "/", "Meter"}]}], 
      ",", 
      RowBox[{"SRI5", "=", 
       RowBox[{
        RowBox[{"MADSRI5", "[", 
         RowBox[{
         "lattice", ",", "ALFX", ",", "BETX", ",", "GAMX", ",", "DX", ",", 
          "DPX"}], "]"}], "/", "Meter"}]}]}], "}"}]}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"End", "[", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"EndPackage", "[", "]"}]], "Input",
 InitializationCell->True]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1144, 764},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"6.0 for Microsoft Windows (32-bit) (April 20, 2007)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[568, 21, 422, 9, 31, "Input",
 InitializationCell->True],
Cell[993, 32, 203, 6, 31, "Input",
 InitializationCell->True],
Cell[1199, 40, 206, 6, 31, "Input",
 InitializationCell->True],
Cell[1408, 48, 206, 6, 31, "Input",
 InitializationCell->True],
Cell[1617, 56, 206, 6, 31, "Input",
 InitializationCell->True],
Cell[1826, 64, 206, 6, 31, "Input",
 InitializationCell->True],
Cell[2035, 72, 206, 6, 31, "Input",
 InitializationCell->True],
Cell[2244, 80, 202, 6, 31, "Input",
 InitializationCell->True],
Cell[2449, 88, 208, 6, 31, "Input",
 InitializationCell->True],
Cell[2660, 96, 182, 5, 31, "Input",
 InitializationCell->True],
Cell[2845, 103, 168, 5, 31, "Input",
 InitializationCell->True],
Cell[3016, 110, 175, 4, 31, "Input",
 InitializationCell->True],
Cell[3194, 116, 196, 6, 31, "Input",
 InitializationCell->True],
Cell[3393, 124, 212, 6, 31, "Input",
 InitializationCell->True],
Cell[3608, 132, 192, 5, 31, "Input",
 InitializationCell->True],
Cell[3803, 139, 219, 5, 31, "Input",
 InitializationCell->True],
Cell[4025, 146, 230, 6, 31, "Input",
 InitializationCell->True],
Cell[4258, 154, 208, 5, 31, "Input",
 InitializationCell->True],
Cell[4469, 161, 138, 4, 31, "Input",
 InitializationCell->True],
Cell[4610, 167, 138, 4, 31, "Input",
 InitializationCell->True],
Cell[4751, 173, 138, 4, 31, "Input",
 InitializationCell->True],
Cell[4892, 179, 138, 4, 31, "Input",
 InitializationCell->True],
Cell[5033, 185, 138, 4, 31, "Input",
 InitializationCell->True],
Cell[5174, 191, 120, 3, 31, "Input",
 InitializationCell->True],
Cell[5297, 196, 108, 3, 31, "Input",
 InitializationCell->True],
Cell[5408, 201, 108, 3, 31, "Input",
 InitializationCell->True],
Cell[5519, 206, 104, 3, 31, "Input",
 InitializationCell->True],
Cell[5626, 211, 106, 3, 31, "Input",
 InitializationCell->True],
Cell[5735, 216, 152, 3, 31, "Input"],
Cell[5890, 221, 444, 13, 31, "Input",
 InitializationCell->True],
Cell[6337, 236, 248, 7, 31, "Input",
 InitializationCell->True],
Cell[6588, 245, 593, 18, 31, "Input",
 InitializationCell->True],
Cell[7184, 265, 1641, 48, 98, "Input",
 InitializationCell->True],
Cell[8828, 315, 3272, 85, 98, "Input",
 InitializationCell->True],
Cell[12103, 402, 579, 18, 33, "Input",
 InitializationCell->True],
Cell[12685, 422, 645, 20, 31, "Input",
 InitializationCell->True],
Cell[13333, 444, 619, 19, 33, "Input",
 InitializationCell->True],
Cell[13955, 465, 670, 21, 33, "Input",
 InitializationCell->True],
Cell[14628, 488, 1813, 53, 98, "Input",
 InitializationCell->True],
Cell[16444, 543, 3282, 85, 98, "Input",
 InitializationCell->True],
Cell[19729, 630, 6436, 169, 260, "Input",
 InitializationCell->True],
Cell[26168, 801, 2109, 55, 98, "Input",
 InitializationCell->True],
Cell[28280, 858, 2568, 72, 112, "Input",
 InitializationCell->True],
Cell[30851, 932, 221, 6, 31, "Input",
 InitializationCell->True],
Cell[31075, 940, 1493, 40, 117, "Input",
 InitializationCell->True],
Cell[32571, 982, 971, 27, 104, "Input",
 InitializationCell->True],
Cell[33545, 1011, 518, 15, 47, "Input",
 InitializationCell->True],
Cell[34066, 1028, 527, 15, 47, "Input",
 InitializationCell->True],
Cell[34596, 1045, 1440, 40, 117, "Input",
 InitializationCell->True],
Cell[36039, 1087, 1550, 41, 76, "Input",
 InitializationCell->True],
Cell[37592, 1130, 1517, 41, 76, "Input",
 InitializationCell->True],
Cell[39112, 1173, 1568, 41, 76, "Input",
 InitializationCell->True],
Cell[40683, 1216, 377, 11, 45, "Input",
 InitializationCell->True],
Cell[41063, 1229, 384, 11, 45, "Input",
 InitializationCell->True],
Cell[41450, 1242, 148, 4, 31, "Input",
 InitializationCell->True],
Cell[41601, 1248, 954, 24, 132, "Input",
 InitializationCell->True],
Cell[42558, 1274, 954, 24, 132, "Input",
 InitializationCell->True],
Cell[43515, 1300, 1153, 29, 200, "Input",
 InitializationCell->True],
Cell[44671, 1331, 1711, 45, 221, "Input",
 InitializationCell->True],
Cell[46385, 1378, 1153, 33, 141, "Input",
 InitializationCell->True],
Cell[47541, 1413, 78, 2, 31, "Input",
 InitializationCell->True],
Cell[47622, 1417, 85, 2, 31, "Input",
 InitializationCell->True]
}
]
*)

(* End of internal cache information *)

