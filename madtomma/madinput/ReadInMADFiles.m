(* ::Package:: *)

(************************************************************************)
(* This file was generated automatically by the Mathematica front end.  *)
(* It contains Initialization cells from a Notebook file, which         *)
(* typically will have the same name as this file except ending in      *)
(* ".nb" instead of ".m".                                               *)
(*                                                                      *)
(* This file is intended to be loaded into the Mathematica kernel using *)
(* the package loading commands Get or Needs.  Doing so is equivalent   *)
(* to using the Evaluate Initialization Cells menu command in the front *)
(* end.                                                                 *)
(*                                                                      *)
(* DO NOT EDIT THIS FILE.  This entire file is regenerated              *)
(* automatically each time the parent Notebook file is saved in the     *)
(* Mathematica front end.  Any changes you make to this file will be    *)
(* overwritten.                                                         *)
(************************************************************************)



BeginPackage["Madtomma`MADInput`ReadInMADFiles`",{"Madtomma`MADInput`MADInput`"}];


FormatMADFile::usage="FormatMADFile[\"filename\"] creates a formatted MMA set of MAD commands";


FormatMADLines::usage="";


ReadInMADFile::usage="ReadInMADFile[\"filename\"] reads in a MAD file and (re)assigns the element and line definitions";


ReadInMADLines::usage="";


Begin["`Private`"]


ReplaceExponent[string_]:=Block[{list=string},
((If[((DigitQ[StringTake[list,{#-1}]])||(StringTake[list,{#-1}]==="=")||(StringTake[list,{#-1}]==="-")||(StringTake[list,{#-1}]==="+"))&&((DigitQ[StringTake[list,{#+1}]])||(StringTake[list,{#+1}]==="+")||(StringTake[list,{#+1}]==="-")),list=StringReplacePart[list,"*10^",{#,#}]])&/@Reverse[Select[StringPosition[list,"E"][[All,1]],(#>1)&&(#<StringLength[list])&]]);
Return[StringReplace[list,"_"->""]]]


NumberRight[a_,acc_:30]:=NumberForm[N[a],acc,ExponentFunction->(Null&)]


fquadRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];
If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["quad["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","_"->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,"\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


fsolenoidRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];
If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["solenoid["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","_"->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"KS"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"KS"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,"\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


fsbendRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["sbend["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1"]&)]+1))]]]],"0"]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)]>=1,",E1\[Rule]"<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1))]]]],""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"E2"]&)]+1)]>=1,",E2\[Rule]"<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E2"]&)]+1))]]]],""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"HGAP"]&)]+1)]>=1,",HGap\[Rule]"<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"HGAP"]&)]+1))]]]],""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"FINT"]&)]+1)]>=1,",FInt\[Rule]"<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FINT"]&)]+1))]]]],""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"FINTX"]&)]+1)]>=1,",FIntX\[Rule]"<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FINTX"]&)]+1))]]]],""]<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"TILT"]&)]+1)]>=1,",Tilt\[Rule]"<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TILT"]&)]+1))]]]],""]
<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


frbendRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["rbend["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FOCUS"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FOCUS"]&)]+1))]]]],"0"]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)]>=1,",E1\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)),""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"E2"]&)]+1)]>=1,",E2\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E2"]&)]+1)),""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


fsextRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["sext["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K2"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>",Thin\[Rule]usethin"<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


foctRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["oct["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K3"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>",Thin\[Rule]usethin"<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


fmonitorRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];NotebookWrite[SelectedNotebook[],StringReplace["bpm["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1)]>=1,ToString[NumberRight@First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]]


fkickerRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["kick["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"L"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"HKICK"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"HKICK"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"VKICK"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"VKICK"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


fdriftRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["drift["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[NumberRight@First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


fdriftRead2[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["drift["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>"0"<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


fmarkerRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["marker["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


frcollRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["rcoll["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"L"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]],"0"]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"XSIZE"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"XSIZE"]&)]+1))]]]],"0"]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"YSIZE"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"YSIZE"]&)]+1))]]]],"0"]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


fecollRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["ecoll["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"L"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]],"0"]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"XSIZE"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"XSIZE"]&)]+1))]]]],"0"]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"YSIZE"]&)]+1)]>=1,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"YSIZE"]&)]+1))]]]],"0"]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


flcavRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["lcav["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@(",\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),",\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"DELTAE"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",VoltageGain\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"DELTAE"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"PHI0"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",CavityPhase\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"PHI0"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FREQ"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",Frequency\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FREQ"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ELOSS"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LossFactor\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ELOSS"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"VOLTERR"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",VoltageError\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"VOLTERR"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LAGERR"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LagError\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LAGERR"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"NBIN"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",NumberBins\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"NBIN"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"BINMAX"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",MaxBinLength\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"BINMAX"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LFILE"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LWakefieldFile\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LFILE"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TFILE"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",TWakefieldFile\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TFILE"]&)]+1))],{"E"->"*10^"}],""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


fmultipoleRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
NotebookWrite[SelectedNotebook[],StringReplace["multipole["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LRAD"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LRAD\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LRAD"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K0L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K0L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K0L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T0"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T0\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T0"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K1L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T1"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T1\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T1"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K2L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K2L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K2L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T2"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T2\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T2"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K3L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K3L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K3L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T3"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T3\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T3"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K4L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K4L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K4L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T4"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T4\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T4"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K5L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K5L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K5L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T5"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T5"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T5"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K6L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K6L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K6L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T6"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T6\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T6"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K7L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K7L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K7L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T7"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T7\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T7"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K8L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K8L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K8L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T8"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T8\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T8"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K9L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K9L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K9L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T9"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T9\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T9"]&)]+1))],{"E"->"*10^"}],""]

<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


flineRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[StringReplace[a[[c]]," "->""],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];b=StringReplace[StringReplace[ToString[b]," "->""],{" "->"",":LINE=("->":={",":Line=("->":={",":line=("->":={","&\n"->"",")"->"}","\n"->"","&"->"","LINE"->"","("->"{","_"->"",
"100*"->"Table[#,{100}]&@","99*"->"Table[#,{99}]&@","98*"->"Table[#,{98}]&@","97*"->"Table[#,{97}]&@","96*"->"Table[#,{96}]&@","95*"->"Table[#,{95}]&@","94*"->"Table[#,{94}]&@","93*"->"Table[#,{93}]&@","92*"->"Table[#,{92}]&@","91*"->"Table[#,{91}]&@","90*"->"Table[#,{90}]&@","89*"->"Table[#,{89}]&@","88*"->"Table[#,{88}]&@","87*"->"Table[#,{87}]&@","86*"->"Table[#,{86}]&@","85*"->"Table[#,{85}]&@","84*"->"Table[#,{84}]&@","83*"->"Table[#,{83}]&@","82*"->"Table[#,{82}]&@","81*"->"Table[#,{81}]&@","80*"->"Table[#,{80}]&@","79*"->"Table[#,{79}]&@","78*"->"Table[#,{78}]&@","77*"->"Table[#,{77}]&@","76*"->"Table[#,{76}]&@","75*"->"Table[#,{75}]&@","74*"->"Table[#,{74}]&@","73*"->"Table[#,{73}]&@","72*"->"Table[#,{72}]&@","71*"->"Table[#,{71}]&@","70*"->"Table[#,{70}]&@","69*"->"Table[#,{69}]&@","68*"->"Table[#,{68}]&@","67*"->"Table[#,{67}]&@","66*"->"Table[#,{66}]&@","65*"->"Table[#,{65}]&@","64*"->"Table[#,{64}]&@","63*"->"Table[#,{63}]&@","62*"->"Table[#,{62}]&@","61*"->"Table[#,{61}]&@","60*"->"Table[#,{60}]&@","59*"->"Table[#,{59}]&@","58*"->"Table[#,{58}]&@","57*"->"Table[#,{57}]&@","56*"->"Table[#,{56}]&@","55*"->"Table[#,{55}]&@","54*"->"Table[#,{54}]&@","53*"->"Table[#,{53}]&@","52*"->"Table[#,{52}]&@","51*"->"Table[#,{51}]&@","50*"->"Table[#,{50}]&@","49*"->"Table[#,{49}]&@","48*"->"Table[#,{48}]&@","47*"->"Table[#,{47}]&@","46*"->"Table[#,{46}]&@","45*"->"Table[#,{45}]&@","44*"->"Table[#,{44}]&@","43*"->"Table[#,{43}]&@","42*"->"Table[#,{42}]&@","41*"->"Table[#,{41}]&@","40*"->"Table[#,{40}]&@","39*"->"Table[#,{39}]&@","38*"->"Table[#,{38}]&@","37*"->"Table[#,{37}]&@","36*"->"Table[#,{36}]&@","35*"->"Table[#,{35}]&@","34*"->"Table[#,{34}]&@","33*"->"Table[#,{33}]&@","32*"->"Table[#,{32}]&@","31*"->"Table[#,{31}]&@","30*"->"Table[#,{30}]&@","29*"->"Table[#,{29}]&@","28*"->"Table[#,{28}]&@","27*"->"Table[#,{27}]&@","26*"->"Table[#,{26}]&@","25*"->"Table[#,{25}]&@","24*"->"Table[#,{24}]&@","23*"->"Table[#,{23}]&@","22*"->"Table[#,{22}]&@","21*"->"Table[#,{21}]&@","20*"->"Table[#,{20}]&@","19*"->"Table[#,{19}]&@","18*"->"Table[#,{18}]&@","17*"->"Table[#,{17}]&@","16*"->"Table[#,{16}]&@","15*"->"Table[#,{15}]&@","14*"->"Table[#,{14}]&@","13*"->"Table[#,{13}]&@","12*"->"Table[#,{12}]&@","11*"->"Table[#,{11}]&@","10*"->"Table[#,{10}]&@","9*"->"Table[#,{9}]&@","8*"->"Table[#,{8}]&@","7*"->"Table[#,{7}]&@","6*"->"Table[#,{6}]&@","5*"->"Table[#,{5}]&@","4*"->"Table[#,{4}]&@","3*"->"Table[#,{3}]&@","2*"->"Table[#,{2}]&@","1*"->"Table[#,{1}]&@",
"*100"->"Table[#,{100}]&@","*99"->"Table[#,{99}]&@","*98"->"Table[#,{98}]&@","*97"->"Table[#,{97}]&@","*96"->"Table[#,{96}]&@","*95"->"Table[#,{95}]&@","*94"->"Table[#,{94}]&@","*93"->"Table[#,{93}]&@","*92"->"Table[#,{92}]&@","*91"->"Table[#,{91}]&@","*90"->"Table[#,{90}]&@","*89"->"Table[#,{89}]&@","*88"->"Table[#,{88}]&@","*87"->"Table[#,{87}]&@","*86"->"Table[#,{86}]&@","*85"->"Table[#,{85}]&@","*84"->"Table[#,{84}]&@","*83"->"Table[#,{83}]&@","*82"->"Table[#,{82}]&@","*81"->"Table[#,{81}]&@","*80"->"Table[#,{80}]&@","*79"->"Table[#,{79}]&@","*78"->"Table[#,{78}]&@","*77"->"Table[#,{77}]&@","*76"->"Table[#,{76}]&@","*75"->"Table[#,{75}]&@","*74"->"Table[#,{74}]&@","*73"->"Table[#,{73}]&@","*72"->"Table[#,{72}]&@","*71"->"Table[#,{71}]&@","*70"->"Table[#,{70}]&@","*69"->"Table[#,{69}]&@","*68"->"Table[#,{68}]&@","*67"->"Table[#,{67}]&@","*66"->"Table[#,{66}]&@","*65"->"Table[#,{65}]&@","*64"->"Table[#,{64}]&@","*63"->"Table[#,{63}]&@","*62"->"Table[#,{62}]&@","*61"->"Table[#,{61}]&@","*60"->"Table[#,{60}]&@","*59"->"Table[#,{59}]&@","*58"->"Table[#,{58}]&@","*57"->"Table[#,{57}]&@","*56"->"Table[#,{56}]&@","*55"->"Table[#,{55}]&@","*54"->"Table[#,{54}]&@","*53"->"Table[#,{53}]&@","*52"->"Table[#,{52}]&@","*51"->"Table[#,{51}]&@","*50"->"Table[#,{50}]&@","*49"->"Table[#,{49}]&@","*48"->"Table[#,{48}]&@","*47"->"Table[#,{47}]&@","*46"->"Table[#,{46}]&@","*45"->"Table[#,{45}]&@","*44"->"Table[#,{44}]&@","*43"->"Table[#,{43}]&@","*42"->"Table[#,{42}]&@","*41"->"Table[#,{41}]&@","*40"->"Table[#,{40}]&@","*39"->"Table[#,{39}]&@","*38"->"Table[#,{38}]&@","*37"->"Table[#,{37}]&@","*36"->"Table[#,{36}]&@","*35"->"Table[#,{35}]&@","*34"->"Table[#,{34}]&@","*33"->"Table[#,{33}]&@","*32"->"Table[#,{32}]&@","*31"->"Table[#,{31}]&@","*30"->"Table[#,{30}]&@","*29"->"Table[#,{29}]&@","*28"->"Table[#,{28}]&@","*27"->"Table[#,{27}]&@","*26"->"Table[#,{26}]&@","*25"->"Table[#,{25}]&@","*24"->"Table[#,{24}]&@","*23"->"Table[#,{23}]&@","*22"->"Table[#,{22}]&@","*21"->"Table[#,{21}]&@","*20"->"Table[#,{20}]&@","*19"->"Table[#,{19}]&@","*18"->"Table[#,{18}]&@","*17"->"Table[#,{17}]&@","*16"->"Table[#,{16}]&@","*15"->"Table[#,{15}]&@","*14"->"Table[#,{14}]&@","*13"->"Table[#,{13}]&@","*12"->"Table[#,{12}]&@","*11"->"Table[#,{11}]&@","*10"->"Table[#,{10}]&@","*9"->"Table[#,{9}]&@","*8"->"Table[#,{8}]&@","*7"->"Table[#,{7}]&@","*6"->"Table[#,{6}]&@","*5"->"Table[#,{5}]&@","*4"->"Table[#,{4}]&@","*3"->"Table[#,{3}]&@","*2"->"Table[#,{2}]&@","*1"->"Table[#,{1}]&@",

"-"->"Reverse@MADFlatten@"}];NotebookWrite[SelectedNotebook[],b];SelectionMove[SelectedNotebook[],After,Cell]]


fconstantRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];b=StringReplace[StringReplace[ToString[b]," "->""],{"_"->""," "->"","&\n"->"","\n"->"","&"->""}];
d=b;
((If[(NumberQ[StringTake[d,{#-1}]])||((NumberQ[StringTake[d,{#+1}]])||(StringTake[d,{#+1}]==="+")||(StringTake[d,{#+1}]==="-")),d=StringReplacePart[d,"*10*^",{#,#}]])&/@StringPosition[d,"E"][[All,1]]);
NotebookWrite[SelectedNotebook[],d];SelectionMove[SelectedNotebook[],After,Cell]]


FormatMADFile[file_]:=Module[{readfile},readfile=ReadList[file,Record,RecordSeparators->{";","\n"}];
NotebookWrite[SelectedNotebook[],Cell["Element Definitions","Subsection"]];
fconstantRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:=*"]&&StringTake[ToString[#],-1]=!="!"&)];
NotebookWrite[SelectedNotebook[],Cell["Quadrupoles & Bends","Subsubsection"]];
fquadRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*QUAD*"]&&StringTake[ToString[#],-1]=!="!"&)];
fsbendRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*SBEND*"]&&StringTake[ToString[#],-1]=!="!"&)];
frbendRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*RBEND*"]&&StringTake[ToString[#],-1]=!="!"&)];
flcavRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*LCAVITY*"]&&StringTake[ToString[#],-1]=!="!"&)];
NotebookWrite[SelectedNotebook[],Cell["Sextupoles","Subsubsection"]];
fsextRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*SEXT*"]&&StringTake[ToString[#],-1]=!="!"&)];
foctRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*OCT*"]&&StringTake[ToString[#],-1]=!="!"&)];
fsolenoidRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*SOL*"]&&StringTake[ToString[#],-1]=!="!"&)];
fmultipoleRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*MULTIPOLE*"]&&StringTake[ToString[#],-1]=!="!"&)];
NotebookWrite[SelectedNotebook[],Cell["Monitors & Kickers","Subsubsection"]];
fmonitorRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*MONITOR*"]&&StringTake[ToString[#],-1]=!="!"&)];
fkickerRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*KICKER*"]&&StringTake[ToString[#],-1]=!="!"&)];
NotebookWrite[SelectedNotebook[],Cell["Drifts","Subsubsection"]];
fdriftRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*DRIF*"]&&StringTake[ToString[#],-1]=!="!"&)];
fmarkerRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*MARK*"]&&StringTake[ToString[#],-1]=!="!"&)];
frcollRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*RCOLL*"]&&StringTake[ToString[#],-1]=!="!"&)];
fecollRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*ECOLL*"]&&StringTake[ToString[#],-1]=!="!"&)];
fdriftRead2[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*MATRIX*"]&&StringTake[ToString[#],-1]=!="!"&)];
NotebookWrite[SelectedNotebook[],Cell["Lines","Subsubsection"]];
flineRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*LINE*"]&&StringTake[ToString[#],-1]=!="!"&)];]


FormatMADLines[file_]:=Module[{readfile},readfile=ReadList[file,Record,RecordSeparators->{";","\n"}];
NotebookWrite[SelectedNotebook[],Cell["Lines","Subsubsection"]];
flineRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:*LINE*"]&&StringTake[ToString[#],-1]=!="!"&)];]


quadRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];ToExpression[StringReplace["quad["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,"\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];]


sbendRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];
If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["sbend["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FOCUS"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FOCUS"]&)]+1))]]]],"0"]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)]>=1,",E1\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)),""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"E2"]&)]+1)]>=1,",E2\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E2"]&)]+1)),""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"FINT"]&)]+1)]>=1,",FInt\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FINT"]&)]+1)),""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"FINTX"]&)]+1)]>=1,",FIntX\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FINTX"]&)]+1)),""]<>"]",{"_"->""," "->""}]];]


rbendRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];ToExpression[StringReplace["rbend["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FOCUS"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FOCUS"]&)]+1))]]]],"0"]<>","<>If[Length[(Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]>0,ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ANGLE"]&)]+1))]]]],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)]>=1,",E1\[Rule]"<>NumberRight@First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E1"]&)]+1)),""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"E2"]&)]+1)]>=1,",E2\[Rule]"<>NumberRight@First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"E2"]&)]+1)),""]<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"FINT"]&)]+1)]>=1,",FInt\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FINT"]&)]+1)),""]<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->"","&"->""}]]],"FINTX"]&)]+1)]>=1,",FIntX\[Rule]"<>First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FINTX"]&)]+1)),""]<>"]",{"_"->""," "->""}]];]


octRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];ToExpression[StringReplace["oct["<>ToString[Evaluate[ToExpression[c[[1]]][[1,1]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K3"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>",Thin\[Rule]usethin"<>"]",{"_"->""," "->""}]];]


sextRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];ToExpression[StringReplace["sext["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K2"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>",Thin\[Rule]usethin"<>"]",{"_"->""," "->""}]];]


monitorRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];ToExpression[StringReplace["bpm["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1)]>=1,ToString[NumberRight@First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))],"0"]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];]


kickerRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["kick["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"HKICK"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"VKICK"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];
]


hkickerRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["hkick["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"KICK"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];
]


vkickerRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["vkick["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"KICK"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];
]


driftRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
Print[a];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["drift["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];
]


collimatorRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["rcoll["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>","<>
ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"XSIZE"]&)]+1))]]]]<>","<>
ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"YSIZE"]&)]+1))]]]]<>","<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>"]",{"_"->""," "->""}]];
]


driftRead2[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["drift["<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>","<>"0"<>","<>If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[StringReplace[c[[1]],"_"->""]]]]<>"\""]<>"]",{"_"->""," "->""}]];
]


lcavRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["lcav["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>ToString[NumberRight@Evaluate[ToExpression[ToString[First@(Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"L"]&)]+1))]]]]<>
If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@(",\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),",\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"DELTAE"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",VoltageGain\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"DELTAE"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"PHI0"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",CavityPhase\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"PHI0"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FREQ"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",Frequency\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"FREQ"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ELOSS"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LossFactor\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"ELOSS"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"VOLTERR"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",VoltageError\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"VOLTERR"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LAGERR"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LagError\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LAGERR"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"NBIN"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",NumberBins\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"NBIN"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"BINMAX"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",MaxBinLength\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"BINMAX"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LFILE"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LWakefieldFile\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LFILE"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TFILE"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",TWakefieldFile\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TFILE"]&)]+1))],{"E"->"*10^"}],""]<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


multipoleRead[pos_,file_]:=Module[{a,b,c,d},
a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];
a=ReplaceExponent[b];
c=ReadList[(b=StringToStream[a]),Word,WordSeparators->{":",",","=","!","&"}];Close[b];If[Head[Evaluate[ToExpression["Global`"<>c[[1]]]]]===List,Madtomma`MADInput`MADInput`MADClear[Evaluate["Global`"<>c[[1]]]]];
ToExpression[StringReplace["multipole["<>ToString[Evaluate[ToExpression[c[[1]]]]]<>","<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)]>=1,First@("\""<>Extract[c,#]<>"\""&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"TYPE"]&)]+1)),"\""<>ToString[Evaluate[ToExpression[c[[1]]]]]<>"\""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LRAD"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",LRAD\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"LRAD"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K0L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K0L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K0L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T0"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T0\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T0"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K1L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K1L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T1"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T1\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T1"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K2L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K2L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K2L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T2"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T2\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T2"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K3L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K3L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K3L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T3"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T3\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T3"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K4L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K4L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K4L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T4"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T4\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T4"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K5L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K5L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K5L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T5"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T5"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T5"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K6L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K6L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K6L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T6"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T6\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T6"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K7L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K7L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K7L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T7"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T7\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T7"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K8L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K8L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K8L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T8"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T8\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T8"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K9L"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",K9L\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"K9L"]&)]+1))],{"E"->"*10^"}],""]<>

If[Length[Extract[c,#]&/@(Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T9"]&)]+1)]>=1,StringReplace[ToString[NumberRight@First@(",T9\[Rule]"<>Extract[c,#]&/@(First@Position[c,_?(StringMatchQ[ToString[ToUpperCase[StringReplace[#,{" "->""}]]],"T9"]&)]+1))],{"E"->"*10^"}],""]

<>"]",{"_"->""," "->""}]];SelectionMove[SelectedNotebook[],After,Cell]
]


lineRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];b=StringReplace[StringReplace[ToString[b]," "->""],{" "->"",":LINE=("->":={",":Line=("->":={",":line=("->":={","&\n"->"",")"->"}","\n"->"","&"->"","LINE"->"","("->"{","_"->"",
"100*"->"Table[#,{100}]&@","99*"->"Table[#,{99}]&@","98*"->"Table[#,{98}]&@","97*"->"Table[#,{97}]&@","96*"->"Table[#,{96}]&@","95*"->"Table[#,{95}]&@","94*"->"Table[#,{94}]&@","93*"->"Table[#,{93}]&@","92*"->"Table[#,{92}]&@","91*"->"Table[#,{91}]&@","90*"->"Table[#,{90}]&@","89*"->"Table[#,{89}]&@","88*"->"Table[#,{88}]&@","87*"->"Table[#,{87}]&@","86*"->"Table[#,{86}]&@","85*"->"Table[#,{85}]&@","84*"->"Table[#,{84}]&@","83*"->"Table[#,{83}]&@","82*"->"Table[#,{82}]&@","81*"->"Table[#,{81}]&@","80*"->"Table[#,{80}]&@","79*"->"Table[#,{79}]&@","78*"->"Table[#,{78}]&@","77*"->"Table[#,{77}]&@","76*"->"Table[#,{76}]&@","75*"->"Table[#,{75}]&@","74*"->"Table[#,{74}]&@","73*"->"Table[#,{73}]&@","72*"->"Table[#,{72}]&@","71*"->"Table[#,{71}]&@","70*"->"Table[#,{70}]&@","69*"->"Table[#,{69}]&@","68*"->"Table[#,{68}]&@","67*"->"Table[#,{67}]&@","66*"->"Table[#,{66}]&@","65*"->"Table[#,{65}]&@","64*"->"Table[#,{64}]&@","63*"->"Table[#,{63}]&@","62*"->"Table[#,{62}]&@","61*"->"Table[#,{61}]&@","60*"->"Table[#,{60}]&@","59*"->"Table[#,{59}]&@","58*"->"Table[#,{58}]&@","57*"->"Table[#,{57}]&@","56*"->"Table[#,{56}]&@","55*"->"Table[#,{55}]&@","54*"->"Table[#,{54}]&@","53*"->"Table[#,{53}]&@","52*"->"Table[#,{52}]&@","51*"->"Table[#,{51}]&@","50*"->"Table[#,{50}]&@","49*"->"Table[#,{49}]&@","48*"->"Table[#,{48}]&@","47*"->"Table[#,{47}]&@","46*"->"Table[#,{46}]&@","45*"->"Table[#,{45}]&@","44*"->"Table[#,{44}]&@","43*"->"Table[#,{43}]&@","42*"->"Table[#,{42}]&@","41*"->"Table[#,{41}]&@","40*"->"Table[#,{40}]&@","39*"->"Table[#,{39}]&@","38*"->"Table[#,{38}]&@","37*"->"Table[#,{37}]&@","36*"->"Table[#,{36}]&@","35*"->"Table[#,{35}]&@","34*"->"Table[#,{34}]&@","33*"->"Table[#,{33}]&@","32*"->"Table[#,{32}]&@","31*"->"Table[#,{31}]&@","30*"->"Table[#,{30}]&@","29*"->"Table[#,{29}]&@","28*"->"Table[#,{28}]&@","27*"->"Table[#,{27}]&@","26*"->"Table[#,{26}]&@","25*"->"Table[#,{25}]&@","24*"->"Table[#,{24}]&@","23*"->"Table[#,{23}]&@","22*"->"Table[#,{22}]&@","21*"->"Table[#,{21}]&@","20*"->"Table[#,{20}]&@","19*"->"Table[#,{19}]&@","18*"->"Table[#,{18}]&@","17*"->"Table[#,{17}]&@","16*"->"Table[#,{16}]&@","15*"->"Table[#,{15}]&@","14*"->"Table[#,{14}]&@","13*"->"Table[#,{13}]&@","12*"->"Table[#,{12}]&@","11*"->"Table[#,{11}]&@","10*"->"Table[#,{10}]&@","9*"->"Table[#,{9}]&@","8*"->"Table[#,{8}]&@","7*"->"Table[#,{7}]&@","6*"->"Table[#,{6}]&@","5*"->"Table[#,{5}]&@","4*"->"Table[#,{4}]&@","3*"->"Table[#,{3}]&@","2*"->"Table[#,{2}]&@","1*"->"Table[#,{1}]&@",
"*100"->"Table[#,{100}]&@","*99"->"Table[#,{99}]&@","*98"->"Table[#,{98}]&@","*97"->"Table[#,{97}]&@","*96"->"Table[#,{96}]&@","*95"->"Table[#,{95}]&@","*94"->"Table[#,{94}]&@","*93"->"Table[#,{93}]&@","*92"->"Table[#,{92}]&@","*91"->"Table[#,{91}]&@","*90"->"Table[#,{90}]&@","*89"->"Table[#,{89}]&@","*88"->"Table[#,{88}]&@","*87"->"Table[#,{87}]&@","*86"->"Table[#,{86}]&@","*85"->"Table[#,{85}]&@","*84"->"Table[#,{84}]&@","*83"->"Table[#,{83}]&@","*82"->"Table[#,{82}]&@","*81"->"Table[#,{81}]&@","*80"->"Table[#,{80}]&@","*79"->"Table[#,{79}]&@","*78"->"Table[#,{78}]&@","*77"->"Table[#,{77}]&@","*76"->"Table[#,{76}]&@","*75"->"Table[#,{75}]&@","*74"->"Table[#,{74}]&@","*73"->"Table[#,{73}]&@","*72"->"Table[#,{72}]&@","*71"->"Table[#,{71}]&@","*70"->"Table[#,{70}]&@","*69"->"Table[#,{69}]&@","*68"->"Table[#,{68}]&@","*67"->"Table[#,{67}]&@","*66"->"Table[#,{66}]&@","*65"->"Table[#,{65}]&@","*64"->"Table[#,{64}]&@","*63"->"Table[#,{63}]&@","*62"->"Table[#,{62}]&@","*61"->"Table[#,{61}]&@","*60"->"Table[#,{60}]&@","*59"->"Table[#,{59}]&@","*58"->"Table[#,{58}]&@","*57"->"Table[#,{57}]&@","*56"->"Table[#,{56}]&@","*55"->"Table[#,{55}]&@","*54"->"Table[#,{54}]&@","*53"->"Table[#,{53}]&@","*52"->"Table[#,{52}]&@","*51"->"Table[#,{51}]&@","*50"->"Table[#,{50}]&@","*49"->"Table[#,{49}]&@","*48"->"Table[#,{48}]&@","*47"->"Table[#,{47}]&@","*46"->"Table[#,{46}]&@","*45"->"Table[#,{45}]&@","*44"->"Table[#,{44}]&@","*43"->"Table[#,{43}]&@","*42"->"Table[#,{42}]&@","*41"->"Table[#,{41}]&@","*40"->"Table[#,{40}]&@","*39"->"Table[#,{39}]&@","*38"->"Table[#,{38}]&@","*37"->"Table[#,{37}]&@","*36"->"Table[#,{36}]&@","*35"->"Table[#,{35}]&@","*34"->"Table[#,{34}]&@","*33"->"Table[#,{33}]&@","*32"->"Table[#,{32}]&@","*31"->"Table[#,{31}]&@","*30"->"Table[#,{30}]&@","*29"->"Table[#,{29}]&@","*28"->"Table[#,{28}]&@","*27"->"Table[#,{27}]&@","*26"->"Table[#,{26}]&@","*25"->"Table[#,{25}]&@","*24"->"Table[#,{24}]&@","*23"->"Table[#,{23}]&@","*22"->"Table[#,{22}]&@","*21"->"Table[#,{21}]&@","*20"->"Table[#,{20}]&@","*19"->"Table[#,{19}]&@","*18"->"Table[#,{18}]&@","*17"->"Table[#,{17}]&@","*16"->"Table[#,{16}]&@","*15"->"Table[#,{15}]&@","*14"->"Table[#,{14}]&@","*13"->"Table[#,{13}]&@","*12"->"Table[#,{12}]&@","*11"->"Table[#,{11}]&@","*10"->"Table[#,{10}]&@","*9"->"Table[#,{9}]&@","*8"->"Table[#,{8}]&@","*7"->"Table[#,{7}]&@","*6"->"Table[#,{6}]&@","*5"->"Table[#,{5}]&@","*4"->"Table[#,{4}]&@","*3"->"Table[#,{3}]&@","*2"->"Table[#,{2}]&@","*1"->"Table[#,{1}]&@",

"-"->"Reverse@MADFlatten@"}];ToExpression[b];]


constantRead[pos_,file_]:=Module[{a,b,c,d},a=ReadList[file,Record,RecordSeparators->{";","\n"}];b=a[[pos]];c=pos;While[StringTake[a[[c]],-1]==="&",b=StringInsert[b,a[[c+1]],-1];c+=1;];b=StringReplace[StringReplace[ToString[b]," "->""],{"_"->""," "->"","&\n"->"","\n"->"","&"->""}];
d=b;
((If[(NumberQ[StringTake[d,{#-1}]])||((NumberQ[StringTake[d,{#+1}]])||(StringTake[d,{#+1}]==="+")||(StringTake[d,{#+1}]==="-")),d=StringReplacePart[d,"*10^",{#,#}]])&/@StringPosition[d,"E"][[All,1]]);
ToExpression[d];]


ReadInMADFile[file_]:=Module[{readfile},readfile=ReadList[file,Record,RecordSeparators->{";","\n"}];
Print[Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:DRIF*"]&&StringTake[ToString[#],-1]=!="!"&)]];
constantRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:=*"]&&StringTake[ToString[#],-1]=!="!"&)];
quadRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:QUADRUPOLE*"]&&StringTake[ToString[#],-1]=!="!"&)];
sbendRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:SBEND*"]&&StringTake[ToString[#],-1]=!="!"&)];
rbendRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:RBEND*"]&&StringTake[ToString[#],-1]=!="!"&)];
sextRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:SEXTUPOLE*"]&&StringTake[ToString[#],-1]=!="!"&)];
octRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:OCTUPOLE*"]&&StringTake[ToString[#],-1]=!="!"&)];
monitorRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:MONITOR*"]&&StringTake[ToString[#],-1]=!="!"&)];
kickerRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:KICKER*"]&&StringTake[ToString[#],-1]=!="!"&)];
hkickerRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:HKICKER*"]&&StringTake[ToString[#],-1]=!="!"&)];
vkickerRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:VKICKER*"]&&StringTake[ToString[#],-1]=!="!"&)];
driftRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:DRIF*"]&&StringTake[ToString[#],-1]=!="!"&)];
collimatorRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:RCOLLIMATOR*"]&&StringTake[ToString[#],-1]=!="!"&)];
driftRead2[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:MARKER*"]&&StringTake[ToString[#],-1]=!="!"&)];
driftRead2[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:MATRIX*"]&&StringTake[ToString[#],-1]=!="!"&)];
multipoleRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:MULTIPOLE"]&&StringTake[ToString[#],-1]=!="!"&)];
lcavRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:LCAVITY*"]&&StringTake[ToString[#],-1]=!="!"&)];
lineRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[StringReplace[ToString[ToUpperCase[#]]," "->""],"*:LINE*"]&&StringTake[ToString[#],-1]=!="!"&)];]


ReadInMADLines[file_]:=Module[{readfile},readfile=ReadList[file,Record,RecordSeparators->{";","\n"}];
lineRead[#,file]&/@Flatten@Position[readfile,_?(StringMatchQ[ToString[ToUpperCase[#]],"*:LINE*"]&&StringTake[ToString[#],-1]=!="!"&)];]


End[]


EndPackage[]
