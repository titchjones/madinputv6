(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[   1876830,      44803]
NotebookOptionsPosition[   1754571,      42535]
NotebookOutlinePosition[   1759551,      42643]
CellTagsIndexPosition[   1759467,      42638]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 "Running MAD from ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\n",
 StyleBox["A Package to Run the MAD program from within the environment of ",
  FontSize->14],
 StyleBox["Mathematica",
  FontSize->14,
  FontSlant->"Italic"],
 StyleBox[" v6.x.\n",
  FontSize->14],
 StyleBox["Version 6.0\n\n",
  FontSize->18],
 StyleBox["James  Jones\nDaresbury Laboratory",
  FontSize->14],
 StyleBox["\n",
  FontSize->24],
 StyleBox["10/05/2001",
  FontSize->9]
}], "Title",
 CellChangeTimes->{{3.3941739417384496`*^9, 3.3941739426447053`*^9}, 
   3.4048094094035764`*^9},
 TextAlignment->Left],

Cell[CellGroupData[{

Cell["Reference", "Section",
 CellTags->"Reference section"],

Cell[CellGroupData[{

Cell["Title", "Subsubsection",
 CellTags->"Reference section"],

Cell[TextData[{
 "Running MAD from ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "."
}], "Text",
 CellTags->"Reference section"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Author", "Subsubsection",
 CellTags->"Reference section"],

Cell["James K. Jones", "Text",
 CellTags->"Reference section"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Summary", "Subsubsection",
 CellTags->"Reference section"],

Cell[TextData[{
 "This notebook provides functions for creating MAD input files within ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "."
}], "Text",
 CellTags->"Reference section"],

Cell["\<\
This package provides a basis for other packages that can interact with it.\
\>", "Text",
 CellTags->"Reference section"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Notebook Version", "Subsubsection",
 CellTags->"Reference section"],

Cell["6.0", "Text",
 CellChangeTimes->{{3.394173949066622*^9, 3.3941739495666246`*^9}},
 CellTags->"Reference section"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " Version"
}], "Subsubsection",
 CellTags->"Reference section"],

Cell["6.0", "Text",
 CellChangeTimes->{{3.394173951613513*^9, 3.3941739520197654`*^9}},
 CellTags->"Reference section"]
}, Open  ]],

Cell[CellGroupData[{

Cell["History", "Subsubsection",
 CellTags->"Reference section"],

Cell[TextData[{
 "v6 .0\n- Modified for ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " Version 6."
}], "Text",
 CellChangeTimes->{{3.394173957332299*^9, 3.3941739727542734`*^9}}],

Cell[TextData[{
 "v1.7\n- Added MADZAP commands to create a ZAP lattice file using MAD.\n- \
Added FindPeaks and FindTroughs, commands to print out the peaks and troughs \
of data. Currently it averages if any one peak is flat and puts the position \
as an average of all the points. Can't yet figure out how to get it to put \
points for all of the points at the same y but different x ?\n\nv1.6\n- Added \
MADSplitElements, a command to take an element list and split each non zero \
length element into a given number of Slices. The command does not reassign \
any elements as this is very hard. Instead the command produces an output \
element list of split elements. To facilitate writing to a file of this list \
more Extra variables have to be created for SBEND and RBEND magnets. This is \
because the entrance and exit angles only apply on the first and last \
elements respectively.\n\nv1.5\n- Upgraded to ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " 4.1\n- Added MADGetTunes\n- Added some extra documentation\n\nv1.4\n- \
Updated MADDraw to allow straight pictures, i.e. no bends. Set default output \
to graphics object. Can Show MADDraw output and data on same graph.\n- \
Updated some of the help.\n\nv1.3\n- Added A. Wolski's lattice drawing \
function, now called MADDraw. Have speeded up the \"findrotations\" command, \
now ~40 times faster. \n  Also added functions for drawing kickers and bpms, \
as well as an option to not draw bpms.\n- Fixed some functions that were not \
working as required - MADDropLines is a good example."
}], "Text"],

Cell["\<\
v1.2
- Changed the element definitions to include all possible MAD input \
variables. This meant creating a new variable called, say, bendExtra, for \
each element.
  Had to rewrite the MADWrite command to write the extra data. Also meant I \
had to create a command called MADClear to clear variables and their Extra \
definitions.
  Might rewrite so that the MADInfo command only takes the first 7 data \
variables from the defintions and drops the extra stuff. This was the reason \
I created the extra variable - 
  so that my precious MADInfo command worked without modification!\
\>", "Text"],

Cell["\<\
 v1.1
- Added some new commands, mostly for file editing - MADDropLines.
- Updated the matrixTrack command to give the tunes, Qx and Qy.

v1.0
- First Release\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Keywords", "Subsubsection",
 CellTags->"Reference section"],

Cell["MAD, data, Elements, Input, mff, ZAP", "Text",
 CellTags->"Reference section"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Requirements", "Subsubsection",
 CellTags->"Reference section"],

Cell["Uses a standard package for column manipulations, etc.", "Text",
 CellTags->"Reference section"],

Cell["Statistics`DataManipulation`", "Text",
 FontWeight->"Bold",
 FontSlant->"Italic",
 CellTags->"Reference section"],

Cell[TextData[{
 "The functions in this package are available once this one is loaded (and \
are often very useful - see the documentation for this package).\n\nCan be \
integrated with John Jowetts MadToMMA packages, such as ",
 StyleBox["Mfs",
  FontSlant->"Italic"],
 " and ",
 StyleBox["MAD8Survey",
  FontSlant->"Italic"]
}], "Text",
 CellTags->"Reference section"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Definitions", "Section",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Begin", "Subsection"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"\"\<Madtomma`Mfs`mad8survey`\>\"", ","}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<Madtomma`MADInput`MADInput`\>\"", ",", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Madtomma`Mfs`Mfs`\>\"", ",", "\"\<Madtomma`Mfs`MAD8Survey`\>\"", 
      ",", "\"\<PlotLegends`\>\""}], "}"}]}], "]"}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.387880001880001*^9, 3.3878800033330708`*^9}, {
   3.3942753095627055`*^9, 3.3942753233904767`*^9}, {3.4429095306683407`*^9, 
   3.4429095391684494`*^9}, 3.4429096694044914`*^9, {3.4615036218127265`*^9, 
   3.4615036787818413`*^9}, {3.4615039457366743`*^9, 
   3.4615039460804267`*^9}, {3.462016095056948*^9, 3.4620160996976027`*^9}, {
   3.4620161505885534`*^9, 3.4620161824325075`*^9}, {3.467408189468*^9, 
   3.4674081957390003`*^9}}],

Cell[BoxData[
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "\"\<spell1\>\""}], "]"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "\"\<spell\>\""}], "]"}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Options & Variable Definition", "Subsection"],

Cell[CellGroupData[{

Cell["Plots", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResPlotColours", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Black\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", "2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Red\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", "2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Blue\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", "2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Black\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".5", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Red\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", "0.5", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Blue\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".5", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Green\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<Orange\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ColorData", "[", 
        RowBox[{"\"\<Legacy\>\"", ",", "\"\<YellowGreen\>\""}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{".6", ",", "1", ",", "0"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{".8", ",", "1", ",", "0"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{"1", ",", "1", ",", "0"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{"1", ",", "1", ",", ".2"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{"1", ",", "1", ",", ".4"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{"1", ",", "1", ",", ".6"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{"1", ",", "1", ",", ".8"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{"1", ",", "1", ",", "1"}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", ".2", "]"}]}], "}"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.526640937486307*^9, 3.526640985206279*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Legend", "::", "usage"}], "=", 
   "\"\<Options for ResonancePlot\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"LegendData", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<1\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<2\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<3\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"AbsoluteThickness", "[", ".5", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<4\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"AbsoluteThickness", "[", ".5", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<5\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"AbsoluteThickness", "[", ".5", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<6\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Green", ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<7\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Orange", ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<8\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ColorData", "[", 
           RowBox[{"\"\<Legacy\>\"", ",", "\"\<YellowGreen\>\""}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<9\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{".8", ",", "1", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<10\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "1", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<11\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "1", ",", ".2"}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<12\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "1", ",", ".4"}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<13\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "1", ",", ".6"}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<14\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "1", ",", ".8"}], "]"}], ",", 
          RowBox[{"AbsoluteThickness", "[", ".2", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\"\<15\>\""}], "}"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.526640993003353*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"File", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Colour", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HAxis", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VAxis", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VAxis1", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VAxis2", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VAxis3", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VAxis4", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Bars", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Style", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Symbol", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MaxPlot", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Sort", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Spline", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Multiple", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FFT", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HMin", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HMax", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VMin", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VMax", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Table", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Title", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Param", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Range", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Deltap", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Particle", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Turns", "::", "usage"}], "=", "\"\<Option for MADPlot\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "mfsPlotD", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "0", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteDashing", "[", 
           RowBox[{"{", "3", "}"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0", ",", "1"}], "]"}], ",", 
          RowBox[{"AbsoluteDashing", "[", 
           RowBox[{"{", "8", "}"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteDashing", "[", 
           RowBox[{"{", "15", "}"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "1", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteDashing", "[", 
           RowBox[{"{", "35", "}"}], "]"}]}], "}"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.39427399241687*^9, 3.3942740140100675`*^9}, {
  3.4674080239820004`*^9, 3.467408027844*^9}, {3.467409491335*^9, 
  3.4674094919379997`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "mfsPlot", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "0", ",", "0"}], "]"}], ",", 
          RowBox[{"AbsoluteDashing", "[", 
           RowBox[{"{", "6", "}"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0", ",", "0"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{".5", ",", ".5", ",", ".5"}], "]"}]}], "}"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.394274011353885*^9, 3.394274020588024*^9}, {
  3.467408034368*^9, 3.46740803658*^9}, {3.4674095565550003`*^9, 
  3.467409557565*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADInfo", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADInfo", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NoTable", "\[Rule]", "False"}], ",", 
     RowBox[{"LineExpand", "\[Rule]", "True"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADElementSummary", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"ShowTable", "\[Rule]", "True"}], "}"}]}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"6b23de85-e833-4a2a-b33c-88e19f591902"]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADDraw", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RealTimeMADDraw3D", "]"}], "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Lighting", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"Labels", "\[Rule]", "False"}], ",", 
        RowBox[{"Thick", "\[Rule]", "0.004`"}], ",", 
        RowBox[{"Monitors", "\[Rule]", "True"}], ",", 
        RowBox[{"Lengths", "\[Rule]", "False"}], ",", 
        RowBox[{"Filled", "\[Rule]", "False"}], ",", 
        RowBox[{"WidthScale", "\[Rule]", "1"}], ",", 
        RowBox[{"Bends", "\[Rule]", "True"}], ",", 
        RowBox[{"Offset", "\[Rule]", "0"}], ",", 
        RowBox[{"ShowPicture", "\[Rule]", "True"}], ",", 
        RowBox[{"Fontsize", "\[Rule]", "12"}], ",", 
        RowBox[{"Imagesize", "\[Rule]", "800"}], ",", 
        RowBox[{"DrawLabel", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"CheckClosed", "\[Rule]", "False"}]}], "}"}], ",", 
      RowBox[{"Options", "[", "Graphics3D", "]"}]}], "}"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADDraw3D", "]"}], "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Lighting", "\[Rule]", "None"}], ",", 
        RowBox[{"Labels", "\[Rule]", "False"}], ",", 
        RowBox[{"Thick", "\[Rule]", "0.004`"}], ",", 
        RowBox[{"Monitors", "\[Rule]", "True"}], ",", 
        RowBox[{"Lengths", "\[Rule]", "False"}], ",", 
        RowBox[{"Filled", "\[Rule]", "False"}], ",", 
        RowBox[{"WidthScale", "\[Rule]", "1"}], ",", 
        RowBox[{"Bends", "\[Rule]", "True"}], ",", 
        RowBox[{"Offset", "\[Rule]", "0"}], ",", 
        RowBox[{"ShowPicture", "\[Rule]", "True"}], ",", 
        RowBox[{"Fontsize", "\[Rule]", "12"}], ",", 
        RowBox[{"Imagesize", "\[Rule]", "800"}], ",", 
        RowBox[{"DrawLabel", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"CheckClosed", "\[Rule]", "False"}]}], "}"}], ",", 
      RowBox[{"Options", "[", "Graphics3D", "]"}]}], "}"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Fontsize", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Imagesize", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DrawLabel", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ShowPicture", "::", "usage"}], "=", 
   "\"\<Option for MADDraw\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"acceleratorlayout", "::", "usage"}], "=", 
   "\"\<Option for MADDraw\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Offset", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Bends", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Symms", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WidthScale", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Filled", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Lengths", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitors", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Thickness", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Labels", "::", "usage"}], "=", "\"\<Option for MADDraw\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CheckClosed", "::", "usage"}], "=", 
   "\"\<Option for MADDraw\>\""}], ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4700546205271187`*^9, 3.4700546210739937`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADDraw", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Labels", "\[Rule]", "False"}], ",", 
     RowBox[{"Thickness", "\[Rule]", "0.001"}], ",", 
     RowBox[{"Monitors", "\[Rule]", "True"}], ",", 
     RowBox[{"Lengths", "\[Rule]", "False"}], ",", 
     RowBox[{"Filled", "\[Rule]", "False"}], ",", 
     RowBox[{"WidthScale", "\[Rule]", "1.4"}], ",", 
     RowBox[{"Symms", "\[Rule]", "True"}], ",", 
     RowBox[{"Bends", "\[Rule]", "True"}], ",", 
     RowBox[{"Offset", "\[Rule]", "0"}], ",", 
     RowBox[{"ShowPicture", "\[Rule]", "True"}], ",", 
     RowBox[{"Fontsize", "\[Rule]", "12"}], ",", 
     RowBox[{"Imagesize", "\[Rule]", "800"}], ",", 
     RowBox[{"DrawLabel", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"CheckClosed", "\[Rule]", "False"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}]}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.394369389389533*^9, 3.3943694153258715`*^9}, {
  3.4700546133864937`*^9, 3.4700546138552437`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADOptics", "Subsubsection",
 CellChangeTimes->{{3.4700546055271187`*^9, 3.4700546061521187`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BETX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ALFX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MUX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BETY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ALFY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MUY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DPX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DPY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"X", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Y", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"T", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PT", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PHIX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMUX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PHIY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMUY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DDX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DDY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DDPX", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DDPY", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Line", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BETAO", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Centre", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Filename", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Deltap", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Columns", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"File", "::", "usage"}], "=", "\"\<Option for MADOptics\>\""}], 
  ";"}]}], "Input",
 Evaluatable->False]
}, Closed]],

Cell[CellGroupData[{

Cell["MADWrite", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Slice", "::", "usage"}], "=", "\"\<Option for MADWrite\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"New", "::", "usage"}], "=", "\"\<Option for MADWrite\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"datafile", "::", "usage"}], "=", "\"\<Option for MADWrite\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Symm", "::", "usage"}], "=", "\"\<Option for MADLineWrite\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Super", "::", "usage"}], "=", "\"\<Option for MADLineWrite\>\""}],
   ";"}]}], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADLineWrite", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Symm", "\[Rule]", "0"}], ",", 
     RowBox[{"Super", "\[Rule]", "0"}]}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADLineName", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADPrint & MADSelect", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Data", "::", "usage"}], "=", 
   "\"\<Option for MADPrint and MADSelect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Range", "::", "usage"}], "=", 
   "\"\<Option for MADPrint and MADSelect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Type", "::", "usage"}], "=", 
   "\"\<Option for MADPrint and MADSelect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Full", "::", "usage"}], "=", 
   "\"\<Option for MADPrint and MADSelect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "::", "usage"}], "=", 
   "\"\<Option for MADPrint and MADSelect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Flag", "::", "usage"}], "=", 
   "\"\<Option for MADPrint and MADSelect\>\""}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADCorrect & MADMicado", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Error", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NCorr", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Iterate", "::", "usage"}], "=", "\"\<Option for MADCorrect\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"C1List", "::", "usage"}], "=", "\"\<Option for MADCorrect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"C2List", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"M1List", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"M2List", "::", "usage"}], "=", "\"\<Option for MADCorrect\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DXWeight", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DYWeight", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plane", "::", "usage"}], "=", 
   "\"\<Option for MADCorrect & MADMicado\>\""}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Tracking", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Method", "::", "usage"}], "=", "\"\<Option for MADTracking\>\""}],
   ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PrintMatrix", "::", "usage"}], "=", 
   "\"\<Option for MADMatrixTrack\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReplaceWithZeros", "::", "usage"}], "=", 
   "\"\<Option for MADMatrixTrack\>\""}], ";"}]}], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADTracking", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Method", "\[Rule]", "\"\<Lie4\>\""}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADMatrixTrack", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"PrintMatrix", "\[Rule]", "False"}], ",", 
     RowBox[{"ReplaceWithZeros", "\[Rule]", "True"}], ",", 
     RowBox[{"XOffset", "\[Rule]", "0"}]}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADxfinal", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADpxfinal", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADyfinal", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADpyfinal", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Qx", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Qy", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dQxdn", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dQydn", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTrackMatrix", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTrackData", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TrackData", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADxytuneData", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADTwiss", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Tunes", "::", "usage"}], "=", "\"\<Option for MADTwiss\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Chrom", "::", "usage"}], "=", "\"\<Option for MADTwiss\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Couple", "::", "usage"}], "=", "\"\<Option for MADTwiss\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Save", "::", "usage"}], "=", "\"\<Option for MADTwiss\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tape", "::", "usage"}], "=", "\"\<Option for MADTwiss\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Deltap", "::", "usage"}], "=", "\"\<Option for MADTwiss\>\""}], 
  ";"}]}], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADTwiss", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Tunes", "\[Rule]", "False"}], ",", 
     RowBox[{"Chrom", "\[Rule]", "False"}], ",", 
     RowBox[{"Couple", "\[Rule]", "False"}], ",", 
     RowBox[{"Save", "\[Rule]", "False"}], ",", 
     RowBox[{"Tape", "\[Rule]", "False"}], ",", 
     RowBox[{"Deltap", "\[Rule]", "0"}]}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADBeam & MADBMPM", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Lines", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Particle", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Energy", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Charge", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Pc", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Mass", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Gamma", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ex", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ey", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Et", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Exn", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Eyn", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Sigt", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Sige", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KBunch", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NPart", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BCurrent", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Bunched", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Radiate", "::", "usage"}], "=", "\"\<Option for MADBeam\>\""}], 
  ";"}]}], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NInt", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DelQ", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TauQ", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADBucket", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Kappa", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I4I2", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EXData", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FX", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FY", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KHM", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SynRad", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clorb", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tousch", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Single", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EVary", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MidArc", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Interact", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Range", "::", "usage"}], "=", "\"\<Option for MADBMPM\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADBeam", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Particle", "\[Rule]", "\"\<Electron\>\""}], ",", 
     RowBox[{"Energy", "\[Rule]", "2"}], ",", " ", 
     RowBox[{"Charge", "\[Rule]", "1"}], ",", 
     RowBox[{"Pc", "\[Rule]", "0"}], ",", 
     RowBox[{"Mass", "\[Rule]", "1"}], ",", 
     RowBox[{"Gamma", "\[Rule]", "0"}], ",", 
     RowBox[{"Ex", "\[Rule]", "0"}], ",", 
     RowBox[{"Ey", "\[Rule]", "0"}], ",", 
     RowBox[{"Et", "\[Rule]", "0"}], ",", 
     RowBox[{"Exn", "\[Rule]", "0"}], ",", 
     RowBox[{"Eyn", "\[Rule]", "0"}], ",", 
     RowBox[{"Sigt", "\[Rule]", "0"}], ",", 
     RowBox[{"Sige", "\[Rule]", "0"}], ",", 
     RowBox[{"KBunch", "\[Rule]", "0"}], ",", 
     RowBox[{"NPart", "\[Rule]", "0"}], ",", 
     RowBox[{"BCurrent", "\[Rule]", "0"}], ",", 
     RowBox[{"Bunched", "\[Rule]", "False"}], ",", 
     RowBox[{"Radiate", "\[Rule]", "False"}]}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADBMPM", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NInt", "\[Rule]", "0"}], ",", 
     RowBox[{"DelQ", "\[Rule]", "0"}], ",", 
     RowBox[{"TauQ", "\[Rule]", "0"}], ",", 
     RowBox[{"MADBucket", "\[Rule]", "0"}], ",", 
     RowBox[{"Kappa", "\[Rule]", "0"}], ",", 
     RowBox[{"I4I2", "\[Rule]", "0"}], ",", 
     RowBox[{"EXData", "\[Rule]", "0"}], ",", 
     RowBox[{"FX", "\[Rule]", "0"}], ",", 
     RowBox[{"FY", "\[Rule]", "0"}], ",", 
     RowBox[{"KHM", "\[Rule]", "0"}], ",", 
     RowBox[{"SynRad", "\[Rule]", "True"}], ",", 
     RowBox[{"Clorb", "\[Rule]", "False"}], ",", 
     RowBox[{"Tousch", "\[Rule]", "False"}], ",", 
     RowBox[{"Single", "\[Rule]", "True"}], ",", 
     RowBox[{"EVary", "\[Rule]", "False"}], ",", 
     RowBox[{"MidArc", "\[Rule]", "False"}], ",", 
     RowBox[{"Interact", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Range", "\[Rule]", "\"\<\>\""}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDelete", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Depth", "::", "usage"}], "=", "\"\<Option for MADDelete\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeleteAll", "::", "usage"}], "=", 
   "\"\<Option for MADDelete\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Type", "::", "usage"}], "=", "\"\<Option for MADDelete\>\""}], 
  ";"}]}], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADDelete", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DeleteAll", "\[Rule]", "False"}], ",", 
     RowBox[{"Depth", "\[Rule]", "1"}], ",", 
     RowBox[{"Type", "\[Rule]", "Track"}]}], "}"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADElementFind", "Subsubsection",ExpressionUUID->"56fdd13b-215f-4368-9346-26bc46bc7348"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Pos", "::", "usage"}], "=", "\"\<Option for MADElementFind\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Equals", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Greater", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Less", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Columns", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SortBy", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Elements", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Apertures", "::", "usage"}], "=", 
   "\"\<Option for MADElementFind\>\""}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Apertures", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADGetApertures", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Slice", "\[Rule]", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADGetAperturesJAV", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Slice", "\[Rule]", "1"}], "}"}]}], ";"}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"XApp", "::", "usage"}], "=", 
   "\"\<Option for MADGetApertures\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"YApp", "::", "usage"}], "=", 
   "\"\<Option for MADGetApertures\>\""}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Other", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADSplitElements", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"NoFlat", "\[Rule]", "False"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"I1", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I2", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I3", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I4", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I5", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I6X", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I6Y", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"I8", "::", "usage"}], "=", "\"\<\>\""}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LinQx", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LinQy", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADInfoData", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFileName", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADMultipleData", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADOrbitDatay", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADOrbitDatax", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADmonlist", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DiffTunes", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PlotMatrix", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell["More", "Subsubsection"]
}, Closed]],

Cell[CellGroupData[{

Cell["UsageDefinitions", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MADElementCoordinates", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADMagnetCoordinates", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADPositions", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADCalculateRayPositions", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADCalculateRayPositions3D", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5305312065632005`*^9, 3.530531245091792*^9}, {
  3.558782221493335*^9, 
  3.558782225587268*^9}},ExpressionUUID->"7750bf2f-f934-472a-973b-\
cbbf2d1709ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADEnergy", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Element Usage", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"MADErrors", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"GetMADErrors", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4553486021525054`*^9, 3.4553486024025054`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HOMmax", "=", "9"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"MADErrors", ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"MADElements", "[", "]"}], "]"}]}], ",", 
    RowBox[{
     RowBox[{"MADElements", "[", "]"}], "=", 
     RowBox[{"{", "}"}]}]}], "]"}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"610c3684-06c7-4e2a-b9e0-2072a781e171"],

Cell[BoxData[
 RowBox[{"SetMADErrors", ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"GetMADErrors", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4553485698243804`*^9, 3.4553485701212554`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"SetMADOptions", ",", "HoldAll"}], "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"MADOptions", ",", "HoldAll"}], "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"MADOptions", ";"}]], "Input",
 InitializationCell->True]
}, Open  ]],

Cell[CellGroupData[{

Cell["Other Stuff", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NumberRight", "::", "usage"}], "=", "\"\<\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.4221665533762465`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rfc", "::", "usage"}], "=", 
   "\"\<rfc[name, Length, label, options]\\n\\nrfc creates an RF Cavity \
Element. \\n\\nSee MAD manual for options - passed as rules.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"lcav", "::", "usage"}], "=", 
   "\"\<lcav[name, Length, label, options]\\nlcav creates a Linear \
Accelerator Cavity \
Element.\\nOptions:\\n\\tVoltageGain\\n\\tCavityPhase\\n\\tFrequency\\n\\\
tLossFactor\\n\\tVoltageError\\n\\tLagError\\n\\tNumberBins\\n\\tMaxBinLength\
\\n\\tLWakefieldFile\\n\\tTWakefieldFile\\n\\tE0 (Not Used in \
MAD)\\n\\tInitialEnergy (Not Used in MAD)\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"multipole", "::", "usage"}], "=", 
   "\"\<multipole[name, Label, options]\\n\\nmultipole creates a Multipole \
Element. \\n\\nSee MAD manual for options - passed as rules.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"gwiggler", "::", "usage"}], "=", 
   "\"\<gwiggler[Name, L, Focusing, Type] \n\\nCreates a Genesis Wiggler \
Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6145083590243683`*^9, 3.6145083743833685`*^9}, {
  3.6798980354029264`*^9, 3.679898067453926*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"charge", "::", "usage"}], "=", 
   "\"\<charge[Name, Total Charge, Type] \n\\nCreates a Charge \
Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6145083590243683`*^9, 3.6145083743833685`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"watch", "::", "usage"}], "=", 
   "\"\<watch[Name, Filename, Type] \n\\nCreates a Watch Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6145083590243683`*^9, 3.6145083743833685`*^9}, {
  3.687526072962717*^9, 3.687526082096717*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"quad", "::", "usage"}], "=", 
   "\"\<quad[Name, Length [Number], Focus [Number], Type] \n\\nCreates a \
Quadrupole Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"freetext", "::", "usage"}], "=", 
   "\"\<freetext[Name, Type, Text->\\\"<text>\\\"] \n\\nCreates a FreeText \
Element.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.54244916395516*^9, 3.5424491957065105`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"solenoid", "::", "usage"}], "=", 
   "\"\<solenoid[Name, Length [Number], KS [Number], Type] \n\\nCreates a \
Solenoid Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"yrot", "::", "usage"}], "=", 
   "\"\<yrot[Name, Angle [Number], Type] \n\\nCreates a YROT Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"srot", "::", "usage"}], "=", 
   "\"\<srot[Name, Angle [Number], Type] \n\\nCreates an SROT Element.\>\""}],
   ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"drift", "::", "usage"}], "=", 
   "\"\<drift[Name , Length [Number], Type] \n\\nCreates a Drift \
Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"csrdrift", "::", "usage"}], "=", 
   "\"\<csrdrift[Name , Length [Number], Type] \n\\nCreates a CSRDrift \
Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6977833293558054`*^9, 3.6977833349569254`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ecoll", "::", "usage"}], "=", 
   "\"\<ecoll[Name, Length [Number], XSize, YSize, Type] \n\\nCreates an \
Elliptic collimator.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rcoll", "::", "usage"}], "=", 
   "\"\<rcoll[Name, Length [Number], XSize, YSize, Type] \n\\nCreates a \
Rectangular collimator.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"marker", "::", "usage"}], "=", 
   "\"\<marker[Name, Type] \n\\nCreates a Marker Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"imonitor", "::", "usage"}], "=", 
   "\"\<imonitor[Name, Type] \n\\nCreates an imonitor Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4008368010618*^9, 3.400836807608801*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"profile", "::", "usage"}], "=", 
   "\"\<profile[Name, Type] \n\\nCreates a profile Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4008368010618*^9, 3.400836807608801*^9}, {
  3.4008373403221536`*^9, 3.4008373504785986`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"maxamp", "::", "usage"}], "=", 
   "\"\<maxamp[Name, xmax, ymax, Type] \n\\nCreates a profile Element.\>\""}],
   ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4008368010618*^9, 3.400836807608801*^9}, {
  3.4008373403221536`*^9, 3.4008373504785986`*^9}, {3.5831286709764013`*^9, 
  3.5831286783714013`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"monitor", "::", "usage"}], "=", 
   "\"\<monitor[Name, Type] \n\\nCreates a monitor Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"wire", "::", "usage"}], "=", 
   "\"\<wire[Name, Type] \n\\nCreates a wire Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"instrument", "::", "usage"}], "=", 
   "\"\<instrument[Name, Type] \n\\nCreates a instrument Element.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"cwiggler", "::", "usage"}], "=", 
   "\"\<cwiggler[Name, Length [Number], B Max [Number], Bx File, By File, \
Type, Options] \n\\nCreates a CWiggler Element.\nOptions include:\nPeriods, \
StepsPerPeriod, BxMax, ByMax, Sinusoidal, Vertical, Helical, DX, DY, DZ, \
Tilt.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6989909090538235`*^9, 3.6989909156368237`*^9}, {
  3.6989921754948235`*^9, 3.6989922024328237`*^9}, {3.69927797225036*^9, 
  3.6992780313576794`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"sbend", "::", "usage"}], "=", 
   "\"\<sbend[Name, Length [Number], Focus [Number], Angle, Type] \n\
\\nCreates a Sector Bending Magnet Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"csbend", "::", "usage"}], "=", 
   "\"\<csbend[Name, Length [Number], Focus [Number], Angle, Type] \n\
\\nCreates a CSector Bending Magnet Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.697783348388611*^9, 3.6977833527729874`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"csrcsbend", "::", "usage"}], "=", 
   "\"\<csrcsbend[Name, Length [Number], Focus [Number], Angle, Type] \n\
\\nCreates a CSRCSector Bending Magnet Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.697783348388611*^9, 3.697783363461125*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rbend", "::", "usage"}], "=", 
   "\"\<rbend[Name, Length [Number], Focus [Number], Angle, Type] \n\
\\nCreates a Rectangular Bending Magnet Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"sext", "::", "usage"}], "=", 
   "\"\<sext[Name, Length [Number], Focus [Number], Type] \n\\nCreates a \
Sextupole Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"oct", "::", "usage"}], "=", 
   "\"\<oct[Name, Length [Number], Focus [Number], Type] \n\\nCreates an \
Octupole Element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"vkick", "::", "usage"}], "=", 
   "\"\<vkick[Name, Length [Number], Vertical Kick Angle [Number], Type] \n\
\\nCreates a Vertical Corrector with Vertical Kick Angle as given.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"hkick", "::", "usage"}], "=", 
   "\"\<hkick[Name, Length [Number], Horizontal Kick Angle [Number], Type] \n\
\\nCreates a Horizontal Corrector with Horizontal Kick Angle as given.\>\""}],
   ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"kick", "::", "usage"}], "=", 
   "\"\<vkick[Name, Length [Number], Vertical Kick Angle [Number], Horizontal \
Kick Angle [Number], Type] \n\\nCreates a Corrector with Vertical Kick Angle \
and Horizontal Kick Angle as given.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"vbpm", "::", "usage"}], "=", 
   "\"\<vbpm[Name, Length [Number] (Default:0), Type] \n\\nCreates a Vertical \
Beam Position Monitor.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"hbpm", "::", "usage"}], "=", 
   "\"\<hbpm[Name, Length [Number] (Default:0), Type] \n\\nCreates a \
Horizontal Beam Position Monitor.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"bpm", "::", "usage"}], "=", 
   "\"\<bpm[Name, Length [Number] (Default:0), Type] \n\\nCreates a Vertical \
and Horizontal Beam Position Monitor.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"line", "::", "usage"}], "=", 
   "\"\<line[Name, List of Elements] \n\\nCreates a line of elements to be \
added to the MAD file. Use ExpandLattice[linename] to see elements.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->
  True,ExpressionUUID->"8212222f-37ad-43c1-af31-86b5949500d5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LinesLattice", "::", "usage"}], "=", 
   "\"\<LinesLattice[Name] \n\\nExpands line elements to show all elements \
contained with nested lines.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExpandLattice", "::", "usage"}], "=", 
   "\"\<line[Name] \n\\nExpands line elements to show all elements contained \
with nested lines.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->
  True,ExpressionUUID->"ec4c42ce-9a7b-4449-b52c-e7b48ecaa4a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"reverse", "::", "usage"}], "=", 
   "\"\<reverse[line]\n\\nreverse generates a ReversedLine\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"matrix", "::", "usage"}], "=", 
   "\"\<matrix[Name, Type, MatrixTerms->{RM[i,j]->Rij, TM[i,j,k]->Tijk}]\n\
\\nmatrix Generates a Matrix Element.\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"error", "::", "usage"}], "=", 
   "\"\<error[Name, Type, dx\[Rule]Number, dy\[Rule]Number}]\n\\nerror \
Generates an Error Element.\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReverseError", "::", "usage"}], "=", 
   "\"\<error[Name, Type, dx->Number, dy->Number}]\n\\nerror Generates an \
Error Element.\>\""}], ";"}]], "Input",
 InitializationCell->True]
}, Open  ]],

Cell[CellGroupData[{

Cell["Working With MADInput Lists", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFlatten", "::", "usage"}], "=", 
   "\"\<Exapnds a lattice then flattens and partitions it into 7's\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFlat", "::", "usage"}], "=", 
   "\"\<Flatten and Partitions lists into 7's\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExpandLattice", "::", "usage"}], "=", 
   "\"\<Expands line definitions.\>\""}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"0dd782f9-78e7-446f-ba01-9ef5927427e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LineLattice", "::", "usage"}], "=", 
   "\"\<Shows all line definitions within a lattice definition.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetLengths", "::", "usage"}], "=", 
   "\"\<MADGetLengths[Lattice, Slices: 1,XAp->True/False, \
YAp->True/False]\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetApertures", "::", "usage"}], "=", 
   "\"\<MADGetApertures[Lattice, Slices: 1, XAp->True/False, YAp->True/False]\
\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetCollimators", "::", "usage"}], "=", 
   "\"\<MADGetCollimators[Lattice, Slices: 1, XAp->True/False, \
YAp->True/False]\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetAperturesJAV", "::", "usage"}], "=", 
   "\"\<MADGetApertures set up with same rules as MADSplitElements for \
consistency\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElements", "::", "usage"}], "=", 
   "\"\<Internal command to split elements into slices\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsAll", "::", "usage"}], "=", 
   "\"\<Internal command to split elements into slices\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsAllSpecific", "::", "usage"}], "=", 
   "\"\<Internal command to split elements into slices\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsSextQuad", "::", "usage"}], "=", 
   "\"\<Internal command to split elements into slices\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitDipoles", "::", "usage"}], "=", 
   "\"\<Internal command to split Dipoles into slices\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitDipolesLength", "::", "usage"}], "=", 
   "\"\<Internal command to split Dipoles into slices\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6441310708936415`*^9, 3.6441310715737095`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsLength", "::", "usage"}], "=", 
   "\"\<Internal command to split Dipoles into slices\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6441310708936415`*^9, 3.6441310791184645`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADElementFind", "::", "usage"}], "=", 
   "\"\<MADElementFind[Data, Options]\\nMADElementFind is used to interogate \
lists of data.\\nMADElementFind takes 5 options\\n\nColumns \[Rule] Number\\t\
\\tis used to specify the no. of columns per line\\n\nEquals \[Rule] {Column, \
Value} or {{Column, Value},{Column, Value}}\\tis used to look for data in a \
column equal to Value\\n\nGreater and Less\\t\\tare used similar to equals\\n\
\nSortBy \[Rule] Column\\t\\t is used to sort the relevant data by a given \
column\>\""}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"d983218d-64f8-4ef5-9885-2b9e8370618b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADClear", "::", "usage"}], "=", 
   "\"\<Use MADClear to clear variable names for re-assignment. This should \
be used to clear options associated with element definitions\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADInfo", "::", "usage"}], "=", 
   "\"\<MADInfo[Line] \\nProvides Information on Elements and Element \
Lines.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADElementSummary", "::", "usage"}], "=", 
   "\"\<MADElementSummary[Line] \\nProvides summary information on magnetic \
elements.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->
  True,ExpressionUUID->"e766e59c-465c-4e65-b345-7244a7f6c118"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADElementList", "::", "usage"}], "=", 
   "\"\<MADElementList[Line] \\nReturns a list of element informations that \
includes all extra information. The list has elements 30 units long.\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->
  True,ExpressionUUID->"8617b5e4-fbdb-4578-8ab0-e7d87f9a19ed"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSumLength", "::", "usage"}], "=", 
   "\"\<MADSumLength[line]\\nAdds a line printing the combined length of all \
elements in Line\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetElementLengths", "::", "usage"}], "=", 
   "\"\<MADGetElementLengths[lattice]\\nReturns a list of the lengths of all \
elements in <lattice>\>\""}], ";"}]], "Input",
 InitializationCell->True]
}, Open  ]],

Cell[CellGroupData[{

Cell["Writing and Running MAD files", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADBETA0", "::", "usage"}], "=", 
   "\"\<Creates a MAD BETA0 \
Command\\nMADBETA0[file_,name_String,{twissrules__Rule}]\\nMADBETA0[file_,\
name_String,alfx_:Null,betx_:Null,alfy_:Null,bety_:Null,dx_:Null,dpx_:Null,x_:\
Null,px_:Null,y_:Null,py_:Null]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.515221067057155*^9, 3.5152210863074017`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADOptics", "::", "usage"}], "=", 
   "\"\<Creates a MAD Optics Command\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADPrint", "::", "usage"}], "=", 
   "\"\<Creates a MAD Print Command\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSelect", "::", "usage"}], "=", 
   "\"\<Creates a MAD Select Command\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADPlot", "::", "usage"}], "=", 
   "\"\<Creates a MAD Plot Command\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MADGetDisp", "::", "usage"}], "=", 
   "\"\<Creates a MAD GetDisp Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADPutDisp", "::", "usage"}], "=", 
   "\"\<Creates a MAD PutDisp Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADGetKick", "::", "usage"}], "=", 
   "\"\<Creates a MAD GetKick Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADPutKick", "::", "usage"}], "=", 
   "\"\<Creates a MAD PutKick Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADGetOrbit", "::", "usage"}], "=", 
   "\"\<Creates a MAD GetOrbit Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADPutOrbit", "::", "usage"}], "=", 
   "\"\<Creates a MAD PutOrbit Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADMicado", "::", "usage"}], "=", 
   "\"\<Creates a MAD Micado Command\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADCorrect", "::", "usage"}], "=", 
   "\"\<Creates a MAD Correct Command\>\""}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADBMPM", "::", "usage"}], "=", 
   "\"\<MADBMPM[Options]\\nMADBMPM is used to write a BMPM command to a MAD \
text file.\\nMADBMPM takes the same options as in the MAD manual, with the \
exception of\\nFilename \[Rule] filename\\t\\t which gives the filename to \
write to.\\nMADBMPM defaults to writing to the last MAD file written using \
MADWrite\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDropLines", "::", "usage"}], "=", 
   "\"\<MADDropLines[File, Options]\\n\\nMADDropLines is used to delete lines \
from File.\\nIt takes options\\n\nLines->Number\\t\\tLine numbers to drop. \
Will accept a list of lines. Use Range[] to Drop a set of lines.\\n\n\
Out->Filename\\t\\tFile to write to. Defaults to input filename\\n\\n\nWith \
no input, MADDroplines prints the contents of a file with line \
numbers.\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADBeam", "::", "usage"}], "=", 
   "\"\<MADBeam[Options]\\nMADBeam take the following options\\n\\nParticle\
\[Rule]\\\"Electron/Positron/Proton/Anti-Proton\\\"\\nCharge\[Rule]Particle \
Charge [Number]\\nPc\[Rule]Particle Momentum [Number]\\nMass\[Rule]Particle \
Mass [Number]\\nEnergy\[Rule]Beam Energy [Number]\\nGamma\[Rule]Relativistic \
Gamma [Number]\\nEx\[Rule]Horizontal Emittance [Number]\\nEy\[Rule]Vertical \
Emittance [Number]\\nEt\[Rule]Longtidunal Emittance \
[Number]\\nExn\[Rule]Normalised Horizontal Emittance \
[Number]\\nEyn\[Rule]Normalised Vertical Emittance \
[Number]\\nSigt\[Rule]Bunch Length [Number]\\nSige\[Rule]Relative Energy \
Spread [Number]\\nKBunch\[Rule]Particles per Bunch \
[Number]\\nNPart\[Rule]Number of Particles [Number]\\nBCurrent\[Rule]Total \
Beam Current [Number]\\nBunched\[Rule]Bunched Train [True/False]\\nRadiate\
\[Rule]Synchrotron Radiation? [True/False]\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADStringWrite", "::", "usage"}], "=", 
   "\"\<MADStringWrite[filename, string]\\nMADStringWrite is used to write \
String Data to the file \\\"filename\\\"\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADXStringWrite", "::", "usage"}], "=", 
   "\"\<MADXStringWrite[filename, string]\\nMADXStringWrite is used to write \
String Data to the file \\\"filename\\\"\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADWrite", "::", "usage"}], "=", 
   "\"\<MADWrite[Filename, Element List]\\nMADWrite opens and then writes the \
definitions of all elements in List.\\nIt also adds a MAD \\\"Line=\\\" \
command, with the line being given the name of the variable Line\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADXWrite", "::", "usage"}], "=", 
   "\"\<MADXWrite[Filename, Element List,BeamEnergy->1, Beam \
Particle->Electron]\\nMADXWrite opens and then writes the definitions of all \
elements in List.\\nIt also adds a MAD \\\"Line=\\\" command, with the line \
being given the name of the variable Line\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADLineWrite", "::", "usage"}], "=", 
   "\"\<MADLineWrite[List, Linename]\\nMADLineWrite writes the MAD \
\\\"Line=\\\" command to the currently open filename. It is called from \
MADWrite\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADLines", "::", "usage"}], "=", 
   "\"\<MADLines[FileName, Line, Extra]\\nMADLines writes the MAD \\\"Line=\\\
\" command to filename.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADWhatisit", "::", "usage"}], "=", 
   "\"\<MADWhatisit[List]\\nMADWhatisit runs through an element definition \
and depending on the element type, creates and writes an element definition. \
It is normally called from MADWrite.\\nMADWhatisit calls various element \
Write functions, depending on the element.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFileWrite", "::", "usage"}], "=", 
   "\"\<MADFileWrite[Data]\\nMADFileWrite is used to write strings to the \
currently open file.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RunMAD", "::", "usage"}], "=", 
   "\"\<RunMAD[Filename]\\nRunMAD is used to run the MAD program on a \
selected input file\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RunMADX", "::", "usage"}], "=", 
   "\"\<RunMADX[Filename]\\nRunMADX is used to run the MAD program on a \
selected input file\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetMomentumCompaction", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Commands for SRI and Tracking", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTrackingJAV", "::", "usage"}], "=", 
   "\"\<MADTrackingMore without the RUN and ARCHIVE commands, for when you \
want to do more complicated RUNs\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTrackingJKJ", "::", "usage"}], "=", 
   "\"\<MADTrackingMore without the RUN and ARCHIVE commands, for when you \
want to do more complicated RUNs\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTrackingMore", "::", "usage"}], "=", 
   "\"\<MADTracking with more parameters: x,px,y,py,t,deltap\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetChromaticity", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetSRI", "::", "usage"}], "=", 
   "\"\<MADGetSRI[filename]\\nMADGetSRI is used to read in the SRI from a MAD \
Print Command\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADCreateSRIData", "::", "usage"}], "=", 
   "\"\<MADCreateSRIData[filename]\\nMADCreateSRIData is used to write a SRI \
line to the MAD file\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetTunes", "::", "usage"}], "=", 
   "\"\<MADGetTunes[filename]\\nUse MADGetTunes to extract Tune Data from a \
print File. Filename defaults to MADFileName.print.txt\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDeleteTrack", "::", "usage"}], "=", 
   "\"\<MadDeleteTrack[Filename (Default: MADFileName)]\\nMADDeleteTrack is \
used to remove any previous MAD tracking arguments found in MAD data files, \
it then writes the data to filename.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADcreateData", "::", "usage"}], "=", 
   "\"\<MADcreateData[xmin, xmax, xstep, ymin, ymax, ystep]\\nMADcreateData \
is used to create data lists to be used in the MADTracking command. It create \
regularly spaced data arrays.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADMatrixTrack", "::", "usage"}], "=", 
   "\"\<matrixTrack[]\\nmatrixTrack is used to format data read in by John \
Jowetts Mfs package. It should be applied on data read in from a MAD track \
data file.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTracking", "::", "usage"}], "=", 
   "\"\<MADTracking[Data array, No. of Turns]\\nMADTracking is used to write \
MAD tracking lines to the last opend MAD data file, given by MADFileName. The \
data array should be given as all the {x,y} values for a given x. Increasing \
in x. i.e.\n\\n\n\\n           Y2 |  2  |  4  |  6\n\\n            \
-------------------\n\\n           Y1 |  1  |  3  |  5\n\\n            \
-------------------\n\\n              |  X1 |  X2 | X3\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADTwiss", "::", "usage"}], "=", 
   "\"\<MADTwiss[Options]\\nMADTwiss is used to create a twiss command. It \
accepts the following \
options\\n\\nTunes\\tChrom\\tCouple\\nSave\\tTape\\tTwiss\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADcreateData", "::", "usage"}], "=", 
   "\"\<MADcreateData[xmin,xmax,xstep,ymin,ymax,ystep]\\nMADcreateData \
creates data for MADTrack command\>\""}], ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Resonance Plot Stuff", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResonanceLegend", "::", "usage"}], "=", 
   "\"\<ResonanceLegend[Min. Order , Max. Order]\\nResonanceLegend creates a \
legend for ResonancePlot\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResEqn", "::", "usage"}], "=", 
   "\"\<ResEqn[M, N]\\nResEqn creates the resonance equation for a given M \
and N\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResNumAtOrder", "::", "usage"}], "=", 
   "\"\<ResNumAtOrder[Range]\\nResNumAtOrder is used to create ranges of \
points for Resonance Plots\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RangePoints", "::", "usage"}], "=", 
   "\"\<RangePoints[Range]\\nRangePoints is used to find the corners of the \
resonant range\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PValues", "::", "usage"}], "=", 
   "\"\<PValues[Resonance Numbers, Range, Periodicity]\\nPValues Creates a \
list of P-Values that solve the Resonance Equation\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResonanceEquationsAtOrder", "::", "usage"}], "=", 
   "\"\<ResonanceEquationsAtOrder[Range, Order, \
Periodicity]\\nResonanceEquationsAtOrder Creates a list of Resonance \
Equations that apply within the Range\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResonanceEquations", "::", "usage"}], "=", 
   "\"\<ResonanceEquations[Range, OrderStart, OrderEnd, \
Periodicity\\nResonanceEquations solves the Resonance Equations for a \
selection of resonance orders\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResonancePlot", "::", "usage"}], "=", 
   "\"\<ResonancePlot[Range, OrderStart, OrderEnd, \
Periodicity]\\nResonancePlot plots the relevant Resonance Equations in Range, \
and with Order between OrderStart and OrderEnd\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HanningElement", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Hanning", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BartInt", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PeakPosition", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BaseTuneEstimate", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BartIntCorrNum1", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BartIntCorrNum2", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TuneCorrection", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TuneEstimate", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TuneEstimateDescending", "::", "usage"}], "=", 
   "\"\<INTERNAL\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllTuneCorrection", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllBaseTuneEstimate", "::", "usage"}], "=", "\"\<INTERNAL\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADDraw", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RealTimeMADDraw3D", "::", "usage"}], "=", 
   "\"\<MADDraw3D[Lattice, Options]\\n\\nMADDraw is a function used to draw \
3-Dimensional lattice elements in the RealTime3D environment. It takes \
account of the bends from bending magnets, but not from kickers, and only in \
the horizontal plane.\\n MADDraw takes the following options with their \
default values\\n\\n\n\nWidthScale->1.4\\t\\tThe width to height ratio\\n\n\
Bends->True\\t\\tTake account of bending magnet bends\n\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDraw3D", "::", "usage"}], "=", 
   "\"\<MADDraw3D[Lattice, Options]\\n\\nMADDraw3D is a function used to draw \
3-Dimensional lattice elements. It takes account of the bends from bending \
magnets, but not from kickers, and only in the horizontal plane.\\n MADDraw \
takes the following options with their default values\\n\\n\n\n\
WidthScale->1.4\\t\\tThe width to height ratio\\n\nBends->True\\t\\tTake \
account of bending magnet bends\n\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDraw", "::", "usage"}], "=", 
   "\"\<MADDraw[Lattice, Options]\\n\\nMADDraw is a function used to draw \
lattice elements. It takes account of the bends from bending magnets.\\n \
MADDraw takes the following options with their default values\\n\\n\n\n\
Labels->True\\t\\tInclude Text Labels\\n\nThick->0.004\\t\\tThe relative \
thickness of the lines\\n\nMonitors->True\\t\\tInclude BPM positions\\n\n\
Lengths->False\\t\\tInclude element length labels\\n\nFilled->False\\t\\tFill \
in elements\\n\nWidthScale->1.4\\t\\tThe width to height ratio\\n\n\
Symms->True\\t\\tInclude Symmetry lines\\n\nBends->True\\t\\tTake account of \
bending magnet bends\n\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDrawSurvey", "::", "usage"}], "=", 
   "\"\<MADDrawSurvey[Filename, Options]\\n\\nMADDrawSurvey is a function \
used to draw lattice elements based on data taken from a MAD SURVEY command. \
\\n MADDrawSurvey takes the following options, with their default values \
shown,\\n\\n\n\nThick->0.004\\t\\tThe relative thickness of the lines\\n\n\
Filled->False\\t\\tFill in elements\\n\nWidthScale->1.4\\t\\tThe width to \
height ratio\\n\nBends->True\\t\\tTake account of bending magnet bends\n\
\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADPositions", "::", "usage"}], "=", 
   "\"\<MADPositions[Lattice, Options]\\n\\nMADPositions gives a list in {X, \
Y} pairs of the position of the end of each element.\\n\\n\>\""}], 
  ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"884d5da3-6ff5-40f9-889e-13777a1e3ed0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFootPrint", "::", "usage"}], "=", 
   "\"\<MADPositions[Lattice]\\n\\nMADFootPrint gives the size of the lattice \
layout, in metres, in both planes. No account is taken of the physical \
dimensions of elements.\\n\\n\>\""}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"62c3d157-0c75-4721-bbe1-12f204be60c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FancyElements", "::", "usage"}], "=", 
   "\"\<Options for MADDraw.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.417347711220543*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADZAP", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetZAPData", "::", "usage"}], "=", 
   "\"\<MADGetZAPData[filename]\\nMADGetZAPData is used to add an optics line \
to a MAD file to produce suitable ZAP optics data\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADOutputZAPData", "::", "usage"}], "=", 
   "\"\<MADOutputZAPData[Lattice, InputFile :\\\"zap.optics.txt\\\", \
OuputFile :\\\"zaplat.dat\\\"]\\nMADOutputZAPData is used to create a ZAP \
lattice file using Aperture definitions from the elements in Lattice.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADZAP", "::", "usage"}], "=", 
   "\"\<MADZAP[Lattice, Slices, MADFileName :\\\"madzap\\\", InputFile \
:\\\"zap.optics.txt\\\", OuputFile :\\\"zaplat.dat\\\"]\\nMADZAP is used to \
create a ZAP lattice file from Lattice.\>\""}], ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["More", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FindTurningPoints", "::", "usage"}], "=", 
   "\"\<FindPeaks[X data, Y data]\\nFindTroughs is used to determine minimums \
in the data and gives output as {x,y} data\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FindPeaks", "::", "usage"}], "=", 
   "\"\<FindPeaks[X data, Y data]\\nFindTroughs is used to determine minimums \
in the data and gives output as {x,y} data\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FindTroughs", "::", "usage"}], "=", 
   "\"\<FindTroughs[X data, Y data]\\nFindTroughs is used to determine \
minimums in the data and gives output as {x,y} data\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADInput", "::", "Usage"}], "=", "\"\<nb to do stuff\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADClearExtra", "::", "usage"}], "=", 
   "\"\<Use MADClear to clear variable names for re-assignment. This should \
be used to clear options associated with element definitions\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"genExtra", "::", "usage"}], "=", 
   "\"\<Generates extra Element information. INTERNAL\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADLength", "::", "usage"}], "=", 
   "\"\<MADLength[line]\\n\\nMADLength prints the total length of a line of \
elements\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADxytunes", "::", "usage"}], "=", 
   "\"\<MADxytunes[Tracking Data, Qx values, Qy values]\\nMADxytunes is used \
to create a list of {x,y,Qx,Qy} data. It will accept matrix data, and will \
output the appended data in the same matrix format.\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDelete", "::", "usage"}], "=", 
   "\"\<MADDelete[file, options]\\nMADDelete deletes lines from files. It can \
delete Tracking, Usemonitor, Twiss or Beam lines from a file.\\n Option \
\\\"Type\\\" is a rule which gives the type of lines to delete, Track, \
Monitor, Twiss or Beam\\ni.e. MADDelete[file, Type\[Rule]Beam]\\tDeletes all \
beam lines in \\\"file\\\"\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADMonitors", "::", "usage"}], "=", 
   "\"\<MADMonitors[data]\\nMADMonitors is used to create a list of all \
monitors in a Line.\>\""}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADLengthAdd", "::", "usage"}], "=", 
   "\"\<MADLengthAdd[Line]\\nAdds a column to Line printing the current \
Length of all elements upto that point\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDeleteMultiple", "::", "usage"}], "=", 
   "\"\<MADDeleteMultiple[List]\\nMADDeleteMultiple removes all repeated \
elements from an Element list. It returns the variable \[Epsilon], and is \
called from MADWrite\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADmakeMonitorList", "::", "usage"}], "=", 
   "\"\<MADmakeMonitorList[Line]\\nMADmakeMonitorList is used to create a \
list of all Monitor elements in a Line.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADUseMonitors", "::", "usage"}], "=", 
   "\"\<MADUseMonitors[Line,{Monitors}]\\nMADUseMonitors is a command to \
produce a \\\"usemonitor,on,\\\" MAD command.\n\\n{Monitors} should be a list \
of monitor names, as Strings.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADOrbitPlotFile", "::", "usage"}], "=", 
   "\"\<MADOrbitPlotFile[Filename, Line]\\nMADOrbitPlotFile is used to Plot \
MAD Orbit files. The data is automatically plotted against S.\\n\\nThe Line \
variable should be used to ensure that the monitor positions are plotted for \
the correct Element Line!\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADOrbitPlotLine", "::", "usage"}], "=", 
   "\"\<MADOrbitPlotLine[Line]\\nMADOrbitPlotLine is used to plot MAD Orbit \
data, and is called from MADOrbitPlotFile\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADPlot", "::", "usage"}], "=", 
   "\"\<MADPlot[Filename]\\nMADPlot imports and plots MAD \\\"PLOT\\\" \
command output .ps files.\>\""}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mfsPlot", "::", "usage"}], "=", 
   "\"\<mfsPlot[Variables,Options]\\nmfsPlot is used to plot variables \
defined from mfs Datafiles. mfsPlot can take any number of variables to plot, \
but it accepts variables only in list format.\\nTherefore all variable input \
should be either as a list variable (a={X,Y}; mfsPlot[a]), or as explicit \
Lists (mfsPlot[{X}]).\\n\\nmfsPlot takes as options - \
\\n\\tSurvey\[Rule]True/False. Where if True, plot variables against \
Z.\\n\\tLegend\[Rule]{Legend-Names}   Where Legend-Names are the names of the \
variables being plotted\\n\\tPlotstyle\[Rule]{Colour Definitions etc.} Where \
Plotstyle defines the style of the points to be plotted. (See PlotStyle Help)\
\\n\\tSymbolShape\[Rule]{Shape Definition}  Where Shape Definition is the \
shapes of the points to be ploted (See SymbolShape Help)\>\""}], 
  ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropLines", "::", "usage"}], "=", 
   "\"\<DropLines[FileName, Lines\[Rule](Number), \
Output\[Rule]FileNames]\\nDropLines is used to drop specific lines from a \
file.\\nThe option \\\"Output\\\" is used to change the output file. If no \
output file is given, the original file is overwritten.\\nIf no Lines are \
given, DropLines prints a table of the File showing Line Numbers\>\""}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADWriteErrors", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6513229483670273`*^9, 3.6513229521980276`*^9}}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Private", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Element Definitions", "Section"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UnsortedUnion", "[", "x_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "f", "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"Rule", "[", 
        RowBox[{"y_", ",", "z_"}], "]"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"y", ",", "_"}], "]"}], "]"}], "=", 
         RowBox[{"Sequence", "[", "]"}]}], ";", 
        RowBox[{"y", "\[Rule]", "z"}]}], ")"}]}], ";", 
     RowBox[{"f", "/@", "x"}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "MADErrors", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Global`MADdx", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADdy", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADds", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADdtheta", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADdphi", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADdpsi", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADmrex", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADmrey", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADradius", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADdbl", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Global`MADdkl", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"Global`MADdblr", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`MADbrot", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Global`MADrot", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"Global`MADdbln", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Global`MADdkln", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"Global`MADdbls", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Global`MADdkls", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"Global`MADEalign", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "Global`MADdx", ",", "Global`MADdy", ",", "Global`MADds", ",", 
       "Global`MADdtheta", ",", "Global`MADdphi", ",", "Global`MADdpsi", ",", 
       "Global`MADmrex", ",", "Global`MADmrey"}], "}"}]}], ",", 
    RowBox[{"Global`MADEfield", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Global`MADradius", ",", "Global`MADdbl", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Global`MADdkl", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
       "Global`MADdblr", ",", "Global`MADbrot", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Global`MADrot", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
       "Global`MADdbln", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Global`MADdkln", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
       "Global`MADdbls", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Global`MADdkls", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}]}], "}"}]}]}], 
   "}"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5152216690179853`*^9, 3.515221690721388*^9}, {
  3.655642342505104*^9, 
  3.6556423503771043`*^9}},ExpressionUUID->"6623892f-7eca-46e6-96f0-\
22d76922f4cd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "MADErrors", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\"\<dx\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<dy\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<ds\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<dtheta\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<dphi\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<dpsi\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<mrex\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<mrey\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<radius\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<dbl\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<etilt\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"\"\<dkl\>\"", "<>", 
          RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"\"\<dblr\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<brot\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"\"\<rot\>\"", "<>", 
          RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"\"\<dbln\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"\"\<dkln\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}]}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"\"\<dbls\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"\"\<dkls\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}]}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
    RowBox[{"\"\<HKICK\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"\"\<VKICK\>\"", "\[Rule]", "0"}], ",", 
    RowBox[{"Ealign", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<dx\>\"", ",", "\"\<dy\>\"", ",", "\"\<ds\>\"", ",", 
       "\"\<dtheta\>\"", ",", "\"\<dphi\>\"", ",", "\"\<dpsi\>\"", ",", 
       "\"\<mrex\>\"", ",", "\"\<mrey\>\""}], "}"}]}], ",", 
    RowBox[{"Efield", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<radius\>\"", ",", "\"\<dbl\>\"", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<dkl\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
       "\"\<dblr\>\"", ",", "\"\<brot\>\"", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<rot\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
       "\"\<dbln\>\"", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<dkln\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}], ",", 
       "\"\<dbls\>\"", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<dkls\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]}]}], "}"}]}]}], 
   "}"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5152216690179853`*^9, 3.515221690721388*^9}, {
  3.6513211239090276`*^9, 3.6513211602420273`*^9}, {3.651321217319028*^9, 
  3.651321444720028*^9}, {3.6556423204591045`*^9, 3.6556423294421043`*^9}, {
  3.675072703154123*^9, 3.675072706615123*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "MADOptions", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Global`XAp", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`YAp", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`PL", "\[Rule]", "0"}], ",", 
    RowBox[{"Global`PN", "\[Rule]", "4"}], ",", 
    RowBox[{"Global`Name", "\[Rule]", "\"\<\>\""}], ",", 
    RowBox[{"Global`Porder", "\[Rule]", "0"}], ",", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Global`PB", "[", "#", "]"}], "\[Rule]", "0"}], "&"}], "/@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"-", "#"}], "]"}], ",", "#"}], "]"}]}], "&"}], "[", 
      RowBox[{"Range", "[", "9", "]"}], "]"}], ")"}], ",", 
    RowBox[{"Global`Pthick", "\[Rule]", "False"}], ",", 
    RowBox[{"Global`Pirho", "\[Rule]", "0"}]}], "}"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", 
  RowBox[{
  "Global`PL", ",", "Global`PN", ",", "Global`Pthick", ",", "Global`PB"}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "MADElements", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Global`Quadrupoles", "\[Rule]", 
     RowBox[{"{", "}"}]}], ",", 
    RowBox[{"Global`Sextupoles", "\[Rule]", 
     RowBox[{"{", "}"}]}], ",", 
    RowBox[{"Global`Dipoles", "\[Rule]", 
     RowBox[{"{", "}"}]}]}], "}"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADOptions", "[", 
   RowBox[{"name_", ",", "var___Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"MADOptions", "[", 
    RowBox[{"Evaluate", "[", 
     RowBox[{"ToString", "[", "name", "]"}], "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{"MADOptions", "[", "name", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"UnsortedUnion", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "var", "}"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ListQ", "[", 
                RowBox[{"MADOptions", "[", "name", "]"}], "]"}], ",", 
               RowBox[{"MADOptions", "[", "name", "]"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], "]"}], "]"}], "}"}], "]"}], ",", 
        RowBox[{"Options", "[", "MADOptions", "]"}]}], "]"}]}], 
     "}"}]}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOptions", "[", 
   RowBox[{"name_", ",", "var_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"var", "/.", 
    RowBox[{"MADOptions", "[", "name", "]"}]}], "/.", 
   RowBox[{"Options", "[", "MADOptions", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOptions", "[", 
   RowBox[{"name_", ",", "Global`PB"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Global`PB", "[", "#", "]"}], "&"}], "/@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"-", "#"}], "]"}], ",", "#"}], "]"}]}], "&"}], "[", 
      RowBox[{"Range", "[", "9", "]"}], "]"}], ")"}], "/.", 
    RowBox[{"MADOptions", "[", "name", "]"}]}], "/.", 
   RowBox[{"Options", "[", "MADOptions", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOptions", "[", "]"}], ":=", 
  RowBox[{"Definition", "[", "MADOptions", "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"SetMADErrors", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"Global`Quadrupoles", ",", "var___Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"#", "\[Rule]", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"\"\<MADErrors[\>\"", "<>", 
        RowBox[{"ToString", "[", "#", "]"}], "<>", 
        "\"\<,All]={FilterOptions[MADErrors,\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"{", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"{", "var", "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=",
                "0"}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=",
                "0."}]}], "&"}]}], "]"}], "}"}], "]"}], "<>", "\"\<]}\>\""}], 
       "]"}]}], ")"}], "&"}], "/@", 
   RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"Global`Sextupoles", ",", "var___Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"#", "\[Rule]", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"\"\<MADErrors[\>\"", "<>", 
        RowBox[{"ToString", "[", "#", "]"}], "<>", 
        "\"\<,All]={FilterOptions[MADErrors,\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"{", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"{", "var", "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=",
                "0"}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=",
                "0."}]}], "&"}]}], "]"}], "}"}], "]"}], "<>", "\"\<]}\>\""}], 
       "]"}]}], ")"}], "&"}], "/@", 
   RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"Global`Dipoles", ",", "var___Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"#", "\[Rule]", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"\"\<MADErrors[\>\"", "<>", 
        RowBox[{"ToString", "[", "#", "]"}], "<>", 
        "\"\<,All]={FilterOptions[MADErrors,\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"{", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"{", "var", "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=",
                "0"}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=",
                "0."}]}], "&"}]}], "]"}], "}"}], "]"}], "<>", "\"\<]}\>\""}], 
       "]"}]}], ")"}], "&"}], "/@", 
   RowBox[{"MADElements", "[", "Global`Dipoles", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"name_", ",", "Clear"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"MADErrors", "[", "name", "]"}], "=", 
   RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"name_", ",", 
    RowBox[{"no_:", "Integer"}], ",", "Clear"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"MADErrors", "[", 
    RowBox[{
     RowBox[{"HoldForm", "[", "name", "]"}], ",", "no"}], "]"}], "=", 
   RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"name_String", ",", 
    RowBox[{"no_:", "Integer"}], ",", "Clear"}], "]"}], ":=", 
  RowBox[{"ToExpression", "[", 
   RowBox[{"\"\<MADErrors[\>\"", "<>", "name", "<>", "\"\<,\>\"", "<>", 
    RowBox[{"ToString", "[", "no", "]"}], "<>", "\"\<]={}\>\""}], 
   "]"}]}]}], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4776587463716974`*^9, 3.4776587489498224`*^9}, {
   3.4776588781060724`*^9, 3.4776588900591974`*^9}, {3.4776589476373224`*^9, 
   3.4776589550123224`*^9}, {3.554631424895176*^9, 3.5546314310667353`*^9}, 
   3.554631901417652*^9, {3.6513226324030275`*^9, 3.6513226442900276`*^9}, {
   3.6513227256690273`*^9, 3.6513227453560276`*^9}, {3.6513228273270273`*^9, 
   3.6513228301180277`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"All", ",", "Clear"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"DownValues", "[", "MADErrors", "]"}], "=", 
   RowBox[{"{", "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4776587463716974`*^9, 3.4776587489498224`*^9}, {
  3.4776588781060724`*^9, 3.4776588900591974`*^9}, {3.4776589476373224`*^9, 
  3.4776589550123224`*^9}, {3.515149598042748*^9, 3.515149621558674*^9}, {
  3.651322622588028*^9, 3.6513226241880274`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"name_", ",", 
    RowBox[{"no_", ":", "Integer"}], ",", "var___Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"MADErrors", "[", 
    RowBox[{
     TagBox["name",
      HoldForm], ",", "no"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"Sequence", "[", 
          RowBox[{"{", "var", "}"}], "]"}], "}"}], "]"}], ",", 
       RowBox[{"Options", "[", "MADErrors", "]"}]}], "]"}]}], 
    "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6513215546240273`*^9, 3.6513215547840276`*^9}, 
   3.651321851109028*^9, {3.651400667513241*^9, 3.6514006954942408`*^9}, 
   3.651562881436408*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADErrors", "[", 
   RowBox[{"name_", ",", "var___Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"MADErrors", "[", "name", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
           "\[Equal]", "0"}], ",", 
          RowBox[{"{", "}"}], ",", "#"}], "]"}], "&"}], "/@", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "var", "}"}], "]"}], ",", 
             RowBox[{"Options", "[", "MADErrors", "]"}]}], "]"}], ",", 
           RowBox[{"GetMADErrors", "[", "name", "]"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
           "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "===", 
           RowBox[{
           "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
          "&"}]}], "]"}]}], "]"}]}], "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4776587463716974`*^9, 3.4776587489498224`*^9}, {
   3.4776588781060724`*^9, 3.4776588900591974`*^9}, {3.4776590547466974`*^9, 
   3.4776590976216974`*^9}, {3.4776591465279474`*^9, 
   3.4776591686216974`*^9}, {3.4776592033716974`*^9, 
   3.4776592046373224`*^9}, {3.4776592421841974`*^9, 
   3.4776592486841974`*^9}, {3.4776649576373224`*^9, 
   3.4776649731373224`*^9}, {3.4776650408404474`*^9, 
   3.4776650478248224`*^9}, {3.6514003759402065`*^9, 
   3.6514003764902015`*^9}, {3.6514006627812405`*^9, 3.651400663921241*^9}, 
   3.651400715028241*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", "name_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ListQ", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"{", "}"}]}], "]"}], "&"}], "[", 
   RowBox[{"MADErrors", "[", "name", "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4553484954650054`*^9, 3.4553485233712554`*^9}, 
   3.4776586136216974`*^9, {3.651400829025241*^9, 3.651400829967241*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", "name_String", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ListQ", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"{", "}"}]}], "]"}], "&"}], "[", 
   RowBox[{"ToExpression", "[", 
    RowBox[{"\"\<MADErrors[\>\"", "<>", "name", "<>", "\"\<]\>\""}], "]"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4553484954650054`*^9, 3.4553485233712554`*^9}, 
   3.4776586136216974`*^9, {3.515144809125921*^9, 3.5151448233761945`*^9}, {
   3.5151448818148165`*^9, 3.515144882517955*^9}, {3.6514007532712407`*^9, 
   3.6514007626192408`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", "All", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "\[Rule]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"\"\<MADErrors[\>\"", "<>", 
          RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<]\>\""}], "]"}], 
        ",", 
        RowBox[{"{", "}"}]}], "]"}], "]"}]}], "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}], ",", 
      RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}], ",", 
      RowBox[{"MADElements", "[", "Global`Dipoles", "]"}]}], "}"}], 
    "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4553484983868804`*^9, {3.693813291146037*^9, 3.693813296499108*^9}, {
   3.693813339747756*^9, 3.693813345676441*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", "Global`Quadrupoles", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "\[Rule]", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"\"\<MADErrors[\>\"", "<>", 
       RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<]\>\""}], "]"}]}], 
    "&"}], "/@", 
   RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4553484989493804`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", "Global`Sextupoles", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "\[Rule]", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"\"\<MADErrors[\>\"", "<>", 
       RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<]\>\""}], "]"}]}], 
    "&"}], "/@", 
   RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4553484994493804`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", "Global`Dipoles", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "\[Rule]", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"\"\<MADErrors[\>\"", "<>", 
       RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<]\>\""}], "]"}]}], 
    "&"}], "/@", 
   RowBox[{"MADElements", "[", "Global`Dipoles", "]"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4553484999181304`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", 
   RowBox[{"name_", ",", 
    RowBox[{"no_:", "Integer"}], ",", "var_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"var", "/.", 
    RowBox[{"MADErrors", "[", 
     RowBox[{
      RowBox[{"HoldForm", "[", "name", "]"}], ",", "no"}], "]"}]}], "/.", 
   RowBox[{"{", 
    RowBox[{"var", "\[Rule]", "0"}], "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4553485004181304`*^9, {3.4776588389498224`*^9, 3.4776588438560724`*^9}, 
   3.6513218753560276`*^9, {3.6513220669750276`*^9, 3.6513220709430275`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", 
   RowBox[{"name_", ",", "var_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"var", "/.", 
    RowBox[{"MADErrors", "[", "name", "]"}]}], "/.", 
   RowBox[{"{", 
    RowBox[{"var", "\[Rule]", "0"}], "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4553482165900054`*^9, 3.4553482168243804`*^9}, {
   3.4553482550743804`*^9, 3.4553482591056304`*^9}, {3.4553483602618804`*^9, 
   3.4553483609962554`*^9}, 3.4553484486056304`*^9, 3.4553485016993804`*^9, 
   3.4776588496529474`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", 
   RowBox[{"name_String", ",", 
    RowBox[{"no_:", "Integer"}], ",", "var_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"var", "/.", 
    RowBox[{"ToExpression", "[", 
     RowBox[{
     "\"\<MADErrors[HoldForm[\>\"", "<>", "name", "<>", "\"\<],\>\"", "<>", 
      RowBox[{"ToString", "[", "no", "]"}], "<>", "\"\<]\>\""}], "]"}]}], "/.", 
   RowBox[{"{", 
    RowBox[{"var", "\[Rule]", "0"}], "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4553485004181304`*^9, {3.4776588389498224`*^9, 3.4776588438560724`*^9}, {
   3.515144833251384*^9, 3.5151448527830095`*^9}, 3.5151448880805616`*^9, {
   3.6513219004740276`*^9, 3.651321912937028*^9}, {3.6513220953900275`*^9, 
   3.651322101005028*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMADErrors", "[", 
   RowBox[{"name_String", ",", "var_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"var", "/.", 
    RowBox[{"ToExpression", "[", 
     RowBox[{"\"\<MADErrors[\>\"", "<>", "name", "<>", "\"\<]\>\""}], "]"}]}],
    "/.", 
   RowBox[{"{", 
    RowBox[{"var", "\[Rule]", "0"}], "}"}]}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4553482165900054`*^9, 3.4553482168243804`*^9}, {
   3.4553482550743804`*^9, 3.4553482591056304`*^9}, {3.4553483602618804`*^9, 
   3.4553483609962554`*^9}, 3.4553484486056304`*^9, 3.4553485016993804`*^9, 
   3.4776588496529474`*^9, {3.5151448572830954`*^9, 3.51514485959564*^9}, 
   3.515144889674342*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADElements", "[", "var___List", "]"}], ":=", 
  RowBox[{
   RowBox[{"MADElements", "[", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Flatten", "[", "var", "]"}]}], "}"}], "]"}], ",", 
       RowBox[{"Options", "[", "MADElements", "]"}]}], "]"}]}], 
    "}"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Global`Quadrupoles", "/.", 
     RowBox[{"MADElements", "[", "]"}]}], "/.", 
    RowBox[{"Options", "[", "MADElements", "]"}]}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Global`Sextupoles", "/.", 
     RowBox[{"MADElements", "[", "]"}]}], "/.", 
    RowBox[{"Options", "[", "MADElements", "]"}]}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElements", "[", "Global`Dipoles", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Global`Dipoles", "/.", 
     RowBox[{"MADElements", "[", "]"}]}], "/.", 
    RowBox[{"Options", "[", "MADElements", "]"}]}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADElements", "[", 
   RowBox[{"Quadrupole", ",", "name_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{"MemberQ", "[", 
      RowBox[{
       RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}], ",", 
       RowBox[{"HoldForm", "[", "name", "]"}]}], "]"}]}], ",", 
    RowBox[{"SetMADElements", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Global`Quadrupoles", "\[Rule]", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}], ",", 
          RowBox[{"HoldForm", "[", "name", "]"}]}], "]"}]}], ",", 
       RowBox[{"Global`Sextupoles", "\[Rule]", 
        RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}]}], ",", 
       RowBox[{"Global`Dipoles", "\[Rule]", 
        RowBox[{"MADElements", "[", "Global`Dipoles", "]"}]}]}], "}"}], 
     "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADElements", "[", 
   RowBox[{"Sextupole", ",", "name_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{"MemberQ", "[", 
      RowBox[{
       RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}], ",", 
       RowBox[{"HoldForm", "[", "name", "]"}]}], "]"}]}], ",", 
    RowBox[{"SetMADElements", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Global`Quadrupoles", "\[Rule]", 
        RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}]}], ",", 
       RowBox[{"Global`Sextupoles", "\[Rule]", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}], ",", 
          RowBox[{"HoldForm", "[", "name", "]"}]}], "]"}]}], ",", 
       RowBox[{"Global`Dipoles", "\[Rule]", 
        RowBox[{"MADElements", "[", "Global`Dipoles", "]"}]}]}], "}"}], 
     "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetMADElements", "[", 
   RowBox[{"Dipole", ",", "name_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{"MemberQ", "[", 
      RowBox[{
       RowBox[{"MADElements", "[", "Global`Dipoles", "]"}], ",", 
       RowBox[{"HoldForm", "[", "name", "]"}]}], "]"}]}], ",", 
    RowBox[{"SetMADElements", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Global`Quadrupoles", "\[Rule]", 
        RowBox[{"MADElements", "[", "Global`Quadrupoles", "]"}]}], ",", 
       RowBox[{"Global`Sextupoles", "\[Rule]", 
        RowBox[{"MADElements", "[", "Global`Sextupoles", "]"}]}], ",", 
       RowBox[{"Global`Dipoles", "\[Rule]", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"MADElements", "[", "Global`Dipoles", "]"}], ",", 
          RowBox[{"HoldForm", "[", "name", "]"}]}], "]"}]}]}], "}"}], "]"}]}],
    "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"genExtra", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"genExtra", "[", 
   RowBox[{"name_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tilt", ",", "xap", ",", "yap"}], "}"}], ",", 
    RowBox[{
     RowBox[{"xap", "=", 
      RowBox[{
       RowBox[{"Global`XAp", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`XAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"yap", "=", 
      RowBox[{
       RowBox[{"Global`YAp", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`YAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tilt", "=", 
      RowBox[{
       RowBox[{"Global`Tilt", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Tilt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", "name", "]"}], "<>", "\"\<Extra\>\""}], 
          ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
       "name", ",", "\"\<Extra\>\"", ",", "xap", ",", "yap", ",", "tilt"}], 
       "]"}]}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ealignFields", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<dx\>\"", ",", "\"\<dy\>\"", ",", "\"\<ds\>\"", ",", "\"\<dphi\>\"", 
     ",", "\"\<dtheta\>\"", ",", "\"\<dpsi\>\"", ",", "\"\<mrex\>\"", ",", 
     "\"\<mrey\>\""}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4776658399654474`*^9, 3.4776658733716974`*^9}, {
  3.6513209783410273`*^9, 3.6513210075230274`*^9}, {3.6513210813030276`*^9, 
  3.6513210925420275`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"efieldFields", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<order\>\"", ",", "\"\<radius\>\"", ",", "\"\<dbl\>\"", ",", 
     "\"\<dkl\>\"", ",", "\"\<dklr\>\"", ",", "\"\<dklr\>\"", ",", 
     "\"\<brot\>\"", ",", "\"\<rot\>\""}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4776658399654474`*^9, 3.4776658733716974`*^9}, {
  3.4776660676060724`*^9, 3.4776661297623224`*^9}, {3.4776661630123224`*^9, 
  3.4776661645435724`*^9}, {3.6513210104590273`*^9, 3.6513210212190275`*^9}, {
  3.6513210685120277`*^9, 3.6513210792470274`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"efcompFields", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<order\>\"", ",", "\"\<radius\>\"", ",", "\"\<dbln\>\"", ",", 
     "\"\<dkln\>\"", ",", "\"\<dbls\>\"", ",", "\"\<dkls\>\"", ",", 
     "\"\<dblnr\>\"", ",", "\"\<dklnr\>\"", ",", "\"\<dblsr\>\"", ",", 
     "\"\<dklsr\>\"", ",", "\"\<brot\>\"", ",", "\"\<rot\>\""}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4776658399654474`*^9, 3.4776658733716974`*^9}, {
  3.4776660676060724`*^9, 3.4776661979498224`*^9}, {3.6513210227070274`*^9, 
  3.6513210660080276`*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"errorWriteealign", ",", "errorWriteefield"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.651390207891134*^9, 3.651390212437134*^9}, {
  3.651390838160134*^9, 3.651390841601134*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"errorWriteealign", ",", "errorWriteefield"}], "}"}], ",", 
    "HoldFirst"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6513906920971336`*^9, 3.651390698054134*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"errorWriteealign", "[", "rules_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "rules", "]"}], ">", "0"}], "&&", 
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", 
          RowBox[{"rules", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "]"}], ">", 
        "0"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<ealign\>\"", "<>", 
       RowBox[{"StringJoin", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<,\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "<>", "\"\<=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"NumberRight", "[", 
             RowBox[{"Evaluate", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], "]"}], "]"}]}], "&"}], "/@", "rules"}], "]"}], "<>", 
       "\"\<;\\n\>\""}], ",", "\"\<\>\""}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4776656979029474`*^9, 3.4776657728873224`*^9}, {
   3.4776658195591974`*^9, 3.4776658370435724`*^9}, {3.4776658779810724`*^9, 
   3.4776660518248224`*^9}, {3.4776662297779474`*^9, 
   3.4776662699029474`*^9}, {3.4776671671841974`*^9, 
   3.4776671751060724`*^9}, {3.6513209580390277`*^9, 
   3.6513209594170275`*^9}, {3.6513872193578124`*^9, 
   3.6513872222387547`*^9}, {3.6513872802388487`*^9, 3.651387284069811*^9}, {
   3.651390002680134*^9, 3.6513900271981335`*^9}, {3.6513900792471337`*^9, 
   3.651390083508134*^9}, {3.651390138579134*^9, 3.6513901793991337`*^9}, 
   3.6513902744531336`*^9, {3.6513903060691338`*^9, 3.651390367468134*^9}, {
   3.651390413577134*^9, 3.651390481185134*^9}, {3.6513905396581335`*^9, 
   3.651390569723134*^9}, 3.651390609315134*^9, {3.651390669789134*^9, 
   3.651390670749134*^9}, {3.6513907109341335`*^9, 3.6513907112741337`*^9}, {
   3.6513907862171335`*^9, 3.6513907884061337`*^9}, {3.6513909185431337`*^9, 
   3.6513909187151337`*^9}, {3.651391198732134*^9, 3.6513912103731337`*^9}, {
   3.6513988105862103`*^9, 3.6513988276580396`*^9}, {3.6513988943673735`*^9, 
   3.651398936951948*^9}, {3.651398975683562*^9, 3.6513991590827303`*^9}, {
   3.651399212912193*^9, 3.651399214082181*^9}, {3.651400117882237*^9, 
   3.651400119262237*^9}, {3.651562969462408*^9, 3.651563007212408*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"errorWriteefield", "[", "rules_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "rules", "]"}], ">", "0"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<efield\>\"", "<>", 
       RowBox[{"StringJoin", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<,\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "<>", "\"\<=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"NumberRight", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], "]"}]}], "&"}], "/@", "rules"}], "]"}], "<>", 
       "\"\<;\\n\>\""}], ",", "\"\<\>\""}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4776656979029474`*^9, 3.4776657728873224`*^9}, {
   3.4776658195591974`*^9, 3.4776658370435724`*^9}, {3.4776658779810724`*^9, 
   3.4776660518248224`*^9}, {3.4776662160591974`*^9, 
   3.4776662236060724`*^9}, {3.4776669647623224`*^9, 
   3.4776669675279474`*^9}, {3.4776670866841974`*^9, 3.4776671136060724`*^9}, 
   3.4776671493091974`*^9, 3.6513209613830276`*^9, {3.651387218367832*^9, 
   3.65138722447871*^9}, {3.6513900018801336`*^9, 3.6513900744741335`*^9}, 
   3.6513901440071335`*^9, {3.6513901757431335`*^9, 3.6513901814061337`*^9}, {
   3.6513902774011335`*^9, 3.651390279061134*^9}, {3.6513904848161335`*^9, 
   3.6513904903281336`*^9}, {3.651390537204134*^9, 3.651390537395134*^9}, {
   3.651390581643134*^9, 3.6513906063941336`*^9}, {3.651390674442134*^9, 
   3.651390675093134*^9}, {3.6513907133751335`*^9, 3.6513907136951337`*^9}, {
   3.651400116947237*^9, 3.651400121072237*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"errorWriteefcomp", "[", "rules_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "rules", "]"}], ">", "0"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<efcomp\>\"", "<>", 
       RowBox[{"StringJoin", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<,\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "<>", "\"\<=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"NumberRight", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], "]"}]}], "&"}], "/@", "rules"}], "]"}], "<>", 
       "\"\<;\\n\>\""}], ",", "\"\<\>\""}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4776656979029474`*^9, 3.4776657728873224`*^9}, {
   3.4776658195591974`*^9, 3.4776658370435724`*^9}, {3.4776658779810724`*^9, 
   3.4776660518248224`*^9}, {3.4776662181060724`*^9, 
   3.4776662197935724`*^9}, {3.4776670574498224`*^9, 
   3.4776670753404474`*^9}, {3.4776671794966974`*^9, 3.4776671815748224`*^9}, 
   3.6513209621180277`*^9, 3.651390000980134*^9, {3.651390524410134*^9, 
   3.6513905463891335`*^9}, {3.651390582876134*^9, 3.651390610325134*^9}, {
   3.651390678785134*^9, 3.6513906794651337`*^9}, {3.651390716245134*^9, 
   3.651390716565134*^9}, {3.651400108468237*^9, 3.651400111810237*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "MADWriteErrors", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MADWriteErrors", "[", 
   RowBox[{
    RowBox[{"filename_:", "\"\<\>\""}], ",", 
    RowBox[{"eopt_:", "True"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"file", ",", "errors", ",", "errorsindividual"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"filename", "===", "\"\<\>\""}], ",", 
       RowBox[{"file", "=", "MADFileName"}], ",", 
       RowBox[{"file", "=", "filename"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"errors", "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"GetMADErrors", "[", "All", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=!=", 
           RowBox[{"{", "}"}]}], "&&", 
          RowBox[{"Not", "[", 
           RowBox[{
            RowBox[{"Head", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "===", "MADErrors"}], 
           "]"}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"errorsindividual", "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"DownValues", "[", "MADErrors", "]"}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"HoldPattern", "[", 
             RowBox[{"MADErrors", "[", 
              RowBox[{
               TagBox["z_",
                HoldForm], ",", "y_"}], "]"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"{", 
            RowBox[{"x", ",", "y", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"StringQ", "[", "z", "]"}], ",", "z", ",", 
               RowBox[{"z", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
          ",", "\[Infinity]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", "0"}], "&&", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"Abs", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], 
            "]"}], ">", "0"}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"eopt", ",", 
       RowBox[{"MADStringWrite", "[", 
        RowBox[{"file", ",", "\"\<EOPT,ADD=TRUE\n\>\""}], "]"}]}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"err", "=", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"\"\<select,error,pattern=\\\"\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], "<>", "\"\<\\\";\\n\>\""}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"errorWriteealign", "[", 
             RowBox[{"Select", "[", 
              RowBox[{"err", ",", 
               RowBox[{
                RowBox[{"Or", "@@", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"ealignFields", ",", 
                   RowBox[{"ToString", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], "&"}]}], 
              "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"errorWriteefield", "[", 
             RowBox[{"Select", "[", 
              RowBox[{"err", ",", 
               RowBox[{
                RowBox[{"Or", "@@", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"efieldFields", ",", 
                   RowBox[{"ToString", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], "&"}]}], 
              "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"errorWriteefcomp", "[", 
             RowBox[{"Select", "[", 
              RowBox[{"err", ",", 
               RowBox[{
                RowBox[{"Or", "@@", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"efcompFields", ",", 
                   RowBox[{"ToString", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], "&"}]}], 
              "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", "\"\<select,error,clear;\\n\>\""}], "]"}]}]}],
         "]"}], "&"}], "/@", "errors"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"err", "=", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"Abs", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ">", "0"}], 
              "&"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"\"\<select,error,\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              "]"}], "<>", "\"\<[\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], "<>", "\"\<];\\n\>\""}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"errorWriteealign", "[", 
             RowBox[{"Select", "[", 
              RowBox[{"err", ",", 
               RowBox[{
                RowBox[{"Or", "@@", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"ealignFields", ",", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"err", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}], "&"}]}], "]"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"errorWriteefield", "[", 
             RowBox[{"Select", "[", 
              RowBox[{"err", ",", 
               RowBox[{
                RowBox[{"Or", "@@", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"efieldFields", ",", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"err", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}], "&"}]}], "]"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", 
            RowBox[{"errorWriteefcomp", "[", 
             RowBox[{"Select", "[", 
              RowBox[{"err", ",", 
               RowBox[{
                RowBox[{"Or", "@@", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"efcompFields", ",", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"err", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}], "&"}]}], "]"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"MADStringWrite", "[", 
           RowBox[{"file", ",", "\"\<select,error,clear;\\n\>\""}], "]"}]}]}],
         "]"}], "&"}], "/@", "errorsindividual"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAWIQ/elJ0zq5ly8dPz05sBFMp1zeCuF/3Amhd9vLg8Un
B4HpJzoREP4NKF0cB6ElkiA0RxaEXj0RQl+bBaGvz4bKL4OYY7gcat5qiPiq
dRD66n4IrXEARE9xz1rgCqY/gukVQtPNIkxeO27Y1+wLoiu4goNB9Ju510NA
dNNDrXoQvd1+YwNEXLkNok4bTN+S6p4Iojl+9IPp1dZhT8qBdPw1vqcgOuFR
2OxKIM3wV3QOiE6xyF0Colccll0GorVbNmwE0XMOdu0A0Y/Kjx0H0Xn8vmdB
9GWvPXdB9M3ThvdA9CFjqxm1QHrWCduZIFprW8hTEN1RcOw5iBZoF+atA9Ih
QjvEQLTxoY0TFwHp/oueU0H0qezMO2eBdJpB0HMQrVPD+w7C/wamAYE+7x4=

  "]],

Cell[CellGroupData[{

Cell["Quad", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Unprotect", "[", "quad", "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"quad", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.463295406047577*^9, 3.463295412032067*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"quad", "[", 
   RowBox[{
    RowBox[{"name_:", "Quad"}], ",", "L_", ",", "Focus_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"name2", ",", "Extra2"}], "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Quadrupole\>\"",
             ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Quadrupole\>\"",
             ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Options", "[", 
       RowBox[{"Symbol", "@", 
        RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
      RowBox[{"Select", "[", 
       RowBox[{"Extra", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "==", "Rule"}], "&"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"quad", "[", 
   RowBox[{
    RowBox[{"name_:", "Quad"}], ",", "L_", ",", "Focus_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"thin", ",", "name2", ",", "delayed"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"thin", "=", 
      RowBox[{
       RowBox[{"Global`Thin", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Thin", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"delayed", "=", 
      RowBox[{
       RowBox[{"Global`Delayed", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Delayed", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "name", "]"}], "===", "3"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"name2", "=", 
           RowBox[{"StringDrop", "[", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"name", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
             RowBox[{"-", "6"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{"name2", "<>", "\"\<lens\>\""}], ")"}], "]"}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{"name2", "<>", "\"\<drift1\>\""}], ")"}], "]"}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", "name", "]"}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"name2", "=", 
           RowBox[{"ToString", "[", 
            RowBox[{"name", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", "name", "]"}], ";"}]}], "]"}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"SetMADOptions", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Symbol", "@", 
         RowBox[{"ToString", "[", "name", "]"}]}], "]"}], ",", "Extra", ",", 
       RowBox[{"Global`Name", "\[Rule]", 
        RowBox[{"ToString", "[", "name", "]"}]}], ",", 
       RowBox[{"Order", "\[Rule]", "2"}], ",", 
       RowBox[{
        RowBox[{"K", "[", "2", "]"}], "\[Rule]", "Focus"}], ",", 
       RowBox[{"Thick", "\[Rule]", 
        RowBox[{"Not", "[", "Global`Thin", "]"}]}], ",", 
       RowBox[{"Global`L", "\[Rule]", "L"}], ",", 
       RowBox[{"Global`Kl", "\[Rule]", 
        RowBox[{"focus", "*", "l"}]}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"SetMADErrors", "[", 
      RowBox[{"name", ",", "Clear"}], "]"}], ";", 
     RowBox[{"SetMADElements", "[", 
      RowBox[{"Quadrupole", ",", 
       RowBox[{"ToExpression", "[", "name", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"thin", "===", "True"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drift", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"(", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", "name2", "]"}], "<>", 
               "\"\<drift1\>\""}], ")"}]}], ")"}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{"L", "/", "2"}], ")"}], ",", "\"\<\>\""}], "]"}], ";", 
        RowBox[{"multipole", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", "name2", "]"}], "<>", "\"\<lens\>\""}],
              ")"}]}], "]"}], ",", "0", ",", "\"\<\>\"", ",", 
          RowBox[{"Global`LRAD", "\[Rule]", 
           RowBox[{"(", "L", ")"}]}], ",", 
          RowBox[{"Global`K1L", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"Focus", "*", "L"}], ")"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"(", 
                RowBox[{"Symbol", "@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"ToString", "[", 
                    RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
                   "\"\<drift1\>\""}], ")"}]}], ")"}], "]"}], ",", 
              RowBox[{"Evaluate", "[", 
               RowBox[{"Symbol", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"ToString", "[", "name2", "]"}], "<>", 
                  "\"\<lens\>\""}], ")"}]}], "]"}], ",", 
              RowBox[{"Evaluate", "[", 
               RowBox[{"(", 
                RowBox[{"Symbol", "@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"ToString", "[", "name2", "]"}], "<>", 
                   "\"\<drift1\>\""}], ")"}]}], ")"}], "]"}]}], "}"}], "]"}], 
           ",", "7"}], "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
         "\"\<Evaluate[Symbol@ToString[\>\"", "<>", "name2", "<>", 
          "\"\<]]\>\"", "<>", 
          RowBox[{"If", "[", 
           RowBox[{"delayed", ",", "\"\<:\>\"", ",", "\"\<\>\""}], "]"}], 
          "<>", "\"\<={{\\\"\>\"", "<>", "name2", "<>", 
          "\"\<\\\",\\\"Quadrupole\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "L", "]"}], "]"}], "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "@", "Focus"}], "<>", 
          "\"\<,\\\"---\\\",\\\"---\\\",\\\"\>\"", "<>", "Type", "<>", 
          "\"\<\\\"}};\>\""}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4553691496820307`*^9, 3.4553691874789057`*^9, {3.4553692207132807`*^9, 
   3.4553692286507807`*^9}, {3.4553692886820307`*^9, 
   3.4553693254164057`*^9}, {3.4553694177289057`*^9, 
   3.4553694266820307`*^9}, {3.4553695032601557`*^9, 
   3.4553695072132807`*^9}, {3.4553695464164057`*^9, 
   3.4553696214789057`*^9}, {3.4553696818851557`*^9, 
   3.4553697816195307`*^9}, {3.4553698163226557`*^9, 
   3.4553698178382807`*^9}, {3.4553698490726557`*^9, 
   3.4553698492601557`*^9}, {3.4553703354476557`*^9, 
   3.4553703863226557`*^9}, {3.4553704208539057`*^9, 
   3.4553705060726557`*^9}, {3.4553705399945307`*^9, 3.4553707138851557`*^9}, 
   3.4632051729736195`*^9, 3.463205419400226*^9, 3.4632947032840843`*^9, {
   3.4632953576872735`*^9, 3.463295367218706*^9}, 3.4632954759395437`*^9, {
   3.4637409058263474`*^9, 3.4637409196234875`*^9}, 3.4639855014015765`*^9, {
   3.463985723454136*^9, 3.4639857661739798`*^9}, {3.4776589637154474`*^9, 
   3.4776589644810724`*^9}, {3.5106427601658874`*^9, 3.510642856652115*^9}, 
   3.5106429897484207`*^9, {3.5106430393743734`*^9, 3.5106430404056425`*^9}, {
   3.5546314583778367`*^9, 3.5546315031255455`*^9}, {3.554631533170882*^9, 
   3.554631551748056*^9}, {3.5546315902773333`*^9, 3.554631593386549*^9}, 
   3.554631655883349*^9, {3.5546318713879395`*^9, 3.554631871544182*^9}, {
   3.602399198173768*^9, 3.6023991983567677`*^9}, {3.6145137854053683`*^9, 
   3.614513789172368*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", "quad", "]"}], ";"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Drift", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "drift", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"drift", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"csrdrift", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.6977845978394513`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"drift", "[", 
   RowBox[{
    RowBox[{"name_:", "Drift"}], ",", "L_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Drift\>\"", ",",
             "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"NumberQ", "[", "L", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Drift\>\"", 
              ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
              "\"\<---\>\"", ",", 
              RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Drift\>\"", 
              ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
              "\"\<---\>\"", ",", 
              RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}]}], 
         "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.6514729476703835`*^9, {3.6514739482424307`*^9, 3.6514739649311*^9}, 
   3.6514894102353935`*^9, {3.697784505791045*^9, 3.6977845093582582`*^9}, 
   3.697784540027391*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"csrdrift", "[", 
   RowBox[{
    RowBox[{"name_:", "Drift"}], ",", "L_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<CSRDrift\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"NumberQ", "[", "L", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<CSRDrift\>\"",
               ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
              "\"\<---\>\"", ",", 
              RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<CSRDrift\>\"",
               ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
              "\"\<---\>\"", ",", 
              RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}]}], 
         "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.6514729476703835`*^9, {3.6514739482424307`*^9, 3.6514739649311*^9}, 
   3.6514894102353935`*^9, {3.6977831869558306`*^9, 3.6977831907955985`*^9}, {
   3.697783643538129*^9, 3.6977836442852783`*^9}, {3.6977845165346937`*^9, 
   3.697784528095005*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "drift", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["YROT", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "yrot", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"yrot", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"yrot", "[", 
   RowBox[{
    RowBox[{"name_:", "YROT"}], ",", "Angle_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<YROT\>\"", ",", 
            "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<YROT\>\"", ",", 
            "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "yrot", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["SROT", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "srot", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"srot", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"srot", "[", 
   RowBox[{
    RowBox[{"name_:", "SROT"}], ",", "Angle_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<SROT\>\"", ",", 
            "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<SROT\>\"", ",", 
            "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "srot", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["ECOLL", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "ecoll", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"ecoll", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ecoll", "[", 
   RowBox[{
    RowBox[{"name_:", "ECOLL"}], ",", "L_", ",", "XSIZE_", ",", "YSIZE_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", 
            "\"\<ECOLLIMATOR\>\"", ",", "L", ",", "\"\<---\>\"", ",", "XSIZE",
             ",", "YSIZE", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", 
            "\"\<ECOLLIMATOR\>\"", ",", "L", ",", "\"\<---\>\"", ",", "XSIZE",
             ",", "YSIZE", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", 
       RowBox[{"Global`XAp", "\[Rule]", "XSIZE"}], ",", 
       RowBox[{"Global`YAp", "\[Rule]", "YSIZE"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "ecoll", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["RCOLL", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "rcoll", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"rcoll", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"rcoll", "[", 
   RowBox[{
    RowBox[{"name_:", "RCOLL"}], ",", "L_", ",", "XSIZE_", ",", "YSIZE_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", 
            "\"\<RCOLLIMATOR\>\"", ",", "L", ",", "\"\<---\>\"", ",", "XSIZE",
             ",", "YSIZE", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", 
            "\"\<RCOLLIMATOR\>\"", ",", "L", ",", "\"\<---\>\"", ",", "XSIZE",
             ",", "YSIZE", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", 
       RowBox[{"Global`XAp", "\[Rule]", "XSIZE"}], ",", 
       RowBox[{"Global`YAp", "\[Rule]", "YSIZE"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "rcoll", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Marker, Instrument & Wire", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"marker", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"marker", "[", 
   RowBox[{
    RowBox[{"name_:", "Marker"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Marker\>\"", 
            ",", "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Marker\>\"", 
            ",", "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"wire", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"wire", "[", 
   RowBox[{
    RowBox[{"name_:", "Wire"}], ",", 
    RowBox[{"Length_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Wire\>\"", ",", 
            "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Wire\>\"", ",", 
            "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"instrument", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"instrument", "[", 
   RowBox[{
    RowBox[{"name_:", "Instr"}], ",", 
    RowBox[{"Length_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Instrument\>\"",
             ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Instrument\>\"",
             ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"monitor", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"monitor", "[", 
   RowBox[{
    RowBox[{"name_:", "Monitor"}], ",", 
    RowBox[{"Length_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Monitor\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Monitor\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"imonitor", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.400836765842374*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"imonitor", "[", 
   RowBox[{
    RowBox[{"name_:", "Monitor"}], ",", 
    RowBox[{"Length_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<IMonitor\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<IMonitor\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.400836767686159*^9, 3.400836779483261*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"profile", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.400836765842374*^9, {3.400837271789588*^9, 3.4008372725708528`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"profile", "[", 
   RowBox[{
    RowBox[{"name_:", "Monitor"}], ",", 
    RowBox[{"Length_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Profile\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Profile\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.400836767686159*^9, 3.400836779483261*^9}, {
  3.4008372746802683`*^9, 3.400837287758644*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"maxamp", "[", 
   RowBox[{
    RowBox[{"name_:", "MAXAMP"}], ",", 
    RowBox[{"xmax_:", "0.01"}], ",", 
    RowBox[{"ymax_:", "0.01"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Profile\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<MAXAMP\>\"", 
            ",", "0", ",", "xmax", ",", "ymax", ",", "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.400836767686159*^9, 3.400836779483261*^9}, {
  3.4008372746802683`*^9, 3.400837287758644*^9}, {3.583128610262401*^9, 
  3.583128652947401*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"scraper", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.728722217538746*^9, 
  3.728722218331746*^9}},ExpressionUUID->"0bf188cf-a6d8-40a8-971b-\
c57c1e68813a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"scraper", "[", 
   RowBox[{
    RowBox[{"name_:", "Scraper"}], ",", 
    RowBox[{"Length_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Wire\>\"", ",", 
            "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Scraper\>\"", 
            ",", "Length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.728722220431746*^9, 3.728722224182746*^9}, 
   3.728722268479746*^9},ExpressionUUID->"0d4b638b-c3ad-41ef-9861-\
0a6ad8ca80fa"]
}, Open  ]],

Cell[CellGroupData[{

Cell["SBEND", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "sbend", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"sbend", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"csbend", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.6977846073803587`*^9}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"csrcsbend", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.697784610612505*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"sbend", "[", 
    RowBox[{
     RowBox[{"name_:", "SBend"}], ",", "L_", ",", "Focus_", ",", "Angle_", 
     ",", 
     RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"name2", ",", "delayed"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"delayed", "=", 
       RowBox[{
        RowBox[{"Global`Delayed", "/.", 
         RowBox[{"{", "Extra", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`Delayed", "\[Rule]", "False"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
         RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"SetMADErrors", "[", 
       RowBox[{"name", ",", "Clear"}], "]"}], ";", 
      RowBox[{"SetMADElements", "[", 
       RowBox[{"Dipole", ",", "name"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"delayed", ",", "\[IndentingNewLine]", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
         "\"\<Evaluate[Symbol@ToString[\>\"", "<>", "name2", "<>", 
          "\"\<]]:={{\\\"\>\"", "<>", "name2", "<>", 
          "\"\<\\\",\\\"SectorBend\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", "L", "]"}], "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", "Focus", "]"}], "<>", 
          "\"\<,\\\"---\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", "Angle", "]"}], "<>", "\"\<,\\\"\>\"", "<>",
           "Type", "<>", "\"\<\\\"}};\>\""}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<SectorBend\>\"",
             ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"sbendExtra", "[", 
       RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4776589923091974`*^9, {3.5177405865468054`*^9, 3.5177405908281384`*^9}, {
   3.517743189628034*^9, 3.51774320270641*^9}, {3.5177432769109592`*^9, 
   3.5177433315838842`*^9}, 3.5177434811961317`*^9, {3.5177512608917823`*^9, 
   3.5177512636576905`*^9}, {3.5177513103499713`*^9, 3.517751326382863*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"csbend", "[", 
    RowBox[{
     RowBox[{"name_:", "SBend"}], ",", "L_", ",", "Focus_", ",", "Angle_", 
     ",", 
     RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"name2", ",", "delayed"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"delayed", "=", 
       RowBox[{
        RowBox[{"Global`Delayed", "/.", 
         RowBox[{"{", "Extra", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`Delayed", "\[Rule]", "False"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
         RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"SetMADErrors", "[", 
       RowBox[{"name", ",", "Clear"}], "]"}], ";", 
      RowBox[{"SetMADElements", "[", 
       RowBox[{"Dipole", ",", "name"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"delayed", ",", "\[IndentingNewLine]", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
         "\"\<Evaluate[Symbol@ToString[\>\"", "<>", "name2", "<>", 
          "\"\<]]:={{\\\"\>\"", "<>", "name2", "<>", 
          "\"\<\\\",\\\"CSectorBend\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", "L", "]"}], "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", "Focus", "]"}], "<>", 
          "\"\<,\\\"---\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", "Angle", "]"}], "<>", "\"\<,\\\"\>\"", "<>",
           "Type", "<>", "\"\<\\\"}};\>\""}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", 
            "\"\<CSectorBend\>\"", ",", "L", ",", "Focus", ",", "\"\<---\>\"",
             ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"sbendExtra", "[", 
       RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4776589923091974`*^9, {3.5177405865468054`*^9, 3.5177405908281384`*^9}, {
   3.517743189628034*^9, 3.51774320270641*^9}, {3.5177432769109592`*^9, 
   3.5177433315838842`*^9}, 3.5177434811961317`*^9, {3.5177512608917823`*^9, 
   3.5177512636576905`*^9}, {3.5177513103499713`*^9, 3.517751326382863*^9}, 
   3.6977831238637147`*^9, {3.6977832639132195`*^9, 3.6977832812126784`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"csrcsbend", "[", 
    RowBox[{
     RowBox[{"name_:", "SBend"}], ",", "L_", ",", "Focus_", ",", "Angle_", 
     ",", 
     RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"name2", ",", "delayed"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"delayed", "=", 
       RowBox[{
        RowBox[{"Global`Delayed", "/.", 
         RowBox[{"{", "Extra", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`Delayed", "\[Rule]", "False"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
         RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"SetMADErrors", "[", 
       RowBox[{"name", ",", "Clear"}], "]"}], ";", 
      RowBox[{"SetMADElements", "[", 
       RowBox[{"Dipole", ",", "name"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"delayed", ",", "\[IndentingNewLine]", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
         "\"\<Evaluate[Symbol@ToString[\>\"", "<>", "name2", "<>", 
          "\"\<]]:={{\\\"\>\"", "<>", "name2", "<>", 
          "\"\<\\\",\\\"CSRCSectorBend\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", "L", "]"}], "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", "Focus", "]"}], "<>", 
          "\"\<,\\\"---\\\",\>\"", "<>", 
          RowBox[{"ToString", "[", "Angle", "]"}], "<>", "\"\<,\\\"\>\"", "<>",
           "Type", "<>", "\"\<\\\"}};\>\""}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", 
            "\"\<CSRCSectorBend\>\"", ",", "L", ",", "Focus", ",", 
            "\"\<---\>\"", ",", "Angle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"sbendExtra", "[", 
       RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4776589923091974`*^9, {3.5177405865468054`*^9, 3.5177405908281384`*^9}, {
   3.517743189628034*^9, 3.51774320270641*^9}, {3.5177432769109592`*^9, 
   3.5177433315838842`*^9}, 3.5177434811961317`*^9, {3.5177512608917823`*^9, 
   3.5177512636576905`*^9}, {3.5177513103499713`*^9, 3.517751326382863*^9}, 
   3.6977831238637147`*^9, {3.6977831651709747`*^9, 3.6977831654425287`*^9}, {
   3.697783269745385*^9, 3.6977832786746707`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sbendExtra", "[", 
   RowBox[{"name_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "e1", ",", "e2", ",", "tilt", ",", "k2", ",", "h1", ",", "hgap", ",", 
      "fint", ",", "k3", ",", "xap", ",", "yap", ",", "fintx", ",", 
      "delayed"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"delayed", "=", 
      RowBox[{
       RowBox[{"Global`Delayed", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Delayed", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xap", "=", 
      RowBox[{
       RowBox[{"Global`XAp", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`XAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"yap", "=", 
      RowBox[{
       RowBox[{"Global`YAp", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`YAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"e1", "=", 
      RowBox[{
       RowBox[{"Global`E1", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`E1", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"e2", "=", 
      RowBox[{
       RowBox[{"Global`E2", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`E2", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tilt", "=", 
      RowBox[{
       RowBox[{"Global`Tilt", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Tilt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k2", "=", 
      RowBox[{
       RowBox[{"Global`K2", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K2", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"h1", "=", 
      RowBox[{
       RowBox[{"Global`H1", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`H1", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hgap", "=", 
      RowBox[{
       RowBox[{"Global`HGap", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`HGap", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fint", "=", 
      RowBox[{
       RowBox[{"Global`FInt", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`FInt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k3", "=", 
      RowBox[{
       RowBox[{"Global`K3", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K3", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fintx", "=", 
      RowBox[{
       RowBox[{"Global`FIntX", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`FIntX", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"delayed", ",", "\[IndentingNewLine]", 
       RowBox[{"ToExpression", "[", 
        RowBox[{
        "\"\<Evaluate[(Symbol@(ToString[\\\"\>\"", "<>", "name", "<>", 
         "\"\<\\\"]<>\\\"Extra\\\"))]:=List[\\\"\>\"", "<>", "name", "<>", 
         "\"\<\\\",\\\"Extra\\\",\>\"", "<>", 
         RowBox[{"ToString", "[", "xap", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "yap", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "e1", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "e2", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "tilt", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "k2", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "h1", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "hgap", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "fint", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "k3", "]"}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "[", "fintx", "]"}], "<>", "\"\<]\>\""}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"(", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", "name", "]"}], "<>", "\"\<Extra\>\""}], 
            ")"}]}], ")"}], "]"}], "=", 
        RowBox[{"List", "[", 
         RowBox[{
         "name", ",", "\"\<Extra\>\"", ",", "xap", ",", "yap", ",", "e1", ",",
           "e2", ",", "tilt", ",", "k2", ",", "h1", ",", "hgap", ",", "fint", 
          ",", "k3", ",", "fintx"}], "]"}]}]}], "]"}], ";"}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.517743213800373*^9, 3.5177432336288786`*^9}, {
  3.5177433496623564`*^9, 3.517743436070266*^9}, {3.5177511116617455`*^9, 
  3.517751113927936*^9}, {3.517751284378562*^9, 3.5177513089435773`*^9}, {
  3.517751340290537*^9, 3.517751372762612*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "sbend", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["RBEND", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "rbend", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"rbend", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rbend", "[", 
    RowBox[{
     RowBox[{"name_:", "RBend"}], ",", "L_", ",", "Focus_", ",", "Angle_", 
     ",", 
     RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "name2", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
         RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"SetMADErrors", "[", 
       RowBox[{"name", ",", "Clear"}], "]"}], ";", 
      RowBox[{"SetMADElements", "[", 
       RowBox[{"Dipole", ",", "name"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Symbol", "@", 
         RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<RectBend\>\"", 
          ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "Angle", ",", 
          RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rbendExtra", "[", 
       RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4809184589188175`*^9, 3.4809184757942495`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rbendExtra", "[", 
   RowBox[{"name_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "e1", ",", "e2", ",", "tilt", ",", "k2", ",", "h1", ",", "hgap", ",", 
      "fint", ",", "k3", ",", "xap", ",", "yap"}], "}"}], ",", 
    RowBox[{
     RowBox[{"xap", "=", 
      RowBox[{
       RowBox[{"Global`XAp", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`XAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"yap", "=", 
      RowBox[{
       RowBox[{"Global`YAp", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`YAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"e1", "=", 
      RowBox[{
       RowBox[{"Global`E1", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`E1", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"e2", "=", 
      RowBox[{
       RowBox[{"Global`E2", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`E2", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tilt", "=", 
      RowBox[{
       RowBox[{"Global`Tilt", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Tilt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k2", "=", 
      RowBox[{
       RowBox[{"Global`K2", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K2", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"h1", "=", 
      RowBox[{
       RowBox[{"Global`H1", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`H1", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hgap", "=", 
      RowBox[{
       RowBox[{"Global`HGap", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`HGap", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fint", "=", 
      RowBox[{
       RowBox[{"Global`FInt", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`FInt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k3", "=", 
      RowBox[{
       RowBox[{"Global`K3", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K3", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fintx", "=", 
      RowBox[{
       RowBox[{"Global`FIntX", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`FIntX", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", "name", "]"}], "<>", "\"\<Extra\>\""}], 
          ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
       "name", ",", "\"\<Extra\>\"", ",", "xap", ",", "yap", ",", "e1", ",", 
        "e2", ",", "tilt", ",", "k2", ",", "h1", ",", "hgap", ",", "fint", 
        ",", "k3", ",", "fintx"}], "]"}]}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4809184405902233`*^9}],

Cell[BoxData[
 RowBox[{"Protect", "[", "rbend", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Sext", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "sext", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Clear", "[", "sext", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"sext", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"sext", "[", 
   RowBox[{
    RowBox[{"name_:", "Sext"}], ",", "L_", ",", "Focus_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"thin", ",", "name2"}], "}"}], ",", 
    RowBox[{
     RowBox[{"thin", "=", 
      RowBox[{
       RowBox[{"Global`Thin", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Thin", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "name", "]"}], "===", "3"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"name2", "=", 
           RowBox[{"StringDrop", "[", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"name", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
             RowBox[{"-", "6"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{"name2", "<>", "\"\<lens\>\""}], ")"}], "]"}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{"name2", "<>", "\"\<drift1\>\""}], ")"}], "]"}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"name2", "=", 
           RowBox[{"ToString", "[", "name", "]"}]}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"name2", "=", 
           RowBox[{"ToString", "[", 
            RowBox[{"name", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"MADClear", "[", "name", "]"}], ";"}]}], "]"}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"SetMADOptions", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Symbol", "@", 
         RowBox[{"ToString", "[", "name", "]"}]}], "]"}], ",", "Extra", ",", 
       RowBox[{"Global`Name", "\[Rule]", 
        RowBox[{"ToString", "[", "name", "]"}]}], ",", 
       RowBox[{"Global`Porder", "\[Rule]", "3"}], ",", 
       RowBox[{
        RowBox[{"Global`PB", "[", "3", "]"}], "\[Rule]", 
        FractionBox["Focus", "2"]}], ",", 
       RowBox[{"Pirho", "\[Rule]", "0"}], ",", 
       RowBox[{"Pthick", "\[Rule]", "False"}], ",", 
       RowBox[{"Global`PL", "\[Rule]", "L"}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "]"}], ";", "\n", "\[IndentingNewLine]", 
     RowBox[{"SetMADErrors", "[", 
      RowBox[{"name", ",", "Clear"}], "]"}], ";", 
     RowBox[{"SetMADElements", "[", 
      RowBox[{"Sextupole", ",", "name"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"thin", "===", "True"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drift", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"(", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", "name2", "]"}], "<>", 
               "\"\<drift1\>\""}], ")"}]}], ")"}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{"L", "/", "2"}], ")"}], ",", "\"\<\>\""}], "]"}], ";", 
        RowBox[{"multipole", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", "name2", "]"}], "<>", "\"\<lens\>\""}],
              ")"}]}], "]"}], ",", "\"\<\>\"", ",", 
          RowBox[{"Global`K2L", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"Focus", "*", "L"}], ")"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"(", 
                RowBox[{"Symbol", "@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"ToString", "[", 
                    RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
                   "\"\<drift1\>\""}], ")"}]}], ")"}], "]"}], ",", 
              RowBox[{"Evaluate", "[", 
               RowBox[{"Symbol", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"ToString", "[", "name2", "]"}], "<>", 
                  "\"\<lens\>\""}], ")"}]}], "]"}], ",", 
              RowBox[{"Evaluate", "[", 
               RowBox[{"(", 
                RowBox[{"Symbol", "@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"ToString", "[", "name2", "]"}], "<>", 
                   "\"\<drift1\>\""}], ")"}]}], ")"}], "]"}]}], "}"}], "]"}], 
           ",", "7"}], "]"}]}], ";"}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Sextupole\>\"", 
            ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4776589941841974`*^9}],

Cell[BoxData[
 RowBox[{"Protect", "[", "sext", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Oct", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "oct", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"oct", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"oct", "[", 
   RowBox[{
    RowBox[{"name_:", "Oct"}], ",", "L_", ",", "Focus_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Octupole\>\"", 
            ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Octupole\>\"", 
            ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "oct", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["HKick, VKick & Kick", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"vkick", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"vkick", "[", 
   RowBox[{
    RowBox[{"name_:", "Vkick"}], ",", "L_", ",", "VAngle_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<VKicker\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "VAngle", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<VKicker\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "VAngle", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"hkick", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"hkick", "[", 
   RowBox[{
    RowBox[{"name_:", "Hkick"}], ",", "L_", ",", "HAngle_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<HKicker\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "HAngle", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<HKicker\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "HAngle", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"kick", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"kick", "[", 
   RowBox[{
    RowBox[{"name_:", "Kick"}], ",", "L_", ",", "VAngle_", ",", "HAngle_", 
    ",", "Type_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Kicker\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "VAngle", ",", "HAngle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Kicker\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "VAngle", ",", "HAngle", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["VBPM, HBPM & BPM", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"vbpm", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"vbpm", "[", 
   RowBox[{
    RowBox[{"name_:", "VBPM"}], ",", "L_", ",", "Type_", ",", "Extra___"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<VBPM\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<VBPM\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"hbpm", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"hbpm", "[", 
   RowBox[{
    RowBox[{"name_:", "HBPM"}], ",", "L_", ",", "Type_", ",", "Extra___"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<HBPM\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<HBPM\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"bpm", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"bpm", "[", 
   RowBox[{
    RowBox[{"name_:", "BPM"}], ",", "L_", ",", "Type_", ",", "Extra___"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<BPM\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<BPM\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["RFC", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"rfc", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"rfc", "[", 
   RowBox[{
    RowBox[{"name_:", "RFC"}], ",", "L_", ",", "Type_", ",", "Extra___"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<RFC\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<RFC\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"rfcExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"rfcExtra", "[", 
   RowBox[{"name_", ",", "opt___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "volt", ",", "lag", ",", "harmon", ",", "betrf", ",", "pg", ",", "shunt",
       ",", "tfill", ",", "xap", ",", "yap"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xap", "=", 
      RowBox[{
       RowBox[{"Global`XAp", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`XAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"yap", "=", 
      RowBox[{
       RowBox[{"Global`YAp", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`YAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"volt", "=", 
      RowBox[{
       RowBox[{"Global`MADVolt", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`MADVolt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lag", "=", 
      RowBox[{
       RowBox[{"Global`Lag", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Lag", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"harmon", "=", 
      RowBox[{
       RowBox[{"Global`Harmon", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Harmon", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"betrf", "=", 
      RowBox[{
       RowBox[{"Global`BetRF", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BetRF", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pg", "=", 
      RowBox[{
       RowBox[{"Global`PG", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`PG", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"shunt", "=", 
      RowBox[{
       RowBox[{"Global`Shunt", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Shunt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tfill", "=", 
      RowBox[{
       RowBox[{"Global`TFill", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`TFill", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"freq", "=", 
      RowBox[{
       RowBox[{"Global`MADFreq", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`MADFreq", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
        "xap", ",", "yap", ",", "volt", ",", "lag", ",", "harmon", ",", 
        "betrf", ",", "pg", ",", "shunt", ",", "tfill", ",", "freq"}], 
       "]"}]}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"lcav", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"lcav", "[", 
   RowBox[{
    RowBox[{"name_:", "LCAV"}], ",", "L_", ",", "Type_", ",", "Extra___"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<LCAV\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<LCAV\>\"", ",", 
            "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"lcavExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"lcavExtra", "[", 
   RowBox[{"name_", ",", "opt___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "volt", ",", "lag", ",", "harmon", ",", "betrf", ",", "pg", ",", "shunt",
       ",", "tfill", ",", "xap", ",", "yap"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xap", "=", 
      RowBox[{
       RowBox[{"Global`XAp", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`XAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"yap", "=", 
      RowBox[{
       RowBox[{"Global`YAp", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`YAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"e0", "=", 
      RowBox[{
       RowBox[{"Global`E0", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`E0", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"deltae", "=", 
      RowBox[{
       RowBox[{"Global`VoltageGain", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`VoltageGain", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"phi0", "=", 
      RowBox[{
       RowBox[{"Global`CavityPhase", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`CavityPhase", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"freq", "=", 
      RowBox[{
       RowBox[{"Global`Frequency", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Frequency", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eloss", "=", 
      RowBox[{
       RowBox[{"Global`LossFactor", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`LossFactor", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"volterr", "=", 
      RowBox[{
       RowBox[{"Global`VoltageError", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`VoltageError", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lagerr", "=", 
      RowBox[{
       RowBox[{"Global`LagError", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`LagError", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nbin", "=", 
      RowBox[{
       RowBox[{"Global`NumberBins", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`NumberBins", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"binmax", "=", 
      RowBox[{
       RowBox[{"Global`MaxBinLength", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`MaxBinLength", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lfile", "=", 
      RowBox[{
       RowBox[{"Global`LWakefieldFile", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`LWakefieldFile", "\[Rule]", "\"\<\>\""}], "}"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"tfile", "=", 
      RowBox[{
       RowBox[{"Global`TWakefieldFile", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`TWakefieldFile", "\[Rule]", "\"\<\>\""}], "}"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"energy", "=", 
      RowBox[{
       RowBox[{"Global`InitialEnergy", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`InitialEnergy", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
        "xap", ",", "yap", ",", "deltae", ",", "phi0", ",", "freq", ",", 
        "eloss", ",", "volterr", ",", "lagerr", ",", "nbin", ",", "binmax", 
        ",", "lfile", ",", "tfile", ",", "e0", ",", "energy"}], "]"}]}]}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Line", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "line", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"line", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"line", "[", 
   RowBox[{"name_", ",", "list_", ",", "Extra___"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}], "||", 
        RowBox[{"ValueQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"HoldForm", "[", "name", "]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name2", "]"}], ",", "\"\<Line\>\"", ",", 
            RowBox[{"MADLength", "[", "list", "]"}], ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<\>\""}], "}"}], 
          "}"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name2", "]"}], ",", "\"\<Line\>\"", ",", 
            RowBox[{"MADLength", "[", "list", "]"}], ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<\>\""}], "}"}], 
          "}"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"lineExtra", "[", 
      RowBox[{"name2", ",", "list", ",", "Extra"}], "]"}], ";"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"line", "[", "name_", "]"}], ":=", 
  RowBox[{"ExpandLattice", "[", "name", "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"f0af7aca-44f9-4bc5-a7b4-de33da11644b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"line", "[", 
   RowBox[{"name_", ",", "Global`NoExpand"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"name", "\[LeftDoubleBracket]", 
      RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
     "\"\<Line\>\""}], ",", 
    RowBox[{
     RowBox[{"Evaluate", "[", 
      RowBox[{"(", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{"name", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], "<>", 
          "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "\[LeftDoubleBracket]", 
     "3", "\[RightDoubleBracket]"}], ",", 
    RowBox[{"MADFlat", "[", "name", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"lineExtra", "[", 
   RowBox[{"name_", ",", "list_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{"SetDelayed", "[", 
    RowBox[{
     RowBox[{"Evaluate", "[", 
      RowBox[{"(", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ToString", "[", "name", "]"}], "<>", "\"\<Extra\>\""}], 
         ")"}]}], ")"}], "]"}], ",", 
     RowBox[{"List", "[", 
      RowBox[{
       RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"reversed", "[", "#", "]"}], "&"}], "/@", 
        RowBox[{
         RowBox[{"MADFlat", "[", "list", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{
        RowBox[{"Global`Repetition", "/.", 
         RowBox[{"{", "Extra", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`Repetition", "\[Rule]", "1"}], "}"}]}]}], "]"}]}], 
    "]"}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"reversed", "[", 
   RowBox[{"{", 
    RowBox[{"name_", ",", "type_"}], "}"}], "]"}], ":=", 
  RowBox[{"Switch", "[", 
   RowBox[{"type", ",", "\"\<ReversedLine\>\"", ",", 
    RowBox[{"reverse", "[", 
     RowBox[{"ToExpression", "[", "name", "]"}], "]"}], ",", "_", ",", 
    RowBox[{"ToExpression", "[", "name", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"reverse", "[", 
   RowBox[{"list_", "/;", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
      "\"\<Line\>\""}], ")"}]}], "]"}], ":=", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"list", ",", "\"\<ReversedLine\>\"", ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", "line", "]"}], ";"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Multipole", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"multipole", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"multipole", "[", 
   RowBox[{
    RowBox[{"name_:", "MULTIPOLE"}], ",", "Type_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name2", "]"}], ",", "\"\<MULTIPOLE\>\"",
             ",", "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name2", "]"}], ",", "\"\<MULTIPOLE\>\"",
             ",", "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADOptions", "[", 
       RowBox[{"Symbol", "@", 
        RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"List", "[", "Extra", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "==", "Rule"}], "&"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"multipoleExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"multipole", "[", 
   RowBox[{
    RowBox[{"name_:", "MULTIPOLE"}], ",", "length_", ",", "Type_", ",", 
    "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name2", "]"}], ",", "\"\<MULTIPOLE\>\"",
             ",", "length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name2", "]"}], ",", "\"\<MULTIPOLE\>\"",
             ",", "length", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADOptions", "[", 
       RowBox[{"Symbol", "@", 
        RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"List", "[", "Extra", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "==", "Rule"}], "&"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"multipoleExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.554211429475374*^9, 3.5542114343347178`*^9}, 
   3.554213116948949*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"multipoleExtra", "[", 
   RowBox[{"name_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "lrad", ",", "k0l", ",", "t0", ",", "k1l", ",", "t1", ",", "k2l", ",", 
      "t2", ",", "k3l", ",", "t3", ",", "k4l", ",", "t4", ",", "k5l", ",", 
      "t5", ",", "k6l", ",", "t6", ",", "k7l", ",", "t7", ",", "k8l", ",", 
      "t8", ",", "k9l", ",", "t9", ",", "xap", ",", "yap"}], "}"}], ",", 
    RowBox[{
     RowBox[{"xap", "=", 
      RowBox[{
       RowBox[{"Global`XAp", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`XAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"yap", "=", 
      RowBox[{
       RowBox[{"Global`YAp", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`YAp", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lrad", "=", 
      RowBox[{
       RowBox[{"Global`LRAD", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`LRAD", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k0l", "=", 
      RowBox[{
       RowBox[{"Global`K0L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K0L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t0", "=", 
      RowBox[{
       RowBox[{"Global`T0", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T0", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k1l", "=", 
      RowBox[{
       RowBox[{"Global`K1L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K1L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t1", "=", 
      RowBox[{
       RowBox[{"Global`T1", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T1", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k2l", "=", 
      RowBox[{
       RowBox[{"Global`K2L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K2L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t2", "=", 
      RowBox[{
       RowBox[{"Global`T2", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T2", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k3l", "=", 
      RowBox[{
       RowBox[{"Global`K3L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K3L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t3", "=", 
      RowBox[{
       RowBox[{"Global`T3", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T3", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k4l", "=", 
      RowBox[{
       RowBox[{"Global`K4L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K4L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t4", "=", 
      RowBox[{
       RowBox[{"Global`T4", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T4", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k5l", "=", 
      RowBox[{
       RowBox[{"Global`K5L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K5L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t5", "=", 
      RowBox[{
       RowBox[{"Global`T5", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T5", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k6l", "=", 
      RowBox[{
       RowBox[{"Global`K6L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K6L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t6", "=", 
      RowBox[{
       RowBox[{"Global`T6", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T6", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k7l", "=", 
      RowBox[{
       RowBox[{"Global`K7L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K7L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t7", "=", 
      RowBox[{
       RowBox[{"Global`T7", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T7", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k8l", "=", 
      RowBox[{
       RowBox[{"Global`K8L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K8L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t8", "=", 
      RowBox[{
       RowBox[{"Global`T8", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T8", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k9l", "=", 
      RowBox[{
       RowBox[{"Global`K9L", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`K9L", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t9", "=", 
      RowBox[{
       RowBox[{"Global`T9", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`T9", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
        "xap", ",", "yap", ",", "lrad", ",", "k0l", ",", "t0", ",", "k1l", 
        ",", "t1", ",", "k2l", ",", "t2", ",", "k3l", ",", "t3", ",", "k4l", 
        ",", "t4", ",", "k5l", ",", "t5", ",", "k6l", ",", "t6", ",", "k7l", 
        ",", "t7", ",", "k8l", ",", "t8", ",", "k9l", ",", "t9"}], 
       "]"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Matrix", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "matrix", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"matrix", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"matrix", "[", 
   RowBox[{
    RowBox[{"name_:", "Mat"}], ",", 
    RowBox[{"L_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"name2", ",", "Extra2"}], "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<MATRIX\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<MATRIX\>\"", 
            ",", "L", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"matrixExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.6556284290791044`*^9, 3.6556284635891047`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"matrixExtra", "[", 
   RowBox[{"name_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rmat", ",", "tmat", ",", "kicks"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rmat", "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Global`MatrixTerms", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"{", 
          RowBox[{"Global`MatrixTerms", "\[Rule]", 
           RowBox[{"{", "}"}]}], "}"}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", 
           RowBox[{"First", "[", "#", "]"}], "]"}], "\[Equal]", "Global`RM"}],
          "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tmat", "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Global`MatrixTerms", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"{", 
          RowBox[{"Global`MatrixTerms", "\[Rule]", 
           RowBox[{"{", "}"}]}], "}"}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", 
           RowBox[{"First", "[", "#", "]"}], "]"}], "\[Equal]", "Global`TM"}],
          "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"kicks", "=", 
      RowBox[{
       RowBox[{"Global`KickTerms", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`KickTerms", "\[Rule]", 
         RowBox[{"{", "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
        "rmat", ",", "tmat", ",", "kicks"}], "]"}]}], ";"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.431811908503488*^9, 3.4318119294725065`*^9}, {
  3.431811966066725*^9, 3.4318119668167343`*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "matrix", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Error", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "ReverseError", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "error", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"error", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"error", "[", 
   RowBox[{
    RowBox[{"name_:", "Error"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"name2", ",", "Extra2", ",", "dx", ",", "dy"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dx", "=", 
      RowBox[{
       RowBox[{"Global`dx", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`dx", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dy", "=", 
      RowBox[{
       RowBox[{"Global`dy", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`dy", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Error\>\"", ",",
             "0.0", ",", "dx", ",", "dy", ",", "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Error\>\"", ",",
             "0.0", ",", "dx", ",", "dy", ",", "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"errorExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"errorExtra", "[", 
   RowBox[{"name_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\""}], 
       "]"}]}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReverseError", "[", "error_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "1", ",", 
      RowBox[{"-", "1"}], ",", 
      RowBox[{"-", "1"}], ",", "1", ",", "1"}], "}"}], "*", 
    RowBox[{"error", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
    "/;", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "error", "]"}], "===", "1"}], "&&", 
     RowBox[{
      RowBox[{"error", "\[LeftDoubleBracket]", 
       RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
      "\"\<Error\>\""}]}], ")"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReverseError", "[", "error_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "1", ",", 
      RowBox[{"-", "1"}], ",", 
      RowBox[{"-", "1"}], ",", "1", ",", "1"}], "}"}], "*", "error"}], "/;", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "error", "]"}], ">", "1"}], "&&", 
     RowBox[{
      RowBox[{"error", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
       "===", "\"\<Error\>\""}]}], ")"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "error", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "ReverseError", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["BETA0", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"beta0", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"beta0", "[", 
   RowBox[{
    RowBox[{"name_:", "ECOLL"}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<BETA0\>\"", ",",
             "0", ",", "\"\<---\>\"", ",", "XSIZE", ",", "YSIZE", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<BETA0\>\"", ",",
             "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", "\"\<---\>\""}], "}"}], "}"}]}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"beta0Extra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"!", "True"}], ",", "1", ",", "0"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"beta0Extra", "[", 
   RowBox[{"name_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rmat", ",", "tmat"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"alfax", "=", 
      RowBox[{
       RowBox[{"Global`ALFX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`ALFX", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"betax", "=", 
      RowBox[{
       RowBox[{"Global`BETX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BETX", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mux", "=", 
      RowBox[{
       RowBox[{"Global`MUX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`MUX", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alfay", "=", 
      RowBox[{
       RowBox[{"Global`ALFY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`ALFY", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"betay", "=", 
      RowBox[{
       RowBox[{"Global`BETY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BETY", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"muy", "=", 
      RowBox[{
       RowBox[{"Global`MUY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`MUY", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
        "rmat", ",", "tmat"}], "]"}]}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Solenoid", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "solenoid", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"solenoid", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"solenoid", "[", 
   RowBox[{
    RowBox[{"name_:", "Sol"}], ",", "L_", ",", "Focus_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Solenoid\>\"", 
            ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Solenoid\>\"", 
            ",", "L", ",", "Focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Protect", "[", "solenoid", "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Charge", "Subsubsection",
 CellChangeTimes->{{3.542448582647641*^9, 3.5424485841305056`*^9}, {
  3.6144986281033683`*^9, 3.6144986287993684`*^9}}],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "charge", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5424485880015626`*^9, 3.5424485899995275`*^9}, {
  3.6144986309773684`*^9, 3.6144986316003685`*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"charge", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5424486886501913`*^9, 3.6144986341293683`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"charge", "[", 
   RowBox[{
    RowBox[{"name_:", "charge"}], ",", 
    RowBox[{"Charge_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Charge\>\"", 
            ",", "0", ",", "Charge", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Charge\>\"", 
            ",", "0", ",", "Charge", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5424485950256577`*^9, 3.542448643335822*^9}, {
  3.542448693567184*^9, 3.5424487003573165`*^9}, {3.5424511791471496`*^9, 
  3.542451184994976*^9}, {3.6144986352853684`*^9, 3.6144986819583683`*^9}, {
  3.614498729007368*^9, 3.6144987300963683`*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "charge", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.54244868245322*^9, 3.6144987347873683`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Watch", "Subsubsection",
 CellChangeTimes->{{3.542448582647641*^9, 3.5424485841305056`*^9}, {
  3.6144986281033683`*^9, 3.6144986287993684`*^9}, {3.687525907105117*^9, 
  3.6875259077915173`*^9}}],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "watch", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5424485880015626`*^9, 3.5424485899995275`*^9}, {
   3.6144986309773684`*^9, 3.6144986316003685`*^9}, 3.687526040457917*^9}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"watch", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5424486886501913`*^9, 3.6144986341293683`*^9, 
  3.6875260397559175`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"watch", "[", 
   RowBox[{
    RowBox[{"name_:", "watch"}], ",", 
    RowBox[{"filename_:", "\"\<\>\""}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Watch\>\"", ",",
             "0", ",", "filename", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Watch\>\"", ",",
             "0", ",", "filename", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5424485950256577`*^9, 3.542448643335822*^9}, {
  3.542448693567184*^9, 3.5424487003573165`*^9}, {3.5424511791471496`*^9, 
  3.542451184994976*^9}, {3.6144986352853684`*^9, 3.6144986819583683`*^9}, {
  3.614498729007368*^9, 3.6144987300963683`*^9}, {3.6875260101999173`*^9, 
  3.687526034839917*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "watch", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.54244868245322*^9, 3.6144987347873683`*^9, 
  3.687526041272117*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["CWiggler", "Subsubsection",
 CellChangeTimes->{{3.542448582647641*^9, 3.5424485841305056`*^9}, {
  3.6144986281033683`*^9, 3.6144986287993684`*^9}, {3.6798979368408117`*^9, 
  3.6798979387439313`*^9}, {3.698754777696025*^9, 3.69875478052059*^9}}],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "cwiggler", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5424485880015626`*^9, 3.5424485899995275`*^9}, {
   3.6144986309773684`*^9, 3.6144986316003685`*^9}, {3.6798979461739445`*^9, 
   3.679897948389002*^9}, 3.6987547836962247`*^9}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"cwiggler", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5424486886501913`*^9, 3.6144986341293683`*^9, 
  3.6798979512604275`*^9, 3.698754785593104*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"cwiggler", "[", 
   RowBox[{
    RowBox[{"name_:", "cwiggler"}], ",", "L_", ",", 
    RowBox[{"bmax_:", "0"}], ",", 
    RowBox[{"bxfile_:", "\"\<\>\""}], ",", 
    RowBox[{"byfile_:", "\"\<\>\""}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<CWiggler\>\"", 
            ",", "L", ",", "bmax", ",", "bxfile", ",", "byfile", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<CWiggler\>\"", 
            ",", "L", ",", "bmax", ",", "bxfile", ",", "byfile", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"cwigglerExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5424485950256577`*^9, 3.542448643335822*^9}, {
   3.542448693567184*^9, 3.5424487003573165`*^9}, {3.5424511791471496`*^9, 
   3.542451184994976*^9}, {3.6144986352853684`*^9, 3.6144986819583683`*^9}, {
   3.614498729007368*^9, 3.6144987300963683`*^9}, {3.6798979521087575`*^9, 
   3.679898003355506*^9}, {3.6987547865302916`*^9, 3.6987547980740995`*^9}, {
   3.6987548517338295`*^9, 3.69875489614571*^9}, 3.6987552380944953`*^9, {
   3.6989921428578234`*^9, 3.6989921432038236`*^9}, 3.6989926380788236`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"cwigglerExtra", "[", 
   RowBox[{"name_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "periods", ",", "stepsperperiod", ",", "bxmax", ",", "bymax", ",", 
      "sinusoidal", ",", "vertical", ",", "helical", ",", "dx", ",", "dy", 
      ",", "dz", ",", "tilt"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"periods", "=", 
      RowBox[{
       RowBox[{"Global`Periods", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Periods", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"stepsperperiod", "=", 
      RowBox[{
       RowBox[{"Global`StepsPerPeriod", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`StepsPerPeriod", "\[Rule]", "10"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bxmax", "=", 
      RowBox[{
       RowBox[{"Global`BxMax", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BxMax", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bymax", "=", 
      RowBox[{
       RowBox[{"Global`ByMax", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`ByMax", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sinusoidal", "=", 
      RowBox[{
       RowBox[{"Global`Sinusoidal", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Sinusoidal", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vertical", "=", 
      RowBox[{
       RowBox[{"Global`Vertical", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Vertical", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"helical", "=", 
      RowBox[{
       RowBox[{"Global`Helical", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Helical", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dx", "=", 
      RowBox[{
       RowBox[{"Global`DX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`DX", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dy", "=", 
      RowBox[{
       RowBox[{"Global`DY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`DY", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dz", "=", 
      RowBox[{
       RowBox[{"Global`DZ", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`DZ", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tilt", "=", 
      RowBox[{
       RowBox[{"Global`Tilt", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Tilt", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Unevaluated", "[", "name", "]"}], "]"}], "<>", 
           "\"\<Extra\>\""}], ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<Extra\>\"", ",", 
        "periods", ",", "stepsperperiod", ",", "bxmax", ",", "bymax", ",", 
        "sinusoidal", ",", "vertical", ",", "helical", ",", "dx", ",", "dy", 
        ",", "dz", ",", "tilt"}], "]"}]}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.431811908503488*^9, 3.4318119294725065`*^9}, {
  3.431811966066725*^9, 3.4318119668167343`*^9}, {3.6987549226835165`*^9, 
  3.6987550315447845`*^9}, {3.6987550779392953`*^9, 3.6987552080982304`*^9}, {
  3.698992840551324*^9, 3.6989928409348235`*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "cwiggler", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.54244868245322*^9, 3.6144987347873683`*^9, 
  3.698754915138508*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Genesis AW", "Subsubsection",
 CellChangeTimes->{{3.542448582647641*^9, 3.5424485841305056`*^9}, {
  3.6144986281033683`*^9, 3.6144986287993684`*^9}, {3.6798979368408117`*^9, 
  3.6798979387439313`*^9}}],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "gwiggler", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5424485880015626`*^9, 3.5424485899995275`*^9}, {
  3.6144986309773684`*^9, 3.6144986316003685`*^9}, {3.6798979461739445`*^9, 
  3.679897948389002*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"gwiggler", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5424486886501913`*^9, 3.6144986341293683`*^9, 
  3.6798979512604275`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"gwiggler", "[", 
   RowBox[{
    RowBox[{"name_:", "gwiggler"}], ",", "L_", ",", 
    RowBox[{"focus_:", "0"}], ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<GWiggler\>\"", 
            ",", "L", ",", "focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<GWiggler\>\"", 
            ",", "L", ",", "focus", ",", "\"\<---\>\"", ",", "\"\<---\>\"", 
            ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"genExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5424485950256577`*^9, 3.542448643335822*^9}, {
  3.542448693567184*^9, 3.5424487003573165`*^9}, {3.5424511791471496`*^9, 
  3.542451184994976*^9}, {3.6144986352853684`*^9, 3.6144986819583683`*^9}, {
  3.614498729007368*^9, 3.6144987300963683`*^9}, {3.6798979521087575`*^9, 
  3.679898003355506*^9}}],

Cell[BoxData[
 RowBox[{"Protect", "[", "gwiggler", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.54244868245322*^9, 3.6144987347873683`*^9, 
  3.698754918714223*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["FreeText", "Subsubsection",
 CellChangeTimes->{{3.542448582647641*^9, 3.5424485841305056`*^9}}],

Cell[BoxData[
 RowBox[{"Unprotect", "[", "freetext", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5424485880015626`*^9, 3.5424485899995275`*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"freetext", ",", "HoldFirst"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5424486886501913`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"freetext", "[", 
   RowBox[{
    RowBox[{"name_:", "FreeText"}], ",", "L_", ",", 
    RowBox[{"Type_:", "\"\<\>\""}], ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "name2", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "name", "]"}], "||", 
        RowBox[{"VectorQ", "[", "name", "]"}]}], ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", 
          RowBox[{"name", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"name", "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<FreeText\>\"", 
            ",", "L", ",", "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}], 
       ",", 
       RowBox[{
        RowBox[{"name2", "=", 
         RowBox[{"ToString", "[", "name", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MADClear", "[", "name", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"ToString", "[", "name", "]"}]}], "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToString", "[", "name", "]"}], ",", "\"\<FreeText\>\"", 
            ",", "L", ",", "0", ",", "\"\<---\>\"", ",", "\"\<---\>\"", ",", 
            RowBox[{"ToString", "[", "Type", "]"}]}], "}"}], "}"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"freetextExtra", "[", 
      RowBox[{"name2", ",", "Extra"}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5424485950256577`*^9, 3.542448643335822*^9}, {
  3.542448693567184*^9, 3.5424487003573165`*^9}, {3.5424511791471496`*^9, 
  3.542451184994976*^9}, {3.6144987161923685`*^9, 3.614498724328368*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"freetextExtra", "[", 
   RowBox[{"name_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "text", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Global`FreeText", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`FreeText", "\[Rule]", "\"\<\>\""}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ToString", "[", "name", "]"}], "<>", "\"\<Extra\>\""}], 
          ")"}]}], ")"}], "]"}], "=", 
      RowBox[{"List", "[", 
       RowBox[{"name", ",", "\"\<Extra\>\"", ",", "text"}], "]"}]}], ";"}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.5424486418061304`*^9, 3.5424486751948023`*^9}, {
   3.542449294052379*^9, 3.542449298813612*^9}, 3.6144987210653687`*^9}],

Cell[BoxData[
 RowBox[{"Protect", "[", "freetext", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.54244868245322*^9}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Command Definiton", "Section",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["MADClear", "Subsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"MADClear", ",", "HoldAll"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADClear", "[", "var__", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Apply", "[", 
     RowBox[{"Clear", ",", 
      RowBox[{"HoldForm", "[", "var", "]"}]}], "]"}], ";", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"Evaluate", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<Extra\>\""}], "]"}],
         "]"}], "&"}], ",", 
      RowBox[{"{", "var", "}"}]}], "]"}], ";"}], ")"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"MADClearExtra", ",", "HoldAll"}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADClearExtra", "[", "var__", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Clear", "[", 
      RowBox[{"Evaluate", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<Extra\>\""}], "]"}], 
      "]"}], "&"}], ",", 
    RowBox[{"{", "var", "}"}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADInfo", "Subsection",ExpressionUUID->"21d30154-19e5-46fc-b3d5-0a59db986fb4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADInfo", "[", 
   RowBox[{"data2_", ",", "Opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"notable", "=", 
      RowBox[{
       RowBox[{"NoTable", "/.", 
        RowBox[{"{", "Opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADInfo", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"expand", "=", 
      RowBox[{
       RowBox[{"LineExpand", "/.", 
        RowBox[{"{", "Opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADInfo", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"expand", "===", "True"}], ",", 
        RowBox[{"ExpandLattice", "[", "data2", "]"}], ",", 
        RowBox[{"LinesLattice", "[", "data2", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapThread", "[", 
          RowBox[{"List", ",", 
           RowBox[{"{", 
            RowBox[{"data", ",", 
             RowBox[{"Drop", "[", 
              RowBox[{
               RowBox[{"FoldList", "[", 
                RowBox[{"Plus", ",", "0", ",", 
                 RowBox[{"data", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], 
                "]"}], ",", "1"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "8"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"notable", "===", "False"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"TableForm", "[", 
          RowBox[{"a", ",", 
           RowBox[{"TableAlignments", "\[Rule]", "Center"}], ",", " ", 
           RowBox[{"TableHeadings", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Automatic", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Name\>\"", ",", "\"\<Element\>\"", ",", "\"\<Length\>\"", 
                ",", "\"\<Focus\>\"", ",", "\"\<VAngle\>\"", ",", 
                "\"\<HAngle\>\"", ",", "\"\<Type\>\"", ",", 
                "\"\<Position\>\""}], "}"}]}], "}"}]}]}], "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Total Length = \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"Fold", "[", 
            RowBox[{"Plus", ",", "0", ",", 
             RowBox[{"data", "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "]"}], 
           "]"}], "<>", "\"\< m\>\""}], "]"}]}], ",", "a"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->
  True,ExpressionUUID->"4b59fb76-5aed-46e0-af7e-f6d7ed74c84e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADLengthAdd", "[", "data_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"MADInfoData", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapThread", "[", 
          RowBox[{"List", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"MADFlatten", "[", "data", "]"}], ",", 
             RowBox[{"Drop", "[", 
              RowBox[{
               RowBox[{"FoldList", "[", 
                RowBox[{"Plus", ",", "0", ",", 
                 RowBox[{
                  RowBox[{"MADFlatten", "[", "data", "]"}], 
                  "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], 
                "]"}], ",", "1"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "8"}],
        "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSumLength", "[", "data_", "]"}], ":=", 
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Total Length = \>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"Fold", "[", 
      RowBox[{"Plus", ",", "0", ",", 
       RowBox[{
        RowBox[{"MADFlatten", "[", "data", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "]"}], "]"}], 
    "<>", "\"\< m\>\""}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElementList", "[", "list_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ExtraList", ",", "StripUnusedExtraFields", ",", "ElementList"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"MADExtraList", "[", "lattice_", "]"}], ":=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"MADFlatten", "[", "lattice", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADStripUnusedExtraFields", "[", "extralist_", "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"Drop", "[", 
         RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", "extralist"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ElementList", "[", "lattice_", "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"PadRight", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "30"}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"MADFlatten", "[", "lattice", "]"}], ",", 
          RowBox[{"MADStripUnusedExtraFields", "[", 
           RowBox[{"MADExtraList", "[", "lattice", "]"}], "]"}]}], "}"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ElementList", "[", "list", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"ca1c7e82-41cf-4ff0-b0a6-2e458830ea62"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mflat", "[", 
    RowBox[{"list_", ",", "Repetition_"}], "]"}], ":=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Table", "[", 
       RowBox[{"list", ",", 
        RowBox[{"{", "Repetition", "}"}]}], "]"}], "]"}], ",", "7"}], "]"}]}],
   ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.417244774576836*^9, 3.4172447838737707`*^9}, {
  3.7262986806541767`*^9, 
  3.726298690912203*^9}},ExpressionUUID->"4a4db1c6-8f6f-40a5-9295-\
1d199632a06e"],

Cell["mflat[list_] := Level[list, {-2}];", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.417244789405056*^9, 3.417244793264456*^9}, 
   3.7262963117923145`*^9},ExpressionUUID->"4dcc2125-f8ae-4bae-a84a-\
2d7f99e964ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mflat", "[", "list_", "]"}], ":=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "list", "]"}], ",", "7"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.417244789405056*^9, 3.417244793264456*^9}, {
  3.7262963142645617`*^9, 
  3.726296321768312*^9}},ExpressionUUID->"1a039f9e-133b-428a-a5a9-\
5703890ae694"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExpandLattice", "[", "lattice_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"expand", ",", "expandline"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"expandline", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"expandline", "[", "x", "]"}], "=", 
       RowBox[{"mflat", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "[", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{
              "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], "<>", "\"\<Extra\>\""}], "]"}], "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}], "\[RightDoubleBracket]"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"expand", "[", "line_", "]"}], ":=", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "===", "\"\<Line\>\""}], ",", 
           RowBox[{"expandline", "[", "#", "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "===", "\"\<ReversedLine\>\""}], ",", 
             RowBox[{"Reverse", "[", 
              RowBox[{"expandline", "[", "#", "]"}], "]"}], ",", "#1"}], 
            "]"}]}], "]"}], "&"}], ")"}], "/@", 
       RowBox[{"mflat", "[", "line", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"mflat", "[", 
      RowBox[{"FixedPoint", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"expand", "[", "#1", "]"}], "&"}], ",", "lattice"}], "]"}], 
      "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"cd0cbea3-ec36-4279-a7f0-882f25fd5b2b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OrderedUnion", "[", "li_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "i", "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"i", "[", "n_", "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"i", "[", "n", "]"}], "=", 
         RowBox[{"Sequence", "[", "]"}]}], ";", "n"}], ")"}]}], ";", 
     RowBox[{"i", "/@", "li"}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"LineLattice", "[", "lattice_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"expand", ",", "expandline", ",", 
      RowBox[{"linelist", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"expandline", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"expandline", "[", "x", "]"}], "=", 
       RowBox[{"mflat", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}], "<>", "\"\<Extra\>\""}], "]"}], "]"}], 
         "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"expand", "[", "line_", "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "===", "\"\<Line\>\""}], "||", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "===", "\"\<ReversedLine\>\""}]}], ",", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"linelist", ",", "#"}], "]"}], ";", 
             RowBox[{"expandline", "[", "#", "]"}]}], ",", "#"}], "]"}], 
          "&"}], "/@", 
         RowBox[{"mflat", "[", "line", "]"}]}], ")"}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mflat", "[", 
      RowBox[{"FixedPoint", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"expand", "[", "#", "]"}], "&"}], ",", "lattice"}], "]"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Reverse", "[", 
      RowBox[{"OrderedUnion", "[", "linelist", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"LinesLattice", "[", "lattice_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"expand", ",", "expandline", ",", 
      RowBox[{"linelist", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"expandline", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"expandline", "[", "x", "]"}], "=", 
       RowBox[{"mflat", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}], "<>", "\"\<Extra\>\""}], "]"}], "]"}], 
         "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"expand", "[", "line_", "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "===", "\"\<Line\>\""}], "||", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "===", "\"\<ReversedLine\>\""}]}], ",", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"linelist", ",", "#"}], "]"}], ";", 
             RowBox[{"expandline", "[", "#", "]"}]}], ",", "#"}], "]"}], 
          "&"}], "/@", 
         RowBox[{"mflat", "[", "line", "]"}]}], ")"}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mflat", "[", 
      RowBox[{"expand", "[", "lattice", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"AbsMax", "[", "list_", "]"}], ":=", 
  RowBox[{"list", "\[LeftDoubleBracket]", 
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"Abs", "[", "list", "]"}], ",", 
      RowBox[{"Max", "[", 
       RowBox[{"Abs", "[", "list", "]"}], "]"}]}], "]"}], 
    "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], 
   "\[RightDoubleBracket]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"elementsortfunction", "=", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", "\"\<Quadrupole\>\""}], "&&", 
        RowBox[{
         RowBox[{"#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", "\"\<SectorBend\>\""}]}], "||", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", "\"\<Sextupole\>\""}], "&&", 
        RowBox[{
         RowBox[{"#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", "\"\<Quadrupole\>\""}]}], "||", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", "\"\<Sextupole\>\""}], "&&", 
        RowBox[{
         RowBox[{"#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", "\"\<SectorBend\>\""}]}], "||", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "===", 
         RowBox[{
         "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], "&&", 
        RowBox[{
         RowBox[{"#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
          ">", 
         RowBox[{
         "#2", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}]}], 
      ",", "False", ",", "True"}], "]"}], "&"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElementSummary", "[", 
   RowBox[{"list_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{
     RowBox[{"elementlist", "=", 
      RowBox[{"MADFlatten", "[", "list", "]"}]}], ";", 
     RowBox[{"table", "=", 
      RowBox[{
       RowBox[{"ShowTable", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADElementSummary", "]"}]}]}], ";", 
     RowBox[{"data1", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Split", "[", 
            RowBox[{
             RowBox[{"Sort", "[", 
              RowBox[{"#1", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                  "<", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "3", 
                  "\[RightDoubleBracket]"}]}], "&"}]}], "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "===", 
               RowBox[{
               "#2", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}],
               "&"}]}], "]"}], "&"}], ")"}], "/@", 
         RowBox[{"Split", "[", 
          RowBox[{
           RowBox[{"Sort", "[", 
            RowBox[{
             RowBox[{"Union", "[", 
              RowBox[{"Select", "[", 
               RowBox[{"elementlist", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], 
                  "||", 
                  RowBox[{
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<Quadrupole\>\""}], 
                  "||", 
                  RowBox[{
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<Sextupole\>\""}]}],
                  "&"}]}], "]"}], "]"}], ",", "elementsortfunction"}], "]"}], 
           ",", 
           RowBox[{
            RowBox[{
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "===", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "&"}]}], "]"}]}], ",", "1"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{"table", ",", 
       RowBox[{
        RowBox[{"data2", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Switch", "[", 
             RowBox[{
              RowBox[{"#1", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
              "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{"\"\<Max\>\"", ",", 
                   RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "]"}],
                  ",", "\"\<SectorBend\>\"", ",", 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
                 "\"\<\>\"", ",", "\"\<\>\"", ",", 
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"AbsMax", "[", 
                    RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "6"}], "\[RightDoubleBracket]"}], 
                    "]"}], ",", 
                   RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "]"}],
                  ",", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", "=", "#1"}], "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"elementlist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"#1", "===", "a"}], "&"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], "}"}], "}"}], ",", 
              "\[IndentingNewLine]", "\"\<Quadrupole\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{"\"\<Max\>\"", ",", 
                   RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "]"}],
                  ",", "\"\<Quadrupole\>\"", ",", 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"AbsMax", "[", 
                    RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}], 
                    "]"}], ",", 
                   RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "]"}],
                  ",", "\"\<\>\"", ",", "\"\<\>\"", ",", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", "=", "#1"}], "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"elementlist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"#1", "===", "a"}], "&"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], "}"}], "}"}], ",", 
              "\[IndentingNewLine]", "\"\<Sextupole\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{"\"\<Max\>\"", ",", 
                   RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "]"}],
                  ",", "\"\<Sextupole\>\"", ",", 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"AbsMax", "[", 
                    RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}], 
                    "]"}], ",", 
                   RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "]"}],
                  ",", "\"\<\>\"", ",", "\"\<\>\"", ",", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", "=", "#1"}], "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"elementlist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"#1", "===", "a"}], "&"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], "}"}], "}"}]}], "]"}], 
            "&"}], ")"}], "/@", "data1"}]}], ";", 
        RowBox[{"Print", "[", 
         TagBox[
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{"Join", "[", 
               RowBox[{"data1", ",", 
                RowBox[{"{", 
                 RowBox[{"{", "\"\<----\>\"", "}"}], "}"}], ",", "data2"}], 
               "]"}], "}"}], "]"}], ",", "2"}], "]"}],
          Function[BoxForm`e$, 
           TableForm[BoxForm`e$, TableHeadings -> {None, 
              Map[
              Style[#, FontSlant -> "Italic"]& , {
               "Name", "Element", "Length", "Focus", "VAngle", "HAngle", 
                "Type"}]}]]], "]"}]}], ",", 
       RowBox[{
        RowBox[{"data2", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Switch", "[", 
             RowBox[{
              RowBox[{"#1", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
              "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{"\"\<Max\>\"", ",", "\"\<SectorBend\>\"", ",", 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
                 "\"\<\>\"", ",", "\"\<\>\"", ",", 
                 RowBox[{"AbsMax", "[", 
                  RowBox[{"#1", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "6"}], "\[RightDoubleBracket]"}], 
                  "]"}], ",", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", "=", "#1"}], "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"elementlist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"#1", "===", "a"}], "&"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], "}"}], "}"}], ",", 
              "\[IndentingNewLine]", "\"\<Quadrupole\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{"\"\<Max\>\"", ",", "\"\<Quadrupole\>\"", ",", 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
                 RowBox[{"AbsMax", "[", 
                  RowBox[{"#1", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}], 
                  "]"}], ",", "\"\<\>\"", ",", "\"\<\>\"", ",", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", "=", "#1"}], "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"elementlist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"#1", "===", "a"}], "&"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], "}"}], "}"}], ",", 
              "\[IndentingNewLine]", "\"\<Sextupole\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{"\"\<Max\>\"", ",", "\"\<Sextupole\>\"", ",", 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
                 RowBox[{"AbsMax", "[", 
                  RowBox[{"#1", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}], 
                  "]"}], ",", "\"\<\>\"", ",", "\"\<\>\"", ",", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", "=", "#1"}], "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"elementlist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"#1", "===", "a"}], "&"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], 
                    "\[RightDoubleBracket]"}]}]}]}], "}"}], "}"}]}], "]"}], 
            "&"}], ")"}], "/@", "data1"}]}], ";", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"Join", "[", 
             RowBox[{"data1", ",", "data2"}], "]"}], "}"}], "]"}], ",", "2"}],
          "]"}]}]}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"e3e66b4d-d433-476a-b8d6-8a4844ebef40"]
}, Closed]],

Cell[CellGroupData[{

Cell["MADLength", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADLength", "[", "lattice_", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{"Plus", ",", "0", ",", 
    RowBox[{
     RowBox[{"ExpandLattice", "[", "lattice", "]"}], "\[LeftDoubleBracket]", 
     RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetElementLengths", "[", "lattice_", "]"}], ":=", 
  RowBox[{
   RowBox[{"ExpandLattice", "[", "lattice", "]"}], "\[LeftDoubleBracket]", 
   RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADWrite", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NumberRight", "[", 
   RowBox[{"a_", ",", 
    RowBox[{"acc_:", "15"}]}], "]"}], ":=", 
  RowBox[{"NumberForm", "[", 
   RowBox[{
    RowBox[{"N", "[", "a", "]"}], ",", "acc", ",", 
    RowBox[{"ExponentFunction", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"Null", "&"}], ")"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.419074460803073*^9, 3.419074460881192*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"MADWrite", ",", "HoldRest"}], "]"}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell["Union replaced MADDeleteMultiple", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADWrite", "[", 
   RowBox[{"filename_", ",", "list2_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "acc", ",", "new", ",", "echo", ",", "symm", ",", "super", ",", 
      "MADXSwitch", ",", "MADMultipleData", ",", "list", ",", "slice", ",", 
      "datafile"}], "}"}], ",", 
    RowBox[{
     RowBox[{"slice", "=", 
      RowBox[{
       RowBox[{"Slice", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Slice", "\[Rule]", "1"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"new", "=", 
      RowBox[{
       RowBox[{"New", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"New", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"acc", "=", 
      RowBox[{
       RowBox[{"Accuracy", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Accuracy", "\[Rule]", "8"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"echo", "=", 
      RowBox[{
       RowBox[{"Global`Echo", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Echo", "\[Rule]", "On"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"symm", "=", 
      RowBox[{
       RowBox[{"Symm", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"super", "=", 
      RowBox[{
       RowBox[{"Super", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADXSwitch", "=", "False"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"slice", ">", "1"}], ",", 
       RowBox[{"list", "=", 
        RowBox[{"MADSplitElements", "[", 
         RowBox[{"list2", ",", "slice"}], "]"}]}], ",", 
       RowBox[{"list", "=", "list2"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADLineName", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", 
          RowBox[{"Unevaluated", "[", "list2", "]"}], "]"}], "===", 
         "Symbol"}], ",", 
        RowBox[{"ToString", "[", 
         RowBox[{"Unevaluated", "[", 
          RowBox[{"HoldForm", "[", "list2", "]"}], "]"}], "]"}], ",", 
        "\"\<lattice\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileName", "=", 
      RowBox[{
       RowBox[{"ToString", "[", "filename", "]"}], "<>", "\"\<.mff\>\""}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"new", "===", "False"}], ",", 
       RowBox[{"datafile", "=", 
        RowBox[{"OpenAppend", "[", "MADFileName", "]"}]}], ",", 
       RowBox[{"datafile", "=", 
        RowBox[{"OpenWrite", "[", "MADFileName", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADMultipleData", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"ExpandLattice", "[", "list", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ToLowerCase", "[", 
         RowBox[{"ToString", "[", "echo", "]"}], "]"}], "===", 
        "\"\<off\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MADFileWrite", "[", 
         RowBox[{"\"\<option,-echo;\\n\>\"", ",", "filename"}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{"\"\<assign, print=\\\"\>\"", "<>", 
       RowBox[{"ToString", "[", "filename", "]"}], "<>", 
       "\"\<.print.txt\\\",&\\necho=\\\"\>\"", "<>", 
       RowBox[{"ToString", "[", "filename", "]"}], "<>", 
       "\"\<.echo.txt\\\"\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{
       RowBox[{"\"\<Title,\\\"\>\"", "<>", 
        RowBox[{"ToString", "[", "filename", "]"}], "<>", 
        "\"\< - Created With MADInput\\\";\\n\>\""}], ",", "filename"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"MADWhatisit", "[", "#", "]"}], "&"}], "/@", 
      "MADMultipleData"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"LineLattice", "[", "list", "]"}], "=!=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"MADWhatisit", "[", "#", "]"}], "&"}], "/@", 
         RowBox[{"LineLattice", "[", "list", "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", 
            RowBox[{"Unevaluated", "[", "list2", "]"}], "]"}], "=!=", 
           "Symbol"}], ",", 
          RowBox[{"MADLineWrite", "[", 
           RowBox[{"list", ",", "MADLineName", ",", "Extra"}], "]"}]}], "]"}],
         ";"}], ",", 
       RowBox[{"MADLineWrite", "[", 
        RowBox[{"list", ",", "MADLineName", ",", "Extra"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ToLowerCase", "[", 
         RowBox[{"ToString", "[", "echo", "]"}], "]"}], "===", 
        "\"\<off\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MADFileWrite", "[", 
         RowBox[{"\"\<option,echo;\\n\>\"", ",", "filename"}], "]"}], ";"}]}],
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{
       RowBox[{"\"\<\\n\\nUse,\>\"", "<>", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "MADLineName", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
            RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}],
          "]"}], "<>", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"symm", "===", "True"}], ",", "\"\<, symm\>\"", ",", 
          "\"\<\>\""}], "]"}], "<>", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"super", "=!=", "0"}], ",", 
          RowBox[{"\"\<, Super=\>\"", "<>", 
           RowBox[{"ToString", "[", "super", "]"}]}], ",", "\"\<\>\""}], 
         "]"}], "<>", "\"\<;\\n\>\""}], ",", "filename"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.416838903136769*^9, {3.4190743551422324`*^9, 3.419074355845214*^9}, {
   3.4221665666732063`*^9, 3.4221665978296556`*^9}, {3.467182928637*^9, 
   3.467182983775*^9}, 3.467183037073*^9, {3.4673381879189997`*^9, 
   3.467338209362*^9}, {3.4698898294010286`*^9, 3.4698898377604036`*^9}, 
   3.4698900710260286`*^9, {3.482777390405713*^9, 3.482777390452592*^9}, {
   3.482777809333225*^9, 3.4827778421971235`*^9}, {3.482817992497716*^9, 
   3.482818001107201*^9}, {3.490352276839053*^9, 3.4903522958551645`*^9}, {
   3.4903523538097734`*^9, 3.490352358763025*^9}, {3.490352469968997*^9, 
   3.4903524705940127`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"MADXWrite", ",", "HoldRest"}], "]"}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADXWrite", "[", 
   RowBox[{"filename_", ",", "list2_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "acc", ",", "new", ",", "echo", ",", "symm", ",", "super", ",", 
      "MADXSwitch", ",", "MADMultipleData", ",", "list", ",", "slice", ",", 
      "datafile", ",", "energy", ",", "particle"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"slice", "=", 
      RowBox[{
       RowBox[{"Slice", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Slice", "\[Rule]", "1"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"new", "=", 
      RowBox[{
       RowBox[{"New", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"New", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"acc", "=", 
      RowBox[{
       RowBox[{"Accuracy", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Accuracy", "\[Rule]", "8"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"energy", "=", 
      RowBox[{
       RowBox[{"Energy", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Energy", "\[Rule]", "1"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"particle", "=", 
      RowBox[{
       RowBox[{"Global`MADParticle", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`MADParticle", "\[Rule]", "\"\<electron\>\""}], 
        "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADXSwitch", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"slice", ">", "1"}], ",", 
       RowBox[{"list", "=", 
        RowBox[{"MADSplitElements", "[", 
         RowBox[{"list2", ",", "slice"}], "]"}]}], ",", 
       RowBox[{"list", "=", "list2"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADLineName", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", 
          RowBox[{"Unevaluated", "[", "list2", "]"}], "]"}], "===", 
         "Symbol"}], ",", 
        RowBox[{"ToString", "[", 
         RowBox[{"Unevaluated", "[", 
          RowBox[{"HoldForm", "[", "list2", "]"}], "]"}], "]"}], ",", 
        "\"\<lattice\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileName", "=", 
      RowBox[{
       RowBox[{"ToString", "[", "filename", "]"}], "<>", "\"\<.mfx\>\""}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"new", "===", "False"}], ",", 
       RowBox[{"datafile", "=", 
        RowBox[{"OpenAppend", "[", "MADFileName", "]"}]}], ",", 
       RowBox[{"datafile", "=", 
        RowBox[{"OpenWrite", "[", "MADFileName", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADMultipleData", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"ExpandLattice", "[", "list", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{
       RowBox[{"\"\<assign,echo=\\\"\>\"", "<>", 
        RowBox[{"ToString", "[", "filename", "]"}], "<>", 
        "\"\<.echo.txt\\\"\\n\>\""}], ",", "filename"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{"\"\<Title,\\\"\>\"", "<>", 
       RowBox[{"ToString", "[", "filename", "]"}], "<>", 
       "\"\< - Created With MADInput\\\";\\n\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"MADWhatisit", "[", "#", "]"}], "&"}], "/@", 
      "MADMultipleData"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"LineLattice", "[", "list", "]"}], "=!=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"MADWhatisit", "[", "#", "]"}], "&"}], "/@", 
         RowBox[{"LineLattice", "[", "list", "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", 
            RowBox[{"Unevaluated", "[", "list2", "]"}], "]"}], "=!=", 
           "Symbol"}], ",", 
          RowBox[{"MADXLineWrite", "[", 
           RowBox[{"list", ",", "MADLineName", ",", "Extra"}], "]"}]}], "]"}],
         ";"}], ",", 
       RowBox[{"MADXLineWrite", "[", 
        RowBox[{"list", ",", "MADLineName", ",", "Extra"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{"\"\<beam,energy=\>\"", "<>", 
       RowBox[{"ToString", "[", "energy", "]"}], "<>", "\"\<,particle=\>\"", "<>", 
       RowBox[{"ToString", "[", "particle", "]"}], "<>", "\"\<;\\n\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{"\"\<Use,period=\>\"", "<>", 
       RowBox[{"ToString", "[", "MADLineName", "]"}], "<>", "\"\<;\\n\>\""}], 
      "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665084697084`*^9, 3.4221665090947127`*^9}, {
  3.482777396903825*^9, 3.482777397075645*^9}, {3.482777789108174*^9, 
  3.482777797619875*^9}, {3.4989927480391626`*^9, 3.4989927981338744`*^9}, {
  3.4989928401815567`*^9, 3.4989928404159365`*^9}, {3.4989929361208987`*^9, 
  3.498992936355278*^9}, {3.4989935048141713`*^9, 3.4989935067915993`*^9}, {
  3.498994726470687*^9, 3.4989947287049336`*^9}, {3.4989947833736596`*^9, 
  3.498994791248206*^9}, {3.4989948305596824`*^9, 3.4989948308096776`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADLineWrite", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADLineWrite", "[", 
   RowBox[{"list_", ",", "linename_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Lambda]", ",", "\[Chi]", ",", "\[Beta]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"symm", "=", 
      RowBox[{
       RowBox[{"Symm", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"super", "=", 
      RowBox[{
       RowBox[{"Super", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "list", "]"}], ",", "7"}], "]"}]}], ";", 
     RowBox[{"\[Chi]", "=", "\"\<\>\""}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "linename", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
           RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], 
        "]"}], "<>", "\"\<: Line= ( \>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "\[Lambda]", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Iota]", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Iota]", "+", "1"}], ")"}], "\[LessEqual]", 
            RowBox[{"Length", "[", "\[Lambda]", "]"}]}], "&&", 
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{"\[Beta]", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"Part", "[", 
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{"\[Lambda]", ",", 
                   RowBox[{"(", 
                    RowBox[{"\[Iota]", "+", "1"}], ")"}]}], "]"}], ",", "1"}],
                 "]"}], "]"}]}], "]"}], "<", "70"}]}], ",", 
          RowBox[{
           RowBox[{"\[Iota]", "+=", "1"}], ";", 
           RowBox[{"\[Beta]", "=", 
            RowBox[{"\[Beta]", "<>", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{
                  RowBox[{"Part", "[", 
                   RowBox[{"\[Lambda]", ",", "\[Iota]"}], "]"}], ",", "1"}], 
                 "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
                 RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], 
                "}"}]}], "]"}], "<>", "\"\<, \>\""}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Chi]", "=", 
         RowBox[{"\[Chi]", "<>", "\[Beta]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"\[Lambda]", ",", "\[Iota]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "\[Lambda]", "]"}], ">", "0"}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{
            RowBox[{"StringDrop", "[", 
             RowBox[{"\[Chi]", ",", 
              RowBox[{"-", "1"}]}], "]"}], "<>", "\"\<&\\n\>\""}]}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{"StringInsert", "[", 
            RowBox[{
             RowBox[{"StringDrop", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"-", "2"}]}], "]"}], ",", "\"\< );\\n\>\"", ",", 
             RowBox[{"-", "1"}]}], "]"}]}]}], "]"}], ";", 
        RowBox[{"\[Beta]", "=", "\"\<\>\""}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", "\[Chi]", "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4050722133219256`*^9, 3.405072226150215*^9}, {
   3.4698895420104036`*^9, 3.4698895465416536`*^9}, 3.4698896936041536`*^9, {
   3.4698899098541536`*^9, 3.4698899118697786`*^9}, 3.4698900626979036`*^9, {
   3.4698902389166536`*^9, 3.4698902896354036`*^9}, 3.4698905137604036`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADXLineWrite", "[", 
   RowBox[{"list_", ",", "linename_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Lambda]", ",", "\[Chi]", ",", "\[Beta]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"symm", "=", 
      RowBox[{
       RowBox[{"Symm", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"super", "=", 
      RowBox[{
       RowBox[{"Super", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "list", "]"}], ",", "7"}], "]"}]}], ";", 
     RowBox[{"\[Chi]", "=", "\"\<\>\""}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "linename", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
           RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], 
        "]"}], "<>", "\"\<: Line= ( \>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "\[Lambda]", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Iota]", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Iota]", "+", "1"}], ")"}], "\[LessEqual]", 
            RowBox[{"Length", "[", "\[Lambda]", "]"}]}], "&&", 
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{"\[Beta]", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"Part", "[", 
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{"\[Lambda]", ",", 
                   RowBox[{"(", 
                    RowBox[{"\[Iota]", "+", "1"}], ")"}]}], "]"}], ",", "1"}],
                 "]"}], "]"}]}], "]"}], "<", "70"}]}], ",", 
          RowBox[{
           RowBox[{"\[Iota]", "+=", "1"}], ";", 
           RowBox[{"\[Beta]", "=", 
            RowBox[{"\[Beta]", "<>", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{
                  RowBox[{"Part", "[", 
                   RowBox[{"\[Lambda]", ",", "\[Iota]"}], "]"}], ",", "1"}], 
                 "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
                 RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], 
                "}"}]}], "]"}], "<>", "\"\<, \>\""}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Chi]", "=", 
         RowBox[{"\[Chi]", "<>", "\[Beta]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"\[Lambda]", ",", "\[Iota]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "\[Lambda]", "]"}], ">", "0"}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{
            RowBox[{"StringDrop", "[", 
             RowBox[{"\[Chi]", ",", 
              RowBox[{"-", "1"}]}], "]"}], "<>", "\"\<\\n\>\""}]}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{"StringInsert", "[", 
            RowBox[{
             RowBox[{"StringDrop", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"-", "2"}]}], "]"}], ",", "\"\< );\\n\>\"", ",", 
             RowBox[{"-", "1"}]}], "]"}]}]}], "]"}], ";", 
        RowBox[{"\[Beta]", "=", "\"\<\>\""}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", "\[Chi]", "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4050722133219256`*^9, 3.405072226150215*^9}, {
   3.4698895420104036`*^9, 3.4698895465416536`*^9}, 3.4698896936041536`*^9, {
   3.4698899098541536`*^9, 3.4698899118697786`*^9}, 3.4698900626979036`*^9, {
   3.4698902389166536`*^9, 3.4698902896354036`*^9}, 3.4698905137604036`*^9, {
   3.498993520010784*^9, 3.4989935252268343`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADLineWriteOld", "[", 
   RowBox[{"list_", ",", "linename_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "symm", ",", "super"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"symm", "=", 
      RowBox[{
       RowBox[{"Symm", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"super", "=", 
      RowBox[{
       RowBox[{"Super", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"ToString", "[", "linename", "]"}], "<>", "\"\<: Line= ( \>\"",
        "<>", 
       RowBox[{"StringDrop", "[", 
        RowBox[{
         RowBox[{"StringDrop", "[", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "list", "]"}], ",", "7"}], "]"}]}], 
            "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}], "<>", 
       "\"\< );\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"a", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"a", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{"First", "[", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"a", ",", "\"\<,\>\""}], "]"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"#", "<", 
               RowBox[{"(", 
                RowBox[{"n", "*", "80"}], ")"}]}], "&"}]}], "]"}], "]"}]}], 
         "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "1", ",", 
         RowBox[{"Ceiling", "[", 
          RowBox[{
           RowBox[{"StringLength", "[", "a", "]"}], "/", "80"}], "]"}]}], 
        "}"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"a", "<>", "\"\<\\n\\nUse,\>\"", "<>", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "linename", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
           RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], 
        "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"symm", "===", "True"}], ",", "\"\<, symm\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"super", "=!=", "0"}], ",", 
         RowBox[{"\"\<, Super=\>\"", "<>", 
          RowBox[{"ToString", "[", "super", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADFileWrite", "[", "a", "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.3878807224148316`*^9, {3.4698897502291536`*^9, 3.4698897653385286`*^9}, 
   3.4698901307760286`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"MADLines", ",", "HoldRest"}], "]"}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADLines", "[", 
   RowBox[{"file_", ",", "line_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Lambda]", ",", "\[Chi]", ",", "\[Beta]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"symm", "=", 
      RowBox[{
       RowBox[{"Symm", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"super", "=", 
      RowBox[{
       RowBox[{"Super", "/.", 
        RowBox[{"{", "Extra", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADLineWrite", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"linename", "=", 
      RowBox[{"ToString", "[", 
       RowBox[{"Unevaluated", "[", 
        RowBox[{"HoldForm", "[", "line", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Lambda]", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "line", "]"}], ",", "7"}], "]"}]}], ";", 
     RowBox[{"\[Chi]", "=", "\"\<\>\""}], ";", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{
       RowBox[{"ToString", "[", "linename", "]"}], "<>", 
       "\"\<: Line= ( \>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "\[Lambda]", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Iota]", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Iota]", "+", "1"}], ")"}], "\[LessEqual]", 
            RowBox[{"Length", "[", "\[Lambda]", "]"}]}], "&&", 
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{"\[Beta]", "<>", 
              RowBox[{"Part", "[", 
               RowBox[{
                RowBox[{"Part", "[", 
                 RowBox[{"\[Lambda]", ",", 
                  RowBox[{"(", 
                   RowBox[{"\[Iota]", "+", "1"}], ")"}]}], "]"}], ",", "1"}], 
               "]"}]}], "]"}], "<", "70"}]}], ",", 
          RowBox[{
           RowBox[{"\[Iota]", "+=", "1"}], ";", 
           RowBox[{"\[Beta]", "=", 
            RowBox[{"\[Beta]", "<>", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{
                  RowBox[{"Part", "[", 
                   RowBox[{"\[Lambda]", ",", "\[Iota]"}], "]"}], ",", "1"}], 
                 "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
                 RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], 
                "}"}]}], "]"}], "<>", "\"\<, \>\""}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Chi]", "=", 
         RowBox[{"\[Chi]", "<>", "\[Beta]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"\[Lambda]", ",", "\[Iota]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "\[Lambda]", "]"}], ">", "0"}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{
            RowBox[{"StringDrop", "[", 
             RowBox[{"\[Chi]", ",", 
              RowBox[{"-", "1"}]}], "]"}], "<>", "\"\<&\\n\>\""}]}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{"StringInsert", "[", 
            RowBox[{
             RowBox[{"StringDrop", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"-", "2"}]}], "]"}], ",", "\"\< );\\n\>\"", ",", 
             RowBox[{"-", "1"}]}], "]"}]}]}], "]"}], ";", 
        RowBox[{"\[Beta]", "=", "\"\<\>\""}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", 
     RowBox[{"MADFileWrite", "[", 
      RowBox[{"\[Chi]", ",", "file"}], "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.461417526785228*^9, 3.461417539519684*^9}, 
   3.4698904036041536`*^9, {3.482777403042485*^9, 3.482777403292405*^9}, {
   3.482777454822785*^9, 3.482777477315585*^9}, {3.4827777186562777`*^9, 
   3.482777747174381*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDeleteMultiple", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDeleteMultiple", "[", "list_List", "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"MADMultipleData", "=", "list"}], ";", 
    RowBox[{"\[Alpha]", "=", "1"}], ";", "\[IndentingNewLine]", 
    RowBox[{"While", "[", 
     RowBox[{
      RowBox[{"\[Alpha]", "\[LessEqual]", 
       RowBox[{"Length", "[", "MADMultipleData", "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Chi]", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"list", ",", 
          RowBox[{"Part", "[", 
           RowBox[{"list", ",", "\[Alpha]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Delta]", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"MADMultipleData", ",", 
          RowBox[{"Part", "[", 
           RowBox[{"MADMultipleData", ",", "\[Alpha]"}], "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "\[Delta]", "]"}], ">", "1"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"MADMultipleData", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"MADMultipleData", ",", 
             RowBox[{"{", 
              RowBox[{"Part", "[", 
               RowBox[{
                RowBox[{"Part", "[", 
                 RowBox[{"\[Delta]", ",", "2"}], "]"}], ",", "1"}], "]"}], 
              "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"\[Delta]", "=", 
           RowBox[{"Position", "[", 
            RowBox[{"MADMultipleData", ",", 
             RowBox[{"Part", "[", 
              RowBox[{"MADMultipleData", ",", "\[Alpha]"}], "]"}]}], "]"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Alpha]", "+=", "1"}], ";"}]}], "]"}], ";", 
    RowBox[{"Return", "[", "MADMultipleData", "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADWhatisit", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADWhatisit2", "[", "list_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Part", "[", 
      RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<Quadrupole\>\""}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"quadWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Part", "[", 
        RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<Drift\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"driftWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<SectorBend\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"sbendWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<RectBend\>\""}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"rbendWrite", "[", "list", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<Sextupole\>\""}],
             ",", "\[IndentingNewLine]", 
            RowBox[{"sextWrite", "[", "list", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"list", ",", "2"}], "]"}], "===", 
               "\"\<Octupole\>\""}], ",", "\[IndentingNewLine]", 
              RowBox[{"octWrite", "[", "list", "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{"list", ",", "2"}], "]"}], "===", 
                 "\"\<VKicker\>\""}], ",", "\[IndentingNewLine]", 
                RowBox[{"vkickWrite", "[", "list", "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", 
                   "\"\<HKicker\>\""}], ",", "\[IndentingNewLine]", 
                  RowBox[{"hkickWrite", "[", "list", "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", 
                    "\"\<Kicker\>\""}], ",", "\[IndentingNewLine]", 
                    RowBox[{"kickWrite", "[", "list", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", 
                    "\"\<VBPM\>\""}], ",", "\[IndentingNewLine]", 
                    RowBox[{"vbpmWrite", "[", "list", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", 
                    "\"\<HBPM\>\""}], ",", "\[IndentingNewLine]", 
                    RowBox[{"hbpmWrite", "[", "list", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<BPM\>\""}],
                     ",", "\[IndentingNewLine]", 
                    RowBox[{"bpmWrite", "[", "list", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", "\"\<RFC\>\""}],
                     ",", "\[IndentingNewLine]", 
                    RowBox[{"rfcWrite", "[", "list", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"list", ",", "2"}], "]"}], "===", 
                    "\"\<MULTIPOLE\>\""}], ",", "\[IndentingNewLine]", 
                    RowBox[{"multipoleWrite", "[", "list", "]"}]}], 
                    "\[IndentingNewLine]", "]"}]}], "]"}]}], "]"}]}], "]"}]}],
                     "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], 
         "]"}]}], "]"}]}], "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4671832034110003`*^9, 3.467183206249*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADWhatisit", "[", "list_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", "=", 
      RowBox[{
      "list", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{"Switch", "[", 
     RowBox[{"data", ",", "\"\<Quadrupole\>\"", ",", 
      RowBox[{"quadWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Drift\>\"", ",", 
      RowBox[{"driftWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<CSRDrift\>\"", ",", 
      RowBox[{"driftWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<SectorBend\>\"", ",", 
      RowBox[{"sbendWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<CSectorBend\>\"", ",", 
      RowBox[{"sbendWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<CSRCSectorBend\>\"", ",", 
      RowBox[{"sbendWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<RectBend\>\"", ",", 
      RowBox[{"rbendWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Sextupole\>\"", ",", 
      RowBox[{"sextWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Octupole\>\"", ",", 
      RowBox[{"octWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<VKicker\>\"", ",", 
      RowBox[{"vkickWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<HKicker\>\"", ",", 
      RowBox[{"hkickWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Kicker\>\"", ",", 
      RowBox[{"kickWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<VBPM\>\"", ",", 
      RowBox[{"vbpmWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<HBPM\>\"", ",", 
      RowBox[{"hbpmWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<BPM\>\"", ",", 
      RowBox[{"bpmWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Monitor\>\"", ",", 
      RowBox[{"monitorWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<IMonitor\>\"", ",", 
      RowBox[{"imonitorWrite", "[", "list", "]"}], ",", 
      "\[IndentingNewLine]", "\"\<Profile\>\"", ",", 
      RowBox[{"profileWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Wire\>\"", ",", 
      RowBox[{"wireWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Instrument\>\"", ",", 
      RowBox[{"instrumentWrite", "[", "list", "]"}], ",", 
      "\[IndentingNewLine]", "\"\<RFC\>\"", ",", 
      RowBox[{"rfcWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<MULTIPOLE\>\"", ",", 
      RowBox[{"multipoleWrite", "[", "list", "]"}], ",", 
      "\[IndentingNewLine]", "\"\<Marker\>\"", ",", 
      RowBox[{"markerWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<ECOLLIMATOR\>\"", ",", 
      RowBox[{"ecollWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<RCOLLIMATOR\>\"", ",", 
      RowBox[{"rcollWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<YROT\>\"", ",", 
      RowBox[{"yrotWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<SROT\>\"", ",", 
      RowBox[{"srotWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Line\>\"", ",", 
      RowBox[{"lineWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<ReversedLine\>\"", ",", 
      RowBox[{"lineWriteReverse", "[", "list", "]"}], ",", 
      "\[IndentingNewLine]", "\"\<LCAV\>\"", ",", 
      RowBox[{"lcavWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<MATRIX\>\"", ",", 
      RowBox[{"matrixWrite", "[", "list", "]"}], ",", "\[IndentingNewLine]", 
      "\"\<Solenoid\>\"", ",", 
      RowBox[{"solenoidWrite", "[", "list", "]"}], ",", 
      "\[IndentingNewLine]", "\"\<FreeText\>\"", ",", 
      RowBox[{"freetextWrite", "[", "list", "]"}], ",", 
      "\[IndentingNewLine]", "\"\<GWiggler\>\"", ",", 
      RowBox[{"driftWrite", "[", "list", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4008368371562433`*^9, 3.4008368403594294`*^9}, {
   3.4008368926104326`*^9, 3.4008368960167484`*^9}, {3.4008373600412827`*^9, 
   3.4008373687601995`*^9}, {3.431813434444895*^9, 3.431813437069928*^9}, {
   3.5424490582578187`*^9, 3.542449074492531*^9}, {3.679898092300926*^9, 
   3.6798981007899265`*^9}, 3.6798981409029264`*^9, {3.697783461502229*^9, 
   3.697783473774683*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADStringWrite", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADStringWrite", "[", 
   RowBox[{"filename_", ",", "data_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "datafile", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MADFileName", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"StringTake", "[", 
           RowBox[{"filename", ",", 
            RowBox[{"-", "3"}]}], "]"}], "===", "\"\<mff\>\""}], "||", 
         RowBox[{
          RowBox[{"StringTake", "[", 
           RowBox[{"filename", ",", 
            RowBox[{"-", "3"}]}], "]"}], "===", "\"\<mfx\>\""}]}], ",", 
        "filename", ",", 
        RowBox[{
         RowBox[{"ToString", "[", "filename", "]"}], "<>", "\"\<.mff\>\""}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", "MADFileName", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"datafile", ",", "data"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4671832274379997`*^9, 3.4671832308529997`*^9}, {
  3.4827772552529793`*^9, 3.4827772584563913`*^9}, {3.482817978903792*^9, 
  3.482817979544425*^9}, {3.4989933538912535`*^9, 3.4989933578461094`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADXStringWrite", "[", 
   RowBox[{"filename_", ",", "data_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "datafile", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MADFileName", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{"filename", ",", 
           RowBox[{"-", "3"}]}], "]"}], "===", "\"\<mfx\>\""}], ",", 
        "filename", ",", 
        RowBox[{
         RowBox[{"ToString", "[", "filename", "]"}], "<>", "\"\<.mfx\>\""}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", "MADFileName", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"datafile", ",", "data"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.46718323721*^9, 3.482777262003584*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"data_", ",", 
    RowBox[{"filename_:", "MADFileName"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "datafile", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", "MADFileName", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"datafile", ",", "data"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.467183146916*^9, {3.482777482501425*^9, 3.482777484172765*^9}, {
   3.482777589029825*^9, 3.482777658304525*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
The next set of functions are used to write formatted lines for each of the \
different element types.\
\>", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADString", "[", "inputstring_String", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"string", "=", "inputstring"}], ",", 
      RowBox[{"string2", "=", "\"\<\>\""}], ",", "stringpos"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"stringpos", ":=", 
      RowBox[{"Last", "[", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringPosition", "[", 
           RowBox[{"string", ",", "\"\<,\>\""}], "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"#", "<", "80"}], "&"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MADXSwitch", "===", "True"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringLength", "[", "string", "]"}], ">", "80"}], ",", 
          RowBox[{
           RowBox[{"string2", "=", 
            RowBox[{"StringJoin", "[", 
             RowBox[{"string2", ",", 
              RowBox[{
               RowBox[{"StringTake", "[", 
                RowBox[{"string", ",", "stringpos"}], "]"}], "<>", 
               "\"\<\\n\>\""}]}], "]"}]}], ";", 
           RowBox[{"string", "=", 
            RowBox[{"StringDrop", "[", 
             RowBox[{"string", ",", "stringpos"}], "]"}]}]}]}], "]"}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringLength", "[", "string", "]"}], ">", "80"}], ",", 
         RowBox[{
          RowBox[{"string2", "=", 
           RowBox[{"StringJoin", "[", 
            RowBox[{"string2", ",", 
             RowBox[{
              RowBox[{"StringTake", "[", 
               RowBox[{"string", ",", "stringpos"}], "]"}], "<>", 
              "\"\<&\\n\>\""}]}], "]"}]}], ";", 
          RowBox[{"string", "=", 
           RowBox[{"StringDrop", "[", 
            RowBox[{"string", ",", "stringpos"}], "]"}]}], ";"}]}], "]"}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"string2", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"StringJoin", "[", 
         RowBox[{"string2", ",", "string"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\< \>\"", "\[Rule]", "\"\<\>\""}], ",", 
          RowBox[{"\"\<$\>\"", "\[Rule]", "\"\<_\>\""}], ",", 
          RowBox[{"\"\<\[Sterling]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "string2"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4050713651704445`*^9, 3.405071372779917*^9}, {
   3.4698897007760286`*^9, 3.4698897039947786`*^9}, 3.4698900880260286`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"quadWrite", "[", "quad_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"quad", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: QUADRUPOLE, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"quad", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, K1=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"quad", ",", "4"}], "]"}]}], "]"}], "<>", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"quad", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"quad", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"quad", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"quad", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665246885624`*^9, 3.4221665256104436`*^9}, 
   3.480918558937003*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"solenoidWrite", "[", "sol_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"sol", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: SOLENOID, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sol", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, KS=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sol", ",", "4"}], "]"}]}], "]"}], "<>", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"sol", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"sol", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], "]"}],
      "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sol", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"sol", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.422166526204197*^9, 3.4221665268448267`*^9}, 
   3.480918556655695*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lineWrite", "[", "line_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", "\"\<: LINE=\>\"", 
     "<>", "\"\<(\>\"", "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "\[LeftDoubleBracket]", "4", 
         "\[RightDoubleBracket]"}], ">", "1"}], ",", 
       RowBox[{
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Part", "[", 
                RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", 
              "\"\<Extra\>\""}], ")"}]}], "]"}], "\[LeftDoubleBracket]", "4", 
          "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<*(\>\""}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"mflat", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "\[LeftDoubleBracket]", "3",
            "\[RightDoubleBracket]"}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<{\>\"", "\[Rule]", "\"\<\>\""}], ",", 
         RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}], ",", 
         RowBox[{"\"\<  \>\"", "\[Rule]", "\"\< \>\""}]}], "}"}]}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "\[LeftDoubleBracket]", "4", 
         "\[RightDoubleBracket]"}], ">", "1"}], ",", "\"\<)\>\"", ",", 
       "\"\<\>\""}], "]"}], "<>", "\"\<);\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.480918551499313*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lineWriteReverse", "[", "line_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", "\"\<: LINE=\>\"", "<>", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"mflat", "[", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"line", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "\[LeftDoubleBracket]", 
            "3", "\[RightDoubleBracket]"}], "]"}], "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<{\>\"", "\[Rule]", "\"\<(\>\""}], ",", 
         RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<)\>\""}], ",", 
         RowBox[{"\"\<  \>\"", "\[Rule]", "\"\< \>\""}]}], "}"}]}], "]"}], 
     "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.480918548827369*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"yrotWrite", "[", "yrot_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"yrot", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: YROT, ANGLE=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"yrot", ",", "6"}], "]"}]}], "]"}], "<>", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"yrot", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"yrot", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4221665275167055`*^9, 3.480918545842918*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"srotWrite", "[", "srot_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"srot", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: SROT, ANGLE=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"srot", ",", "6"}], "]"}]}], "]"}], "<>", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"srot", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"srot", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4221665279073334`*^9, 3.480918543874118*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sextWrite", "[", "sext_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"sext", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: SEXTUPOLE, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sext", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, K2=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sext", ",", "4"}], "]"}]}], "]"}], "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"sext", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"sext", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sext", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"sext", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665285948377`*^9, 3.42216652903234*^9}, 
   3.4809185404052787`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"driftWrite", "[", "drift_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"drift", ",", "1"}], "]"}], "]"}], "<>", "\"\<: DRIFT, L=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"drift", ",", "3"}], "]"}]}], "]"}], "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"drift", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"drift", ",", "7"}], "]"}], "]"}], "<>", "\"\<;\\n\>\""}], 
       ",", "\"\<;\\n\>\""}], "]"}]}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4221665295010934`*^9, 3.4809185378270874`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ecollWrite", "[", "ecoll_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"ecoll", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: ECOLLIMATOR, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"ecoll", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, XSIZE=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"ecoll", ",", "5"}], "]"}]}], "]"}], "<>", "\"\<, YSIZE=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"ecoll", ",", "6"}], "]"}]}], "]"}], "<>", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"ecoll", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"ecoll", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665299385962`*^9, 3.4221665307511015`*^9}, 
   3.480918534873887*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rcollWrite", "[", "rcoll_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"rcoll", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: RCOLLIMATOR, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rcoll", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, XSIZE=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rcoll", ",", "5"}], "]"}]}], "]"}], "<>", "\"\<, YSIZE=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rcoll", ",", "6"}], "]"}]}], "]"}], "<>", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"rcoll", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"rcoll", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665311886044`*^9, 3.4221665317511077`*^9}, 
   3.4809185328894615`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"markerWrite", "[", "marker_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"marker", ",", "1"}], "]"}], "]"}], "<>", "\"\<: MARKER,\>\"", 
     "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"marker", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"marker", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.480918529748756*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sbendWrite", "[", "sbend_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", "\"\<: SBEND, L=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sbend", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, K1=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sbend", ",", "4"}], "]"}]}], "]"}], "<>", " ", 
     "\"\<, Angle=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"sbend", ",", "6"}], "]"}]}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"sbend", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"sbend", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,E1=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "6", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,E2=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "6", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "7", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "7", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "8", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K2=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "8", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "9", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,H1=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "9", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "10", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,HGap=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "10", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "11", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,FInt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "11", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "12", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K3=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "12", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "13", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,FIntx=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"sbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "13", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665322042356`*^9, 3.422166536266762*^9}, 
   3.4809185234048433`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rbendWrite", "[", "rbend_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", "\"\<: RBEND, L=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rbend", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, K1=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rbend", ",", "4"}], "]"}]}], "]"}], "<>", " ", 
     "\"\<, Angle=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rbend", ",", "6"}], "]"}]}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"rbend", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"rbend", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,E1=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "6", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,E2=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "6", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "7", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "7", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "8", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K2=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "8", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "9", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,H1=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "9", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "10", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,HGap=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "10", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "11", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,FInt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "11", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "12", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K3=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "12", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "13", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,FIntx=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rbend", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "13", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665367511396`*^9, 3.422166538516776*^9}, {
  3.480918511904549*^9, 3.480918518982855*^9}, {3.480918719410185*^9, 
  3.4809187251291175`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"octWrite", "[", "oct_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"oct", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: OCTUPOLE, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"oct", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, K3=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"oct", ",", "4"}], "]"}]}], "]"}], "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"oct", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"oct", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], "]"}],
      "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"oct", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"NumberRight", "@", 
                 RowBox[{"Part", "[", 
                  RowBox[{"oct", ",", "1"}], "]"}]}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.422166539063655*^9, 3.4221665397667837`*^9}, 
   3.480918566202814*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"vkickWrite", "[", "kick_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: VKICKER, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, Kick=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "5"}], "]"}]}], "]"}], "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"kick", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"kick", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.42216653993866*^9, 3.4221665403449125`*^9}, 
   3.480918568234116*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"hkickWrite", "[", "kick_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: HKICKER, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, Kick=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "6"}], "]"}]}], "]"}], "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"kick", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"kick", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.422166540532414*^9, 3.42216654070429*^9}, 
   3.480918570374796*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"kickWrite", "[", "kick_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", "\"\<: KICKER, L=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "3"}], "]"}]}], "]"}], "<>", "\"\<, VKick=\>\"", 
     "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "5"}], "]"}]}], "]"}], "<>", "\"\<, HKick=\>\"", 
     "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"kick", ",", "6"}], "]"}]}], "]"}], "<>", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"kick", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"kick", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"kick", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665408761663`*^9, 3.4221665412042933`*^9}, 
   3.4809185737498827`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"vbpmWrite", "[", "vbpm_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"vbpm", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: VMONITOR, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"vbpm", ",", "3"}], "]"}]}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"vbpm", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"vbpm", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"vbpm", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"vbpm", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.422166541344919*^9, 3.480918576031191*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"hbpmWrite", "[", "hbpm_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"hbpm", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: HMONITOR, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"hbpm", ",", "3"}], "]"}]}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"hbpm", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"hbpm", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"hbpm", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"hbpm", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.42216654150117*^9, 3.480918578968766*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bpmWrite", "[", "bpm_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", "\"\<: MONITOR, L=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "3"}], "]"}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"bpm", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"bpm", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], "]"}],
      "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.480918581656335*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"imonitorWrite", "[", "bpm_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: IMONITOR, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "3"}], "]"}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"bpm", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"bpm", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], "]"}],
      "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.400836883750888*^9, 3.400836903032508*^9}, 
   3.4809185856251864`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"monitorWrite", "[", "bpm_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", "\"\<: MONITOR\>\"", "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"bpm", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"bpm", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], "]"}],
      "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.400836883750888*^9, 3.400836903032508*^9}, {
   3.4318134494763374`*^9, 3.431813464382778*^9}, 3.480918588109625*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"profileWrite", "[", "bpm_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", "\"\<: PROFILE, L=\>\"",
      "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"bpm", ",", "3"}], "]"}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"bpm", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"bpm", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], "]"}],
      "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tilt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"bpm", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.400836883750888*^9, 3.400836903032508*^9}, {
   3.4008373806354275`*^9, 3.4008373892137175`*^9}, 3.480918590234679*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"wireWrite", "[", "wire_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"wire", ",", "1"}], "]"}], "]"}], "<>", "\"\<: WIRE,\>\"", "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"wire", ",", "3"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\< L=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"wire", ",", "3"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"wire", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"wire", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.480918592734743*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"instrumentWrite", "[", "instrument_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"instrument", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: INSTRUMENT,\>\"", "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"instrument", ",", "3"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\< L=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"instrument", ",", "3"}], "]"}], "]"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"instrument", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"instrument", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", "\"\<;\\n\>\""}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4809185954691887`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rfcWrite", "[", "rfc_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: RFCAVITY, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"NumberRight", "@", 
       RowBox[{"Part", "[", 
        RowBox[{"rfc", ",", "3"}], "]"}]}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"rfc", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"NumberRight", "@", 
          RowBox[{"Part", "[", 
           RowBox[{"rfc", ",", "7"}], "]"}]}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Volt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "6", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Lag=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "6", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "7", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Harmon=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "7", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "8", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Betrf=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "8", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "9", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Pg=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "9", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "10", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Shunt=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "10", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "11", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Tfill=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "11", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "12", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,Freq=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberRight", "@", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"rfc", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "12", "]"}], "]"}]}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", "\"\<;\\n\>\""}], 
    "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.422166541673046*^9, 3.4221665429543047`*^9}, 
   3.480918597891125*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"matrixWrite", "[", "mat_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{"StringJoin", "[", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{"Part", "[", 
        RowBox[{"mat", ",", "1"}], "]"}], "]"}], ",", "\"\<: MATRIX\>\"", ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"mat", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
        RowBox[{"\"\<, Type=\>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Part", "[", 
           RowBox[{"mat", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
       "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Part", "[", 
                RowBox[{"mat", ",", "1"}], "]"}], "]"}], "<>", 
              "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "=!=", 
         RowBox[{"{", "}"}]}], ",", "\"\<,\>\"", ",", "\"\<\>\""}], "]"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"Apply", "[", 
       RowBox[{"Sequence", ",", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringJoin", "[", 
            RowBox[{
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"First", "[", "#", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<(\>\""}], ",", 
                 RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<)\>\""}]}], "}"}]}], 
              "]"}], ",", "\"\<=\>\"", ",", 
             RowBox[{"ToString", "[", 
              RowBox[{"NumberRight", "@", 
               RowBox[{"Part", "[", 
                RowBox[{"#", ",", "2"}], "]"}]}], "]"}], ",", 
             "\"\<,&\\n\>\""}], "]"}], "&"}], ",", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"mat", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Part", "[", 
                RowBox[{"mat", ",", "1"}], "]"}], "]"}], "<>", 
              "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "=!=", 
         RowBox[{"{", "}"}]}], ",", "\"\<,\>\"", ",", "\"\<\>\""}], "]"}], 
      ",", 
      RowBox[{"Apply", "[", 
       RowBox[{"Sequence", ",", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringJoin", "[", 
            RowBox[{"\"\<,\>\"", ",", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"First", "[", "#", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<(\>\""}], ",", 
                 RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<)\>\""}]}], "}"}]}], 
              "]"}], ",", "\"\<=\>\"", ",", 
             RowBox[{"ToString", "[", 
              RowBox[{"NumberRight", "@", 
               RowBox[{"Part", "[", 
                RowBox[{"#", ",", "2"}], "]"}]}], "]"}]}], "]"}], "&"}], ",", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"mat", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Part", "[", 
                RowBox[{"mat", ",", "1"}], "]"}], "]"}], "<>", 
              "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
          RowBox[{"[", "5", "]"}], "]"}], "=!=", 
         RowBox[{"{", "}"}]}], ",", "\"\<,\>\"", ",", "\"\<\>\""}], "]"}], 
      ",", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"Sequence", ",", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"StringJoin", "[", 
             RowBox[{
              RowBox[{"StringReplace", "[", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"First", "[", "#", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<(\>\""}], ",", 
                  RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<)\>\""}]}], "}"}]}], 
               "]"}], ",", "\"\<=\>\"", ",", 
              RowBox[{"ToString", "[", 
               RowBox[{"NumberRight", "@", 
                RowBox[{"Part", "[", 
                 RowBox[{"#", ",", "2"}], "]"}]}], "]"}], ",", 
              "\"\<,&\\n\>\""}], "]"}], "&"}], ",", 
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"Part", "[", 
                  RowBox[{"mat", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "]"}], 
       "\"\<;\\n\>\""}]}], "]"}], "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665431105556`*^9, 3.4221665432668066`*^9}, {
   3.429960124152872*^9, 3.429960128043522*^9}, {3.431812010895424*^9, 
   3.4318120160048637`*^9}, 3.43181218916333*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lcavWrite", "[", "lcav_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: LCAVITY, L=\>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"lcav", ",", "3"}], "]"}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"lcav", ",", "7"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<, Type=\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Part", "[", 
          RowBox[{"lcav", ",", "7"}], "]"}], "]"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,DELTAE=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "6", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,PHI0=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "6", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "7", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,FREQ=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "7", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "8", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,ELOSS=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "8", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "9", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,VOLTERR=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "9", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "10", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,LAGERR=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "10", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "11", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,NBIN=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "11", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "12", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,BINMAX=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "12", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "13", "]"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<,LFILE=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "13", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "14", "]"}], "]"}], "=!=", "\"\<\>\""}], ",", 
       RowBox[{"\"\<,TFILE=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"lcav", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "14", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}],
       "]"}], "<>", "\[IndentingNewLine]", "\"\<;\\n\>\""}], "]"}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4809186027975006`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"multipoleWrite", "[", "multipole_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
     "\"\<: MULTIPOLE\>\"", "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,LRAD=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Part", "[", 
                 RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
               "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ")"}]}], ",", "\"\<\>\""}], 
      "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "6", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K0L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "6", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "7", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T0=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "7", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "8", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K1L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "8", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "9", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T1=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "9", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "10", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K2L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "10", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "11", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T2=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "11", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "12", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K3L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "12", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "13", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T3=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "13", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "14", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K4L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "14", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "15", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T4=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "15", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "16", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K5L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "16", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "17", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T5=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "17", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "18", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K6L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "18", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "19", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T6=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "19", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "20", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K7L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "20", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "21", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T7=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "21", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "22", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K8L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "22", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "23", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T8=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "23", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "24", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,K9L=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "24", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"Symbol", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
             "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
         RowBox[{"[", "25", "]"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"\"\<,T9=\>\"", "<>", 
        RowBox[{"(", 
         RowBox[{"ToString", "[", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Part", "[", 
                   RowBox[{"multipole", ",", "1"}], "]"}], "]"}], "<>", 
                 "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
             RowBox[{"[", "25", "]"}], "]"}], ",", 
            RowBox[{"ExponentFunction", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], ")"}]}], ",", 
       "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", "\"\<;\\n\>\""}], 
    "]"}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{3.4809186060632095`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"freetextWrite", "[", "freetext_", "]"}], ":=", 
  RowBox[{"MADFileWrite", "[", 
   RowBox[{"MADString", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{"Part", "[", 
            RowBox[{"freetext", ",", "1"}], "]"}], "]"}], "<>", 
          "\"\<Extra\>\""}], ")"}]}], "]"}], "[", 
      RowBox[{"[", "3", "]"}], "]"}], "<>", "\"\<;\\n\>\""}], "]"}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.4809185954691887`*^9, {3.5424490018265843`*^9, 3.542449033187677*^9}, {
   3.542449398768284*^9, 3.5424494022026157`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADBeam", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADBeam", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "particle", ",", "mass", ",", "charge", ",", "energy", ",", "pc", ",", 
      "gamma", ",", "ex", ",", "exn", ",", "ey", ",", "eyn", ",", "et", ",", 
      "sigt", ",", "sige", ",", "kbunch", ",", "npart", ",", "bcurrent", ",", 
      "bunched", ",", "radiate", ",", "ptrue", ",", "etrue", ",", 
      RowBox[{"newline", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"particle", "=", 
      RowBox[{
       RowBox[{"Particle", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringMatchQ", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "particle", "]"}], ",", "\"\<electron\>\"", 
         ",", 
         RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], ",", 
       RowBox[{"ptrue", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringMatchQ", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "particle", "]"}], ",", "\"\<positron\>\"", 
         ",", 
         RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], ",", 
       RowBox[{"ptrue", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringMatchQ", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "particle", "]"}], ",", "\"\<proton\>\"", 
         ",", 
         RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], ",", 
       RowBox[{"ptrue", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringMatchQ", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "particle", "]"}], ",", 
         "\"\<anti-proton\>\"", ",", 
         RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], ",", 
       RowBox[{"ptrue", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"mass", "=", 
      RowBox[{
       RowBox[{"Mass", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"charge", "=", 
      RowBox[{
       RowBox[{"Charge", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"energy", "=", 
      RowBox[{
       RowBox[{"Energy", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ptrue", "===", "1"}], ",", 
       RowBox[{
        RowBox[{"mass", "=", "0"}], ";", 
        RowBox[{"charge", "=", "0"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"pc", "=", 
      RowBox[{
       RowBox[{"Pc", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gamma", "=", 
      RowBox[{
       RowBox[{"Gamma", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{
       RowBox[{"Ex", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ey", "=", 
      RowBox[{
       RowBox[{"Ey", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"et", "=", 
      RowBox[{
       RowBox[{"Et", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"exn", "=", 
      RowBox[{
       RowBox[{"Exn", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eyn", "=", 
      RowBox[{
       RowBox[{"Eyn", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sigt", "=", 
      RowBox[{
       RowBox[{"Sigt", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sige", "=", 
      RowBox[{
       RowBox[{"Sige", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"kbunch", "=", 
      RowBox[{
       RowBox[{"KBunch", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"npart", "=", 
      RowBox[{
       RowBox[{"NPart", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bcurrent", "=", 
      RowBox[{
       RowBox[{"BCurrent", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bunched", "=", 
      RowBox[{
       RowBox[{"Bunched", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"radiate", "=", 
      RowBox[{
       RowBox[{"Radiate", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBeam", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"beamline", "=", 
      RowBox[{"\"\<Beam,\>\"", "<>", "\"\<Particle=\>\"", "<>", 
       RowBox[{"ToString", "[", "particle", "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "particle", "]"}], ",", 
            "\"\<electron\>\"", ",", 
            RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], "||", 
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "particle", "]"}], ",", 
            "\"\<positron\>\"", ",", 
            RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], "||", 
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "particle", "]"}], ",", "\"\<proton\>\"",
             ",", 
            RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], "||", 
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "particle", "]"}], ",", 
            "\"\<anti-proton\>\"", ",", 
            RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}]}], ",", 
         "\"\<\>\"", ",", 
         RowBox[{"\"\<,charge=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "charge", "]"}], "]"}], "<>", 
          "\"\<,mass=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "mass", "]"}], "]"}]}]}], "]"}], "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"energy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,energy=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "energy", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"pc", "=!=", "0"}], ",", 
         RowBox[{"\"\<,pc=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "pc", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"gamma", "=!=", "0"}], ",", 
         RowBox[{"\"\<,gamma=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "gamma", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "=!=", "0"}], ",", 
         RowBox[{"\"\<,ex=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "ex", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ey", "=!=", "0"}], ",", 
         RowBox[{"\"\<,ey=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "ey", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"et", "=!=", "0"}], ",", 
         RowBox[{"\"\<,et=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "et", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ex", "===", "0"}], "||", 
          RowBox[{"ey", "===", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"exn", "=!=", "0"}], ",", 
            RowBox[{"\"\<,exn=\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"NumberRight", "[", "exn", "]"}], "]"}]}], ",", 
            "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"eyn", "=!=", "0"}], ",", 
            RowBox[{"\"\<,eyn=\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"NumberRight", "[", "eyn", "]"}], "]"}]}], ",", 
            "\"\<\>\""}], "]"}]}], "\[IndentingNewLine]", ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sige", "=!=", "0"}], ",", 
         RowBox[{"\"\<,sige=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "sige", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sigt", "=!=", "0"}], ",", 
         RowBox[{"\"\<,sigt=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "sigt", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kbunch", "=!=", "0"}], ",", 
         RowBox[{"\"\<,kbunch=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "kbunch", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"npart", "=!=", "0"}], ",", 
         RowBox[{"\"\<,npart=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "npart", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"bcurrent", "=!=", "0"}], ",", 
         RowBox[{"\"\<,bcurrent=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberRight", "[", "bcurrent", "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"bunched", "===", "True"}], ",", "\"\<,&\\nbunched=True\>\"",
          ",", "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"radiate", "===", "True"}], ",", "\"\<,radiate=True\>\"", 
         ",", "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"MADFileName", ",", "beamline"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4221665434386826`*^9, 3.422166545798073*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADUseMonitors", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADUseMonitors", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "monuse", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"MADStringWrite", "[", 
        RowBox[{"MADFileName", ",", 
         RowBox[{"\"\<usemonitor,on,\>\"", "<>", 
          RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<;\\n\>\""}]}], 
        "]"}], "&"}], " ", "/@", "opts"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADMonitors", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADMonitors", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", "\"\<These Monitors are available:\>\"", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MADElementFind", "[", 
      RowBox[{"data", ",", 
       RowBox[{"Elements", "\[Rule]", "True"}], ",", 
       RowBox[{"Equals", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "\"\<HBPM\>\""}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "\"\<VBPM\>\""}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "\"\<BPM\>\""}], "}"}]}], "}"}]}], ",", 
       RowBox[{"Monitor", "\[Rule]", "True"}], ",", 
       RowBox[{"TableHeadings", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Name\>\"", ",", "\"\<Element\>\"", ",", "\"\<Length\>\"", 
            ",", "\"\<Focus\>\"", ",", "\"\<VAngle\>\"", ",", 
            "\"\<HAngle\>\"", ",", "\"\<Type\>\"", ",", "\"\<Position\>\""}], 
           "}"}]}], "}"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"34825302-96fc-4c46-8ef3-b246a2af6794"]
}, Closed]],

Cell[CellGroupData[{

Cell["MADmakeMonitorList", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADmakeMonitorList", "[", "data_List", "]"}], ":=", 
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{"MADmonlist", "=", 
      RowBox[{"{", "}"}]}], ";", 
     RowBox[{"MADElementFind", "[", 
      RowBox[{"data", ",", 
       RowBox[{"Elements", "\[Rule]", "True"}], ",", 
       RowBox[{"Equals", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "\"\<HBPM\>\""}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "\"\<VBPM\>\""}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "\"\<BPM\>\""}], "}"}]}], "}"}]}], ",", 
       RowBox[{"Monitor", "\[Rule]", "True"}]}], "]"}], ";"}], "]"}]}], 
  ";"}]], "Input",
 Evaluatable->True,ExpressionUUID->"e7bd82f2-1bc7-443c-819b-617925501483"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADmakeMonitorListOld", "[", "data_List", "]"}], ":=", 
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{"MADmonlist", "=", 
      RowBox[{"{", "}"}]}], ";", 
     RowBox[{"MADLengthAdd", "[", "data", "]"}], ";", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringMatchQ", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", "\"\<VBPM\>\""}], "]"}], "||", 
           RowBox[{"StringMatchQ", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", "\"\<HBPM\>\""}], "]"}], "||", 
           RowBox[{"StringMatchQ", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", "\"\<BPM\>\""}], "]"}]}], 
          ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"MADmonlist", ",", "#"}], "]"}]}], "]"}], ")"}], "&"}], 
      " ", "/@", " ", "MADInfoData"}]}], "]"}]}], ";"}]], "Input",
 Evaluatable->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADElementFind", "Subsection",ExpressionUUID->"75b8dc83-119a-4970-b5a2-66d5ca74b9ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElementFind", "[", 
   RowBox[{"data_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data2", ",", "pos", ",", "equaldata", ",", "greatdata", ",", 
      "lesserdata", ",", "equals", ",", "greater", ",", "less", ",", 
      "MADelementlist", ",", "columns", ",", "optTable", ",", "ApertureListx",
       ",", "ApertureListxy", ",", "apertures"}], "}"}], ",", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"Pos", "/.", "\[InvisibleSpace]", 
       RowBox[{"{", "Extra", "}"}]}]}], ";", 
     RowBox[{"equaldata", "=", 
      RowBox[{"Equals", "/.", "\[InvisibleSpace]", 
       RowBox[{"{", "Extra", "}"}]}]}], ";", 
     RowBox[{"greatdata", "=", 
      RowBox[{"Greater", "/.", "\[InvisibleSpace]", 
       RowBox[{"{", "Extra", "}"}]}]}], ";", 
     RowBox[{"lesserdata", "=", 
      RowBox[{"Less", "/.", "\[InvisibleSpace]", 
       RowBox[{"{", "Extra", "}"}]}]}], ";", 
     RowBox[{"columns", "=", 
      RowBox[{"Columns", "/.", "\[InvisibleSpace]", 
       RowBox[{"{", "Extra", "}"}]}]}], ";", 
     RowBox[{"apertures", "=", 
      RowBox[{"Apertures", "/.", "\[InvisibleSpace]", 
       RowBox[{"{", "Extra", "}"}]}]}], ";", 
     RowBox[{"sortcolumn", "=", 
      RowBox[{
       RowBox[{"SortBy", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "Extra", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"{", 
        RowBox[{"SortBy", "\[Rule]", "8"}], "}"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"columns", "===", "Columns"}], ",", 
       RowBox[{"columns", "=", 
        RowBox[{"Length", "[", 
         RowBox[{
         "data", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "]"}]}]}], "]"}], ";", 
     RowBox[{"optTable", "=", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "Extra", "}"}], "]"}], ",", 
         RowBox[{"Options", "[", "TableForm", "]"}]}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Elements", "/.", "\[InvisibleSpace]", 
          RowBox[{"{", "Extra", "}"}]}], ")"}], "===", "True"}], ",", 
       RowBox[{
        RowBox[{"MADLengthAdd", "[", "data", "]"}], ";", 
        RowBox[{"columns", "=", "8"}], ";", 
        RowBox[{"AppendTo", "[", 
         RowBox[{
          RowBox[{"{", "optTable", "}"}], ",", 
          RowBox[{"TableHeadings", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Automatic", ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<Name\>\"", ",", "\"\<Element\>\"", ",", "\"\<Length\>\"", 
               ",", "\"\<Focus\>\"", ",", "\"\<VAngle\>\"", ",", 
               "\"\<HAngle\>\"", ",", "\"\<Type\>\"", ",", 
               "\"\<Position\>\""}], "}"}]}], "}"}]}]}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"MADInfoData", "=", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "data", "]"}], ",", "columns"}], "]"}]}], 
        ";", 
        RowBox[{"AppendTo", "[", 
         RowBox[{
          RowBox[{"{", "optTable", "}"}], ",", 
          RowBox[{"TableHeadings", "\[Rule]", "Automatic"}]}], "]"}], ";"}]}],
       "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Equals", "/.", "\[InvisibleSpace]", 
          RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "Equals"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ListQ", "[", "equaldata", "]"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", "equaldata", "]"}], "]"}], ">", "2"}]}], 
         ",", 
         RowBox[{"equals", "=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Extract", "[", 
              RowBox[{"MADInfoData", ",", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"MADInfoData", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", 
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                 ",", 
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], "&"}], ")"}], "/@",
            "equaldata"}]}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ListQ", "[", "equaldata", "]"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"Flatten", "[", "equaldata", "]"}], "]"}], "===", 
             "2"}]}], ",", 
           RowBox[{"equals", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"MADInfoData", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#1", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "equaldata", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], "===", 
                RowBox[{
                "equaldata", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], "&"}]}], "]"}]}], ",", 
           RowBox[{"equals", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"MADInfoData", ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "pos", 
                 "\[RightDoubleBracket]"}], "===", "equaldata"}], "&"}]}], 
             "]"}]}]}], "]"}]}], "]"}], ",", 
       RowBox[{"equals", "=", 
        RowBox[{"{", "}"}]}]}], "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Greater", "/.", "\[InvisibleSpace]", 
          RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "Greater"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ListQ", "[", "greatdata", "]"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", "greatdata", "]"}], "]"}], ">", "2"}]}], 
         ",", 
         RowBox[{"greater", "=", 
          RowBox[{"Union", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"MADInfoData", ",", 
                RowBox[{
                 RowBox[{"data2", "=", 
                  RowBox[{
                  "#1", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{"MADInfoData", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", 
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                   ",", 
                   RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", ">", "data2"}], "&"}], ")"}]}]}], "]"}]}]}],
                "]"}], "&"}], ")"}], "/@", "greatdata"}], "]"}]}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ListQ", "[", "greatdata", "]"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"Flatten", "[", "greatdata", "]"}], "]"}], "===", 
             "2"}]}], ",", 
           RowBox[{"greater", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"MADInfoData", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#1", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "greatdata", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], ">", 
                RowBox[{
                "greatdata", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], "&"}]}], "]"}]}], ",", 
           RowBox[{"greater", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"MADInfoData", ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "pos", 
                 "\[RightDoubleBracket]"}], ">", "greatdata"}], "&"}]}], 
             "]"}]}]}], "]"}]}], "]"}], ",", 
       RowBox[{"greater", "=", 
        RowBox[{"{", "}"}]}]}], "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Less", "/.", "\[InvisibleSpace]", 
          RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "Less"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ListQ", "[", "lesserdata", "]"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", "lesserdata", "]"}], "]"}], ">", "2"}]}], 
         ",", 
         RowBox[{"less", "=", 
          RowBox[{"Union", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"MADInfoData", ",", 
                RowBox[{
                 RowBox[{"data2", "=", 
                  RowBox[{
                  "#1", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}], ";", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{"MADInfoData", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", 
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                   ",", 
                   RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#1", "<", "data2"}], "&"}], ")"}]}]}], "]"}]}]}],
                "]"}], "&"}], ")"}], "/@", "lesserdata"}], "]"}]}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ListQ", "[", "lesserdata", "]"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"Flatten", "[", "lesserdata", "]"}], "]"}], "===", 
             "2"}]}], ",", 
           RowBox[{"less", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"MADInfoData", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#1", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "lesserdata", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], "<", 
                RowBox[{
                "lesserdata", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], "&"}]}], "]"}]}], ",", 
           RowBox[{"less", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"MADInfoData", ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "pos", 
                 "\[RightDoubleBracket]"}], "<", "lesserdata"}], "&"}]}], 
             "]"}]}]}], "]"}]}], "]"}], ",", 
       RowBox[{"less", "=", 
        RowBox[{"{", "}"}]}]}], "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Equals", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "Equals"}], "||", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Greater", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "Greater"}], "||", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Less", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "Less"}]}], ",", 
       RowBox[{
        RowBox[{"MADelementlist", "=", 
         RowBox[{"Sort", "[", 
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"equals", ",", "greater", ",", "less"}], "}"}], "]"}], 
             ",", "columns"}], "]"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "sortcolumn", 
              "\[RightDoubleBracket]"}], "<", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "sortcolumn", 
              "\[RightDoubleBracket]"}]}], "&"}]}], "]"}]}], ";"}], ",", 
       RowBox[{
        RowBox[{"MADelementlist", "=", "MADInfoData"}], ";"}]}], "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"apertures", "===", "True"}], ",", 
       RowBox[{
        RowBox[{"ApertureListx", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "[", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "]"}], "<>", "\"\<Extra\>\""}], "]"}], "]"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "&"}], 
           ")"}], "/@", "MADelementlist"}]}], ";", 
        RowBox[{"ApertureListy", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"Symbol", "[", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "]"}], "<>", "\"\<Extra\>\""}], "]"}], "]"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], "&"}], 
           ")"}], "/@", "MADelementlist"}]}], ";", 
        RowBox[{"MADelementlist", "=", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"MapThread", "[", 
             RowBox[{"List", ",", 
              RowBox[{"{", 
               RowBox[{
               "MADelementlist", ",", "ApertureListx", ",", "ApertureListy"}],
                "}"}]}], "]"}], "]"}], ",", 
           RowBox[{"columns", "+", "2"}]}], "]"}]}], ";"}]}], "]"}], ";", 
     RowBox[{"Print", "[", 
      TagBox["MADelementlist",
       Function[BoxForm`e$, 
        TableForm[BoxForm`e$, NotebookCompatibility`Dump`Symbols`optTable]]], 
      "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Elements", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "Extra", "}"}]}], ")"}], "===", "True"}], "&&", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Monitor", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "Extra", "}"}]}], ")"}], "=!=", "True"}]}], ",", 
       RowBox[{"MADSumLength", "[", "MADelementlist", "]"}]}], "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Monitor", "/.", "\[InvisibleSpace]", 
          RowBox[{"{", "Extra", "}"}]}], ")"}], "===", "True"}], ",", 
       RowBox[{"MADmonlist", "=", "MADelementlist"}]}], "]"}], ";"}]}], 
   "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"c4d02006-a0dd-4620-b58b-04e7351b68cd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADelementFindOld", "[", 
   RowBox[{"data_", ",", "element_", ",", "Extra___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{
     RowBox[{"MADmakeElementList", "[", 
      RowBox[{"data", ",", "element", ",", "Extra"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"TableForm", "[", "Global`MADelementlist", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Elements", "/.", 
          RowBox[{"{", "Extra", "}"}]}], ")"}], "===", "True"}], ",", 
       RowBox[{"MADSumLength", "[", "Global`MADelementlist", "]"}]}], "]"}], 
     ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",ExpressionUUID->\
"0a9a1977-54cf-4f17-9372-d405182777d1"]
}, Closed]],

Cell[CellGroupData[{

Cell["MADmakeElementList", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADmakeElementList", "[", 
    RowBox[{"data_", ",", "element_", ",", "Extra___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "pos", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pos", "=", 
       RowBox[{
        RowBox[{"Pos", "/.", 
         RowBox[{"{", "Extra", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADmakeElementList", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Global`MADelementlist", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"MADLengthAdd", "[", "data", "]"}], ";", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringMatchQ", "[", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"Part", "[", 
               RowBox[{"#", ",", "pos"}], "]"}], "]"}], ",", 
             RowBox[{"ToString", "[", "element", "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Global`MADelementlist", ",", "#"}], "]"}]}], "]"}], 
         ")"}], "&"}], " ", "/@", " ", "MADInfoData"}]}]}], "]"}]}], 
  ";"}]], "Input",
 Evaluatable->True,ExpressionUUID->"4555b9fc-c2be-43e4-b73d-694231c67286"]
}, Closed]],

Cell[CellGroupData[{

Cell["MADOrbitPlotFile", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOrbitPlotFile", "[", 
   RowBox[{"file_String", ",", 
    RowBox[{"line_:", "MADLineName"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "b", ",", "c", ",", "d", ",", "ex", ",", "fx", ",", "gx", ",", 
      "ey", ",", "fy", ",", "gy", ",", "x"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x", "=", 
       RowBox[{"(", 
        RowBox[{"ReadList", "[", 
         RowBox[{"file", ",", "Word", ",", 
          RowBox[{"WordSeparators", "\[Rule]", 
           RowBox[{"{", "\"\< \>\"", "}"}]}], ",", 
          RowBox[{"NullWords", "\[Rule]", "False"}]}], "]"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{"(", 
        RowBox[{"Drop", "[", 
         RowBox[{"x", ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{
              RowBox[{"Part", "[", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"x", ",", "\"\<TIME\>\""}], "]"}], ",", "1"}], "]"}],
               ",", "1"}], "]"}], "+", "2"}], ")"}]}], "]"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"(", 
        RowBox[{"Partition", "[", 
         RowBox[{"a", ",", "4"}], "]"}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", "4", "}"}]}], "]"}], "&"}], "/@", "b"}], ")"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"d", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "/@", "c"}], ")"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ex", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Part", "[", 
           RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "d"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fx", "=", 
       RowBox[{"(", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"ex", ",", "\"\<0.00000\>\""}], "]"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gx", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{
            RowBox[{"StringToStream", "[", "#", "]"}], ",", "Number"}], "]"}],
           "&"}], "/@", "fx"}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MADOrbitDatax", "=", 
       RowBox[{"Flatten", "[", "gx", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ey", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Part", "[", 
           RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", "d"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fy", "=", 
       RowBox[{"(", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"ey", ",", "\"\<0.00000\>\""}], "]"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gy", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{
            RowBox[{"StringToStream", "[", "#", "]"}], ",", "Number"}], "]"}],
           "&"}], "/@", "fy"}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MADOrbitDatay", "=", 
       RowBox[{"(", 
        RowBox[{"Flatten", "[", "gy", "]"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MADOrbitPlotLine", "[", "line", "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADOrbitPlotLine", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOrbitPlotLine", "[", 
   RowBox[{"line_", ":", 
    RowBox[{"ToString", "[", "MADLineName", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "by", ",", "bx", ",", "cy", ",", "cx"}], "}"}], ",", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"MADmakeMonitorList", "[", "line", "]"}], ";", 
      RowBox[{"a", "=", "MADmonlist"}], ";", 
      RowBox[{"by", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"a", ",", 
         RowBox[{"{", 
          RowBox[{
          "_", ",", "\"\<HBPM\>\"", ",", "_", ",", "_", ",", "_", ",", "_", 
           ",", "_", ",", "_"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"bx", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"a", ",", 
         RowBox[{"{", 
          RowBox[{
          "_", ",", "\"\<VBPM\>\"", ",", "_", ",", "_", ",", "_", ",", "_", 
           ",", "_", ",", "_"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"cy", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "#1", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], "&"}],
          ")"}], "/@", "by"}]}], ";", 
      RowBox[{"Print", "[", "cy", "]"}], ";", 
      RowBox[{"cx", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "#1", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], "&"}],
          ")"}], "/@", "bx"}]}], ";", 
      RowBox[{"dx", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{"cx", ",", "MADOrbitDatax"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"dy", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{"cy", ",", "MADOrbitDatay"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dx", ",", "dy"}], "}"}], ",", 
        RowBox[{"Joined", "\[Rule]", "True"}], ",", 
        RowBox[{"AxesLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<S (m)\>\"", ",", "\"\<Deviation (mm)\>\""}], "}"}]}], 
        ",", 
        RowBox[{"PlotLegend", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}]}], "]"}]}], 
     "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADPlot", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPlot", "[", 
   RowBox[{"file_String", ":", "\"\<mad.metafile.ps\>\""}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "graphic", "}"}], ",", 
    RowBox[{
     RowBox[{"graphic", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"\"\<Mad.metafile.ps\>\"", ",", "\"\<PSImage\>\""}], "]"}]}], 
     ";", 
     RowBox[{"Show", "[", "graphic", "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Not sure what these are for?", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"orbitFix", "[", 
   RowBox[{"line_:", "MADLineName"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"by", ",", "bx", ",", "cy", ",", "cx", ",", "x2", ",", "y2"}], 
     "}"}], ",", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"MADmakeMonitorList", "[", "line", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"by", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"MAD", ",", 
         RowBox[{"{", 
          RowBox[{
          "_", ",", "\"\<HBPM\>\"", ",", "_", ",", "_", ",", "_", ",", "_", 
           ",", "_", ",", "_"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bx", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"monlist", ",", 
         RowBox[{"{", 
          RowBox[{
          "_", ",", "\"\<VBPM\>\"", ",", "_", ",", "_", ",", "_", ",", "_", 
           ",", "_", ",", "_"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cy", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"#", ",", "8"}], "]"}], "&"}], "/@", "by"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cx", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"#", ",", "8"}], "]"}], "&"}], "/@", "bx"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{"X", ",", 
         RowBox[{"Position", "[", 
          RowBox[{"monlist", ",", 
           RowBox[{"{", 
            RowBox[{
            "_", ",", "\"\<VBPM\>\"", ",", "_", ",", "_", ",", "_", ",", "_", 
             ",", "_", ",", "_"}], "}"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"y2", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{"Y", ",", 
         RowBox[{"Position", "[", 
          RowBox[{"monlist", ",", 
           RowBox[{"{", 
            RowBox[{
            "_", ",", "\"\<HBPM\>\"", ",", "_", ",", "_", ",", "_", ",", "_", 
             ",", "_", ",", "_"}], "}"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"X2", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{"cx", ",", "X2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Y2", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{"cy", ",", "Y2"}], "}"}]}], "]"}]}], ";"}], "]"}]}], 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"lengthPlotAdd", "[", 
   RowBox[{"list_List", ",", 
    RowBox[{"line_:", "MADLineName"}]}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"Part", "[", 
       RowBox[{"list", ",", "1"}], "]"}], "]"}], ">", "7"}], ",", "list", ",", 
    RowBox[{"MapThread", "[", 
     RowBox[{"List", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{"#", ",", "8"}], "]"}], "&"}], "/@", 
          RowBox[{"lengthAdd", "[", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"StringQ", "[", "line", "]"}], ",", 
             RowBox[{"Symbol", "[", "line", "]"}], ",", "line"}], "]"}], 
           "]"}]}], ")"}], ",", "list"}], "}"}]}], "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["mfsPlot", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mfsPlot", "[", 
   RowBox[{"var_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Sequence", "@@", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Depth", "[", "#", "]"}], "<", "4"}], ",", 
           RowBox[{"MapThread", "[", 
            RowBox[{"List", ",", "#1"}], "]"}], ",", 
           RowBox[{"Sequence", "@@", "#1"}]}], "]"}], "&"}], ")"}], "/@", 
       "var"}]}], "}"}], ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Options", "[", "mfsPlot", "]"}], ",", 
       RowBox[{"{", "opts", "}"}]}], "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.3878805527338476`*^9, 3.387880553686936*^9}, 
   3.3942625962086205`*^9, 3.394273047378564*^9, {3.3942741565065255`*^9, 
   3.394274158381513*^9}, {3.3943506138540287`*^9, 3.39435061683827*^9}, {
   3.3943508988256364`*^9, 3.3943509008724194`*^9}, 3.394350999461753*^9, {
   3.394351116050279*^9, 3.394351119143891*^9}, {3.3943511518299265`*^9, 
   3.3943511568609505`*^9}, {3.3943511918281345`*^9, 
   3.3943512174519863`*^9}, {3.4674083216949997`*^9, 3.467408342935*^9}, {
   3.4674084020480003`*^9, 3.467408402467*^9}, {3.467408664828*^9, 
   3.46740866904*^9}, {3.4674092861809998`*^9, 3.467409293449*^9}, {
   3.4674094084779997`*^9, 3.467409414543*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["RunMAD", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ServerRunMAD", "[", "file_", "]"}], ":=", 
   RowBox[{"Run", "[", 
    RowBox[{
    "\"\<\\\\\\\\Sroserve\\\\ap\\\\Software\\\\MAD\\\\MAD8dl\\\\mad8dl.bat \>\
\"", "<>", 
     RowBox[{"Directory", "[", "]"}], "<>", "\"\<\\\\\>\"", "<>", 
     RowBox[{"ToString", "[", "file", "]"}]}], "]"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"getShortDirectory", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{"ReadList", "[", 
       RowBox[{"\"\<!for %I in (.) do %~sI\>\"", ",", "String"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Directory", "[", "]"}], "<>", "\"\<>\>\""}], "\[Rule]", 
       "\"\<\>\""}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<\\\\\>\""}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.7253846622670584`*^9, 
  3.7253847174240584`*^9}},ExpressionUUID->"af512216-c3bc-440b-834b-\
c45a538b254c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"getShortDirectory", "[", "]"}]], "Input",ExpressionUUID->"82d8eb07-74ee-4c40-bb49-d424cef0b9de"],

Cell[BoxData["\<\"F:\\\\MYDOCU~1\\\\MATHEM~1\\\\CLARA\\\\CLARA_~1\\\\SHORT_~1\
\\\\\"\>"], "Output",
 CellChangeTimes->{{3.7253847061540585`*^9, 
  3.7253847195710583`*^9}},ExpressionUUID->"e97a0e0f-de49-49ec-b3ad-\
dd44c5d86fd6"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RunMAD", "[", "file_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"DirectoryName", "[", "file", "]"}], "===", "\"\<\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{
           RowBox[{"\"\<!\>\"", "<>", "\"\<c:\\\\MAD8dl\\\\mad8dl.bat \>\"", "<>", 
            RowBox[{"getShortDirectory", "[", "]"}], "<>", "\"\<\\\\\>\"", "<>", 
            RowBox[{"ToString", "[", "file", "]"}]}], ",", "\"\<String\>\""}],
           "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Import", "[", 
         RowBox[{
          RowBox[{"\"\<!\>\"", "<>", "\"\<c:\\\\MAD8dl\\\\mad8dl.bat \>\"", "<>", 
           RowBox[{"ToString", "[", "file", "]"}]}], ",", "\"\<String\>\""}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4535433324922295`*^9, 3.4535434030074034`*^9}, {
   3.45354343711656*^9, 3.453543441663406*^9}, {3.4964117396868553`*^9, 
   3.4964117477839794`*^9}, 
   3.7253847238650584`*^9},ExpressionUUID->"d1ee3d60-a8f9-437c-a468-\
dedc2ecfd836"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RunMADX", "[", "file_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{
      RowBox[{"Import", "[", 
       RowBox[{
        RowBox[{"\"\<!\>\"", "<>", "\"\<c:\\\\MADX\\\\MADX.bat \>\"", "<>", 
         RowBox[{"Directory", "[", "]"}], "<>", "\"\<\\\\\>\"", "<>", 
         RowBox[{"ToString", "[", "file", "]"}]}], ",", "\"\<String\>\""}], 
       "]"}], ";", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.498993437643897*^9, 3.498993451626026*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADTracking", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADTracking", "[", 
   RowBox[{"data_", ",", "turns_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "method"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MADTrackData", "=", "data"}], ";", "\[IndentingNewLine]", 
     RowBox[{"method", "=", 
      RowBox[{
       RowBox[{"Method", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTracking", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", "\"\<track;\\n\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<start,x=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "1"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,y=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,deltap=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "3"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<;\\n\>\""}], "&"}], "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "data", "]"}], ",", "3"}], "]"}]}], ")"}]}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"MADFileName", ",", 
       RowBox[{"a", "<>", "b", "<>", "\"\<run,method=\>\"", "<>", 
        RowBox[{"ToString", "[", "method", "]"}], "<>", "\"\<,turns=\>\"", "<>", 
        RowBox[{"ToString", "[", "turns", "]"}], "<>", "\[IndentingNewLine]", 
        "\"\<,table=ttrack;\\nArchive,table=ttrack,filename=trackht.dat;\\\
nendtrack;\\n\>\""}]}], "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.482777315774027*^9, 3.482777315992796*^9}, {
  3.53641630549617*^9, 3.53641633327742*^9}}],

Cell["\<\
MADTracking[data_, turns_, opts___] := Block[{a, b, method, datafile}, \
datafile = OpenAppend[ToString[MADFileName]];
  MADTrackData = data;
  method = Method /. {opts} /. Options[MADTracking];
  a = \"track;\\n\";
  b = (\"start,x=\" <> ToString[NumberForm[Part[#, 1], ExponentFunction -> \
(Null &)]] <> \",y=\" <> ToString[NumberForm[Part[#, 2], ExponentFunction -> \
(Null &)]] <> \",deltap=\" <> ToString[NumberForm[Part[#, 3], \
ExponentFunction -> (Null &)]] <> \";\\n\" & /@ Partition[Flatten[data], 3]);
  
  WriteString[datafile, a <> b <> \"run,method=\" <> ToString[method] <> \
\",turns=\" <> ToString[turns] <>
    \",table=ttrack;\\nArchive,table=ttrack,filename=trackht.dat;\\nendtrack;\
\\n\"];
  Close[datafile];]\
\>", "Text",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.482777315774027*^9, 3.482777315992796*^9}, 
   3.536416302918045*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADcreateData", "[", 
   RowBox[{
   "xmin_", ",", "xmax_", ",", "xstep_", ",", "ymin_", ",", "ymax_", ",", 
    "ystep_", ",", "deltap_"}], "]"}], ":=", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"TrackData", "=", 
     RowBox[{"{", "}"}]}], ";", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"AppendTo", "[", 
       RowBox[{"TrackData", ",", 
        RowBox[{"{", 
         RowBox[{"\[Iota]", ",", "\[CurlyPhi]", ",", "deltap"}], "}"}]}], 
       "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Iota]", ",", "xmin", ",", "xmax", ",", "xstep"}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"\[CurlyPhi]", ",", "ymin", ",", "ymax", ",", "ystep"}], 
       "}"}]}], "]"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADTrackingJAV", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "method", ",", "datafile"}], "}"}], ",", 
    RowBox[{
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", 
       RowBox[{"ToString", "[", "MADFileName", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADTrackData", "=", "data"}], ";", "\[IndentingNewLine]", 
     RowBox[{"method", "=", 
      RowBox[{
       RowBox[{"Method", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTracking", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", "\"\<track;\\n\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<start,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "1"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "3"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "4"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "5"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "6"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<;\\n\>\""}], "&"}], "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "data", "]"}], ",", "6"}], "]"}]}], ")"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"datafile", ",", 
       RowBox[{"a", "<>", "b"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4827773206338367`*^9, 3.482777322040213*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADTrackingJKJ", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "method", ",", "datafile"}], "}"}], ",", 
    RowBox[{
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", 
       RowBox[{"ToString", "[", "MADFileName", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADTrackData", "=", "data"}], ";", "\[IndentingNewLine]", 
     RowBox[{"method", "=", 
      RowBox[{
       RowBox[{"Method", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTracking", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", "\"\<track;\\n\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<start,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "1"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "3"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "4"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "5"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "6"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<;\\n\>\""}], "&"}], "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "data", "]"}], ",", "6"}], "]"}]}], ")"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"datafile", ",", 
       RowBox[{"a", "<>", "b"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4827773264624844`*^9, 3.482777326790639*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADTrackingMore", "[", 
   RowBox[{"data_", ",", "turns_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "method", ",", "datafile"}], "}"}], ",", 
    RowBox[{
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", 
       RowBox[{"ToString", "[", "MADFileName", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADTrackData", "=", "data"}], ";", "\[IndentingNewLine]", 
     RowBox[{"method", "=", 
      RowBox[{
       RowBox[{"Method", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTracking", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", "\"\<track;\\n\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<start,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "1"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "2"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "3"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "4"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "5"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "6"}], "]"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
          "\"\<;\\n\>\""}], "&"}], "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "data", "]"}], ",", "6"}], "]"}]}], ")"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"datafile", ",", 
       RowBox[{"a", "<>", "b", "<>", "\"\<run,method=\>\"", "<>", 
        RowBox[{"ToString", "[", "method", "]"}], "<>", "\"\<,turns=\>\"", "<>", 
        RowBox[{"ToString", "[", "turns", "]"}], "<>", "\[IndentingNewLine]", 
        "\"\<,table=ttrack;\\nArchive,table=ttrack,filename=trackht.dat;\\\
nendtrack;\\n\>\""}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";"}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.482777331181657*^9, 3.4827773314316797`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["The following stuff for parsing tracking data", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HanningElement", "[", 
   RowBox[{"x_", ",", 
    RowBox[{"{", "k_", "}"}]}], "]"}], ":=", 
  RowBox[{"x", " ", "2", " ", 
   SuperscriptBox[
    RowBox[{"Sin", "[", 
     FractionBox[
      RowBox[{"\[Pi]", " ", "k"}], "n"], "]"}], "2"]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"HanningElement2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "_Integer"}], "}"}]}], "}"}], ",", 
     RowBox[{"x", " ", "2", " ", 
      SuperscriptBox[
       RowBox[{"Sin", "[", 
        FractionBox[
         RowBox[{"\[Pi]", " ", "k"}], "n"], "]"}], "2"]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "Hanning", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Hanning", "[", "X_", "]"}], ":=", 
  RowBox[{
   RowBox[{"MapIndexed", "[", 
    RowBox[{"HanningElement", ",", "X"}], "]"}], "/.", 
   RowBox[{"n", "\[Rule]", 
    RowBox[{"Length", "[", "X", "]"}]}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4216481218617535`*^9, 3.4216481413308773`*^9}, {
  3.53641643190242*^9, 3.53641643205867*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Hanning2", "[", "X_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "test", "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"test", "[", 
       RowBox[{"a_", ",", 
        RowBox[{"{", "b_", "}"}]}], "]"}], ":=", 
      RowBox[{"HanningElement", "[", 
       RowBox[{"a", ",", 
        RowBox[{"{", "b", "}"}], ",", 
        RowBox[{"Length", "[", "X", "]"}]}], "]"}]}], ";", 
     RowBox[{"Flatten", "[", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{"test", ",", "X"}], "]"}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536413585980545*^9, 3.536413586324295*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BartInt", "[", 
   RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
  FractionBox[
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{"a", "+", 
        RowBox[{"b", " ", "c"}]}], ")"}]}], 
     RowBox[{"(", 
      RowBox[{"a", "-", "b"}], ")"}]}], "+", 
    RowBox[{"b", 
     SqrtBox[
      RowBox[{
       RowBox[{
        SuperscriptBox["c", "2"], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"a", "+", "b"}], ")"}], "2"]}], "-", 
       RowBox[{"2", "a", " ", "b", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", 
           SuperscriptBox["c", "2"]}], "-", "c", "-", "1"}], ")"}]}]}]]}]}], 
   RowBox[{
    SuperscriptBox["a", "2"], "+", 
    SuperscriptBox["b", "2"], "+", 
    RowBox[{"2", "a", " ", "b", " ", "c"}]}]]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"PeakPosition", "[", "X_", "]"}], ":=", 
  RowBox[{"Part", "[", 
   RowBox[{
    RowBox[{"First", "[", 
     RowBox[{"Position", "[", 
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{"Fourier", "[", 
         RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], ",", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"Fourier", "[", 
          RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], "]"}]}], "]"}], 
     "]"}], ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5369353957736387`*^9, 3.536935398314564*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "AllPeakPositions", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllPeakPositions", "[", 
   RowBox[{"X_", ",", "\[Epsilon]_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"fh", "=", 
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"Fourier", "[", 
          RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Round", "[", 
         FractionBox[
          RowBox[{"Length", "[", "X", "]"}], "2"], "]"}]}], "]"}]}], "}"}], 
    ",", 
    RowBox[{"Sort", "[", 
     RowBox[{
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"FindTurningPoints", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "fh", "]"}], "]"}], ",", "fh"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
           ">", 
          RowBox[{
           RowBox[{"Max", "[", "fh", "]"}], "*", "\[Epsilon]"}]}], "&"}]}], 
       "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ">", 
        RowBox[{
        "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
       "&"}]}], "]"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.421648152502967*^9, 3.4216481622687793`*^9}, {
  3.536413613011795*^9, 3.53641361315242*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BaseTuneEstimate", "[", "X_", "]"}], ":=", 
  FractionBox[
   RowBox[{"PeakPosition", "[", "X", "]"}], 
   RowBox[{"Length", "[", "X", "]"}]]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"AllBaseTuneEstimate", "[", 
   RowBox[{"X_", ",", 
    RowBox[{"\[Epsilon]_:", "0.01"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      FractionBox[
       RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       RowBox[{"Length", "[", "X", "]"}]], ",", 
      RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
     "}"}], "&"}], "/@", 
   RowBox[{"AllPeakPositions", "[", 
    RowBox[{"X", ",", "\[Epsilon]"}], "]"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"BartIntCorrNum1", "[", "X_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Abs", "[", 
    RowBox[{"Fourier", "[", 
     RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"PeakPosition", "[", "X", "]"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"BartIntCorrNum2", "[", "X_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Abs", "[", 
    RowBox[{"Fourier", "[", 
     RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"PeakPosition", "[", "X", "]"}], "+", "1"}], "]"}], 
   "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"TuneCorrection", "[", "X_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   FractionBox["1", 
    RowBox[{"2", "\[Pi]"}]], 
   RowBox[{"ArcSin", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"BartInt", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"Fourier", "[", 
          RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"PeakPosition", "[", "X", "]"}], "]"}], "]"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"Fourier", "[", 
          RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"PeakPosition", "[", "X", "]"}], "+", "1"}], "]"}], "]"}], 
       ",", 
       RowBox[{"Cos", "[", 
        FractionBox[
         RowBox[{"2", " ", "\[Pi]"}], 
         RowBox[{"Length", "[", "X", "]"}]], "]"}]}], "]"}], " ", 
     RowBox[{"Sin", " ", "[", 
      FractionBox[
       RowBox[{"2", " ", "\[Pi]"}], 
       RowBox[{"Length", "[", "X", "]"}]], "]"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.5369353883223352`*^9, 3.536935425220315*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AllTuneCorrection", "[", 
   RowBox[{"X_", ",", "\[Epsilon]_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       FractionBox["1", 
        RowBox[{"2", "\[Pi]"}]], 
       RowBox[{"ArcSin", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BartInt", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Fourier", "[", 
              RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "\[RightDoubleBracket]"}], "\[IndentingNewLine]", ",", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Fourier", "[", 
              RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+",
              "1"}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{"Cos", "[", 
            FractionBox[
             RowBox[{"2", " ", "\[Pi]"}], 
             RowBox[{"Length", "[", "X", "]"}]], "]"}]}], "]"}], " ", 
         RowBox[{"Sin", " ", "[", 
          FractionBox[
           RowBox[{"2", " ", "\[Pi]"}], 
           RowBox[{"Length", "[", "X", "]"}]], "]"}]}], "]"}]}], ",", "0"}], 
     "}"}], "&"}], "/@", 
   RowBox[{"AllPeakPositions", "[", 
    RowBox[{"X", ",", "\[Epsilon]"}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5369353835678434`*^9, 3.536935385173459*^9}, {
  3.536935420621708*^9, 3.536935421962319*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TuneEstimateDescending", "[", 
   RowBox[{"X_", ",", 
    RowBox[{"\[Epsilon]_:", "0.01"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"AllBaseTuneEstimate", "[", 
    RowBox[{"X", ",", "\[Epsilon]"}], "]"}], "+", 
   RowBox[{"AllTuneCorrection", "[", 
    RowBox[{"X", ",", "\[Epsilon]"}], "]"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"TuneEstimate", "[", "X_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"First", "[", 
           RowBox[{"First", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Max", "[", "#", "]"}]}], "]"}], "]"}], "]"}], "-", 
          "1"}], ")"}], "/", 
        RowBox[{"Length", "[", "X", "]"}]}], ")"}], "+", 
      RowBox[{
       RowBox[{"ArcSin", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BartInt", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"First", "[", 
              RowBox[{"First", "[", 
               RowBox[{"Position", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"Max", "[", "#", "]"}]}], "]"}], "]"}], "]"}], "]"}],
             "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"First", "[", 
               RowBox[{"First", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"Max", "[", "#", "]"}]}], "]"}], "]"}], "]"}], "+", 
              "1"}], "]"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"2", " ", 
             RowBox[{"\[Pi]", "/", 
              RowBox[{"Length", "[", "X", "]"}]}]}], "]"}]}], "]"}], " ", 
         RowBox[{"Sin", " ", "[", 
          RowBox[{"2", " ", 
           RowBox[{"\[Pi]", "/", 
            RowBox[{"Length", "[", "X", "]"}]}]}], "]"}]}], "]"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", " ", "Pi"}], ")"}]}]}], ")"}], "&"}], "[", 
   RowBox[{"Abs", "[", 
    RowBox[{"Fourier", "[", 
     RowBox[{"Hanning", "[", "X", "]"}], "]"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5369347097065616`*^9, {3.536935381042506*^9, 3.53693540771443*^9}, 
   3.5369355958520365`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiffusionRate", "[", "X_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", 
    RowBox[{"Length", "[", "X", "]"}]], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"TuneEstimate", "[", 
      RowBox[{"Drop", "[", 
       RowBox[{"X", ",", 
        RowBox[{"IntegerPart", "[", 
         FractionBox[
          RowBox[{"Length", "[", "X", "]"}], "2"], "]"}]}], "]"}], "]"}], "-", 
     RowBox[{"TuneEstimate", "[", 
      RowBox[{"Take", "[", 
       RowBox[{"X", ",", 
        RowBox[{"IntegerPart", "[", 
         FractionBox[
          RowBox[{"Length", "[", "X", "]"}], "2"], "]"}]}], "]"}], "]"}]}], 
    ")"}]}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"bin6", "[", 
    RowBox[{"b_", ",", "c_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"b", "[", 
      RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Split", "[", 
     RowBox[{
      RowBox[{"Ordering", "[", "c", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"c", "[", 
         RowBox[{"[", "#1", "]"}], "]"}], "\[Equal]", 
        RowBox[{"c", "[", 
         RowBox[{"[", "#2", "]"}], "]"}]}], "&"}]}], "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADMatrixTrack", "[", "opts___", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "y", ",", "x", ",", "i", ",", "j", ",", "k", ",", "table", ",", "pm", 
       ",", "replace", ",", "replace2", ",", "bin2", ",", "xoffset", 
       RowBox[{"(*", 
        RowBox[{
        ",", "MADxfinal", ",", "MADyfinal", ",", "MADpxfinal", ",", 
         "MADpyfinal"}], "*)"}], ",", "MADmatrix"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", "Hanning", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Hanning", "[", "X_", "]"}], ":=", 
       RowBox[{
        RowBox[{"Hanning", "[", "X", "]"}], "=", 
        RowBox[{
         RowBox[{"MapIndexed", "[", 
          RowBox[{"HanningElement", ",", "X"}], "]"}], "/.", 
         RowBox[{"n", "\[Rule]", 
          RowBox[{"Length", "[", "X", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pm", "=", 
       RowBox[{
        RowBox[{"PrintMatrix", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADMatrixTrack", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"replace", "=", 
       RowBox[{
        RowBox[{"ReplaceWithZeros", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADMatrixTrack", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xoffset", "=", 
       RowBox[{
        RowBox[{"XOffset", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADMatrixTrack", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"MADxfinal", "=", 
       RowBox[{"bin6", "[", 
        RowBox[{"Global`X", ",", "Global`PARTICLE"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"MADyfinal", "=", 
       RowBox[{"bin6", "[", 
        RowBox[{"Global`Y", ",", "Global`PARTICLE"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"MADpxfinal", "=", 
       RowBox[{"bin6", "[", 
        RowBox[{"Global`PX", ",", "Global`PARTICLE"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"MADpyfinal", "=", 
       RowBox[{"bin6", "[", 
        RowBox[{"Global`PY", ",", "Global`PARTICLE"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"MADmatrix", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "[", "MADxfinal", "]"}], ",", 
           RowBox[{"Flatten", "[", "MADpxfinal", "]"}], ",", 
           RowBox[{"Flatten", "[", "MADyfinal", "]"}], ",", 
           RowBox[{"Flatten", "[", "MADpyfinal", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Qx", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"replace", "===", "True"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"Abs", "[", "#", "]"}], "]"}], "=!=", "0."}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], ">", "2"}]}], ",", 
             RowBox[{"TuneEstimate", "[", 
              RowBox[{"#", "-", 
               RowBox[{"Mean", "[", "#", "]"}]}], "]"}], ",", "0."}], "]"}], 
           ",", 
           RowBox[{"TuneEstimate", "[", 
            RowBox[{"#", "-", 
             RowBox[{"Mean", "[", "#", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
        "MADxfinal"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Qy", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"replace", "===", "True"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"Abs", "[", "#", "]"}], "]"}], "=!=", "0."}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], ">", "2"}]}], ",", 
             RowBox[{"TuneEstimate", "[", 
              RowBox[{"#", "-", 
               RowBox[{"Mean", "[", "#", "]"}]}], "]"}], ",", "0."}], "]"}], 
           ",", 
           RowBox[{"TuneEstimate", "[", 
            RowBox[{"#", "-", 
             RowBox[{"Mean", "[", "#", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
        "MADyfinal"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dQxdn", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"replace", "===", "True"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"Abs", "[", "#", "]"}], "]"}], "=!=", "0."}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], ">", "3"}]}], ",", 
             RowBox[{"DiffusionRate", "[", 
              RowBox[{"#", "-", 
               RowBox[{"Mean", "[", "#", "]"}]}], "]"}], ",", "0."}], "]"}], 
           ",", 
           RowBox[{"DiffusionRate", "[", 
            RowBox[{"#", "-", 
             RowBox[{"Mean", "[", "#", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
        "MADxfinal"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dQydn", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"replace", "===", "True"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"Abs", "[", "#", "]"}], "]"}], "=!=", "0."}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], ">", "3"}]}], ",", 
             RowBox[{"DiffusionRate", "[", 
              RowBox[{"#", "-", 
               RowBox[{"Mean", "[", "#", "]"}]}], "]"}], ",", "0."}], "]"}], 
           ",", 
           RowBox[{"DiffusionRate", "[", 
            RowBox[{"#", "-", 
             RowBox[{"Mean", "[", "#", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
        "MADyfinal"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"DiffTunes", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", 
         RowBox[{"{", 
          RowBox[{"Qx", ",", "Qy", ",", "dQxdn", ",", "dQydn"}], "}"}]}], 
        "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{
  3.535796943547678*^9, {3.53641347058992*^9, 3.53641352683992*^9}, {
   3.53641375737117*^9, 3.536413762574295*^9}, {3.5365014260960503`*^9, 
   3.5365014328460503`*^9}, {3.5369354288836126`*^9, 3.536935444612409*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADxytunes", "[", 
   RowBox[{"trackdata_", ",", 
    RowBox[{"qx_:", "Qx"}], ",", 
    RowBox[{"qy_:", "Qy"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Do", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MADxytuneData", "=", 
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "trackdata", "]"}], ",", "2"}], "]"}], 
            ",", "qx", ",", "qy"}], "}"}]}], "]"}], "]"}], ",", "4"}], 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"MADxytuneData", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"MADxytuneData", ",", 
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Drop", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "trackdata", "]"}], ",", "1"}], 
              "]"}], ",", "1"}], "]"}], ",", "\[Iota]"}], "]"}]}], "]"}]}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"\[Iota]", ",", "1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Dimensions", "[", "trackdata", "]"}], ",", "1"}], "]"}],
            ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDelete", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDelete", "[", 
   RowBox[{
    RowBox[{"file_:", "MADFileName"}], ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "MADReadFile", ",", "a", ",", "c", ",", "type", ",", "id", ",", "length",
       ",", "datafile"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"type", "=", 
      RowBox[{
       RowBox[{"Type", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDelete", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"type", "=", 
      RowBox[{"ToString", "[", "type", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"type", "===", "\"\<Beam\>\""}], "||", 
        RowBox[{"type", "===", "\"\<Monitor\>\""}], "||", 
        RowBox[{"type", "===", "\"\<Twiss\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MADReadFile", "=", 
         RowBox[{"ReadList", "[", 
          RowBox[{"file", ",", "Word", ",", 
           RowBox[{"WordSeparators", "\[Rule]", 
            RowBox[{"{", "\"\<;\>\"", "}"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"type", "===", "\"\<Beam\>\""}], ",", 
          RowBox[{
           RowBox[{"id", "=", "\"\<Beam\>\""}], ";", 
           RowBox[{"length", "=", "4"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"type", "===", "\"\<Twiss\>\""}], ",", 
          RowBox[{
           RowBox[{"id", "=", "\"\<twiss\>\""}], ";", 
           RowBox[{"length", "=", "5"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"type", "===", "\"\<Monitor\>\""}], ",", 
          RowBox[{
           RowBox[{"id", "=", "\"\<usemonitor\>\""}], ";", 
           RowBox[{"length", "=", "10"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"a", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"MADReadFile", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"StringTake", "[", 
              RowBox[{"#", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"StringLength", "[", "#", "]"}], ">", "length"}], 
                 ",", "length", ",", 
                 RowBox[{"StringLength", "[", "#", "]"}]}], "]"}]}], "]"}], "=!=",
              "id"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"datafile", "=", 
         RowBox[{"OpenWrite", "[", "file", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringTake", "[", 
               RowBox[{"#", ",", 
                RowBox[{"-", "1"}]}], "]"}], "=!=", "\"\<&\>\""}], ",", 
             RowBox[{"#", "<>", "\"\<;\\n\>\""}], ",", 
             RowBox[{"#", "<>", "\"\<\\n\>\""}]}], "]"}], "&"}], "/@", 
          "a"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"WriteString", "[", 
           RowBox[{"datafile", ",", "#"}], "]"}], "&"}], "/@", "c"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Close", "[", "file", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"type", "===", "\"\<Track\>\""}], ",", 
       RowBox[{"MADDeleteTrack", "[", 
        RowBox[{"file", ",", "opts"}], "]"}]}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDeleteTrack", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDeleteTrack", "[", 
   RowBox[{
    RowBox[{"file_:", "MADFileName"}], ",", "opts___"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "MADReadFile", ",", "a1", ",", "a2", ",", "b", ",", "c", ",", "\[Iota]", 
      ",", "all", ",", "datafile"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MADReadFile", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"file", ",", "Word", ",", 
        RowBox[{"WordSeparators", "\[Rule]", 
         RowBox[{"{", "\"\<;\>\"", "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"depth", "=", 
      RowBox[{
       RowBox[{"Depth", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDeleteTrack", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"all", "=", 
      RowBox[{
       RowBox[{"DeleteAll", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDeleteTrack", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Iota]", "=", "depth"}], ";", "\[IndentingNewLine]", 
     RowBox[{"a1", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"MADReadFile", ",", "\"\<track\>\""}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a2", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"MADReadFile", ",", "\"\<endtrack\>\""}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"a1", "=!=", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"all", "===", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"b", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"MADReadFile", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"First", "[", "a1", "]"}], ",", 
               RowBox[{"Last", "[", "a2", "]"}]}], "}"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"NumberQ", "[", "depth", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"b", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"MADReadFile", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{"a1", ",", "\[Iota]"}], "]"}], ",", 
                 RowBox[{"Part", "[", 
                  RowBox[{"a2", ",", "\[Iota]"}], "]"}]}], "}"}]}], "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"ListQ", "[", "depth", "]"}], ",", 
              RowBox[{
               RowBox[{"b", "=", "MADReadFile"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"b", "=", 
                  RowBox[{"Drop", "[", 
                   RowBox[{"b", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"Sort", "[", 
                    RowBox[{"a1", ",", "Greater"}], "]"}], ",", 
                    RowBox[{"Part", "[", 
                    RowBox[{"depth", ",", "\[CurlyPhi]"}], "]"}]}], "]"}], 
                    ",", 
                    RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"Sort", "[", 
                    RowBox[{"a2", ",", "Greater"}], "]"}], ",", 
                    RowBox[{"Part", "[", 
                    RowBox[{"depth", ",", "\[CurlyPhi]"}], "]"}]}], "]"}]}], 
                    "}"}]}], "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"\[CurlyPhi]", ",", "1", ",", 
                   RowBox[{"Length", "[", "depth", "]"}]}], "}"}]}], "]"}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
              "Print", "[", 
               "\"\<Depth is not a number or a list of Numbers\>\"", "]"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"datafile", "=", 
         RowBox[{"OpenWrite", "[", "file", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringTake", "[", 
               RowBox[{"#", ",", 
                RowBox[{"-", "1"}]}], "]"}], "=!=", "\"\<&\>\""}], ",", 
             RowBox[{"#", "<>", "\"\<;\\n\>\""}], ",", 
             RowBox[{"#", "<>", "\"\<\\n\>\""}]}], "]"}], "&"}], "/@", 
          "b"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"WriteString", "[", 
           RowBox[{"datafile", ",", "#"}], "]"}], "&"}], "/@", "c"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Close", "[", "file", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.4827773439327993`*^9, 3.4827773443390856`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDropLines", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDropLines", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "b", ",", "c", ",", "d", ",", "lines", ",", "datafile"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"lines", "=", 
      RowBox[{"Lines", "/.", 
       RowBox[{"{", "opts", "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"out", "=", 
      RowBox[{"Output", "/.", 
       RowBox[{"{", "opts", "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringQ", "[", "out", "]"}], ",", "out", ",", 
       RowBox[{"out", "=", "file"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "file", "]"}], ",", "Word", ",", 
        RowBox[{"WordSeparators", "\[Rule]", 
         RowBox[{"{", "\"\<;\>\"", "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"NumberQ", "[", "lines", "]"}], ",", 
       RowBox[{"c", "=", 
        RowBox[{"Drop", "[", 
         RowBox[{"a", ",", 
          RowBox[{"{", "lines", "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ListQ", "[", "lines", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"lines", "=", 
           RowBox[{"Sort", "[", 
            RowBox[{"lines", ",", "Greater"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"c", "=", "a"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"c", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"c", ",", 
               RowBox[{"{", 
                RowBox[{"Part", "[", 
                 RowBox[{"lines", ",", "\[Iota]"}], "]"}], "}"}]}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"\[Iota]", ",", "1", ",", 
              RowBox[{"Length", "[", "lines", "]"}]}], "}"}]}], "]"}], ";"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"TableForm", "[", 
            RowBox[{"a", ",", 
             RowBox[{"TableHeadings", "\[Rule]", 
              RowBox[{"{", "Automatic", "}"}]}]}], "]"}], "]"}], ";", 
          RowBox[{
          "Print", "[", 
           "\"\<Use \\\"Lines\[Rule]Number\\\" to Drop Lines\>\"", "]"}], ";", 
          RowBox[{"c", "=", "a"}]}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"datafile", "=", 
      RowBox[{"OpenWrite", "[", "out", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringTake", "[", 
            RowBox[{"#", ",", 
             RowBox[{"-", "1"}]}], "]"}], "=!=", "\"\<&\>\""}], ",", 
          RowBox[{"#", "<>", "\"\<;\\n\>\""}], ",", 
          RowBox[{"#", "<>", "\"\<\\n\>\""}]}], "]"}], "&"}], "/@", "c"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"WriteString", "[", 
        RowBox[{"datafile", ",", "#"}], "]"}], "&"}], "/@", "d"}], ";", "\n", 
     RowBox[{"Close", "[", "out", "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4827773569808435`*^9, 3.4827773572464924`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADTwiss", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADTwiss", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "tunes", ",", "chrom", ",", "couple", ",", "save", ",", "tape", ",", 
      "twiss", ",", "a", ",", "deltap"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tunes", "=", 
      RowBox[{
       RowBox[{"Tunes", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTwiss", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"chrom", "=", 
      RowBox[{
       RowBox[{"Chrom", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTwiss", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"couple", "=", 
      RowBox[{
       RowBox[{"Couple", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTwiss", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"save", "=", 
      RowBox[{
       RowBox[{"Save", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTwiss", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tape", "=", 
      RowBox[{
       RowBox[{"Tape", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTwiss", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"deltap", "=", 
      RowBox[{
       RowBox[{"Deltap", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADTwiss", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"twiss", "=", 
      RowBox[{"\"\<twiss\>\"", "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"deltap", "=!=", "0"}], ",", 
         RowBox[{"\"\<,deltap=\>\"", "<>", 
          RowBox[{"ToString", "[", "deltap", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"tunes", "===", "True"}], ",", "\"\<,tunes\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "tunes", "]"}], "===", "String"}], ",", 
         RowBox[{"\"\<,tunes=\>\"", "<>", "tunes"}], ",", "\"\<\>\""}], "]"}],
        "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"chrom", "&&", 
          RowBox[{"!", "couple"}]}], ",", "\"\<,chrom\>\"", ",", "\"\<\>\""}],
         "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"couple", "&&", 
          RowBox[{"!", "chrom"}]}], ",", "\"\<,couple\>\"", ",", "\"\<\>\""}],
         "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"couple", "&&", "chrom"}], ",", "\"\<,couple\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"save", "===", "True"}], ",", "\"\<,save\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "save", "]"}], "===", "String"}], ",", 
         RowBox[{"\"\<,save=\>\"", "<>", 
          RowBox[{"ToString", "[", "save", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"tape", "===", "True"}], ",", "\"\<,tape\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "tape", "]"}], "===", "String"}], ",", 
         RowBox[{"\"\<,tape=\>\"", "<>", "tape"}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"MADFileName", ",", "twiss"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDraw Definitions", "Subsection"],

Cell["'widthscale' is controled by arguments to the main function ", "Text"],

Cell["\<\
'ws' and 'wq' etc. for each element, sets the relative width of the different \
elements\
\>", "Text"],

Cell["\<\
The colour of the elements is controlled by 'RGBColour[r,g,b]' in each \
function\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TextOscillate", "[", "]"}], ":=", 
  RowBox[{"Switch", "[", 
   RowBox[{"TEXTOSCILLATE", ",", "1", ",", 
    RowBox[{"TEXTOSCILLATE", "=", 
     RowBox[{"-", "1"}]}], ",", 
    RowBox[{"-", "1"}], ",", 
    RowBox[{"TEXTOSCILLATE", "=", "1"}], ",", "_", ",", "1"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978991091630783`*^9, 3.3978991147100244`*^9}, {
  3.3978992959154687`*^9, 3.3978993264471097`*^9}, {3.397899482636609*^9, 
  3.3978994829959884`*^9}, {3.397899578981592*^9, 3.3978995877785797`*^9}, {
  3.397899697873739*^9, 3.3978996989675026`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TextDirection", "[", "]"}], ":=", 
  RowBox[{"Switch", "[", 
   RowBox[{"TEXTOSCILLATE", ",", 
    RowBox[{"-", "1"}], ",", "1", ",", "_", ",", 
    RowBox[{"-", "1"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978991235226374`*^9, 3.3978991303508496`*^9}, {
   3.3978993316659265`*^9, 3.397899339619153*^9}, {3.3978995926223917`*^9, 
   3.3978995985443425`*^9}, {3.3978997007644005`*^9, 3.397899701623787*^9}, 
   3.3979006494171686`*^9, {3.3979007301369514`*^9, 3.3979007351838913`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Global`ElementModified", "=", "1"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4044811052601166`*^9, 3.4044811135257945`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElementModify", "[", "element_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Global`ElementModified", "++"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"element", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
       "\[IndentingNewLine]", "\"\<Quadrupole\>\"", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "l", ",", "k1", ",", "label"}], "}"}], "=", 
         RowBox[{"element", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "4", ",", "7"}], "}"}]}], 
          "\[RightDoubleBracket]"}]}], ";", 
        RowBox[{"CreateDialog", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Grid", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Name\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{
                  RowBox[{"Dynamic", "[", "name", "]"}], ",", 
                  RowBox[{"Enabled", "\[Rule]", "False"}]}], "]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"\"\<L\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "l", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<\!\(\*SubscriptBox[\(K\), \(1\)]\)\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "k1", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<Label\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "label", "]"}], "]"}]}], "}"}]}], 
             "}"}], "]"}], ",", 
           RowBox[{"DefaultButton", "[", 
            RowBox[{"DialogReturn", "[", 
             RowBox[{
              RowBox[{"MADClear", "[", 
               RowBox[{"Evaluate", "[", "name", "]"}], "]"}], ";", 
              RowBox[{"quad", "[", 
               RowBox[{
                RowBox[{"Evaluate", "[", 
                 RowBox[{"Symbol", "@", "name"}], "]"}], ",", "l", ",", "k1", 
                ",", "label"}], "]"}]}], "]"}], "]"}]}], "}"}], "]"}], ";"}], 
       ",", "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "l", ",", "k1", ",", "angle", ",", "label"}], 
          "}"}], "=", 
         RowBox[{"element", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "4", ",", "6", ",", "7"}], "}"}]}], 
          "\[RightDoubleBracket]"}]}], ";", 
        RowBox[{"angle", "=", 
         RowBox[{"N", "[", 
          RowBox[{"angle", "/", "Degree"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"CreateDialog", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Grid", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Name\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{
                  RowBox[{"Dynamic", "[", "name", "]"}], ",", 
                  RowBox[{"Enabled", "\[Rule]", "False"}]}], "]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"\"\<L\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "l", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<\[Theta]\[Degree]\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "angle", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<\!\(\*SubscriptBox[\(K\), \(1\)]\)\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "k1", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<Label\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "label", "]"}], "]"}]}], "}"}]}], 
             "}"}], "]"}], ",", 
           RowBox[{"DefaultButton", "[", 
            RowBox[{"\"\<Ok\>\"", ",", 
             RowBox[{
              RowBox[{"MADClear", "[", 
               RowBox[{"Evaluate", "[", "name", "]"}], "]"}], ";", 
              RowBox[{"sbend", "[", 
               RowBox[{
                RowBox[{"Evaluate", "[", 
                 RowBox[{"Symbol", "@", "name"}], "]"}], ",", 
                RowBox[{"N", "[", "l", "]"}], ",", "k1", ",", 
                RowBox[{"N", "[", 
                 RowBox[{"angle", "*", "Degree"}], "]"}], ",", "label"}], 
               "]"}]}]}], "]"}]}], "}"}], "]"}], ";"}], ",", 
       "\[IndentingNewLine]", "\"\<Sextupole\>\"", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "l", ",", "k2", ",", "label"}], "}"}], "=", 
         RowBox[{"element", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "4", ",", "7"}], "}"}]}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"CreateDialog", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Grid", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Name\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{
                  RowBox[{"Dynamic", "[", "name", "]"}], ",", 
                  RowBox[{"Enabled", "\[Rule]", "False"}]}], "]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"\"\<L\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "l", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<\!\(\*SubscriptBox[\(K\), \(2\)]\)\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "k2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<Label\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "label", "]"}], "]"}]}], "}"}]}], 
             "}"}], "]"}], ",", 
           RowBox[{"DefaultButton", "[", 
            RowBox[{"DialogReturn", "[", 
             RowBox[{
              RowBox[{"MADClear", "[", 
               RowBox[{"Evaluate", "[", "name", "]"}], "]"}], ";", 
              RowBox[{"sext", "[", 
               RowBox[{
                RowBox[{"Evaluate", "[", 
                 RowBox[{"Symbol", "@", "name"}], "]"}], ",", "l", ",", "k2", 
                ",", "label"}], "]"}]}], "]"}], "]"}]}], "}"}], "]"}], ";"}], 
       ",", "\[IndentingNewLine]", "\"\<Drift\>\"", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "l", ",", "label"}], "}"}], "=", 
         RowBox[{"element", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "7"}], "}"}]}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"CreateDialog", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Grid", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Name\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{
                  RowBox[{"Dynamic", "[", "name", "]"}], ",", 
                  RowBox[{"Enabled", "\[Rule]", "False"}]}], "]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"\"\<L\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "l", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<Label\>\"", ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{"Dynamic", "[", "label", "]"}], "]"}]}], "}"}]}], 
             "}"}], "]"}], ",", 
           RowBox[{"DefaultButton", "[", 
            RowBox[{"DialogReturn", "[", 
             RowBox[{
              RowBox[{"MADClear", "[", 
               RowBox[{"Evaluate", "[", "name", "]"}], "]"}], ";", 
              RowBox[{"drift", "[", 
               RowBox[{
                RowBox[{"Evaluate", "[", 
                 RowBox[{"Symbol", "@", "name"}], "]"}], ",", "l", ",", 
                "label"}], "]"}]}], "]"}], "]"}]}], "}"}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4042245444400883`*^9, 3.404224753317762*^9}, {
   3.404224790615114*^9, 3.4042248639910536`*^9}, {3.404225016305503*^9, 
   3.404225402372945*^9}, {3.4042254605143137`*^9, 3.404225462998721*^9}, {
   3.4042257856903515`*^9, 3.404225868691414*^9}, {3.404226381744856*^9, 
   3.404226407167056*^9}, {3.4042272414902353`*^9, 3.404227413976818*^9}, {
   3.404227468961897*^9, 3.4042274724463167`*^9}, {3.4042275043217244`*^9, 
   3.404227550541066*^9}, {3.4042275922290993`*^9, 3.404227626651415*^9}, {
   3.4044562981951027`*^9, 3.4044563119451904`*^9}, {3.404456599431405*^9, 
   3.4044566254315715`*^9}, {3.4044605320971994`*^9, 3.404460555847351*^9}, {
   3.404460591113202*^9, 3.4044606058632965`*^9}, {3.4044721940937104`*^9, 
   3.4044722267345448`*^9}, {3.4044722730004654`*^9, 
   3.4044722731410913`*^9}, {3.4044723252508*^9, 3.404472331953968*^9}, {
   3.404472364063548*^9, 3.4044725076269674`*^9}, {3.4044725464397154`*^9, 
   3.4044725466115913`*^9}, {3.4044726592685623`*^9, 
   3.4044727345502944`*^9}, {3.4044728457853813`*^9, 3.4044728525979247`*^9}, 
   3.4044729293171663`*^9, {3.4044730184114857`*^9, 3.4044730202239976`*^9}, {
   3.4044736865720124`*^9, 3.4044736949158154`*^9}, {3.404473792322689*^9, 
   3.4044738328698235`*^9}, {3.4044739303704476`*^9, 
   3.4044739440892854`*^9}, {3.4044740175585055`*^9, 
   3.4044740904808474`*^9}, {3.4044746881565475`*^9, 
   3.4044746883127985`*^9}, {3.4044749527051153`*^9, 
   3.4044749545645027`*^9}, {3.404481118775828*^9, 
   3.4044811214945955`*^9}},ExpressionUUID->"3346ed2f-3784-423e-8191-\
9bff723006b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDrawRot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_"}], "}"}], ",", "\[Theta]_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"x", " ", 
      RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
     RowBox[{"y", " ", 
      RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
    RowBox[{
     RowBox[{"x", " ", 
      RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
     RowBox[{"y", " ", 
      RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.4632962532825937`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"position", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"length", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rotation", "=", 
   RowBox[{"\[Pi]", "/", "4"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.447744428237061*^9, 3.447744472472002*^9}, {
  3.4550131979168425`*^9, 3.4550132090887175`*^9}}],

Cell[BoxData[
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"Polygon", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"position", "+", 
       RowBox[{"MADDrawRot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
      RowBox[{"position", "+", 
       RowBox[{"MADDrawRot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"length", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}], 
      ",", 
      RowBox[{"position", "+", 
       RowBox[{"MADDrawRot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"length", ",", 
           RowBox[{"-", "wd"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
      RowBox[{"position", "+", 
       RowBox[{"MADDrawRot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "wd"}]}], "}"}], ",", "rotation"}], "]"}]}]}], "}"}], 
    "]"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.447679703018656*^9, 3.4476798254413147`*^9}, {
  3.447679953067131*^9, 3.4476799570984073`*^9}, {3.4477443992835655`*^9, 
  3.4477444269245443`*^9}, {3.463296254220112*^9, 3.463296256235775*^9}}],

Cell[CellGroupData[{

Cell["Drift", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wdr", ":=", 
   RowBox[{"0.16", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978140667652955`*^9, {3.3978153135468793`*^9, 3.397815324093889*^9}, 
   3.397815417657587*^9, {3.3978175105281253`*^9, 3.397817540106629*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<drift\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"fancyelements", "===", "True"}], ",", 
       RowBox[{"EventHandler", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
           RowBox[{"MADElementModify", "[", 
            RowBox[{"Element", "/.", 
             RowBox[{"{", "opts", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"List", "[", "#", "]"}]}], "]"}], "&"}], "@", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"driftlabels", "=", 
         RowBox[{
          RowBox[{"Global`DriftLabels", "/.", "opts"}], "/.", 
          RowBox[{"{", 
           RowBox[{"Global`DriftLabels", "\[Rule]", "False"}], "}"}]}]}], ",", 
        RowBox[{"driftlengths", "=", 
         RowBox[{
          RowBox[{"Global`DriftLengths", "/.", "opts"}], "/.", 
          RowBox[{"{", 
           RowBox[{"Global`DriftLengths", "\[Rule]", "False"}], "}"}]}]}]}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{"position", ",", 
            RowBox[{"position", "+", 
             RowBox[{"MADDrawRot", "[", 
              RowBox[{
               RowBox[{"length", "*", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], ",", "rotation"}], 
              "]"}]}]}], "}"}], "]"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"MADDrawText", ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"driftlabels", "===", "True"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"driftlengths", "===", "True"}], ",", 
               RowBox[{"label", "=", 
                RowBox[{"label", "<>", "\"\<\\n\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"NumberRight", "[", "length", "]"}], "]"}], "<>", 
                 "\"\<m\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"Text", "[", 
               RowBox[{"label", ",", 
                RowBox[{"position", "+", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    FractionBox["length", "2"], 
                    RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                   RowBox[{
                    FractionBox["length", "2"], 
                    RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
                 RowBox[{
                  RowBox[{"TextOscillate", "[", "]"}], 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"0.5", "wdr", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}], ",", " ", 
                    RowBox[{"0.5", " ", "wdr", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"-", "rotation"}], "]"}], ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"driftlengths", "===", "True"}], ",", 
              RowBox[{"{", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "[", "length", "]"}], "]"}], "<>", 
                  "\"\<m\>\""}], ",", 
                 RowBox[{"position", "+", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    FractionBox["length", "2"], 
                    RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                    RowBox[{
                    FractionBox["length", "2"], 
                    RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
                  RowBox[{
                   RowBox[{"TextOscillate", "[", "]"}], 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"1", "wdr", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}], ",", " ", 
                    RowBox[{"1", " ", "wdr", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Sin", "[", 
                    RowBox[{"-", "rotation"}], "]"}], ",", 
                   RowBox[{"Cos", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], "}"}],
               ",", 
              RowBox[{"{", "}"}]}], "]"}]}], "]"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978120462759132`*^9, 3.397812046400915*^9}, {
   3.397814015467764*^9, 3.397814041499347*^9}, {3.397815283374618*^9, 
   3.3978153111093483`*^9}, {3.397815371281993*^9, 3.397815454829938*^9}, {
   3.3978154865647187`*^9, 3.3978155312215405`*^9}, {3.3978173373227835`*^9, 
   3.3978173391353064`*^9}, {3.3978174420428734`*^9, 
   3.3978175157938175`*^9}, {3.3979020616539946`*^9, 
   3.3979020747479124`*^9}, {3.397902464706029*^9, 3.3979024687373304`*^9}, 
   3.397971231505986*^9, {3.3979713356010685`*^9, 3.3979714042581973`*^9}, {
   3.3979714360086036`*^9, 3.397971494399976*^9}, {3.3979742537630043`*^9, 
   3.3979743724113665`*^9}, {3.3979744107056465`*^9, 
   3.3979744449747167`*^9}, {3.3979745256446085`*^9, 
   3.3979745425446386`*^9}, {3.3992712941436214`*^9, 
   3.3992712996280317`*^9}, {3.3992713383939047`*^9, 
   3.3992713391439095`*^9}, {3.4034262862088833`*^9, 
   3.4034263318500924`*^9}, {3.4034263819757338`*^9, 
   3.4034264015697346`*^9}, {3.4034264574610753`*^9, 3.403426474508168*^9}, {
   3.404473165303051*^9, 3.404473169849955*^9}, {3.4052368275672626`*^9, 
   3.405236834364225*^9}, 3.41734788961231*^9, 3.417351067898276*^9, {
   3.422166545938699*^9, 3.4221665466887035`*^9}, {3.4325513155027127`*^9, 
   3.4325513767218547`*^9}, 3.4632962568139114`*^9, 3.5018436473497763`*^9, 
   3.501843680224987*^9, {3.50184373777223*^9, 
   3.5018437391472387`*^9}},ExpressionUUID->"d1df4752-6fe3-4427-85fb-\
44d15787f3fc"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dipole", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", ":=", 
   RowBox[{"0.1", "*", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.397812907020444*^9}],

Cell[BoxData[
 RowBox[{"Tooltip", "[", 
  RowBox[{
   RowBox[{"EventHandler", "[", 
    RowBox[{"#", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
       RowBox[{"MADElementModify", "[", 
        RowBox[{"Element", "/.", 
         RowBox[{"{", "opts", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", 
   RowBox[{"TableForm", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}], "===", 
              "\"\<\>\""}], ",", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}]}], "]"}], 
           "&"}], "[", 
          RowBox[{"(", 
           RowBox[{"Element", "/.", 
            RowBox[{"{", "opts", "}"}]}], ")"}], "]"}], ",", "Bold"}], "]"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<Length = \>\"", "<>", 
        RowBox[{"ToString", "[", "length", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<angle = \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"N", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Element", "/.", 
              RowBox[{"{", "opts", "}"}]}], ")"}], "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "/", 
           "Degree"}], "]"}], "]"}], "<>", "\"\<\[Degree]\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<Position = \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"NumberRight", "@", 
          RowBox[{"Chop", "[", 
           RowBox[{"position", ",", 
            SuperscriptBox["10", 
             RowBox[{"-", "5"}]]}], "]"}]}], "]"}]}], "}"}]}], "}"}], "]"}]}],
   "]"}]], "Text",
 CellChangeTimes->{
  3.4221665475480843`*^9},ExpressionUUID->"085d912f-566e-43f1-844d-\
03c35c8e7793"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<dipole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"E1", ",", "E2", ",", "colour"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"colour", "=", 
       RowBox[{
        RowBox[{"Colour", "/.", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"opts", ",", 
           RowBox[{"{", "Colour", "}"}]}], "]"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Colour", "\[Rule]", 
          RowBox[{"{", "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"fancyelements", "===", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"E1", "=", 
            RowBox[{"-", 
             RowBox[{
              RowBox[{"Symbol", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], ")"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "5", 
              "\[RightDoubleBracket]"}]}]}], ";", 
           RowBox[{"E2", "=", 
            RowBox[{"-", 
             RowBox[{
              RowBox[{"Symbol", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], ")"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "6", 
              "\[RightDoubleBracket]"}]}]}], ";", 
           RowBox[{"Tooltip", "[", 
            RowBox[{
             RowBox[{"EventHandler", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
                 RowBox[{"MADElementModify", "[", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TableForm", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<\>\""}], ",", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "&"}], "[", 
                    RowBox[{"(", 
                    RowBox[{"Element", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], "]"}], ",", "Bold"}],
                   "]"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<Length = \>\"", "<>", 
                  RowBox[{"ToString", "[", "length", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<angle = \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"N", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Element", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "/", 
                    "Degree"}], "]"}], "]"}], "<>", "\"\<\[Degree]\>\""}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<Position = \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "@", 
                    RowBox[{"Chop", "[", 
                    RowBox[{"position", ",", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "5"}]]}], "]"}]}], "]"}]}], "}"}]}], "}"}], 
              "]"}]}], "]"}]}], ",", 
          RowBox[{"List", "[", "#", "]"}]}], "]"}], "&"}], "[", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"bends", "===", "True"}], "&&", 
          RowBox[{
           RowBox[{"Abs", "[", "bend", "]"}], ">", "0.001"}], "&&", 
          RowBox[{"length", ">", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"colour", ",", 
           RowBox[{"Thickness", "[", "thick", "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"position", "+", 
              RowBox[{"MADDrawRot", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  FractionBox["length", "bend"]}], "}"}], ",", "rotation"}], 
               "]"}]}], ",", 
             RowBox[{
              FractionBox["length", 
               RowBox[{"Abs", "[", "bend", "]"}]], "-", "wd"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bend", "\[GreaterEqual]", "0"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "rotation"}], ",", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "bend", "+", 
                  "rotation"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{
                    RowBox[{"-", "3"}], "\[Pi]"}], "2"], "+", "rotation", "+",
                   "bend"}], ",", 
                 RowBox[{
                  FractionBox[
                   RowBox[{
                    RowBox[{"-", "3"}], "\[Pi]"}], "2"], "+", "rotation"}]}], 
                "}"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"position", "+", 
              RowBox[{"MADDrawRot", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  FractionBox["length", "bend"]}], "}"}], ",", "rotation"}], 
               "]"}]}], ",", 
             RowBox[{
              FractionBox["length", 
               RowBox[{"Abs", "[", "bend", "]"}]], "+", "wd"}], "  ", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bend", "\[GreaterEqual]", "0"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "rotation"}], ",", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "bend", "+", 
                  "rotation"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{
                    RowBox[{"-", "3"}], "\[Pi]"}], "2"], "+", "rotation", "+",
                   "bend"}], ",", 
                 RowBox[{
                  RowBox[{"-", 
                   FractionBox[
                    RowBox[{"3", "\[Pi]"}], "2"]}], "+", "rotation"}]}], 
                "}"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}],
               ",", 
              RowBox[{"position", "-", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], 
                "]"}]}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    FractionBox["length", "bend"], "-", "wd"}], " ", ")"}], 
                    RowBox[{"Sin", "[", "bend", "]"}]}], ",", 
                   RowBox[{
                    RowBox[{
                    FractionBox["length", "bend"], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Cos", "[", "bend", "]"}]}], ")"}]}], "+", 
                    RowBox[{"wd", " ", 
                    RowBox[{"Cos", "[", "bend", "]"}]}]}]}], "}"}], ",", 
                 "rotation"}], "]"}]}], ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    FractionBox["length", "bend"], "+", "wd"}], ")"}], 
                    RowBox[{"(", 
                    RowBox[{"Sin", "[", "bend", "]"}], ")"}]}], ",", 
                   RowBox[{
                    RowBox[{
                    FractionBox["length", "bend"], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Cos", "[", "bend", "]"}]}], ")"}]}], "-", 
                    RowBox[{"wd", " ", 
                    RowBox[{"Cos", "[", "bend", "]"}]}]}]}], "}"}], ",", 
                 "rotation"}], "]"}]}]}], "}"}], "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{"MADDrawText", ",", 
             RowBox[{"Text", "[", 
              RowBox[{"label", ",", 
               RowBox[{"position", "+", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
                RowBox[{
                 RowBox[{"TextOscillate", "[", "]"}], 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", 
                    FractionBox["bend", "2"]}], "]"}]}], ",", 
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", 
                    FractionBox["bend", "2"]}], "]"}]}]}], "}"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", 
                   FractionBox["bend", "2"]}], "]"}], ",", 
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", 
                   FractionBox["bend", "2"]}], "]"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"White", ",", "colour", ",", 
           RowBox[{"Thickness", "[", "thick", "]"}], ",", 
           RowBox[{"EdgeForm", "[", 
            RowBox[{"Thickness", "[", "Medium", "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Polygon", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}],
               ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"length", ",", "wd"}], "}"}], ",", "rotation"}], 
                "]"}]}], ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"length", ",", 
                   RowBox[{"-", "wd"}]}], "}"}], ",", "rotation"}], "]"}]}], 
              ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"-", "wd"}]}], "}"}], ",", "rotation"}], "]"}]}]}],
              "}"}], "]"}], ",", "Black", ",", 
           RowBox[{"If", "[", 
            RowBox[{"MADDrawText", ",", 
             RowBox[{"Text", "[", 
              RowBox[{"label", ",", 
               RowBox[{"position", "+", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
                RowBox[{
                 RowBox[{"TextOscillate", "[", "]"}], 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}], ",", 
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}]}], 
                  "}"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", "0"}], "]"}], ",", 
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}], "}"}]}], 
              "]"}], ",", 
             RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], "]"}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978138994975295`*^9, 3.3978139079507627`*^9}, {
   3.3978139643421097`*^9, 3.397813968607789*^9}, {3.397831158202813*^9, 
   3.397831159827834*^9}, {3.397899144069775*^9, 3.3978991709607444`*^9}, {
   3.3978992360397024`*^9, 3.3978992435241733`*^9}, {3.397899922876619*^9, 
   3.397899938611195*^9}, 3.397971232380997*^9, {3.3992713149250045`*^9, 
   3.399271324393815*^9}, {3.39927977596353*^9, 3.399279781260439*^9}, {
   3.40205103090625*^9, 3.402051038890625*^9}, {3.4029280644634666`*^9, 
   3.4029280990576596`*^9}, {3.40342500938004*^9, 3.403425062833849*^9}, {
   3.403425135866034*^9, 3.403425151241231*^9}, 3.403425216335814*^9, {
   3.4034252512737613`*^9, 3.403425341165537*^9}, {3.4034253785566406`*^9, 
   3.4034254382292795`*^9}, {3.4034254822454677`*^9, 3.403425511011461*^9}, {
   3.4034255544651423`*^9, 3.4034255564651675`*^9}, 3.4034257466707273`*^9, {
   3.403425823515461*^9, 3.403425823624837*^9}, {3.403425853797098*^9, 
   3.403425894406993*^9}, {3.403426136925722*^9, 3.403426151269656*^9}, {
   3.4034265385714884`*^9, 3.4034265720719175`*^9}, 3.403427369738377*^9, 
   3.4034275825536013`*^9, 3.403433419596534*^9, 3.4034334971131516`*^9, {
   3.403433580926724*^9, 3.403433635911803*^9}, {3.4034339330093555`*^9, 
   3.403434005541534*^9}, {3.403435733532402*^9, 3.4034357346261663`*^9}, 
   3.403435769064107*^9, {3.404469345981733*^9, 3.404469414435296*^9}, {
   3.4044695871707764`*^9, 3.404469607733408*^9}, 3.4044699122822323`*^9, 
   3.404472582564947*^9, {3.405236401858689*^9, 3.4052364102025456`*^9}, {
   3.4052365350947695`*^9, 3.4052365355010242`*^9}, 3.4052365895954666`*^9, {
   3.4173279351579313`*^9, 3.417327945829875*^9}, 3.4173279771894503`*^9, {
   3.4173280382835913`*^9, 3.4173280384398427`*^9}, 3.4173478923467026`*^9, 
   3.4173510684920297`*^9, {3.4185385823675995`*^9, 3.41853862813381*^9}, {
   3.4185387045566635`*^9, 3.4185387048691673`*^9}, {3.4185387404321227`*^9, 
   3.4185387654324427`*^9}, 3.418539049420453*^9, 3.4221665491730947`*^9, {
   3.4265882601657*^9, 3.426588260478198*^9}, {3.4265886155071754`*^9, 
   3.4265886162102966`*^9}, {3.4344620806733294`*^9, 
   3.4344621081578803`*^9}, {3.4429115731944847`*^9, 
   3.4429116245857673`*^9}, {3.443340756242387*^9, 3.4433411243072424`*^9}, {
   3.443341161479356*^9, 3.4433412068702707`*^9}, {3.4433412921051917`*^9, 
   3.4433414240122857`*^9}, {3.4433414664969325`*^9, 
   3.4433416415918036`*^9}, {3.4433416746701403`*^9, 
   3.4433417612488194`*^9}, {3.443341814405409*^9, 3.4433420900946736`*^9}, {
   3.443342127344912*^9, 3.443342200579756*^9}, {3.443342234533098*^9, 
   3.44334229897101*^9}, {3.4433423556744986`*^9, 3.4433423924403586`*^9}, {
   3.443342455628263*^9, 3.443342621254323*^9}, {3.4433426683796244`*^9, 
   3.443342758958329*^9}, {3.4433428566308293`*^9, 3.443343060913387*^9}, {
   3.4433430921323366`*^9, 3.443343318633786*^9}, {3.4433433750560226`*^9, 
   3.4433434011655645`*^9}, {3.4433434329001427`*^9, 3.44334344107207*^9}, {
   3.4433434809942007`*^9, 3.4433434918692703`*^9}, {3.4433435333851604`*^9, 
   3.4433435557134285`*^9}, {3.44334371837072*^9, 3.443343750058422*^9}, {
   3.4433439310127053`*^9, 3.4433439388252554`*^9}, {3.443343985606805*^9, 
   3.443344031888351*^9}, {3.4433441168263946`*^9, 3.4433441516703677`*^9}, {
   3.443344183811198*^9, 3.443344316015169*^9}, 3.443344353734161*^9, {
   3.4433444154689307`*^9, 3.4433445336571875`*^9}, {3.443344831377843*^9, 
   3.443344847002943*^9}, {3.447420109567984*^9, 3.4474201250680833`*^9}, {
   3.447420227818741*^9, 3.4474202421625824`*^9}, {3.4474202992410727`*^9, 
   3.4474203002098293`*^9}, {3.4476793801415896`*^9, 
   3.4476793879385147`*^9}, {3.4476794294231553`*^9, 
   3.4476795413457465`*^9}, {3.447679598111735*^9, 3.447679647971429*^9}, {
   3.4476798485039625`*^9, 3.4476798814572983`*^9}, {3.4476799129262495`*^9, 
   3.4476799323326235`*^9}, {3.447679965520336*^9, 3.447679967973477*^9}, {
   3.4476800424583282`*^9, 3.4476800904586353`*^9}, {3.4476801543965445`*^9, 
   3.4476801569121857`*^9}, {3.4477443911740866`*^9, 3.447744391502216*^9}, {
   3.4550158148699675`*^9, 3.4550158417137175`*^9}, {3.4550159259168425`*^9, 
   3.4550159488387175`*^9}, {3.4550159992918425`*^9, 
   3.4550160259012175`*^9}, {3.4550162781824675`*^9, 
   3.4550163326355925`*^9}, {3.4550163700262175`*^9, 
   3.4550163784480925`*^9}, {3.4550164117918425`*^9, 
   3.4550164237293425`*^9}, {3.4550164631043425`*^9, 
   3.4550164643387175`*^9}, {3.4552604882930055`*^9, 
   3.4552605046680055`*^9}, {3.4552609247617555`*^9, 
   3.4552609436680055`*^9}, {3.4555363227693405`*^9, 
   3.4555363279099655`*^9}, {3.463296257063916*^9, 3.4632962585795703`*^9}, 
   3.4689130082956142`*^9, {3.4700548117146187`*^9, 
   3.4700548471208687`*^9}},ExpressionUUID->"2c5d06ed-9354-4bbe-9abf-\
3479a092f510"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.4034253716815524`*^9, 3.403425376494114*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<septumabove\>\"", ",", "position_", ",", "length_", ",", "bend_", 
     ",", "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"E1", ",", "E2", ",", "colour"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"colour", "=", 
       RowBox[{
        RowBox[{"Colour", "/.", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"opts", ",", 
           RowBox[{"{", "Colour", "}"}]}], "]"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Colour", "\[Rule]", 
          RowBox[{"{", "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"fancyelements", "===", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"E1", "=", 
            RowBox[{"-", 
             RowBox[{
              RowBox[{"Symbol", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], ")"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "5", 
              "\[RightDoubleBracket]"}]}]}], ";", 
           RowBox[{"E2", "=", 
            RowBox[{"-", 
             RowBox[{
              RowBox[{"Symbol", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], ")"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<>", 
                "\"\<Extra\>\""}], "]"}], "\[LeftDoubleBracket]", "6", 
              "\[RightDoubleBracket]"}]}]}], ";", 
           RowBox[{"Tooltip", "[", 
            RowBox[{
             RowBox[{"EventHandler", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
                 RowBox[{"MADElementModify", "[", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TableForm", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<\>\""}], ",", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "&"}], "[", 
                    RowBox[{"(", 
                    RowBox[{"Element", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], "]"}], ",", "Bold"}],
                   "]"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<Length = \>\"", "<>", 
                  RowBox[{"ToString", "[", "length", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<angle = \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"N", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Element", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "/", 
                    "Degree"}], "]"}], "]"}], "<>", "\"\<\[Degree]\>\""}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<Position = \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"NumberRight", "@", 
                    RowBox[{"Chop", "[", 
                    RowBox[{"position", ",", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "5"}]]}], "]"}]}], "]"}]}], "}"}]}], "}"}], 
              "]"}]}], "]"}]}], ",", 
          RowBox[{"List", "[", "#", "]"}]}], "]"}], "&"}], "[", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"bends", "===", "True"}], "&&", 
          RowBox[{
           RowBox[{"Abs", "[", "bend", "]"}], ">", "10"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"colour", ",", 
           RowBox[{"Thickness", "[", "thick", "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"position", "+", 
              RowBox[{"MADDrawRot", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  FractionBox["length", "bend"]}], "}"}], ",", "rotation"}], 
               "]"}]}], ",", 
             RowBox[{
              FractionBox["length", 
               RowBox[{"Abs", "[", "bend", "]"}]], "-", "wd"}], "  ", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bend", "\[GreaterEqual]", "0"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "rotation"}], ",", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "bend", "+", 
                  "rotation"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{
                    RowBox[{"-", "3"}], "\[Pi]"}], "2"], "+", "rotation", "+",
                   "bend"}], ",", 
                 RowBox[{
                  RowBox[{"-", 
                   FractionBox[
                    RowBox[{"3", "\[Pi]"}], "2"]}], "+", "rotation"}]}], 
                "}"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"position", "+", 
              RowBox[{"MADDrawRot", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  FractionBox["length", "bend"]}], "}"}], ",", "rotation"}], 
               "]"}]}], ",", 
             FractionBox["length", 
              RowBox[{"Abs", "[", "bend", "]"}]], ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bend", "\[GreaterEqual]", "0"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "rotation"}], ",", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"3", "\[Pi]"}], "2"], "+", "bend", "+", 
                  "rotation"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{
                    RowBox[{"-", "3"}], "\[Pi]"}], "2"], "+", "rotation", "+",
                   "bend"}], ",", 
                 RowBox[{
                  RowBox[{"-", 
                   FractionBox[
                    RowBox[{"3", "\[Pi]"}], "2"]}], "+", "rotation"}]}], 
                "}"}]}], "]"}]}], "]"}], "\[IndentingNewLine]", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}],
               ",", 
              RowBox[{"position", "-", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", "rotation"}], 
                "]"}]}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    FractionBox["length", "bend"], " ", ")"}], 
                    RowBox[{"Sin", "[", "bend", "]"}]}], ",", 
                   RowBox[{
                    RowBox[{
                    FractionBox["length", "bend"], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Cos", "[", "bend", "]"}]}], ")"}]}], "+", 
                    RowBox[{"wd", " ", 
                    RowBox[{"Cos", "[", "bend", "]"}]}]}]}], "}"}], ",", 
                 "rotation"}], "]"}]}], ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    FractionBox["length", "bend"], "+", "wd"}], ")"}], 
                    RowBox[{"(", 
                    RowBox[{"Sin", "[", "bend", "]"}], ")"}]}], ",", 
                   RowBox[{
                    FractionBox["length", "bend"], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Cos", "[", "bend", "]"}]}], ")"}]}]}], "}"}], 
                 ",", "rotation"}], "]"}]}]}], "}"}], "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{"MADDrawText", ",", 
             RowBox[{"Text", "[", 
              RowBox[{"label", ",", 
               RowBox[{"position", "+", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
                RowBox[{
                 RowBox[{"TextOscillate", "[", "]"}], 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", 
                    FractionBox["bend", "2"]}], "]"}]}], ",", 
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", 
                    FractionBox["bend", "2"]}], "]"}]}]}], "}"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", 
                   FractionBox["bend", "2"]}], "]"}], ",", 
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", 
                   FractionBox["bend", "2"]}], "]"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"White", ",", "colour", ",", 
           RowBox[{"Thickness", "[", "thick", "]"}], ",", 
           RowBox[{"EdgeForm", "[", 
            RowBox[{"Thickness", "[", "Medium", "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Polygon", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}],
               ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"length", ",", "wd"}], "}"}], ",", "rotation"}], 
                "]"}]}], ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"length", ",", 
                   RowBox[{
                    RowBox[{"-", "0.25"}], "wd"}]}], "}"}], ",", "rotation"}],
                 "]"}]}], ",", 
              RowBox[{"position", "+", 
               RowBox[{"MADDrawRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"-", "0.25"}], "wd"}]}], "}"}], ",", "rotation"}],
                 "]"}]}]}], "}"}], "]"}], ",", "Black", ",", 
           RowBox[{"If", "[", 
            RowBox[{"MADDrawText", ",", 
             RowBox[{"Text", "[", 
              RowBox[{"label", ",", 
               RowBox[{"position", "+", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                  RowBox[{
                   FractionBox["length", "2"], 
                   RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
                RowBox[{
                 RowBox[{"TextOscillate", "[", "]"}], 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}], ",", 
                   RowBox[{"1.3", "wd", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}]}], 
                  "}"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", "0"}], "]"}], ",", 
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}], "}"}]}], 
              "]"}], ",", 
             RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], "]"}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978138994975295`*^9, 3.3978139079507627`*^9}, {
   3.3978139643421097`*^9, 3.397813968607789*^9}, {3.397831158202813*^9, 
   3.397831159827834*^9}, {3.397899144069775*^9, 3.3978991709607444`*^9}, {
   3.3978992360397024`*^9, 3.3978992435241733`*^9}, {3.397899922876619*^9, 
   3.397899938611195*^9}, 3.397971232380997*^9, {3.3992713149250045`*^9, 
   3.399271324393815*^9}, {3.39927977596353*^9, 3.399279781260439*^9}, {
   3.40205103090625*^9, 3.402051038890625*^9}, {3.4029280644634666`*^9, 
   3.4029280990576596`*^9}, {3.40342500938004*^9, 3.403425062833849*^9}, {
   3.403425135866034*^9, 3.403425151241231*^9}, 3.403425216335814*^9, {
   3.4034252512737613`*^9, 3.403425341165537*^9}, {3.4034253785566406`*^9, 
   3.4034254382292795`*^9}, {3.4034254822454677`*^9, 3.403425511011461*^9}, {
   3.4034255544651423`*^9, 3.4034255564651675`*^9}, 3.4034257466707273`*^9, {
   3.403425823515461*^9, 3.403425823624837*^9}, {3.403425853797098*^9, 
   3.403425894406993*^9}, {3.403426136925722*^9, 3.403426151269656*^9}, {
   3.4034265385714884`*^9, 3.4034265720719175`*^9}, 3.403427369738377*^9, 
   3.4034275825536013`*^9, 3.403433419596534*^9, 3.4034334971131516`*^9, {
   3.403433580926724*^9, 3.403433635911803*^9}, {3.4034339330093555`*^9, 
   3.403434005541534*^9}, {3.403435733532402*^9, 3.4034357346261663`*^9}, 
   3.403435769064107*^9, {3.404469345981733*^9, 3.404469414435296*^9}, {
   3.4044695871707764`*^9, 3.404469607733408*^9}, 3.4044699122822323`*^9, 
   3.404472582564947*^9, {3.405236401858689*^9, 3.4052364102025456`*^9}, {
   3.4052365350947695`*^9, 3.4052365355010242`*^9}, 3.4052365895954666`*^9, {
   3.4173279351579313`*^9, 3.417327945829875*^9}, 3.4173279771894503`*^9, {
   3.4173280382835913`*^9, 3.4173280384398427`*^9}, 3.4173478923467026`*^9, 
   3.4173510684920297`*^9, {3.4185385823675995`*^9, 3.41853862813381*^9}, {
   3.4185387045566635`*^9, 3.4185387048691673`*^9}, {3.4185387404321227`*^9, 
   3.4185387654324427`*^9}, 3.418539049420453*^9, 3.4221665491730947`*^9, {
   3.4265882601657*^9, 3.426588260478198*^9}, {3.4265886155071754`*^9, 
   3.4265886162102966`*^9}, {3.4344620806733294`*^9, 
   3.4344621081578803`*^9}, {3.4429115731944847`*^9, 
   3.4429116245857673`*^9}, {3.443340756242387*^9, 3.4433411243072424`*^9}, {
   3.443341161479356*^9, 3.4433412068702707`*^9}, {3.4433412921051917`*^9, 
   3.4433414240122857`*^9}, {3.4433414664969325`*^9, 
   3.4433416415918036`*^9}, {3.4433416746701403`*^9, 
   3.4433417612488194`*^9}, {3.443341814405409*^9, 3.4433420900946736`*^9}, {
   3.443342127344912*^9, 3.443342200579756*^9}, {3.443342234533098*^9, 
   3.44334229897101*^9}, {3.4433423556744986`*^9, 3.4433423924403586`*^9}, {
   3.443342455628263*^9, 3.443342621254323*^9}, {3.4433426683796244`*^9, 
   3.443342758958329*^9}, {3.4433428566308293`*^9, 3.443343060913387*^9}, {
   3.4433430921323366`*^9, 3.443343318633786*^9}, {3.4433433750560226`*^9, 
   3.4433434011655645`*^9}, {3.4433434329001427`*^9, 3.44334344107207*^9}, {
   3.4433434809942007`*^9, 3.4433434918692703`*^9}, {3.4433435333851604`*^9, 
   3.4433435557134285`*^9}, {3.44334371837072*^9, 3.443343750058422*^9}, {
   3.4433439310127053`*^9, 3.4433439388252554`*^9}, {3.443343985606805*^9, 
   3.443344031888351*^9}, {3.4433441168263946`*^9, 3.4433441516703677`*^9}, {
   3.443344183811198*^9, 3.443344316015169*^9}, 3.443344353734161*^9, {
   3.4433444154689307`*^9, 3.4433445336571875`*^9}, {3.443344831377843*^9, 
   3.443344847002943*^9}, {3.447420109567984*^9, 3.4474201250680833`*^9}, {
   3.447420227818741*^9, 3.4474202421625824`*^9}, {3.4474202992410727`*^9, 
   3.4474203002098293`*^9}, {3.4476793801415896`*^9, 
   3.4476793879385147`*^9}, {3.4476794294231553`*^9, 
   3.4476795413457465`*^9}, {3.447679598111735*^9, 3.447679647971429*^9}, {
   3.4476798485039625`*^9, 3.4476798814572983`*^9}, {3.4476799129262495`*^9, 
   3.4476799323326235`*^9}, {3.447679965520336*^9, 3.447679967973477*^9}, {
   3.4476800424583282`*^9, 3.4476800904586353`*^9}, {3.4476801543965445`*^9, 
   3.4476801569121857`*^9}, {3.4477443911740866`*^9, 3.447744391502216*^9}, {
   3.4550158148699675`*^9, 3.4550158417137175`*^9}, {3.4550159259168425`*^9, 
   3.4550159488387175`*^9}, {3.4550159992918425`*^9, 
   3.4550160259012175`*^9}, {3.4550162781824675`*^9, 
   3.4550163326355925`*^9}, {3.4550163700262175`*^9, 
   3.4550163784480925`*^9}, {3.4550164117918425`*^9, 
   3.4550164237293425`*^9}, {3.4550164631043425`*^9, 
   3.4550164643387175`*^9}, {3.4552604882930055`*^9, 
   3.4552605046680055`*^9}, {3.4552609247617555`*^9, 
   3.4552609436680055`*^9}, {3.4552628552305055`*^9, 
   3.4552629276211305`*^9}, {3.4552631052930055`*^9, 
   3.4552631099180055`*^9}, {3.4552631761211305`*^9, 
   3.4552631781367555`*^9}, {3.4552633952617555`*^9, 
   3.4552634145898805`*^9}, {3.4552635691523805`*^9, 
   3.4552636494961305`*^9}, {3.4552637197617555`*^9, 
   3.4552637390742555`*^9}, {3.4552679601523805`*^9, 
   3.4552680382930055`*^9}, {3.4552680869023805`*^9, 
   3.4552681852773805`*^9}, {3.4552682987773805`*^9, 
   3.4552682989492555`*^9}, {3.4552707575430055`*^9, 
   3.4552707673711305`*^9}, {3.4632962587201977`*^9, 
   3.4632962602046013`*^9}},ExpressionUUID->"7ca759c4-bd6a-45c9-aeba-\
b045e28768ab"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quadrupole", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"wq", ":=", 
   RowBox[{"0.12", "*", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397812903661284*^9, {3.397813649853709*^9, 3.3978136671351805`*^9}, {
   3.404474136731143*^9, 3.404474143231185*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<quadrupole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",",
      "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ar", "=", " ", 
       RowBox[{"1", "+", 
        RowBox[{"0", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"1", "/", "AspectRatio"}], "/.", "opts"}], "/.", 
           RowBox[{"{", 
            RowBox[{"AspectRatio", "\[Rule]", "1"}], "}"}]}], ")"}]}]}]}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"fancyelements", "===", "True"}], ",", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"EventHandler", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
               RowBox[{"MADElementModify", "[", 
                RowBox[{"Element", "/.", 
                 RowBox[{"{", "opts", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"TableForm", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<\>\""}], ",", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "&"}], "[", 
                  RowBox[{"(", 
                   RowBox[{"Element", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], "]"}], ",", "Bold"}],
                 "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<Length = \>\"", "<>", 
                RowBox[{"ToString", "[", "length", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<\!\(\*SubscriptBox[\(K\), \(1\)]\) = \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"N", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"Element", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], 
                   "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}], "]"}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"\"\<Position = \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"NumberRight", "@", 
                  RowBox[{"Chop", "[", 
                   RowBox[{"position", ",", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "5"}]]}], "]"}]}], "]"}]}], "}"}]}], "}"}], 
            "]"}]}], "]"}], ",", 
         RowBox[{"List", "[", "#", "]"}]}], "]"}], "&"}], "[", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FilterRules", "[", 
         RowBox[{"opts", ",", 
          RowBox[{"{", "Colour", "}"}]}], "]"}], ",", 
        RowBox[{"Thickness", "[", "thick", "]"}], ",", "White", ",", 
        RowBox[{"EdgeForm", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Thickness", "[", "Medium", "]"}], ",", 
           RowBox[{"RGBColor", "[", 
            RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], "}"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Polygon", "[", 
         RowBox[{"{", 
          RowBox[{"position", ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"1.4", "wq"}]}], "}"}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"length", ",", 
                RowBox[{"1.4", "wq"}]}], "}"}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"length", ",", 
                RowBox[{
                 RowBox[{"-", "1.4"}], "wq"}]}], "}"}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"1.4", "wq"}]}], "}"}]}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", "position"}], 
          "}"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Polygon", "[", 
         RowBox[{"{", 
          RowBox[{"position", ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "wq"}], "}"}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"length", ",", "wq"}], "}"}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"length", ",", 
                RowBox[{"-", "wq"}]}], "}"}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", 
           RowBox[{"position", "+", 
            RowBox[{"MADDrawRot", "[", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"{", 
                RowBox[{"0", ",", "wq"}], "}"}]}], ",", 
              RowBox[{"ar", " ", "rotation"}]}], "]"}]}], ",", "position"}], 
          "}"}], "]"}], ",", 
        RowBox[{"If", "[", 
         RowBox[{"MADDrawText", ",", 
          RowBox[{"{", 
           RowBox[{"Red", ",", 
            RowBox[{"Text", "[", 
             RowBox[{"label", ",", 
              RowBox[{"position", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  FractionBox["length", "2"], 
                  RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
                 RowBox[{
                  FractionBox["length", "2"], 
                  RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
               RowBox[{
                RowBox[{"TextOscillate", "[", "]"}], 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"1.5", "wq", " ", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}], ",", " ", 
                  RowBox[{"1.5", " ", "wq", " ", 
                   RowBox[{"Cos", "[", 
                    RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Sin", "[", 
                 RowBox[{"-", "rotation"}], "]"}], ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          ",", 
          RowBox[{"{", "}"}]}], "]"}]}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978136974793186`*^9, 3.3978138085276155`*^9}, {
   3.397813884591089*^9, 3.397813884856717*^9}, {3.397813927013507*^9, 
   3.397813929716666*^9}, 3.3978991764139395`*^9, 3.397899237992852*^9, {
   3.3978996364198275`*^9, 3.3978996874829807`*^9}, {3.397899748421261*^9, 
   3.397899831625451*^9}, 3.397971232974755*^9, {3.399279787713605*^9, 
   3.3992797917292557`*^9}, {3.4034274335048184`*^9, 3.403427439629897*^9}, {
   3.4034274800054135`*^9, 3.4034275084276524`*^9}, {3.4034275886630545`*^9, 
   3.4034276417106085`*^9}, {3.403433411065175*^9, 3.403433412502693*^9}, 
   3.4034334934568543`*^9, {3.403433600301972*^9, 3.4034336033020105`*^9}, 
   3.403433711819024*^9, {3.403433747397605*^9, 3.403433843648837*^9}, {
   3.403434052760888*^9, 3.4034340556671753`*^9}, {3.4034357390637226`*^9, 
   3.4034357668453283`*^9}, 3.4044731445841684`*^9, {3.4044739812926483`*^9, 
   3.4044739936677275`*^9}, {3.4044741114341063`*^9, 3.404474113684121*^9}, 
   3.4044741519031153`*^9, {3.404474187653344*^9, 3.404474193544007*^9}, {
   3.404474961377046*^9, 3.4044749615020466`*^9}, {3.4044806784448853`*^9, 
   3.4044806838355446`*^9}, {3.4052363649675913`*^9, 3.4052363922804413`*^9}, 
   3.405236540141709*^9, 3.405236585642291*^9, {3.4105941341595745`*^9, 
   3.410594157456748*^9}, 3.4105942322077045`*^9, {3.4105942680362883`*^9, 
   3.410594278223919*^9}, 3.4173478950342197`*^9, 3.4173510688045316`*^9, 
   3.422166549766848*^9, {3.4550133082605925`*^9, 3.4550133485887175`*^9}, {
   3.4550143121043425`*^9, 3.4550143492137175`*^9}, {3.4550144301043425`*^9, 
   3.4550145325105925`*^9}, {3.4550145781355925`*^9, 
   3.4550145817293425`*^9}, {3.4550146376512175`*^9, 
   3.4550146556512175`*^9}, {3.4550146907762175`*^9, 
   3.4550147959480925`*^9}, {3.4550148309012175`*^9, 
   3.4550148830574675`*^9}, {3.4550149133074675`*^9, 
   3.4550149767293425`*^9}, {3.4550150188230925`*^9, 
   3.4550150206199675`*^9}, {3.4550150684637175`*^9, 
   3.4550151054480925`*^9}, {3.4550151573699675`*^9, 
   3.4550152056980925`*^9}, {3.4550152455574675`*^9, 
   3.4550152498855925`*^9}, {3.4550152819324675`*^9, 3.4550153070105925`*^9}, 
   3.4550159529168425`*^9, {3.463296260360854*^9, 
   3.463296261532752*^9}},ExpressionUUID->"5adafa75-371d-47f3-a45c-\
e366d8449155"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sextupole", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ws", ":=", 
   RowBox[{"0.08", "*", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.3978155766439967`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<sextupole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"fancyelements", "===", "True"}], ",", 
       RowBox[{"Tooltip", "[", 
        RowBox[{
         RowBox[{"EventHandler", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
             RowBox[{"MADElementModify", "[", 
              RowBox[{"Element", "/.", 
               RowBox[{"{", "opts", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"TableForm", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}], 
                    "===", "\"\<\>\""}], ",", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "7"}], "\[RightDoubleBracket]"}]}], 
                  "]"}], "&"}], "[", 
                RowBox[{"(", 
                 RowBox[{"Element", "/.", 
                  RowBox[{"{", "opts", "}"}]}], ")"}], "]"}], ",", "Bold"}], 
              "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\"\<Length = \>\"", "<>", 
              RowBox[{"ToString", "[", "length", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\"\<\!\(\*SubscriptBox[\(K\), \(2\)]\) = \>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"N", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Element", "/.", 
                   RowBox[{"{", "opts", "}"}]}], ")"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}], "]"}], 
               "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"\"\<Position = \>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"NumberRight", "@", 
                RowBox[{"Chop", "[", 
                 RowBox[{"position", ",", 
                  SuperscriptBox["10", 
                   RowBox[{"-", "5"}]]}], "]"}]}], "]"}]}], "}"}]}], "}"}], 
          "]"}]}], "]"}], ",", 
       RowBox[{"List", "[", "#", "]"}]}], "]"}], "&"}], "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Thickness", "[", "thick", "]"}], ",", "White", ",", 
      RowBox[{"EdgeForm", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Thickness", "[", "Medium", "]"}], ",", 
         RowBox[{"RGBColor", "[", 
          RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Polygon", "[", 
       RowBox[{"{", 
        RowBox[{"position", ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "ws"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"length", ",", 
              RowBox[{"1.4", "ws"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"length", ",", 
              RowBox[{
               RowBox[{"-", "1.4"}], "ws"}]}], "}"}], ",", "rotation"}], 
           "]"}]}], ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"1.4", "ws"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
         ",", "position"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Polygon", "[", 
       RowBox[{"{", 
        RowBox[{"position", ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "ws"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"length", ",", "ws"}], "}"}], ",", "rotation"}], "]"}]}],
          ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"length", ",", 
              RowBox[{"-", "ws"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"{", 
              RowBox[{"0", ",", "ws"}], "}"}]}], ",", "rotation"}], "]"}]}], 
         ",", "position"}], "}"}], "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{"MADDrawText", ",", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"Text", "[", 
           RowBox[{"label", ",", 
            RowBox[{"position", "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                FractionBox["length", "2"], 
                RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
               RowBox[{
                FractionBox["length", "2"], 
                RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
             RowBox[{
              RowBox[{"TextOscillate", "[", "]"}], 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"2.2", "ws", " ", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"-", "rotation"}], "]"}]}], ",", 
                RowBox[{"2.2", "ws", " ", 
                 RowBox[{"Cos", "[", 
                  RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}], ",", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", "}"}]}], "]"}]}], "}"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978140964375505`*^9, 3.397814124328532*^9}, 
   3.397899180335864*^9, 3.397899239930377*^9, {3.3978999481894426`*^9, 
   3.3978999614396124`*^9}, 3.3979712335685124`*^9, {3.399279796463661*^9, 
   3.3992798004011865`*^9}, {3.3992802362164755`*^9, 3.399280249935313*^9}, {
   3.4034333451112056`*^9, 3.403433354892581*^9}, {3.403433425549735*^9, 
   3.4034334899568095`*^9}, {3.4034336498182306`*^9, 3.403433651849507*^9}, 
   3.4034337188659897`*^9, {3.403433835539358*^9, 3.4034338605240526`*^9}, {
   3.403434057651576*^9, 3.4034340584640865`*^9}, {3.4034357411262493`*^9, 
   3.403435763673413*^9}, 3.4044731482404423`*^9, {3.4052363980305147`*^9, 
   3.4052364156713657`*^9}, {3.4052365438761315`*^9, 3.405236580954731*^9}, {
   3.4105943074742928`*^9, 3.410594310927462*^9}, 3.4173478970498576`*^9, 
   3.4173510694139104`*^9, 3.4221665504387274`*^9, {3.463296261689005*^9, 
   3.4632962628140264`*^9}},ExpressionUUID->"a80df69f-6460-45b8-b4ad-\
5f934533e602"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Octupole", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"wo", ":=", 
   RowBox[{"0.06", "*", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.397814135766179*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<octupole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0", ",", "0.5", ",", "1"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wo"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wo"}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wo"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "wo"}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wo"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wo"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wo"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wo"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.8", "wo", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.8", "wo", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978141435162783`*^9, 3.3978141588602247`*^9}, 
   3.397899183445279*^9, 3.3978992469929676`*^9, {3.3978999712678633`*^9, 
   3.3978999770335617`*^9}, 3.3979712342872715`*^9, {3.3992798048699646`*^9, 
   3.399279809901247*^9}, {3.4632962629702797`*^9, 3.46329626429843*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["RF Cavities & Solenoids", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"wrf", ":=", 
   RowBox[{"0.05", "*", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.397815570440792*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<rfc\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0", ",", "1", ",", "0"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}],
         ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "wrf"}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wrf"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wrf"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{"Text", "[", 
      RowBox[{"label", ",", 
       RowBox[{"position", "+", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
        RowBox[{
         RowBox[{"TextOscillate", "[", "]"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Sin", "[", 
             RowBox[{"-", "rotation"}], "]"}]}], ",", 
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"-", "rotation"}], "]"}], ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.397814169391609*^9, 3.397814177516713*^9}, 
   3.397899189289104*^9, 3.3978992510555196`*^9, {3.3978999801429768`*^9, 
   3.3978999855649214`*^9}, 3.397971234802903*^9, {3.4632962644546833`*^9, 
   3.463296265657831*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<lcav\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0", ",", "1", ",", "0"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}],
         ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "wrf"}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wrf"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wrf"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{"Text", "[", 
      RowBox[{"label", ",", 
       RowBox[{"position", "+", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
        RowBox[{
         RowBox[{"TextOscillate", "[", "]"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Sin", "[", 
             RowBox[{"-", "rotation"}], "]"}]}], ",", 
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"-", "rotation"}], "]"}], ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978141812823863`*^9, 3.397899188273466*^9, 3.3978992522586603`*^9, {
   3.3978999905181093`*^9, 3.397899997283821*^9}, 3.3979712354435363`*^9, {
   3.463296265845335*^9, 3.463296267001607*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<solenoid\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0", ",", "1", ",", "0.25"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}],
         ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "wrf"}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wrf"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wrf"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{"Text", "[", 
      RowBox[{"label", ",", 
       RowBox[{"position", "+", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
        RowBox[{
         RowBox[{"TextOscillate", "[", "]"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Sin", "[", 
             RowBox[{"-", "rotation"}], "]"}]}], ",", 
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"-", "rotation"}], "]"}], ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978141831574106`*^9, 3.3978991871328263`*^9, 3.397899253586802*^9, {
   3.397900000627614*^9, 3.3979000053933*^9}, 3.397971235959168*^9, {
   3.46329626715786*^9, 3.4632962683297577`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<freetext\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0.25", ",", "1", ",", "0.5"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wrf"}], "}"}], ",", "rotation"}], "]"}]}],
         ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "wrf"}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wrf"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wrf"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wrf"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{"Text", "[", 
      RowBox[{"label", ",", 
       RowBox[{"position", "+", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
          RowBox[{
           FractionBox["length", "2"], 
           RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
        RowBox[{
         RowBox[{"TextOscillate", "[", "]"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Sin", "[", 
             RowBox[{"-", "rotation"}], "]"}]}], ",", 
           RowBox[{"1.9", "wrf", " ", 
            RowBox[{"Cos", "[", 
             RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"-", "rotation"}], "]"}], ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978141831574106`*^9, 3.3978991871328263`*^9, 3.397899253586802*^9, {
   3.397900000627614*^9, 3.3979000053933*^9}, 3.397971235959168*^9, {
   3.46329626715786*^9, 3.4632962683297577`*^9}, {3.5424512671147227`*^9, 
   3.54245127879474*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<gwiggler\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0.25", ",", "0.5", ",", "0.25"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"EdgeForm", "[", 
      RowBox[{"Thickness", "[", "Medium", "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wd"}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wd"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "wd"}]}], "}"}], ",", "rotation"}], "]"}]}]}], 
       "}"}], "]"}], ",", "Black", ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.3", "wd", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{
                RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}], ",", 
             RowBox[{"1.3", "wd", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{
                RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}]}], "}"}]}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{
             RowBox[{"-", "rotation"}], "-", "0"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{
             RowBox[{"-", "rotation"}], "-", "0"}], "]"}]}], "}"}]}], "]"}], 
       ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.397814169391609*^9, 3.397814177516713*^9}, 
   3.397899189289104*^9, 3.3978992510555196`*^9, {3.3978999801429768`*^9, 
   3.3978999855649214`*^9}, 3.397971234802903*^9, {3.4632962644546833`*^9, 
   3.463296265657831*^9}, {3.6798981605229263`*^9, 3.6798981736489267`*^9}, {
   3.6798982059899263`*^9, 3.6798982440074263`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Kickers", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"wkick", ":=", 
   RowBox[{"0.05", "*", "widthscale"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.397815555940607*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<kicker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{".4", ",", ".4", ",", ".4"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], "]"}]}],
         ",", "position"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.8", "wkick", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.8", "wkick", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978141897981205`*^9, 3.3978141973607173`*^9}, {
   3.397828376604709*^9, 3.397828395042445*^9}, 3.3978991489604626`*^9, 
   3.3978992565868406`*^9, {3.3979000242685413`*^9, 3.3979000349093027`*^9}, 
   3.397971236381048*^9, {3.4541547048902426`*^9, 3.4541547080308676`*^9}, {
   3.463296268517261*^9, 3.4632962692672753`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<hkicker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{".4", ",", ".4", ",", ".4"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], "]"}]}],
         ",", "position"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.8", "wkick", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.8", "wkick", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978142014701447`*^9, {3.3978283852298193`*^9, 3.397828393792429*^9}, {
   3.3978990943503885`*^9, 3.3978990963504143`*^9}, 3.3978991509448633`*^9, 
   3.397899259430627*^9, {3.397900026315443*^9, 3.3979000444719253`*^9}, 
   3.3979712370060563`*^9, {3.4541547094683676`*^9, 3.4541547130777426`*^9}, {
   3.4632962694547787`*^9, 3.46329627001729*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<vkicker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{".4", ",", ".4", ",", ".4"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], "]"}]}],
         ",", "position"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.8", "wkick", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.8", "wkick", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978142026889105`*^9, {3.3978283866829634`*^9, 3.397828392417412*^9}, 
   3.3978991526167593`*^9, 3.3978992616025295`*^9, {3.397900027971714*^9, 
   3.3979000496282415`*^9}, 3.3979712375685635`*^9, {3.4541547152496176`*^9, 
   3.4541547191714926`*^9}, {3.463296270189168*^9, 3.4632962707204285`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Markers", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<symmline\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"Dashing", "[", 
      RowBox[{"{", 
       RowBox[{"0.01", ",", "0.01"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"3", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "3"}], " ", "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"3.5", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"3.5", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.397814211001517*^9, 3.397814222736042*^9}, {
   3.3978151046223297`*^9, 3.397815107137987*^9}, 3.3978991977735877`*^9, 
   3.397899265633831*^9, {3.3979000552845635`*^9, 3.3979000625346565`*^9}, 
   3.397971238256072*^9, {3.442910861919755*^9, 3.44291088573256*^9}, {
   3.4541546877808676`*^9, 3.4541546912183676`*^9}, {3.4541547242652426`*^9, 
   3.4541547247652426`*^9}, {3.4632962709079323`*^9, 3.463296271111061*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<marker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Thickness", "[", "thick", "]"}], ",", 
      RowBox[{"RGBColor", "[", 
       RowBox[{"0", ",", "0.79", ",", "0.34"}], "]"}], ",", 
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
         RowBox[{"position", "+", 
          RowBox[{"MADDrawRot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{
               RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
           "]"}]}]}], "}"}], "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{"MADDrawText", ",", 
        RowBox[{"Text", "[", 
         RowBox[{"label", ",", 
          RowBox[{"position", "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              FractionBox["length", "2"], 
              RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
             RowBox[{
              FractionBox["length", "2"], 
              RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
           RowBox[{
            RowBox[{"TextOscillate", "[", "]"}], 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2.3", "wq", " ", 
               RowBox[{"Sin", "[", 
                RowBox[{"-", "rotation"}], "]"}]}], ",", 
              RowBox[{"2.3", "wq", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{"-", "rotation"}], "]"}], ",", 
            RowBox[{"Cos", "[", 
             RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], "}"}], ")"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.397815111950549*^9, 3.397815120481908*^9}, 
   3.397899196695449*^9, 3.3978992669307227`*^9, {3.39790005695646*^9, 
   3.3979000698785005`*^9}, 3.3979712387248287`*^9, {3.442910892310769*^9, 
   3.44291092284241*^9}, {3.442910966530469*^9, 3.442910969874262*^9}, {
   3.4429110669223795`*^9, 3.442911069109907*^9}, {3.4541547349683676`*^9, 
   3.4541547379996176`*^9}, {3.463296271329815*^9, 3.4632962715016932`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["BPMs and Monitors", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<bpm\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"length", "*", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], ",", "rotation"}], "]"}]}]}], 
       "}"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"length", ">", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Polygon", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{
                RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
            "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], 
            "]"}]}], ",", "position"}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{
                RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
            "]"}]}]}], "}"}], "]"}]}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978151339352055`*^9, 3.3978151502947893`*^9}, 
   3.3978280802884164`*^9, 3.3978281453517494`*^9, {3.39782818213347*^9, 
   3.397828208852562*^9}, 3.39782835713571*^9, 3.3978992021173935`*^9, 
   3.397899270212015*^9, {3.397900073097292*^9, 3.397900096253838*^9}, 
   3.3979712053494015`*^9, {3.4541547431089926`*^9, 3.4541547567027426`*^9}, {
   3.4632962717048225`*^9, 3.4632962718610754`*^9}, {3.572006375677059*^9, 
   3.5720063811986113`*^9}, {3.572006427184209*^9, 3.572006482068697*^9}, {
   3.572006666041093*^9, 3.5720066905715456`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<bpmcircle\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"length", "*", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], ",", "rotation"}], "]"}]}]}], 
       "}"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{"1", ",", "0", ",", "0"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Disk", "[", 
      RowBox[{
       RowBox[{"position", "+", 
        RowBox[{"MADDrawRot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"length", "/", "2"}], ",", "0"}], "}"}], ",", 
          "rotation"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0.9", 
          RowBox[{"length", "/", "2"}]}], ",", 
         RowBox[{"1", "wq"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.2", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.2", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978151339352055`*^9, 3.3978151502947893`*^9}, {
   3.3978273941233835`*^9, 3.3978274838432817`*^9}, {3.397827548828489*^9, 
   3.3978275497035*^9}, {3.397827613891822*^9, 3.3978276773145084`*^9}, {
   3.3978280585537634`*^9, 3.3978280752883525`*^9}, 3.3978281464611387`*^9, {
   3.3978281835866137`*^9, 3.3978282614001093`*^9}, {3.3978282946036596`*^9, 
   3.3978283234165287`*^9}, 3.3978992033986597`*^9, 3.397899272196415*^9, {
   3.397900074706687*^9, 3.3979000993320026`*^9}, {3.3979021024357667`*^9, 
   3.397902105982687*^9}, 3.397971209036948*^9, {3.4541547441089926`*^9, 
   3.4541547599527426`*^9}, 3.4632962720329533`*^9, {3.5177386337593126`*^9, 
   3.517738635493721*^9}, {3.572006365903082*^9, 3.5720063669421854`*^9}, {
   3.5720065299894886`*^9, 3.5720065498604755`*^9}, {3.57200662040753*^9, 
   3.5720066385843472`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<vbpm\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397815161888688*^9, 3.397899206648701*^9, 3.39789927374331*^9, {
   3.3979000766754627`*^9, 3.3979001025351686`*^9}, 3.39797123924046*^9, {
   3.4541547449683676`*^9, 3.4541547634996176`*^9}, {3.463296272220457*^9, 
   3.463296272439211*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<hbpm\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397815163623085*^9, 3.397899207554963*^9, 3.397899275071452*^9, {
   3.3979000777067256`*^9, 3.397900105878961*^9}, 3.397971239818592*^9, {
   3.4541547457808676`*^9, 3.4541547672183676`*^9}, {3.46329627264234*^9, 
   3.4632962727985935`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<monitor\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978151679825163`*^9, 3.3978992086956024`*^9, 3.397899276587096*^9, {
   3.397900079362997*^9, 3.3979001093165054`*^9}, 3.3979712403342237`*^9, {
   3.4541547467027426`*^9, 3.4541547713121176`*^9}, {3.463296272986097*^9, 
   3.463296273204851*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<monitor\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"length", "*", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], ",", "rotation"}], "]"}]}]}], 
       "}"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"length", ">", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Polygon", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{
                RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
            "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], 
            "]"}]}], ",", "position"}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{
                RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
            "]"}]}]}], "}"}], "]"}]}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978151679825163`*^9, 3.3978992086956024`*^9, 3.397899276587096*^9, {
   3.397900079362997*^9, 3.3979001093165054`*^9}, 3.3979712403342237`*^9, {
   3.4541547467027426`*^9, 3.4541547713121176`*^9}, {3.463296272986097*^9, 
   3.463296273204851*^9}, 3.674804617742653*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<imonitor\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978151679825163`*^9, 3.3978992086956024`*^9, 3.397899276587096*^9, {
   3.397900079362997*^9, 3.3979001093165054`*^9}, 3.3979712403342237`*^9, 
   3.4009163171312327`*^9, {3.4541547477496176`*^9, 3.4541547768589926`*^9}, {
   3.463296273423605*^9, 3.463296273611109*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<instrument\>\"", ",", "position_", ",", "length_", ",", "bend_", ",",
      "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978151697481637`*^9, 3.3978992115393887`*^9, 3.397899278884001*^9, {
   3.397900081269271*^9, 3.397900112722799*^9}, 3.397971240865481*^9, 
   3.4541547488433676`*^9, {3.4541547796246176`*^9, 3.4541547866402426`*^9}, {
   3.4632962738454885`*^9, 3.463296274079868*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<profile\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978151697481637`*^9, 3.3978992115393887`*^9, 3.397899278884001*^9, {
   3.397900081269271*^9, 3.397900112722799*^9}, 3.397971240865481*^9, {
   3.4009163768667545`*^9, 3.4009163776792707`*^9}, 3.4541547498902426`*^9, {
   3.4541547830308676`*^9, 3.4541547842496176`*^9}, {3.463296274282997*^9, 
   3.4632962744705005`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<wire\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{".8", ",", ".3", ",", ".8"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397815171966942*^9, 3.397899212648778*^9, 3.39789928038402*^9, 
   3.3979000831130447`*^9, {3.3979001147384496`*^9, 3.397900116207218*^9}, 
   3.3979712413967376`*^9, 3.4541547518902426`*^9, {3.4541547900308676`*^9, 
   3.4541547908902426`*^9}, {3.463296274658004*^9, 3.4632962750955124`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<charge\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", "Purple", ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397815171966942*^9, 3.397899212648778*^9, 3.39789928038402*^9, 
   3.3979000831130447`*^9, {3.3979001147384496`*^9, 3.397900116207218*^9}, 
   3.3979712413967376`*^9, 3.4541547518902426`*^9, {3.4541547900308676`*^9, 
   3.4541547908902426`*^9}, {3.463296274658004*^9, 3.4632962750955124`*^9}, {
   3.6145092823303685`*^9, 3.6145092876093683`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<watch\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", "Purple", ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397815171966942*^9, 3.397899212648778*^9, 3.39789928038402*^9, 
   3.3979000831130447`*^9, {3.3979001147384496`*^9, 3.397900116207218*^9}, 
   3.3979712413967376`*^9, 3.4541547518902426`*^9, {3.4541547900308676`*^9, 
   3.4541547908902426`*^9}, {3.463296274658004*^9, 3.4632962750955124`*^9}, {
   3.6145092823303685`*^9, 3.6145092876093683`*^9}, {3.69381016378269*^9, 
   3.693810164470827*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "element_", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", "element", "]"}], ";", 
      RowBox[{"{", "}"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397815171966942*^9, 3.397899212648778*^9, 3.39789928038402*^9, 
   3.3979000831130447`*^9, {3.3979001147384496`*^9, 3.397900116207218*^9}, 
   3.3979712413967376`*^9, 3.4541547518902426`*^9, {3.4541547900308676`*^9, 
   3.4541547908902426`*^9}, {3.463296274658004*^9, 3.4632962750955124`*^9}, {
   3.6145092823303685`*^9, 3.6145092876093683`*^9}, {3.69381016378269*^9, 
   3.693810164470827*^9}, {3.6938102388607025`*^9, 3.6938102590312357`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Multipole", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<multipole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{"0", ",", "0", ",", "1"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", " ", "ws"}]}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], " ", "ws"}]}], "}"}], ",", "rotation"}], 
          "]"}]}]}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.8", "ws", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.8", "ws", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.3978151799670444`*^9, 3.397815192717208*^9}, 
   3.397899217258212*^9, 3.397899282352795*^9, 3.397900085238072*^9, {
   3.3979001180978675`*^9, 3.397900119535386*^9}, 3.3979712423967505`*^9, {
   3.4541547963902426`*^9, 3.4541547993589926`*^9}, {3.463296275564271*^9, 
   3.4632962759861546`*^9}, 3.57017411486584*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<multipole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"RGBColor", "[", 
      RowBox[{"0.5", ",", "0", ",", "0.75"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "wo"}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", "wo"}], "}"}], ",", "rotation"}], "]"}]}], 
        ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"-", "wo"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "wo"}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", "shape"}], "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"1.4", "wo"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{"1.4", "wo"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"length", ",", 
             RowBox[{
              RowBox[{"-", "1.4"}], "wo"}]}], "}"}], ",", "rotation"}], 
          "]"}]}], ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"1.4", "wo"}]}], "}"}]}], ",", "rotation"}], "]"}]}], 
        ",", "position"}], "}"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1.8", "wo", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"1.8", "wo", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978151799670444`*^9, 3.397815192717208*^9}, 
   3.397899217258212*^9, 3.397899282352795*^9, 3.397900085238072*^9, {
   3.3979001180978675`*^9, 3.397900119535386*^9}, 3.3979712423967505`*^9, {
   3.4541547963902426`*^9, 3.4541547993589926`*^9}, {3.463296275564271*^9, 
   3.4632962759861546`*^9}, {3.57017410672264*^9, 3.57017410864144*^9}, {
   3.57017414018464*^9, 3.57017414274304*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Collimators", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<rcollimator\>\"", ",", "position_", ",", "length_", ",", "bend_", 
     ",", "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"length", "*", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], ",", "rotation"}], "]"}]}]}], 
       "}"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{"0.`", ",", "0.79", ",", "0.34"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"length", ">", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Polygon", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{
                RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
            "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], 
            "]"}]}], ",", "position"}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{
                RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
            "]"}]}]}], "}"}], "]"}]}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3978152022329545`*^9, 3.397815211748701*^9}, 
   3.3978992201644993`*^9, 3.3978992841184425`*^9, 3.397900087144346*^9, {
   3.3979001214416604`*^9, 3.3979001250042057`*^9}, 3.397971243084259*^9, {
   3.4541548041402426`*^9, 3.4541548076871176`*^9}, {3.463296276470539*^9, 
   3.463296276845546*^9}, 3.674804752108088*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pelement", "[", 
    RowBox[{
    "\"\<ecollimator\>\"", ",", "position_", ",", "length_", ",", "bend_", 
     ",", "rotation_", ",", "label_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"position", ",", 
        RowBox[{"position", "+", 
         RowBox[{"MADDrawRot", "[", 
          RowBox[{
           RowBox[{"length", "*", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], ",", "rotation"}], "]"}]}]}], 
       "}"}], "]"}], ",", 
     RowBox[{"Thickness", "[", "thick", "]"}], ",", 
     RowBox[{"RGBColor", "[", 
      RowBox[{"0.`", ",", "0.79", ",", "0.34"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"length", ">", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Polygon", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{"1.4", "wkick"}]}], "}"}], ",", "rotation"}], "]"}]}], 
          ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"length", ",", 
               RowBox[{
                RowBox[{"-", "1.4"}], "wkick"}]}], "}"}], ",", "rotation"}], 
            "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"1.4", "wkick"}]}], "}"}]}], ",", "rotation"}], 
            "]"}]}], ",", "position"}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{"2", "wq"}]}], "}"}], ",", "rotation"}], "]"}]}], ",", 
          RowBox[{"position", "+", 
           RowBox[{"MADDrawRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"length", "/", "2"}], ",", 
               RowBox[{
                RowBox[{"-", "2"}], "wq"}]}], "}"}], ",", "rotation"}], 
            "]"}]}]}], "}"}], "]"}]}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{"MADDrawText", ",", 
       RowBox[{"Text", "[", 
        RowBox[{"label", ",", 
         RowBox[{"position", "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Cos", "[", "rotation", "]"}]}], ",", 
            RowBox[{
             FractionBox["length", "2"], 
             RowBox[{"Sin", "[", "rotation", "]"}]}]}], "}"}], "+", 
          RowBox[{
           RowBox[{"TextOscillate", "[", "]"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"-", "rotation"}], "]"}]}], ",", 
             RowBox[{"2.3", "wq", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"-", "rotation"}], "]"}]}]}], "}"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"TextDirection", "[", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", 
            RowBox[{"-", "rotation"}], "]"}], ",", 
           RowBox[{"Cos", "[", 
            RowBox[{"-", "rotation"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.397899222258276*^9, 3.39789928585284*^9, 3.3979000886131153`*^9, {
   3.3979001269261055`*^9, 3.397900128379249*^9}, 3.3979712456780424`*^9, {
   3.4541548049527426`*^9, 3.4541548111246176`*^9}, {3.4632962772518034`*^9, 
   3.4632962776580615`*^9}, {3.674804725993477*^9, 3.674804739394817*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDraw", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BaseMADDraw", "[", 
   RowBox[{"lattice_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "rot", ",", "roty", ",", "sinc", ",", "cosc", ",", "sinc2", ",", "sym", 
      ",", "test", ",", "autolabels", ",", "thick", ",", "bpms", ",", 
      "lengths", ",", "filled", ",", "widthscale", ",", "symms", ",", "bends",
       ",", "closed", ",", "offset", ",", "bpmcircle", ",", "textoscillate", 
      ",", "fancyelements", ",", "anglesum", ",", "findrotations", ",", 
      "findrotationsv", ",", "cc", ",", "RM", ",", "prepositions", ",", 
      "prepositions2", ",", "v", ",", "rm", ",", "sum1", ",", "startangle", 
      ",", "layout", ",", "fancy", ",", "optShow", ",", "angle", ",", 
      "errors", ",", "vbends", ",", "tmp"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"text", ",", 
       RowBox[{"MADDrawText", "=", "True"}], ",", 
       RowBox[{"MADDrawText", "=", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"autolabels", "=", 
      RowBox[{
       RowBox[{"Global`AutoLabels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`AutoLabels", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"thick", "=", 
      RowBox[{
       RowBox[{"Thickness", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpms", "=", 
      RowBox[{
       RowBox[{"Monitors", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lengths", "=", 
      RowBox[{
       RowBox[{"Lengths", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filled", "=", 
      RowBox[{
       RowBox[{"Filled", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"filled", ",", 
       RowBox[{"shape", "=", "\"\<Polygon\>\""}], ",", 
       RowBox[{"shape", "=", "\"\<Line\>\""}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"widthscale", "=", 
      RowBox[{
       RowBox[{"WidthScale", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"symms", "=", 
      RowBox[{
       RowBox[{"Symms", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bends", "=", 
      RowBox[{
       RowBox[{"Bends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"closed", "=", 
      RowBox[{
       RowBox[{"CheckClosed", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"offset", "=", 
      RowBox[{
       RowBox[{"Offset", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpmcircle", "=", 
      RowBox[{
       RowBox[{"Global`BPMCircles", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BPMCircles", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vbends", "=", 
      RowBox[{
       RowBox[{"Global`VerticalBends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`VerticalBends", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{"bpmcircle", ",", "True", ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"0.1", "wq"}]}], ",", 
       RowBox[{"_Integer", "|", "_Real"}], ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"bpmcircle", " ", "wq"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"textoscillate", "=", 
      RowBox[{
       RowBox[{"Global`TextOscillate", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`TextOscillate", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"textoscillate", "===", "True"}], ",", 
       RowBox[{"TEXTOSCILLATE", "=", "1"}], ",", 
       RowBox[{"TEXTOSCILLATE", "=", "0"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fancyelements", "=", 
      RowBox[{
       RowBox[{"FancyElements", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"FancyElements", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"anglesum", "=", 
      RowBox[{"startangle", "=", 
       RowBox[{
        RowBox[{"Global`AngleOffset", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`AngleOffset", "\[Rule]", "0"}], "}"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"optShow", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Options", "[", "MADDraw", "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"errors", "=", 
      RowBox[{
       RowBox[{"Global`Errors", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Errors", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADDrawRot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "y_"}], "}"}], ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{"y", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{"y", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"roty", "[", 
       RowBox[{"line_", ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"1", "-", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc2", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sym", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<symmline\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"bends", "===", "True"}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
             RowBox[{"anglesum", "+=", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"vbends", "===", "True"}], ",", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "5", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Cos", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "]"}], 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "3", 
                "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]", 
             "\"\<quadrupole\>\"", ",", 
             RowBox[{"anglesum", "+=", 
              RowBox[{
               RowBox[{"GetMADErrors", "[", 
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}],
                   "]"}], ",", "\"\<dx\>\""}], "]"}], "*", 
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "3"}], "\[RightDoubleBracket]"}], 
               "*", 
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "4"}], 
                "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]", 
             "_", ",", "anglesum"}], "]"}], "&"}], "/@", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{"lattice", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "lattice", "]"}], "}"}]}], "]"}]}]}], "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"findrotationsv", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"sum1", "=", "0"}], ";", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"sum1", "+=", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"vbends", "===", "True"}], ",", 
               RowBox[{"-", 
                RowBox[{"Sin", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "5", "]"}], "]"}], "]"}]}], ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "]"}], 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}],
            "&"}], ")"}], "/@", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"Prepend", "[", 
            RowBox[{"lattice", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
              "}"}]}], "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}]}]}], ")"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"cc", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
     RowBox[{"RM", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", 
     RowBox[{"startangle", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"v", "=", 
           RowBox[{
            RowBox[{"RotationMatrix", "[", 
             RowBox[{"startangle", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Sin", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "5", "]"}], "]"}], "]"}], ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "*", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{"sinc", "[", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "]"}], ",", "1"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
                "*", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{"cosc", "[", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "]"}], ",", "0"}], "]"}]}], ",", "0"}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rm", "=", 
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bends", "===", "True"}], ",", 
               RowBox[{
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sin", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cos", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", "\"\<quadrupole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"bends", "===", "True"}], "&&", 
                RowBox[{"errors", "===", "True"}]}], ",", 
               RowBox[{
                RowBox[{"angle", "=", 
                 RowBox[{
                  RowBox[{"GetMADErrors", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}],
                     "]"}], ",", "\"\<dx\>\""}], "]"}], "*", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "3"}], "\[RightDoubleBracket]"}],
                   "*", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "4"}], 
                   "\[RightDoubleBracket]"}]}]}], ";", 
                RowBox[{
                 RowBox[{"RotationMatrix", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], ".", 
                 RowBox[{"RotationMatrix", "[", 
                  RowBox[{"angle", ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], 
               ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", "_", ",", 
             RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"RM", "=", 
           RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cc", "+=", 
           RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"prepositions", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{"prepositions", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{"prepositions", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"prepositions", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cc", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
       RowBox[{"RM", "=", 
        RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"prepositions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"v", "=", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{"startangle", ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "*", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"bends", "===", "True"}], ",", 
                   RowBox[{"sinc", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"vbends", "===", "True"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", "1"}], "]"}]}], 
                ",", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}], "*", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"bends", "===", "True"}], ",", 
                   RowBox[{"cosc", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"vbends", "===", "True"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", "0"}], "]"}]}], 
                ",", "0"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"rm", "=", 
             RowBox[{"Switch", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"vbends", "===", "True"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], 
                  "\[IndentingNewLine]", "]"}], ",", 
                 RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
               "\[IndentingNewLine]", "\"\<quadrupole\>\"", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"bends", "===", "True"}], "&&", 
                  RowBox[{"errors", "===", "True"}]}], ",", 
                 RowBox[{
                  RowBox[{"angle", "=", 
                   RowBox[{
                    RowBox[{"GetMADErrors", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}],
                     "]"}], ",", "Global`MADdx"}], "]"}], "*", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "3"}], "\[RightDoubleBracket]"}],
                     "*", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "4"}], 
                    "\[RightDoubleBracket]"}]}]}], ";", 
                  RowBox[{
                   RowBox[{"RotationMatrix", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], ".", 
                   RowBox[{"RotationMatrix", "[", 
                    RowBox[{"angle", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], 
                 ",", 
                 RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
               "\[IndentingNewLine]", "_", ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"RM", "=", 
             RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"cc", "+=", 
             RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"prepositions2", "=", 
        RowBox[{"prepositions", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}], ";"}
       ], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xform", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Theta]_", ",", "tilt_", ",", "length_"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x_", ",", "r_"}], "}"}]}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dx", ",", "n", ",", "rt", ",", "rp"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dx", "=", 
          RowBox[{"r", ".", 
           RowBox[{"(", GridBox[{
              {
               RowBox[{"Cos", "[", "tilt", "]"}], 
               RowBox[{"-", 
                RowBox[{"Sin", "[", "tilt", "]"}]}], "0"},
              {
               RowBox[{"Sin", "[", "tilt", "]"}], 
               RowBox[{"Cos", "[", "tilt", "]"}], "0"},
              {"0", "0", "1"}
             }], ")"}], ".", 
           RowBox[{"(", GridBox[{
              {
               RowBox[{"Limit", "[", 
                RowBox[{
                 RowBox[{
                  FractionBox["length", "\[Theta]1"], 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Cos", "[", "\[Theta]1", "]"}], "-", "1"}], 
                   ")"}]}], ",", 
                 RowBox[{"\[Theta]1", "\[Rule]", "\[Theta]"}]}], "]"}]},
              {"0"},
              {
               RowBox[{"Limit", "[", 
                RowBox[{
                 RowBox[{
                  FractionBox["length", "\[Theta]1"], 
                  RowBox[{"Sin", "[", "\[Theta]1", "]"}]}], ",", 
                 RowBox[{"\[Theta]1", "\[Rule]", "\[Theta]"}]}], "]"}]}
             }], ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rt", "=", 
          RowBox[{"Transpose", "[", "r", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", "=", 
          RowBox[{
           RowBox[{
            RowBox[{
            "rt", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            RowBox[{"Cos", "[", "tilt", "]"}]}], "-", 
           RowBox[{
            RowBox[{
            "rt", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            RowBox[{"Sin", "[", "tilt", "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"rp", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Outer", "[", 
             RowBox[{"Times", ",", 
              RowBox[{"rt", ".", "n"}], ",", "n"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"1", "-", 
              RowBox[{"Cos", "[", "\[Theta]", "]"}]}], ")"}]}], "+", 
           RowBox[{"rt", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{
                "rt", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                ",", "n"}], "]"}], ",", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{
                "rt", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                ",", "n"}], "]"}], ",", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{
                "rt", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
                ",", "n"}], "]"}]}], "}"}], 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "+", "dx"}], ",", 
           RowBox[{"Transpose", "[", "rp", "]"}]}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{"{", 
       RowBox[{"(", GridBox[{
          {"0"},
          {"0"},
          {"0"}
         }], ")"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"localXYZ", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x1", ",", "localXYZ"}], "}"}], "=", 
           RowBox[{"xform", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{"bends", ",", 
                 RowBox[{"-", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], ",", "0"}], "]"}], ",", 
               RowBox[{"-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"x", "\[LeftDoubleBracket]", 
                RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
               "localXYZ"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"x", ",", "x1"}], "]"}]}]}], "]"}], "&"}], "/@", 
      "lattice"}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"Rest", "[", 
       RowBox[{"x", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}], ",", "1"}], "]"}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"errors", "===", "True"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"prepositions2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", "err", "}"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], "===", 
                 "\"\<Quadrupole\>\""}], "&&", 
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{"err", "=", 
                   RowBox[{"GetMADErrors", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], "]"}],
                     ",", "\"\<dx\>\""}], "]"}]}], "]"}], ">", "0"}]}], ",", 
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "err"}], "}"}]}], ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              "]"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"prepositions2", ",", 
             RowBox[{"Append", "[", 
              RowBox[{
               RowBox[{"Rest", "[", 
                RowBox[{
                 RowBox[{"MADFlatten", "[", "lattice", "]"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"All", ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}]}], 
                 "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"\"\<\>\"", ",", "\"\<\>\""}], "}"}]}], "]"}]}], 
            "}"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"Length", "[", "offset", "]"}], ",", "\[IndentingNewLine]", 
       "0", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ReplacePart", "[", 
             RowBox[{"#1", ",", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "+", "offset"}], ",", "2"}], "]"}], "&"}], ")"}], "/@", 
          "prepositions2"}]}], ";"}], ",", "\[IndentingNewLine]", "2", ",", 
       RowBox[{"prepositions", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ReplacePart", "[", 
            RowBox[{
             RowBox[{"ReplacePart", "[", 
              RowBox[{"#1", ",", 
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "offset", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], ",", "2"}], "]"}], ",", 
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{
              "offset", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}], ",", "1"}], "]"}], "&"}], ")"}], "/@",
          "prepositions2"}]}], ",", "\[IndentingNewLine]", "_", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", "prepositions2"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"layout", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"pelement", "[", 
            RowBox[{
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", 
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], " ", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bends", "===", "True"}], ",", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"vbends", "===", "True"}], ",", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "5"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "5"}], "]"}], "]"}], "]"}]}], "]"}], 
                RowBox[{"#1", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], ",", 
               "0"}], "]"}], ",", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
             ",", 
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "opts", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"Element", "\[Rule]", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], "}"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"FancyElements", "\[Rule]", "fancy"}], "}"}]}], 
              "]"}]}], "]"}], "&"}], ")"}], "/@", "#"}], "&"}], "/@", 
       "\[IndentingNewLine]", 
       RowBox[{"Split", "[", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"MapThread", "[", 
           RowBox[{"List", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Rest", "[", "lattice", "]"}], ",", 
              RowBox[{"Drop", "[", 
               RowBox[{"prepositions", ",", 
                RowBox[{"-", "1"}]}], "]"}], ",", 
              RowBox[{"Rest", "[", "findrotations", "]"}], ",", 
              RowBox[{"Rest", "[", "findrotationsv", "]"}]}], "}"}]}], "]"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
           RowBox[{"#2", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], "&"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"acceleratorlayout", "=", 
      RowBox[{"Graphics", "[", 
       RowBox[{"layout", ",", "optShow"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ShowPicture", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}], ")"}], "===", "True"}], 
       ",", 
       RowBox[{"Show", "[", 
        RowBox[{"acceleratorlayout", ",", 
         RowBox[{"Sequence", "@@", "optShow"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", 
         RowBox[{"BaseStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FontSize", "\[Rule]", "Fontsize"}], "/.", 
              "\[InvisibleSpace]", 
              RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
             RowBox[{"Options", "[", "MADDraw", "]"}]}], ",", 
            RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "}"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ImageSize", "\[Rule]", "Imagesize"}], "/.", 
           "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"PlotLabel", "\[Rule]", "DrawLabel"}], "/.", 
           "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"closed", "===", "True"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "]"}],
            "<", 
           FractionBox["1", 
            SuperscriptBox["10", "6"]]}], "&&", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], "]"}],
            "<", 
           FractionBox["1", 
            SuperscriptBox["10", "6"]]}]}], ",", 
         RowBox[{
         "Print", "[", "\"\<Lattice is Closed to Micron Level\>\"", "]"}], 
         ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Lattice is not closed, difference is X=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "]"}],
            "<>", "\"\<, Y=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "]"}]}], "]"}]}], "]"}], ";", "acceleratorlayout"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4429118774483786`*^9, 3.442912039325451*^9}, 
   3.442912091951124*^9, {3.442912151280009*^9, 3.4429121524206486`*^9}, {
   3.442912219405881*^9, 3.442912230656025*^9}, {3.442912262406431*^9, 
   3.4429122652189674`*^9}, {3.4433412399486074`*^9, 3.443341250651801*^9}, {
   3.4474195446112432`*^9, 3.4474195569081964`*^9}, {3.4474196883934135`*^9, 
   3.4474196981122255`*^9}, {3.447420156787036*^9, 3.447420156927662*^9}, {
   3.4476783985640435`*^9, 3.4476784050485845`*^9}, {3.448018931212336*^9, 
   3.4480189322592173`*^9}, 3.463296279564348*^9, {3.4700546408708687`*^9, 
   3.4700546413396187`*^9}, 3.5018317285391216`*^9, {3.5305299666345563`*^9, 
   3.530529994065916*^9}, {3.530530039545864*^9, 3.5305300738818226`*^9}, {
   3.5305302881269784`*^9, 3.5305302888595204`*^9}, 3.5305303235071983`*^9, {
   3.530530395592448*^9, 3.530530672212776*^9}, {3.5305307296160145`*^9, 
   3.5305307625648184`*^9}, 3.5305309295688086`*^9, {3.5305346347877874`*^9, 
   3.530534656849058*^9}, {3.5305347051882515`*^9, 3.530534760774316*^9}, {
   3.5305348550958667`*^9, 3.5305350283293633`*^9}, {3.530535065366072*^9, 
   3.530535242609392*^9}, {3.530535308360704*^9, 3.530535308485855*^9}, {
   3.5306024305156164`*^9, 3.5306025521993847`*^9}, {3.5306026576732254`*^9, 
   3.530602660000084*^9}, {3.53060272195074*^9, 3.530602724152666*^9}, {
   3.5306027896951165`*^9, 3.530602851411525*^9}, {3.5720084449879694`*^9, 
   3.5720084711595864`*^9}, {3.627024813146263*^9, 3.6270248133272815`*^9}, {
   3.6270248933622837`*^9, 3.6270249227472224`*^9}, {3.6270249541473618`*^9, 
   3.627024988259773*^9}, {3.627025018599807*^9, 3.627025035686515*^9}, {
   3.6270251924351883`*^9, 3.6270252613290772`*^9}, {3.627025297192663*^9, 
   3.6270253170816517`*^9}, {3.627025365947538*^9, 3.6270254354124837`*^9}, {
   3.627025466015544*^9, 3.6270254942673683`*^9}, {3.6270255482257643`*^9, 
   3.6270257155134907`*^9}, {3.6270257486148005`*^9, 3.627025760040943*^9}, {
   3.6270257905559945`*^9, 3.627025815732512*^9}, {3.6270259420791454`*^9, 
   3.627025967169654*^9}, {3.6270259989968367`*^9, 3.627026038087745*^9}, {
   3.6270260691088467`*^9, 3.6270261615350885`*^9}, 3.627026194280363*^9, {
   3.6270262319981346`*^9, 3.627026255545489*^9}, 3.627026292140148*^9, {
   3.627026396410574*^9, 3.6270264426221943`*^9}, {3.6270264733152637`*^9, 
   3.6270265105759892`*^9}, {3.6270266648824186`*^9, 
   3.6270266686927996`*^9}, {3.655124188367261*^9, 3.655124262232647*^9}, 
   3.655124311674591*^9, {3.6551243647889013`*^9, 3.655124366229046*^9}, 
   3.655124423527775*^9, {3.657609657549878*^9, 3.6576096640858784`*^9}, {
   3.6576097239538784`*^9, 3.657609757671878*^9}, {3.6576097929018784`*^9, 
   3.657609808107878*^9}, {3.7223394014317045`*^9, 3.7223394140089617`*^9}, {
   3.72822589565454*^9, 
   3.7282259172959404`*^9}},ExpressionUUID->"693673f4-de8a-4982-8332-\
c36af2bb5bb2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Cos", "[", 
  RowBox[{"-", "1.57"}], "]"}]], "Input",
 CellChangeTimes->{{3.6270257305419936`*^9, 3.6270257438623257`*^9}, {
  3.6270258958755255`*^9, 3.627025909491887*^9}, {3.6270260605609922`*^9, 
  3.627026061393076*^9}}],

Cell[BoxData["0.0007963267107332633`"], "Output",
 CellChangeTimes->{{3.627025731790118*^9, 3.6270257443103704`*^9}, {
   3.6270258965265903`*^9, 3.6270259097049084`*^9}, 3.6270260615800943`*^9, 
   3.627038155656376*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDraw", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "text", ",", "thick", ",", "bpms", ",", "lengths", ",", "filled", ",", 
      "widthscale", ",", "symms", ",", "bends", ",", "closed", ",", "offset", 
      ",", "optShow", ",", "a", ",", "b", ",", "c", ",", "lattice", ",", 
      "rot", ",", "sinc", ",", "cosc", ",", "sym", ",", "findrotations", ",", 
      "findrotationsv", ",", "cc", ",", "sum1", ",", "layout", ",", 
      "acceleratorlayout", ",", "bpmcircle", ",", "fancy", ",", "vbends"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"text", ",", 
       RowBox[{"MADDrawText", "=", "True"}], ",", 
       RowBox[{"MADDrawText", "=", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"autolabels", "=", 
      RowBox[{
       RowBox[{"Global`AutoLabels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`AutoLabels", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lengths", "=", 
      RowBox[{
       RowBox[{"Lengths", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"symms", "=", 
      RowBox[{
       RowBox[{"Symms", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpms", "=", 
      RowBox[{
       RowBox[{"Monitors", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpmcircle", "=", 
      RowBox[{
       RowBox[{"Global`BPMCircles", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BPMCircles", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vbends", "=", 
      RowBox[{
       RowBox[{"Global`VerticalBends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`VerticalBends", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{"bpmcircle", ",", "True", ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"0.1", "wq"}]}], ",", 
       RowBox[{"_Integer", "|", "_Real"}], ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"bpmcircle", " ", "wq"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"MADFlatten", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"bpms", "===", "True"}], ",", 
       RowBox[{"b", "=", "a"}], ",", 
       RowBox[{"b", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "=!=", "\"\<BPM\>\""}], "&"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tilt", "[", "element_", "]"}], ":=", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{
        "element", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ",", "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "element", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<Extra\>\""}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "7", 
         "\[RightDoubleBracket]"}], " ", ",", "\[IndentingNewLine]", 
        "\"\<RectBend\>\"", ",", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "element", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<Extra\>\""}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "7", 
         "\[RightDoubleBracket]"}], " ", ",", "\[IndentingNewLine]", "_", ",",
         "0"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", "\"\<dipole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"bpmcircle", "=!=", "False"}], ")"}], "&&", 
                RowBox[{"StringMatchQ", "[", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   ",", "\"\<BPM\>\""}], "]"}]}], ",", "\"\<bpmcircle\>\"", 
               ",", 
               RowBox[{"ToLowerCase", "[", 
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "]"}]}], "]"}]}], "]"}], ",", 
           RowBox[{
           "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", 
             RowBox[{"N", "[", 
              RowBox[{"-", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}],
               "]"}], ",", "0"}], "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{"text", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"lengths", "===", "True"}], ",", 
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                "<>", "\"\<[\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                  "]"}], "<>", "\"\<m]\>\""}], ",", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}],
               "]"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{"autolabels", ",", 
               RowBox[{
                RowBox[{"MADDrawText", "=", "True"}], ";", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                 "]"}]}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"lengths", "===", "True"}], ",", 
                 RowBox[{"\"\<[\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<m]\>\""}], 
                 ",", "\"\<\>\""}], "]"}]}], "]"}]}], "]"}], ",", 
           RowBox[{"tilt", "[", "#1", "]"}], ",", "#"}], "}"}], "&"}], ")"}], 
       "/@", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"symms", "===", "True"}], ",", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";"}], ",", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
            "}"}]}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
            "}"}]}], "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"lattice", "=", "c"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"BaseMADDraw", "[", 
      RowBox[{"lattice", ",", "opts"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3978119010709295`*^9, {3.3978120298850784`*^9, 3.397812030072581*^9}, 
   3.397817331307081*^9, {3.397817366698159*^9, 3.3978173917922306`*^9}, {
   3.3978211491215734`*^9, 3.3978211492622004`*^9}, {3.397827169995515*^9, 
   3.397827204870961*^9}, {3.3978272412464266`*^9, 3.3978273783106813`*^9}, {
   3.39782756259429*^9, 3.3978275637974305`*^9}, {3.3978993532443275`*^9, 
   3.397899420245185*^9}, {3.3979002496620517`*^9, 3.3979002538652306`*^9}, {
   3.397900433226901*^9, 3.397900441352005*^9}, {3.3979004902745066`*^9, 
   3.3979005063684626`*^9}, {3.3979006144635963`*^9, 3.397900624838729*^9}, {
   3.3979006675267754`*^9, 3.3979006959958897`*^9}, {3.3979021132640305`*^9, 
   3.39790217374918*^9}, 3.397902385517515*^9, 3.3979024216742277`*^9, {
   3.3979025016283765`*^9, 3.39790252730058*^9}, {3.3979026007077694`*^9, 
   3.397902636114473*^9}, {3.3979026886776457`*^9, 3.3979027160217457`*^9}, {
   3.3979712688814645`*^9, 3.3979713085538473`*^9}, {3.399271230471339*^9, 
   3.3992712617996645`*^9}, {3.3992714376914153`*^9, 
   3.3992714551915274`*^9}, {3.3992798730891514`*^9, 
   3.3992798989955673`*^9}, {3.399279935511426*^9, 3.399279965011615*^9}, {
   3.3992801309189267`*^9, 3.399280177012972*^9}, {3.3992804674523306`*^9, 
   3.399280467842958*^9}, {3.3992893653217764`*^9, 3.3992893663061576`*^9}, {
   3.3992896101045933`*^9, 3.399289623854681*^9}, {3.3992899894331903`*^9, 
   3.3992899942317543`*^9}, 3.3992903910027328`*^9, {3.399296022511956*^9, 
   3.3992960630747156`*^9}, 3.399296112950035*^9, 3.3992963083731604`*^9, {
   3.3992964907337027`*^9, 3.3992965180463777`*^9}, {3.3997042421062045`*^9, 
   3.399704245262495*^9}, {3.3997074815851693`*^9, 3.399707496866615*^9}, 
   3.399707627274534*^9, {3.3997077215257406`*^9, 3.3997077230570097`*^9}, {
   3.399727787861772*^9, 3.3997279075976796`*^9}, {3.3997279758954287`*^9, 
   3.3997279764110603`*^9}, {3.3997280072083297`*^9, 
   3.3997280103021193`*^9}, {3.399728954267327*^9, 3.399728955142338*^9}, {
   3.3997290604718113`*^9, 3.39972906236246*^9}, {3.399790344845886*^9, 
   3.399790353408496*^9}, {3.3999870170397816`*^9, 3.399987017649164*^9}, {
   3.3999872370269723`*^9, 3.39998724348018*^9}, {3.399987319574904*^9, 
   3.39998733605949*^9}, 3.3999873890757933`*^9, 3.399987424498122*^9, {
   3.3999874568110356`*^9, 3.39998754892159*^9}, {3.399987582453269*^9, 
   3.399987631672649*^9}, {3.3999877127518115`*^9, 3.3999877228613157`*^9}, {
   3.3999877992060432`*^9, 3.3999878087686653`*^9}, {3.399987857378663*^9, 
   3.3999878633787394`*^9}, {3.3999879167387977`*^9, 3.399987920207592*^9}, 
   3.4005682605411267`*^9, {3.4009167413425026`*^9, 3.4009167497176633`*^9}, {
   3.401780754171875*^9, 3.40178082309375*^9}, {3.401780919484375*^9, 
   3.40178092303125*^9}, {3.401780961703125*^9, 3.40178116275*^9}, {
   3.401781199*^9, 3.401781221984375*^9}, {3.4017813375625*^9, 
   3.401781364171875*^9}, 3.401781405078125*^9, {3.40342561951285*^9, 
   3.4034256313098755`*^9}, {3.403425712810919*^9, 3.403425714029684*^9}, {
   3.4034257677491217`*^9, 3.403425791327549*^9}, {3.4034259463764086`*^9, 
   3.403425984236268*^9}, {3.4034260396588526`*^9, 3.403426080643752*^9}, {
   3.403426240380172*^9, 3.4034262556147413`*^9}, 3.4034264997272415`*^9, {
   3.4034275620377135`*^9, 3.4034275738191147`*^9}, {3.4052364354841194`*^9, 
   3.4052364851253796`*^9}, {3.4105940750963182`*^9, 3.410594077065094*^9}, {
   3.410594111143655*^9, 3.4105941112842817`*^9}, {3.4173477768459635`*^9, 
   3.4173477769865894`*^9}, 3.417347929893818*^9, {3.4173510512731695`*^9, 
   3.4173510544606895`*^9}, {3.4175016197953215`*^9, 3.417501621185955*^9}, {
   3.418537497947469*^9, 3.418537500119372*^9}, {3.4185375324322853`*^9, 
   3.418537547682481*^9}, {3.4185377986700687`*^9, 3.418537828311073*^9}, {
   3.418537858717712*^9, 3.4185378599364777`*^9}, {3.4185378974369574`*^9, 
   3.4185379145778017`*^9}, {3.418537990047518*^9, 3.4185379982194977`*^9}, 
   3.418538203393999*^9, {3.418538237191306*^9, 3.4185382540040216`*^9}, {
   3.418538933481469*^9, 3.4185389518879547`*^9}, 3.426588582366763*^9, {
   3.434462200658472*^9, 3.434462209986657*^9}, {3.434462258611968*^9, 
   3.434462262643244*^9}, {3.434462329409296*^9, 3.4344623305499287`*^9}, {
   3.434462367659541*^9, 3.4344624241599026`*^9}, 3.43446254173878*^9, {
   3.4344625803952775`*^9, 3.4344626105204706`*^9}, {3.434462728458725*^9, 
   3.4344627306774893`*^9}, {3.4368746318849635`*^9, 3.436874633197632*^9}, {
   3.4429103980231924`*^9, 3.4429103996794634`*^9}, {3.4429123081570168`*^9, 
   3.4429123360167484`*^9}, {3.4429123707671933`*^9, 
   3.4429123870642767`*^9}, {3.4474199004416456`*^9, 
   3.4474199010510244`*^9}, {3.4474199584107666`*^9, 
   3.4474199624264174`*^9}, {3.4474201416931896`*^9, 3.447420146896348*^9}, {
   3.517738525054101*^9, 3.5177385266166306`*^9}, {3.6270251638313284`*^9, 
   3.627025185529498*^9}, {3.7282259533981404`*^9, 3.7282259566549406`*^9}, {
   3.7282260185213404`*^9, 
   3.7282260194589405`*^9}},ExpressionUUID->"36069cc9-f809-4687-aa0b-\
910b505ac5b4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Cos", "[", 
  RowBox[{"tilt", "[", 
   RowBox[{"S11B0A", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.627024862391187*^9, 3.6270248797119193`*^9}}],

Cell[BoxData[
 RowBox[{"-", "3.8285686989269494`*^-16"}]], "Output",
 CellChangeTimes->{{3.62702486461641*^9, 3.6270248803259807`*^9}, 
   3.627038155683376*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["MADDrawSurvey", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"changeKEYWORD", "[", "KEYWORD_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"ToString", "[", "#", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<DRIF\>\"", "\[Rule]", "\"\<drift\>\""}], ",", 
         RowBox[{"\"\<KICK\>\"", "\[Rule]", "\"\<hkicker\>\""}], ",", 
         RowBox[{"\"\<HKIC\>\"", "\[Rule]", "\"\<hkicker\>\""}], ",", 
         RowBox[{"\"\<MONI\>\"", "\[Rule]", "\"\<bpm\>\""}], ",", 
         RowBox[{"\"\<MULT\>\"", "\[Rule]", "\"\<multipole\>\""}], ",", 
         RowBox[{"\"\<QUAD\>\"", "\[Rule]", "\"\<quadrupole\>\""}], ",", 
         RowBox[{"\"\<SBEN\>\"", "\[Rule]", "\"\<dipole\>\""}], ",", 
         RowBox[{"\"\<RBEN\>\"", "\[Rule]", "\"\<dipole\>\""}], ",", 
         RowBox[{"\"\<VKIC\>\"", "\[Rule]", "\"\<vkicker\>\""}], ",", 
         RowBox[{"\"\<    \>\"", "\[Rule]", "\"\<drift\>\""}], ",", 
         RowBox[{"\"\<MARK\>\"", "->", "\"\<marker\>\""}], ",", 
         RowBox[{"\"\<SEXT\>\"", "->", "\"\<sextupole\>\""}], ",", 
         RowBox[{"\"\<RFCA\>\"", "\[Rule]", "\"\<rfc\>\""}], ",", 
         RowBox[{"\"\<OCTU\>\"", "\[Rule]", "\"\<octupole\>\""}], ",", 
         RowBox[{"\"\<INST\>\"", "\[Rule]", "\"\<bpm\>\""}], ",", 
         RowBox[{"\"\<WIRE\>\"", "\[Rule]", "\"\<bpm\>\""}], ",", 
         RowBox[{"\"\<RCOL\>\"", "\[Rule]", "\"\<rcollimator\>\""}], ",", 
         RowBox[{"\"\<ECOL\>\"", "\[Rule]", "\"\<ecollimator\>\""}], ",", 
         RowBox[{"\"\<LCAV\>\"", "\[Rule]", "\"\<lcav\>\""}], ",", 
         RowBox[{"\"\<MATR\>\"", "\[Rule]", "\"\<marker\>\""}], ",", 
         RowBox[{"\"\<SOLE\>\"", "\[Rule]", "\"\<solenoid\>\""}]}], "}"}]}], 
      "]"}], "&"}], "/@", "KEYWORD"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4217483384127455`*^9, 3.421748349147189*^9}, {
  3.4534594381234407`*^9, 3.4534594445296497`*^9}, {3.4960563111020203`*^9, 
  3.4960563150829525`*^9}, {3.572867374171438*^9, 3.5728673922024384`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"readSurveyFile", "[", 
   RowBox[{"filename_", ",", 
    RowBox[{"text_:", "False"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "c", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mfsInterpret", "[", 
      RowBox[{
       RowBox[{"surveyTapeRead", "[", "filename", "]"}], ",", 
       RowBox[{"mfsDrop", "\[Rule]", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"changeKEYWORD", "[", "Global`KEYWORD", "]"}], ",", 
         "Global`L", ",", 
         RowBox[{"-", "Global`ANGLE"}], ",", 
         RowBox[{"If", "[", 
          RowBox[{"text", ",", "Global`NAME", ",", 
           RowBox[{"Table", "[", 
            RowBox[{"\"\<\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", "Global`NAME", "]"}], "}"}]}], "]"}]}], 
          "]"}], ",", "Global`THETA"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Append", "[", 
       RowBox[{"c", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"p", "=", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"Global`Z", ",", "Global`X", ",", "Global`Y"}], "}"}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"c", ",", "p"}], "}"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.447420066302082*^9, 3.4474200771615267`*^9}, {
  3.5728675098264384`*^9, 3.5728675389434385`*^9}, {3.5728676872864385`*^9, 
  3.5728677338604383`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDrawSurvey", "[", 
   RowBox[{"filename_String", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"text", ",", "c", ",", "p"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c", ",", "p"}], "}"}], "=", 
      RowBox[{"readSurveyFile", "[", 
       RowBox[{"filename", ",", "text"}], "]"}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"baseMADDrawSurvey", "[", 
      RowBox[{"c", ",", "p", ",", "opts"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5728675060504384`*^9, 3.572867507489438*^9}, {
  3.5728676269374385`*^9, 3.5728676608074384`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDrawSurvey", "[", 
   RowBox[{"filename_List", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"text", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"readSurveyFile", "[", 
           RowBox[{"#", ",", "text"}], "]"}], "&"}], "/@", "filename"}], ",", 
        "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"baseMADDrawSurvey", "[", 
      RowBox[{"c", ",", "opts"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True],

Cell["\<\
MapThread[Flatten[{##}] &, {latticein[[All, {1, 2, 3, 4}]], \
Map[Subtract[Sequence @@ Reverse[#]] &, Partition[Prepend[latticein[[All, \
5]], 0], 2, 1]]}]\
\>", "Text",
 CellChangeTimes->{{3.447669374239827*^9, 3.447669377521098*^9}}],

Cell[BoxData[
 RowBox[{"Options", "[", "MADDraw", "]"}]], "Input",
 CellChangeTimes->{{3.513428775668295*^9, 3.513428787731335*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"baseMADDrawSurvey", "[", 
   RowBox[{"latticein_", ",", "prepositionsin_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "theta", ",", "lattice", ",", "rot", ",", "roty", ",", "sinc", ",", 
      "cosc", ",", "sinc2", ",", "sym", ",", "test", ",", "autolabels", ",", 
      "thick", ",", "bpms", ",", "lengths", ",", "filled", ",", "widthscale", 
      ",", "symms", ",", "bends", ",", "closed", ",", "offset", ",", 
      "bpmcircle", ",", "textoscillate", ",", "fancyelements", ",", 
      "anglesum", ",", "findrotations", ",", "findrotationsv", ",", "cc", ",",
       "RM", ",", "prepositions", ",", "prepositions2", ",", "v", ",", "rm", 
      ",", "sum1", ",", "startangle", ",", "layout", ",", "fancy", ",", 
      "optShow", ",", "ar"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ar", "=", 
      RowBox[{
       RowBox[{"AspectRatio", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"theta", "=", 
      RowBox[{"latticein", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "5"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lattice", "=", "latticein"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"BaseMADDraw", "[", 
       RowBox[{"lattice", ",", "opts"}], "]"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"text", ",", 
       RowBox[{"MADDrawText", "=", "True"}], ",", 
       RowBox[{"MADDrawText", "=", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"autolabels", "=", 
      RowBox[{
       RowBox[{"Global`AutoLabels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`AutoLabels", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"thick", "=", 
      RowBox[{
       RowBox[{"Thickness", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpms", "=", 
      RowBox[{
       RowBox[{"Monitors", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lengths", "=", 
      RowBox[{
       RowBox[{"Lengths", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filled", "=", 
      RowBox[{
       RowBox[{"Filled", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"filled", ",", 
       RowBox[{"shape", "=", "\"\<Polygon\>\""}], ",", 
       RowBox[{"shape", "=", "\"\<Line\>\""}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"widthscale", "=", 
      RowBox[{
       RowBox[{"WidthScale", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"symms", "=", 
      RowBox[{
       RowBox[{"Symms", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bends", "=", 
      RowBox[{
       RowBox[{"Bends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"closed", "=", 
      RowBox[{
       RowBox[{"CheckClosed", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"offset", "=", 
      RowBox[{
       RowBox[{"Offset", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpmcircle", "=", 
      RowBox[{
       RowBox[{"Global`BPMCircles", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BPMCircles", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{"bpmcircle", ",", "True", ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"0.1", "wq"}]}], ",", 
       RowBox[{"_Integer", "|", "_Real"}], ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"bpmcircle", " ", "wq"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"textoscillate", "=", 
      RowBox[{
       RowBox[{"Global`TextOscillate", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`TextOscillate", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"textoscillate", "===", "True"}], ",", 
       RowBox[{"TEXTOSCILLATE", "=", "1"}], ",", 
       RowBox[{"TEXTOSCILLATE", "=", "0"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fancyelements", "=", 
      RowBox[{
       RowBox[{"FancyElements", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"FancyElements", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"anglesum", "=", 
      RowBox[{"startangle", "=", 
       RowBox[{
        RowBox[{"Global`AngleOffset", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`AngleOffset", "\[Rule]", "0"}], "}"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"optShow", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Options", "[", "MADDraw", "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADDrawRot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "y_"}], "}"}], ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{"y", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{"y", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"roty", "[", 
       RowBox[{"line_", ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"1", "-", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc2", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sym", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<symmline\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"cc", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
     RowBox[{"RM", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions", "=", "prepositionsin"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"v", "=", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"startangle", "+", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}],
                ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               ",", "0", ",", "0"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"rm", "=", 
            RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"RM", "=", 
            RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"cc", "+=", 
            RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"prepositions", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"Length", "[", "offset", "]"}], ",", "\[IndentingNewLine]", 
       "0", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ReplacePart", "[", 
             RowBox[{"#1", ",", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "+", "offset"}], ",", "2"}], "]"}], "&"}], ")"}], "/@", 
          "prepositions2"}]}], ";"}], ",", "\[IndentingNewLine]", "2", ",", 
       RowBox[{"prepositions", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ReplacePart", "[", 
            RowBox[{
             RowBox[{"ReplacePart", "[", 
              RowBox[{"#1", ",", 
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "offset", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], ",", "2"}], "]"}], ",", 
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{
              "offset", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}], ",", "1"}], "]"}], "&"}], ")"}], "/@",
          "prepositions2"}]}], ",", "\[IndentingNewLine]", "_", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", "prepositions2"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"layout", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"pelement", "[", 
            RowBox[{
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", 
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], " ", ",", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#1", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "5"}], "\[RightDoubleBracket]"}], "+", 
               "startangle", "-", 
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ")"}], ",", 
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "opts", "}"}], ",", 
               RowBox[{"Cases", "[", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                 ",", "_Rule"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"FancyElements", "\[Rule]", "fancy"}], "}"}]}], 
              "]"}]}], "]"}], "&"}], ")"}], "/@", "#"}], "&"}], "/@", 
       RowBox[{"Split", "[", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"MapThread", "[", 
           RowBox[{"List", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Rest", "[", "lattice", "]"}], ",", 
              RowBox[{"Most", "[", "prepositions", "]"}]}], "}"}]}], "]"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
           RowBox[{"#2", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], "&"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"acceleratorlayout", "=", 
      RowBox[{"Graphics", "[", 
       RowBox[{"layout", ",", "optShow"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ShowPicture", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}], ")"}], "===", "True"}], 
       ",", 
       RowBox[{"Show", "[", 
        RowBox[{"acceleratorlayout", ",", 
         RowBox[{"Sequence", "@@", "optShow"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", 
         RowBox[{"BaseStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FontSize", "\[Rule]", "Fontsize"}], "/.", 
              "\[InvisibleSpace]", 
              RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
             RowBox[{"Options", "[", "MADDraw", "]"}]}], ",", 
            RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "}"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ImageSize", "\[Rule]", "Imagesize"}], "/.", 
           "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"PlotLabel", "\[Rule]", "DrawLabel"}], "/.", 
           "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"closed", "===", "True"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "]"}],
            "<", 
           FractionBox["1", 
            SuperscriptBox["10", "6"]]}], "&&", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], "]"}],
            "<", 
           FractionBox["1", 
            SuperscriptBox["10", "6"]]}]}], ",", 
         RowBox[{
         "Print", "[", "\"\<Lattice is Closed to Micron Level\>\"", "]"}], 
         ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Lattice is not closed, difference is X=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "]"}],
            "<>", "\"\<, Y=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "]"}]}], "]"}]}], "]"}], ";", "acceleratorlayout"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.442909818422024*^9, 3.442909821406437*^9}, {
   3.4429098642976108`*^9, 3.4429098644382377`*^9}, {3.442910037893583*^9, 
   3.442910059237606*^9}, {3.4429101175508523`*^9, 3.442910120254012*^9}, {
   3.442910468695972*^9, 3.4429104803836217`*^9}, {3.4429105218685274`*^9, 
   3.442910557775237*^9}, {3.4429106101352825`*^9, 3.4429106854174957`*^9}, {
   3.4429110907351837`*^9, 3.4429111203449383`*^9}, 3.4429111818301*^9, {
   3.442911284784543*^9, 3.4429112857220545`*^9}, {3.442911340488381*^9, 
   3.44291136464494*^9}, {3.4429113953797083`*^9, 3.4429113970203543`*^9}, {
   3.442911428130128*^9, 3.44291144117717*^9}, 3.4429115235844746`*^9, 
   3.4429117362121964`*^9, {3.442911778259609*^9, 3.442911820228896*^9}, {
   3.4429118505261593`*^9, 3.442911875323352*^9}, {3.442912051934987*^9, 
   3.442912075841543*^9}, {3.447419374078902*^9, 3.4474193762351656`*^9}, {
   3.4474194129541507`*^9, 3.447419413094776*^9}, {3.44741949411092*^9, 
   3.4474194987671995`*^9}, {3.4474196412368617`*^9, 3.447419641674364*^9}, 
   3.4474196754402056`*^9, {3.4474201513651266`*^9, 3.447420151490127*^9}, {
   3.44766751835295*^9, 3.447667521696721*^9}, {3.4476677398699923`*^9, 
   3.447667782323389*^9}, {3.4476693405364866`*^9, 3.4476693978024783`*^9}, 
   3.4476694520684505`*^9, {3.4476782537654057`*^9, 3.4476782935469103`*^9}, {
   3.447678425283478*^9, 3.44767842636163*^9}, {3.4476784602374973`*^9, 
   3.447678472753443*^9}, {3.4476785213640623`*^9, 3.4476785235047417`*^9}, {
   3.4476785673183637`*^9, 3.4476785808030834`*^9}, {3.447678631601259*^9, 
   3.447678631726262*^9}, {3.4476787149776263`*^9, 3.447678849791852*^9}, {
   3.447678981762291*^9, 3.4476790060751023`*^9}, {3.4476791323267183`*^9, 
   3.4476791934837513`*^9}, {3.447679240890608*^9, 3.447679253718897*^9}, {
   3.4550137797605925`*^9, 3.4550138952449675`*^9}, {3.4550141117762175`*^9, 
   3.4550141461824675`*^9}, {3.4550142029168425`*^9, 3.4550142467605925`*^9}, 
   3.4550142903699675`*^9, {3.4550154133855925`*^9, 3.4550154189480925`*^9}, {
   3.4550154545105925`*^9, 3.4550154768387175`*^9}, {3.4550161237918425`*^9, 
   3.4550161260262175`*^9}, {3.4550161569480925`*^9, 
   3.4550162558230925`*^9}, {3.4552635144336305`*^9, 3.4552635174648805`*^9}, 
   3.4552635484961305`*^9, {3.4552682533867555`*^9, 3.4552682761211305`*^9}, {
   3.4625186415206966`*^9, 3.4625186416925755`*^9}, {3.462688111356264*^9, 
   3.462688113793827*^9}, {3.4626882147807875`*^9, 3.4626882170620956`*^9}, 
   3.4626883329556875`*^9, {3.4626883964573126`*^9, 3.462688433911397*^9}, {
   3.462688926674011*^9, 3.4626889355336127`*^9}, 3.463296280486241*^9, {
   3.5134288042476997`*^9, 3.5134288047320967`*^9}, {3.5728674163714385`*^9, 
   3.5728674523494387`*^9}, {3.5728675478864384`*^9, 
   3.5728675788914385`*^9}},ExpressionUUID->"e692d3de-8190-4547-9445-\
4384eed58cb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"baseMADDrawSurvey2", "[", 
   RowBox[{"latticein_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "theta", ",", "lattice", ",", "rot", ",", "roty", ",", "sinc", ",", 
      "cosc", ",", "sinc2", ",", "sym", ",", "test", ",", "autolabels", ",", 
      "thick", ",", "bpms", ",", "lengths", ",", "filled", ",", "widthscale", 
      ",", "symms", ",", "bends", ",", "closed", ",", "offset", ",", 
      "bpmcircle", ",", "textoscillate", ",", "fancyelements", ",", 
      "anglesum", ",", "findrotations", ",", "findrotationsv", ",", "cc", ",",
       "RM", ",", "prepositions", ",", "prepositions2", ",", "v", ",", "rm", 
      ",", "sum1", ",", "startangle", ",", "layout", ",", "fancy", ",", 
      "optShow", ",", "ar"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ar", "=", 
      RowBox[{
       RowBox[{"AspectRatio", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"theta", "=", 
      RowBox[{"latticein", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "5"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lattice", "=", "latticein"}], ";", "\[IndentingNewLine]", 
     RowBox[{"BaseMADDraw", "[", 
      RowBox[{"lattice", ",", "opts"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"text", ",", 
       RowBox[{"MADDrawText", "=", "True"}], ",", 
       RowBox[{"MADDrawText", "=", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"autolabels", "=", 
      RowBox[{
       RowBox[{"Global`AutoLabels", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`AutoLabels", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"thick", "=", 
      RowBox[{
       RowBox[{"Thick", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpms", "=", 
      RowBox[{
       RowBox[{"Monitors", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lengths", "=", 
      RowBox[{
       RowBox[{"Lengths", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filled", "=", 
      RowBox[{
       RowBox[{"Filled", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"filled", ",", 
       RowBox[{"shape", "=", "\"\<Polygon\>\""}], ",", 
       RowBox[{"shape", "=", "\"\<Line\>\""}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"widthscale", "=", 
      RowBox[{
       RowBox[{"WidthScale", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"symms", "=", 
      RowBox[{
       RowBox[{"Symms", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bends", "=", 
      RowBox[{
       RowBox[{"Bends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"closed", "=", 
      RowBox[{
       RowBox[{"CheckClosed", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"offset", "=", 
      RowBox[{
       RowBox[{"Offset", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpmcircle", "=", 
      RowBox[{
       RowBox[{"Global`BPMCircles", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`BPMCircles", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{"bpmcircle", ",", "True", ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"0.1", "wq"}]}], ",", 
       RowBox[{"_Integer", "|", "_Real"}], ",", 
       RowBox[{"BPMCIRCLESIZE", "=", 
        RowBox[{"bpmcircle", " ", "wq"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"textoscillate", "=", 
      RowBox[{
       RowBox[{"Global`TextOscillate", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`TextOscillate", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"textoscillate", "===", "True"}], ",", 
       RowBox[{"TEXTOSCILLATE", "=", "1"}], ",", 
       RowBox[{"TEXTOSCILLATE", "=", "0"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fancyelements", "=", 
      RowBox[{
       RowBox[{"FancyElements", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"FancyElements", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"anglesum", "=", 
      RowBox[{"startangle", "=", 
       RowBox[{
        RowBox[{"Global`AngleOffset", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`AngleOffset", "\[Rule]", "0"}], "}"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"optShow", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Options", "[", "MADDraw", "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADDrawRot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "y_"}], "}"}], ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{"y", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{"y", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"roty", "[", 
       RowBox[{"line_", ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"1", "-", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc2", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sym", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<symmline\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"cc", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
     RowBox[{"RM", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"v", "=", 
           RowBox[{
            RowBox[{"RotationMatrix", "[", 
             RowBox[{
              RowBox[{"startangle", "+", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ",", "0", ",", "0"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"rm", "=", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"RM", "=", 
           RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cc", "+=", 
           RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"prepositions", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"Length", "[", "offset", "]"}], ",", "\[IndentingNewLine]", 
       "0", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ReplacePart", "[", 
             RowBox[{"#1", ",", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "+", "offset"}], ",", "2"}], "]"}], "&"}], ")"}], "/@", 
          "prepositions2"}]}], ";"}], ",", "\[IndentingNewLine]", "2", ",", 
       RowBox[{"prepositions", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ReplacePart", "[", 
            RowBox[{
             RowBox[{"ReplacePart", "[", 
              RowBox[{"#1", ",", 
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "offset", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], ",", "2"}], "]"}], ",", 
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{
              "offset", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}], ",", "1"}], "]"}], "&"}], ")"}], "/@",
          "prepositions2"}]}], ",", "\[IndentingNewLine]", "_", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", "prepositions2"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"layout", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"pelement", "[", 
            RowBox[{
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", 
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], " ", ",", 
             FractionBox[
              RowBox[{"-", 
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], "5"], 
             ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#1", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "5"}], "\[RightDoubleBracket]"}], "+", 
               "startangle"}], ")"}], ",", 
             RowBox[{"#1", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "4"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "opts", "}"}], ",", 
               RowBox[{"Cases", "[", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                 ",", "_Rule"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"FancyElements", "\[Rule]", "fancy"}], "}"}]}], 
              "]"}]}], "]"}], "&"}], ")"}], "/@", "#"}], "&"}], "/@", 
       RowBox[{"Split", "[", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"MapThread", "[", 
           RowBox[{"List", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Rest", "[", "lattice", "]"}], ",", 
              RowBox[{"Most", "[", "prepositions", "]"}]}], "}"}]}], "]"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
           RowBox[{"#2", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], "&"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"acceleratorlayout", "=", 
      RowBox[{"Graphics", "[", 
       RowBox[{"layout", ",", "optShow"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ShowPicture", "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}], ")"}], "===", "True"}], 
       ",", 
       RowBox[{"Show", "[", 
        RowBox[{"acceleratorlayout", ",", 
         RowBox[{"Sequence", "@@", "optShow"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", 
         RowBox[{"BaseStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FontSize", "\[Rule]", "Fontsize"}], "/.", 
              "\[InvisibleSpace]", 
              RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
             RowBox[{"Options", "[", "MADDraw", "]"}]}], ",", 
            RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}]}], "}"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ImageSize", "\[Rule]", "Imagesize"}], "/.", 
           "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"PlotLabel", "\[Rule]", "DrawLabel"}], "/.", 
           "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "MADDraw", "]"}]}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"closed", "===", "True"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "]"}],
            "<", 
           FractionBox["1", 
            SuperscriptBox["10", "6"]]}], "&&", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], "]"}],
            "<", 
           FractionBox["1", 
            SuperscriptBox["10", "6"]]}]}], ",", 
         RowBox[{
         "Print", "[", "\"\<Lattice is Closed to Micron Level\>\"", "]"}], 
         ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Lattice is not closed, difference is X=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "]"}],
            "<>", "\"\<, Y=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
              RowBox[{"First", "[", "prepositions", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "]"}]}], "]"}]}], "]"}], ";", "acceleratorlayout"}], 
    "*)"}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.442909818422024*^9, 3.442909821406437*^9}, {
   3.4429098642976108`*^9, 3.4429098644382377`*^9}, {3.442910037893583*^9, 
   3.442910059237606*^9}, {3.4429101175508523`*^9, 3.442910120254012*^9}, {
   3.442910468695972*^9, 3.4429104803836217`*^9}, {3.4429105218685274`*^9, 
   3.442910557775237*^9}, {3.4429106101352825`*^9, 3.4429106854174957`*^9}, {
   3.4429110907351837`*^9, 3.4429111203449383`*^9}, 3.4429111818301*^9, {
   3.442911284784543*^9, 3.4429112857220545`*^9}, {3.442911340488381*^9, 
   3.44291136464494*^9}, {3.4429113953797083`*^9, 3.4429113970203543`*^9}, {
   3.442911428130128*^9, 3.44291144117717*^9}, 3.4429115235844746`*^9, 
   3.4429117362121964`*^9, {3.442911778259609*^9, 3.442911820228896*^9}, {
   3.4429118505261593`*^9, 3.442911875323352*^9}, {3.442912051934987*^9, 
   3.442912075841543*^9}, {3.447419374078902*^9, 3.4474193762351656`*^9}, {
   3.4474194129541507`*^9, 3.447419413094776*^9}, {3.44741949411092*^9, 
   3.4474194987671995`*^9}, {3.4474196412368617`*^9, 3.447419641674364*^9}, 
   3.4474196754402056`*^9, {3.4474201513651266`*^9, 3.447420151490127*^9}, {
   3.44766751835295*^9, 3.447667521696721*^9}, {3.4476677398699923`*^9, 
   3.447667782323389*^9}, {3.4476693405364866`*^9, 3.4476693978024783`*^9}, 
   3.4476694520684505`*^9, {3.4476782537654057`*^9, 3.4476782935469103`*^9}, {
   3.447678425283478*^9, 3.44767842636163*^9}, {3.4476784602374973`*^9, 
   3.447678472753443*^9}, {3.4476785213640623`*^9, 3.4476785235047417`*^9}, {
   3.4476785673183637`*^9, 3.4476785808030834`*^9}, {3.447678631601259*^9, 
   3.447678631726262*^9}, {3.4476787149776263`*^9, 3.447678849791852*^9}, {
   3.447678981762291*^9, 3.4476790060751023`*^9}, {3.4476791323267183`*^9, 
   3.4476791934837513`*^9}, {3.447679240890608*^9, 3.447679253718897*^9}, {
   3.4550137797605925`*^9, 3.4550138952449675`*^9}, {3.4550141117762175`*^9, 
   3.4550141461824675`*^9}, {3.4550142029168425`*^9, 3.4550142467605925`*^9}, 
   3.4550142903699675`*^9, {3.4550154133855925`*^9, 3.4550154189480925`*^9}, {
   3.4550154545105925`*^9, 3.4550154768387175`*^9}, {3.4550161237918425`*^9, 
   3.4550161260262175`*^9}, {3.4550161569480925`*^9, 
   3.4550162558230925`*^9}, {3.4552635144336305`*^9, 3.4552635174648805`*^9}, 
   3.4552635484961305`*^9, {3.4552682533867555`*^9, 3.4552682761211305`*^9}, {
   3.4625186415206966`*^9, 3.4625186416925755`*^9}, {3.462688111356264*^9, 
   3.462688113793827*^9}, {3.4626882147807875`*^9, 3.4626882170620956`*^9}, 
   3.4626883329556875`*^9, {3.4626883964573126`*^9, 3.462688433911397*^9}, {
   3.462688926674011*^9, 3.4626889355336127`*^9}, 3.463296280486241*^9, {
   3.5018317621330867`*^9, 3.501831769180007*^9}, 
   3.5090875589575677`*^9},ExpressionUUID->"e46ad888-51c9-4cf2-ae7a-\
47dcd59b8a7f"]
}, Closed]],

Cell[CellGroupData[{

Cell["MADPositions", "Subsection",ExpressionUUID->"56958279-83a4-49ed-89b5-82b525d59f09"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPositions", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "rot", ",", "roty", ",", "sinc", ",", "cosc", ",", "sinc2", ",", "sym", 
      ",", "test", ",", "autolabels", ",", "thick", ",", "bpms", ",", 
      "lengths", ",", "filled", ",", "widthscale", ",", "symms", ",", "bends",
       ",", "closed", ",", "offset", ",", "bpmcircle", ",", "textoscillate", 
      ",", "fancyelements", ",", "anglesum", ",", "findrotations", ",", 
      "findrotationsv", ",", "cc", ",", "RM", ",", "prepositions", ",", 
      "prepositions2", ",", "v", ",", "rm", ",", "sum1", ",", "startangle", 
      ",", "layout", ",", "fancy", ",", "optShow", ",", "b", ",", "a", ",", 
      "c", ",", "lattice", ",", "tilt", ",", "text"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"anglesum", "=", 
      RowBox[{"startangle", "=", 
       RowBox[{
        RowBox[{"Global`AngleOffset", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`AngleOffset", "\[Rule]", "0"}], "}"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"offset", "=", 
      RowBox[{
       RowBox[{"Offset", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bends", "=", 
      RowBox[{
       RowBox[{"Bends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"text", "=", "False"}], ";", "\[IndentingNewLine]", 
     RowBox[{"autolabels", "=", "False"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"MADFlatten", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tilt", "[", "element_", "]"}], ":=", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{
        "element", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ",", "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "element", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<Extra\>\""}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "7", 
         "\[RightDoubleBracket]"}], " ", ",", "\[IndentingNewLine]", 
        "\"\<RectBend\>\"", ",", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "element", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<Extra\>\""}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "7", 
         "\[RightDoubleBracket]"}], " ", ",", "\[IndentingNewLine]", "_", ",",
         "0"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", "\"\<dipole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"bpmcircle", "=!=", "False"}], ")"}], "&&", 
                RowBox[{"StringMatchQ", "[", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   ",", "\"\<BPM\>\""}], "]"}]}], ",", "\"\<bpmcircle\>\"", 
               ",", 
               RowBox[{"ToLowerCase", "[", 
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "]"}]}], "]"}]}], "]"}], ",", 
           RowBox[{
           "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", 
             RowBox[{"N", "[", 
              RowBox[{"-", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}],
               "]"}], ",", "0"}], "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{"text", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"lengths", "===", "True"}], ",", 
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                "<>", "\"\<[\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                  "]"}], "<>", "\"\<m]\>\""}], ",", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}],
               "]"}], ",", "\"\<\>\""}], "]"}], ",", 
           RowBox[{"tilt", "[", "#1", "]"}], ",", "#"}], "}"}], "&"}], ")"}], 
       "/@", "a"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"symms", "===", "True"}], ",", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";"}], ",", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
            "}"}]}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
            "}"}]}], "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"lattice", "=", "c"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADDrawRot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "y_"}], "}"}], ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{"y", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{"y", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"roty", "[", 
       RowBox[{"line_", ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
      FractionBox[
       RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "0", "]"}], "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
      FractionBox[
       RowBox[{"1", "-", 
        RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "0", "]"}], "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc2", "[", "\[Theta]_", "]"}], ":=", 
      FractionBox[
       RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sym", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<symmline\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"bends", "===", "True"}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"anglesum", "+=", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
            "&"}], ")"}], "/@", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{"lattice", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "c", "]"}], "}"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"findrotationsv", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"sum1", "=", "0"}], ";", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"sum1", "+=", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], 
           "&"}], ")"}], "/@", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"Prepend", "[", 
            RowBox[{"lattice", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
              "}"}]}], "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}]}]}], ")"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"cc", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
     RowBox[{"RM", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"v", "=", 
           RowBox[{
            RowBox[{"RotationMatrix", "[", 
             RowBox[{"startangle", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "*", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{"sinc", "[", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "]"}], ",", "1"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
                "*", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{"cosc", "[", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "]"}], ",", "0"}], "]"}]}], ",", "0"}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rm", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "===", "\"\<dipole\>\""}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bends", "===", "True"}], ",", 
               RowBox[{
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sign", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "5", 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], ".", 
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
             RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"RM", "=", 
           RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cc", "+=", 
           RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"prepositions", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Rest", "[", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RotateRight", "[", 
           RowBox[{"prepositions2", ",", "1"}], "]"}], ",", "lattice", ",", 
          "findrotations"}], "}"}]}], "]"}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4558738790459156`*^9, 3.4558738968427906`*^9}, {
   3.4558739293896656`*^9, 3.4558739383115406`*^9}, {3.4558741109365406`*^9, 
   3.4558741379521656`*^9}, {3.4620170421567593`*^9, 3.462017088594557*^9}, {
   3.4620171598293877`*^9, 3.4620172374861345`*^9}, 3.462017274751998*^9, 
   3.463296281064377*^9, 3.498202822567094*^9, {3.498202959817094*^9, 
   3.498203001160844*^9}, {3.498203044879594*^9, 3.498203071207719*^9}, 
   3.5305315043181443`*^9, {3.5309500084796023`*^9, 3.5309500128533144`*^9}, 
   3.5309502564065914`*^9, {3.7106549350842505`*^9, 3.7106549352512503`*^9}, 
   3.726298747953906*^9},ExpressionUUID->"927129ac-f4f2-49b9-acf9-\
50a31b881b18"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADFootPrint", "[", "lattice_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
        RowBox[{"Min", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ")"}], ",", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", 
        RowBox[{"Min", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}]}], "}"}], "&"}], "[", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{"MADPositions", "[", "lattice", "]"}], "\[LeftDoubleBracket]", 
     RowBox[{"All", ",", "1", ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}], "]"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.462017405330959*^9, 3.4620174074872227`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPositions2", "[", 
   RowBox[{"latticein_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "anglesum", ",", "bends", ",", "findrotations", ",", "cc", ",", "RM", 
      ",", "v", ",", "rm", ",", "startangle", ",", "prepositions", ",", 
      "prepositions2", ",", "offset", ",", "angle", ",", "lattice"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"anglesum", "=", 
      RowBox[{"startangle", "=", 
       RowBox[{
        RowBox[{"Global`AngleOffset", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`AngleOffset", "\[Rule]", "0"}], "}"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bends", "=", 
      RowBox[{
       RowBox[{"Bends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"offset", "=", 
      RowBox[{
       RowBox[{"Offset", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"1", "-", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"lattice", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", "\"\<dipole\>\"", ",", 
             RowBox[{"ToLowerCase", "[", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}]}], "]"}], ",", 
           RowBox[{
           "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", 
             RowBox[{"N", "[", 
              RowBox[{"-", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}],
               "]"}], ",", "0"}], "]"}], ",", "\"\<\>\"", ",", "0", ",", 
           "#"}], "}"}], "&"}], ")"}], "/@", 
       RowBox[{"MADFlatten", "[", "latticein", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "lattice", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"bends", "===", "True"}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
             RowBox[{"anglesum", "+=", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
             ",", "\[IndentingNewLine]", "\"\<quadrupole\>\"", ",", 
             RowBox[{"anglesum", "+=", 
              RowBox[{
               RowBox[{"GetMADErrors", "[", 
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}],
                   "]"}], ",", "Global`MADdx"}], "]"}], "*", 
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "3"}], "\[RightDoubleBracket]"}], 
               "*", 
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "4"}], 
                "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]", 
             "_", ",", "0"}], "]"}], "&"}], "/@", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{"lattice", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "lattice", "]"}], "}"}]}], "]"}]}]}], "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"cc", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
     RowBox[{"RM", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"v", "=", 
           RowBox[{
            RowBox[{"RotationMatrix", "[", 
             RowBox[{"startangle", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "*", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{"sinc", "[", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "]"}], ",", "1"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
                "*", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{"cosc", "[", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "]"}], ",", "0"}], "]"}]}], ",", "0"}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rm", "=", 
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bends", "===", "True"}], ",", 
               RowBox[{
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sign", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "5", 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], ".", 
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", "\"\<quadrupole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"bends", "===", "True"}], ",", 
               RowBox[{
                RowBox[{"angle", "=", 
                 RowBox[{
                  RowBox[{"GetMADErrors", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}],
                     "]"}], ",", "Global`MADdx"}], "]"}], "*", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "3"}], "\[RightDoubleBracket]"}],
                   "*", 
                  RowBox[{"#", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "4"}], 
                   "\[RightDoubleBracket]"}]}]}], ";", 
                RowBox[{
                 RowBox[{"RotationMatrix", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], ".", 
                 RowBox[{"RotationMatrix", "[", 
                  RowBox[{"angle", ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], 
               ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", "_", ",", 
             RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"RM", "=", 
           RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cc", "+=", 
           RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"prepositions", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"Length", "[", "offset", "]"}], ",", "\[IndentingNewLine]", 
       "0", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ReplacePart", "[", 
             RowBox[{"#1", ",", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "+", "offset"}], ",", "2"}], "]"}], "&"}], ")"}], "/@", 
          "prepositions2"}]}], ";"}], ",", "\[IndentingNewLine]", "2", ",", 
       RowBox[{"prepositions", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ReplacePart", "[", 
            RowBox[{
             RowBox[{"ReplacePart", "[", 
              RowBox[{"#1", ",", 
               RowBox[{
                RowBox[{
                "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "offset", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], ",", "2"}], "]"}], ",", 
             RowBox[{
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{
              "offset", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}], ",", "1"}], "]"}], "&"}], ")"}], "/@",
          "prepositions2"}]}], ",", "\[IndentingNewLine]", "_", ",", 
       RowBox[{
        RowBox[{"prepositions", "=", "prepositions2"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Chop", "@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "##", "}"}], "]"}]}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"prepositions", ",", "findrotations", ",", 
         RowBox[{
          RowBox[{"MADFlatten", "[", "lattice", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "7"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
        "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5165423192786193`*^9, 3.5165423730921526`*^9}, {
   3.51654243207766*^9, 3.5165424956882563`*^9}, {3.516542604877853*^9, 
   3.5165426119873643`*^9}, {3.5165426640977397`*^9, 
   3.5165427265833144`*^9}, {3.5165427831625257`*^9, 
   3.5165428033972893`*^9}, {3.516543248921468*^9, 3.5165432550934615`*^9}, {
   3.5165434137840085`*^9, 3.5165434142215166`*^9}, {3.5165437063052497`*^9, 
   3.5165437904162397`*^9}, {3.516544124047645*^9, 3.516544139001057*^9}, {
   3.5165443256452656`*^9, 3.5165443373642406`*^9}, {3.516595282009976*^9, 
   3.5165952871194487`*^9}, {3.5165953207919703`*^9, 3.516595329510888*^9}, {
   3.5165959560854177`*^9, 3.5165959733826246`*^9}, {3.516729097842*^9, 
   3.516729100038*^9}, {3.5175510198753166`*^9, 3.517551026797324*^9}, 
   3.5175674368055735`*^9, {3.5305311169748726`*^9, 3.5305311653694024`*^9}, {
   3.5305313849761424`*^9, 3.530531386129506*^9}, {3.5305315486447287`*^9, 
   3.5305316251719885`*^9}, {3.530531702322688*^9, 3.53053174646224*^9}, {
   3.5305317973972883`*^9, 3.530531917939412*^9}, {3.5305319547847166`*^9, 
   3.5305319556263604`*^9}, {3.5305320718823347`*^9, 3.53053208039229*^9}, {
   3.5305321525398846`*^9, 3.530532154831026*^9}, {3.5305343310202875`*^9, 
   3.5305345432474566`*^9}, {3.5305345748728404`*^9, 3.530534652247616*^9}, {
   3.5309500405795245`*^9, 3.53095004275076*^9}, 3.5309501975645447`*^9, 
   3.530950245253626*^9, {3.541246834353549*^9, 
   3.5412468356968517`*^9}},ExpressionUUID->"92065a82-f37d-4497-8544-\
794ef817c1c8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADElementCoordinates", "[", 
   RowBox[{"lattice_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", "5"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", "2", ",", "1"}], "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "All", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], 
            "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], "}"}], "&"}], "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Prepend", "[", 
          RowBox[{
           RowBox[{"MADPositions2", "[", 
            RowBox[{"lattice", ",", "opts"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", "2", ",", 
         "1"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "#", "]"}], ">", "0"}], "&"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.516544896234346*^9, 3.5165449279693303`*^9}, {
   3.516545077065943*^9, 3.516545093535009*^9}, {3.516546111054545*^9, 
   3.516546114179605*^9}, {3.5165955040611143`*^9, 3.5165955361554804`*^9}, 
   3.516595568640479*^9, {3.516595600797346*^9, 3.516595633157343*^9}, 
   3.5305311150733805`*^9, {3.5305311981935186`*^9, 3.5305311989572325`*^9}, 
   3.5309502512206182`*^9},ExpressionUUID->"dd9421be-e413-4c61-b7f0-\
c5855cd80e6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADDraw3D", "Subsection",
 InitializationCell->
  True,ExpressionUUID->"2c233607-366b-4903-8483-4d197010d740"],

Cell[CellGroupData[{

Cell["Shared Functions", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolyCuboid", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"xmin_", ",", "ymin_", ",", "zmin_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"xmax_", ",", "ymax_", ",", "zmax_"}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Polygon", "[", "#", "]"}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymin", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymin", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymin", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymin", ",", "zmax"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymin", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymax", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymax", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymin", ",", "zmax"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymax", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymax", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymax", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymax", ",", "zmax"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymin", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymax", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymax", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymin", ",", "zmax"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymin", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymin", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymax", ",", "zmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymax", ",", "zmax"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymin", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymin", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "ymax", ",", "zmin"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "ymax", ",", "zmin"}], "}"}]}], "}"}]}], 
    "}"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937672409580927`*^9, 3.3937672676450806`*^9}, {
  3.393767406939281*^9, 3.393767408673623*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TranslateShape", "[", 
   RowBox[{"gr_", ",", "vec_"}], "]"}], ":=", 
  RowBox[{"Translate", "[", 
   RowBox[{"gr", ",", "vec"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3937603848099265`*^9, {3.3937666487194643`*^9, 3.393766676593929*^9}, {
   3.393768187184165*^9, 3.393768188262269*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AffineShape", "[", 
   RowBox[{"gr_", ",", "vec_"}], "]"}], ":=", 
  RowBox[{"Scale", "[", 
   RowBox[{"gr", ",", "vec", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393760549184558*^9, 3.3937605771236672`*^9}, 
   3.3937657513487372`*^9, 3.3937664591137295`*^9, {3.3937666466101294`*^9, 
   3.3937666773907886`*^9}, {3.3937679566584015`*^9, 
   3.3937679615176525`*^9}, {3.3937681361070204`*^9, 3.3937681533410645`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RotateShape", "[", 
   RowBox[{"gr_", ",", "phi_", ",", "theta_", ",", "psi_"}], "]"}], ":=", 
  RowBox[{"Rotate", "[", 
   RowBox[{
    RowBox[{"Rotate", "[", 
     RowBox[{
      RowBox[{"Rotate", "[", 
       RowBox[{"gr", ",", "phi", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "psi", ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", 
        RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "theta", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393765553559458*^9, 3.3937656107291374`*^9}, {
   3.3937656467590036`*^9, 3.393765658305435*^9}, 3.3937657534892797`*^9, {
   3.3937658014407063`*^9, 3.393765835174217*^9}, {3.3937666500944376`*^9, 
   3.393766678297021*^9}, {3.393768183481111*^9, 3.393768185934189*^9}, {
   3.3937689477789364`*^9, 3.3937689524663463`*^9}, {3.3937690571049623`*^9, 
   3.393769103869689*^9}, {3.3938312090337768`*^9, 3.393831217033572*^9}, {
   3.393831319140333*^9, 3.3938313472021146`*^9}, {3.3941737712842336`*^9, 
   3.3941738076750917`*^9}, {3.39417386140981*^9, 3.3941738645504556`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RotateShape", "[", 
   RowBox[{"gr_", ",", "theta_", ",", "phi_", ",", "psi_"}], "]"}], ":=", 
  RowBox[{"Rotate", "[", 
   RowBox[{
    RowBox[{"Rotate", "[", 
     RowBox[{
      RowBox[{"Rotate", "[", 
       RowBox[{"gr", ",", "theta", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", "psi", ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ",", "phi", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393765553559458*^9, 3.3937656107291374`*^9}, {
   3.3937656467590036`*^9, 3.393765658305435*^9}, 3.3937657534892797`*^9, {
   3.3937658014407063`*^9, 3.393765835174217*^9}, {3.3937666500944376`*^9, 
   3.393766678297021*^9}, {3.393768183481111*^9, 3.393768185934189*^9}, {
   3.3937689477789364`*^9, 3.3937689524663463`*^9}, {3.3937690571049623`*^9, 
   3.393769103869689*^9}, {3.3938312090337768`*^9, 3.393831217033572*^9}, {
   3.393831319140333*^9, 3.3938313472021146`*^9}, {3.39417885483294*^9, 
   3.394178887176276*^9}, {3.3997939507201653`*^9, 3.3997939535952024`*^9}, {
   3.3997940472057753`*^9, 3.39979408270623*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cylinder5", "[", 
   RowBox[{"r_", ",", "h_", ",", "n_"}], "]"}], ":=", 
  RowBox[{"Cylinder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", 
        RowBox[{"-", "h"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "h"}], "}"}]}], "}"}], ",", "r"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393768653628334*^9, 3.3937687287987657`*^9}, {
  3.3937687935318975`*^9, 3.39376879576623*^9}, {3.393769337818322*^9, 
  3.393769338912051*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"barrelface", "[", "order_", "]"}], ":=", 
  RowBox[{"Polygon", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "1"}], " ", 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "1"}], ",", 
       RowBox[{"-", "0.5"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "1"}], " ", 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "1"}], ",", "0.5"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", " ", 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "1"}], ",", "0.5"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", " ", 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "1"}], ",", 
       RowBox[{"-", "0.5"}]}], "}"}]}], "}"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393828054942649*^9, 3.3938281468934193`*^9}, {
  3.3938283087174015`*^9, 3.393828334216749*^9}, {3.393828425730031*^9, 
  3.3938284351829143`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"barrel", "[", "order_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"RotateShape", "[", 
     RowBox[{
      RowBox[{"barrelface", "[", "order", "]"}], ",", "0", ",", "0", ",", 
      "i"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", 
      RowBox[{"2", "\[Pi]"}], ",", 
      FractionBox["\[Pi]", 
       RowBox[{"2", " ", "order"}]]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938284829004426`*^9, 3.3938284986969132`*^9}, {
  3.3938285941944685`*^9, 3.3938286001318164`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"face", "[", "order_", "]"}], ":=", 
  RowBox[{"Polygon", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Tan", "[", 
        FractionBox["\[Pi]", 
         RowBox[{"4", "order"}]], "]"}], ",", 
       RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"0.6", 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "0.6"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "0.6"}], 
        RowBox[{"Tan", "[", 
         FractionBox["\[Pi]", 
          RowBox[{"4", "order"}]], "]"}]}], ",", 
       RowBox[{"-", "0.6"}], ",", "0"}], "}"}]}], "}"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393828794001853*^9, 3.3938288243760757`*^9}, {
  3.393828859234558*^9, 3.3938288803590174`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"faceplate", "[", "order_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"RotateShape", "[", 
     RowBox[{
      RowBox[{"face", "[", "order", "]"}], ",", "0", ",", "0", ",", "i"}], 
     "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", 
      RowBox[{"2", "\[Pi]"}], ",", 
      FractionBox["\[Pi]", 
       RowBox[{"2", "order"}]]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393828966888052*^9, 3.3938289882468805`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"\[Theta]", "\[Equal]", "0"}], ",", "1", ",", 
     FractionBox[
      RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"\[Theta]", "\[Equal]", "0"}], ",", "0", ",", 
     FractionBox[
      RowBox[{"1", "-", 
       RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADDrawRot", "[", 
    RowBox[{"line_", ",", "\[Theta]_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        " ", 
       RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
      RowBox[{
       RowBox[{"line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
        " ", 
       RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        " ", 
       RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
      RowBox[{
       RowBox[{"line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
        " ", 
       RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.463296281923768*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Dipole3D", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Arc3D", "[", 
   RowBox[{"length_", ",", "bend_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"l", "=", 
      RowBox[{"length", "/", "bend"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"AbsoluteThickness", "[", "3", "]"}], ",", 
      RowBox[{"TranslateShape", "[", 
       RowBox[{
        RowBox[{"RotateShape", "[", 
         RowBox[{
          RowBox[{"RotateShape", "[", 
           RowBox[{
            RowBox[{"Line", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"l", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Cos", "[", "i", "]"}], "-", "1"}], ")"}]}], ",", 
                 RowBox[{"l", " ", 
                  RowBox[{"Sin", "[", "i", "]"}]}], ",", "z"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "0", ",", 
                 RowBox[{"-", "bend"}], ",", 
                 RowBox[{"-", 
                  FractionBox["bend", "12"]}]}], "}"}]}], "]"}], "]"}], ",", 
            "0", ",", "phi", ",", 
            RowBox[{"psi", "-", "bend", "+", "\[Pi]"}]}], "]"}], ",", "theta",
           ",", "0", ",", "0"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938322194922833`*^9, 3.3938322208203745`*^9}, {
   3.3938442677979155`*^9, 3.393844349108334*^9}, {3.393844399982032*^9, 
   3.3938444174815836`*^9}, {3.393844816736987*^9, 3.39384489300066*^9}, {
   3.393844948702359*^9, 3.393844959170841*^9}, {3.393845005857146*^9, 
   3.393845013653821*^9}, 3.3938450493560324`*^9, {3.3938451332288847`*^9, 
   3.3938451352757072`*^9}, {3.3938452078675995`*^9, 
   3.3938452233515778`*^9}, {3.393845264631771*^9, 3.3938453075681715`*^9}, {
   3.393845392753491*^9, 3.3938454055969124`*^9}, {3.3938454436115637`*^9, 
   3.393845448408316*^9}, {3.393845491407215*^9, 3.3938456074511194`*^9}, {
   3.3938456511375012`*^9, 3.3938456752150097`*^9}, {3.393845707979796*^9, 
   3.3938457330729036`*^9}, {3.3938457633221292`*^9, 
   3.3938457853371906`*^9}, {3.393845820992528*^9, 3.393845826679882*^9}, {
   3.3938459308490906`*^9, 3.393845935880212*^9}, {3.3938459784103727`*^9, 
   3.3938460100970616`*^9}, {3.393846292542956*^9, 3.3938463481821566`*^9}, {
   3.3938463977902613`*^9, 3.3938463997277117`*^9}, {3.393848819118899*^9, 
   3.3938488192595205`*^9}, {3.393848998083067*^9, 3.3938490383476615`*^9}, {
   3.3938495888023195`*^9, 3.3938496042081747`*^9}, {3.3939198335221577`*^9, 
   3.393919833740902*^9}, {3.3939199057660017`*^9, 3.393919957365137*^9}, {
   3.393929737565095*^9, 3.393929755002372*^9}, {3.3939308825816884`*^9, 
   3.3939308904722123`*^9}, {3.3939309745180116`*^9, 
   3.3939309754398746`*^9}, {3.3939355141348996`*^9, 3.393935529241954*^9}, {
   3.3939355761878667`*^9, 3.3939355771408453`*^9}, {3.393935614369501*^9, 
   3.393935631257532*^9}, 3.393936369581608*^9, {3.393936419308344*^9, 
   3.3939364860324683`*^9}, {3.393937463241721*^9, 3.3939374696626096`*^9}, {
   3.394177557528973*^9, 3.3941777119417896`*^9}, {3.39417775889221*^9, 
   3.394177759220316*^9}, {3.3941781057190933`*^9, 3.3941781270150146`*^9}, {
   3.3941785320705442`*^9, 3.3941785502424192`*^9}, {3.394189679245186*^9, 
   3.394189703901278*^9}, 3.630412650771243*^9, {3.65513250448479*^9, 
   3.655132506221964*^9}, {3.65513259620096*^9, 3.6551326029206324`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dipoleblocks", " ", "=", " ", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PolyCuboid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ",", " ", 
           RowBox[{"-", "1"}], ",", " ", 
           RowBox[{"-", "0.5"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", " ", 
           RowBox[{
            RowBox[{"-", "2"}], "/", "3"}], ",", " ", "0.5"}], "}"}]}], "]"}],
        ",", " ", 
       RowBox[{"PolyCuboid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ",", " ", 
           RowBox[{"2", "/", "3"}], ",", " ", 
           RowBox[{"-", "0.5"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", " ", "1", ",", " ", "0.5"}], "}"}]}], "]"}], ",", 
       " ", 
       RowBox[{"PolyCuboid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "/", "3"}], ",", " ", 
           RowBox[{
            RowBox[{"-", "2"}], "/", "3"}], ",", " ", 
           RowBox[{"-", "0.5"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", " ", 
           RowBox[{"2", "/", "3"}], ",", " ", "0.5"}], "}"}]}], "]"}], ",", 
       " ", 
       RowBox[{"PolyCuboid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ",", " ", 
           RowBox[{
            RowBox[{"-", "2"}], "/", "3"}], ",", " ", 
           RowBox[{"-", "0.5"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "/", "3"}], ",", " ", 
           RowBox[{"-", "0.45"}], ",", " ", "0.5"}], "}"}]}], "]"}], ",", " ", 
       RowBox[{"PolyCuboid", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ",", " ", "0.2", ",", " ", 
           RowBox[{"-", "0.5"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "/", "3"}], ",", " ", 
           RowBox[{"2", "/", "3"}], ",", " ", "0.5"}], "}"}]}], "]"}]}], 
      "}"}], ",", " ", "1"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393767147022396*^9, 3.3937671648970532`*^9}, {
   3.3937674109860783`*^9, 3.3937674161266046`*^9}, {3.393767454735238*^9, 
   3.393767456157086*^9}, {3.5587902181280007`*^9, 3.5587903091008263`*^9}, {
   3.5587903503995514`*^9, 3.558790402933155*^9}, {3.558865673488845*^9, 
   3.5588657062948914`*^9}, {3.5588660030797777`*^9, 3.5588660060756245`*^9}, 
   3.558866325425098*^9, {3.5588671317574167`*^9, 3.558867153670637*^9}, 
   3.5592900590996623`*^9, {3.6304126571962433`*^9, 3.630412660461243*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Opacity", "[", "0.4", "]"}], ",", "dipoleblocks"}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.5588658915097303`*^9, 3.558865925709509*^9}, {
   3.5588659566441517`*^9, 3.558865972885681*^9}, {3.558866009660542*^9, 
   3.5588660353608685`*^9}, 3.558866373602098*^9, 3.5592946227902584`*^9}],

Cell[BoxData[
 Graphics3DBox[
  {Opacity[0.4], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], -1, -0.5}, {1, -1, -0.5}, {1, -1, 0.5}, {
      Rational[-1, 3], -1, 0.5}}, {{-0.3333333333333333, -1, -0.5}, {
      1, -1, -0.5}, {1, -1, 0.5}, {-0.3333333333333333, -1, 0.5}}]], 
   Polygon3DBox[
    NCache[{{1, -1, -0.5}, {1, Rational[-2, 3], -0.5}, {
      1, Rational[-2, 3], 0.5}, {1, -1, 0.5}}, {{1, -1, -0.5}, {
      1, -0.6666666666666666, -0.5}, {1, -0.6666666666666666, 0.5}, {
      1, -1, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
      1, Rational[-2, 3], -0.5}, {1, Rational[-2, 3], 0.5}, {
      Rational[-1, 3], Rational[-2, 3], 
       0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, {
      1, -0.6666666666666666, -0.5}, {
      1, -0.6666666666666666, 0.5}, {-0.3333333333333333, -0.6666666666666666,
       0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], -1, -0.5}, {
      Rational[-1, 3], Rational[-2, 3], -0.5}, {
      Rational[-1, 3], Rational[-2, 3], 0.5}, {
      Rational[-1, 3], -1, 
       0.5}}, {{-0.3333333333333333, -1, -0.5}, {-0.3333333333333333, \
-0.6666666666666666, -0.5}, {-0.3333333333333333, -0.6666666666666666, 
      0.5}, {-0.3333333333333333, -1, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], -1, 0.5}, {1, -1, 0.5}, {
      1, Rational[-2, 3], 0.5}, {
      Rational[-1, 3], Rational[-2, 3], 0.5}}, {{-0.3333333333333333, -1, 
       0.5}, {1, -1, 0.5}, {
      1, -0.6666666666666666, 0.5}, {-0.3333333333333333, -0.6666666666666666,
       0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], -1, -0.5}, {1, -1, -0.5}, {
      1, Rational[-2, 3], -0.5}, {
      Rational[-1, 3], 
       Rational[-2, 3], -0.5}}, {{-0.3333333333333333, -1, -0.5}, {
      1, -1, -0.5}, {
      1, -0.6666666666666666, -0.5}, {-0.3333333333333333, \
-0.6666666666666666, -0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
      1, Rational[2, 3], -0.5}, {1, Rational[2, 3], 0.5}, {
      Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
      0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
      1, 0.6666666666666666, 0.5}, {-0.3333333333333333, 0.6666666666666666, 
      0.5}}]], Polygon3DBox[
    NCache[{{1, Rational[2, 3], -0.5}, {1, 1, -0.5}, {1, 1, 0.5}, {
      1, Rational[2, 3], 0.5}}, {{1, 0.6666666666666666, -0.5}, {
      1, 1, -0.5}, {1, 1, 0.5}, {1, 0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], 1, -0.5}, {1, 1, -0.5}, {1, 1, 0.5}, {
      Rational[-1, 3], 1, 0.5}}, {{-0.3333333333333333, 1, -0.5}, {
      1, 1, -0.5}, {1, 1, 0.5}, {-0.3333333333333333, 1, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
      Rational[-1, 3], 1, -0.5}, {Rational[-1, 3], 1, 0.5}, {
      Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
      0.6666666666666666, -0.5}, {-0.3333333333333333, 
       1, -0.5}, {-0.3333333333333333, 1, 0.5}, {-0.3333333333333333, 
      0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[2, 3], 0.5}, {
      1, Rational[2, 3], 0.5}, {1, 1, 0.5}, {
      Rational[-1, 3], 1, 0.5}}, {{-0.3333333333333333, 0.6666666666666666, 
      0.5}, {1, 0.6666666666666666, 0.5}, {
      1, 1, 0.5}, {-0.3333333333333333, 1, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
      1, Rational[2, 3], -0.5}, {1, 1, -0.5}, {
      Rational[-1, 3], 1, -0.5}}, {{-0.3333333333333333, 
      0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
      1, 1, -0.5}, {-0.3333333333333333, 1, -0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[2, 3], Rational[-2, 3], -0.5}, {
      1, Rational[-2, 3], -0.5}, {1, Rational[-2, 3], 0.5}, {
      Rational[2, 3], Rational[-2, 3], 0.5}}, {{
      0.6666666666666666, -0.6666666666666666, -0.5}, {
      1, -0.6666666666666666, -0.5}, {1, -0.6666666666666666, 0.5}, {
      0.6666666666666666, -0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{1, Rational[-2, 3], -0.5}, {1, Rational[2, 3], -0.5}, {
      1, Rational[2, 3], 0.5}, {1, Rational[-2, 3], 0.5}}, {{
      1, -0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
      1, 0.6666666666666666, 0.5}, {1, -0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[2, 3], Rational[2, 3], -0.5}, {
      1, Rational[2, 3], -0.5}, {1, Rational[2, 3], 0.5}, {
      Rational[2, 3], Rational[2, 3], 0.5}}, {{0.6666666666666666, 
      0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
      1, 0.6666666666666666, 0.5}, {0.6666666666666666, 0.6666666666666666, 
      0.5}}]], Polygon3DBox[
    NCache[{{Rational[2, 3], Rational[-2, 3], -0.5}, {
      Rational[2, 3], Rational[2, 3], -0.5}, {
      Rational[2, 3], Rational[2, 3], 0.5}, {
      Rational[2, 3], Rational[-2, 3], 0.5}}, {{
     0.6666666666666666, -0.6666666666666666, -0.5}, {0.6666666666666666, 
     0.6666666666666666, -0.5}, {0.6666666666666666, 0.6666666666666666, 
     0.5}, {0.6666666666666666, -0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[2, 3], Rational[-2, 3], 0.5}, {
      1, Rational[-2, 3], 0.5}, {1, Rational[2, 3], 0.5}, {
      Rational[2, 3], Rational[2, 3], 0.5}}, {{
      0.6666666666666666, -0.6666666666666666, 0.5}, {
      1, -0.6666666666666666, 0.5}, {1, 0.6666666666666666, 0.5}, {
      0.6666666666666666, 0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[2, 3], Rational[-2, 3], -0.5}, {
      1, Rational[-2, 3], -0.5}, {1, Rational[2, 3], -0.5}, {
      Rational[2, 3], Rational[2, 3], -0.5}}, {{
      0.6666666666666666, -0.6666666666666666, -0.5}, {
      1, -0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
      0.6666666666666666, 0.6666666666666666, -0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
      Rational[1, 3], Rational[-2, 3], -0.5}, {
      Rational[1, 3], Rational[-2, 3], 0.5}, {
      Rational[-1, 3], Rational[-2, 3], 
       0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, {
     0.3333333333333333, -0.6666666666666666, -0.5}, {
     0.3333333333333333, -0.6666666666666666, 
     0.5}, {-0.3333333333333333, -0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[1, 3], Rational[-2, 3], -0.5}, {
      Rational[1, 3], -0.45, -0.5}, {Rational[1, 3], -0.45, 0.5}, {
      Rational[1, 3], Rational[-2, 3], 0.5}}, {{
     0.3333333333333333, -0.6666666666666666, -0.5}, {
     0.3333333333333333, -0.45, -0.5}, {0.3333333333333333, -0.45, 0.5}, {
     0.3333333333333333, -0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], -0.45, -0.5}, {Rational[1, 3], -0.45, -0.5}, {
      Rational[1, 3], -0.45, 0.5}, {
      Rational[-1, 3], -0.45, 0.5}}, {{-0.3333333333333333, -0.45, -0.5}, {
     0.3333333333333333, -0.45, -0.5}, {0.3333333333333333, -0.45, 
     0.5}, {-0.3333333333333333, -0.45, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
      Rational[-1, 3], -0.45, -0.5}, {Rational[-1, 3], -0.45, 0.5}, {
      Rational[-1, 3], Rational[-2, 3], 
       0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, \
{-0.3333333333333333, -0.45, -0.5}, {-0.3333333333333333, -0.45, 
     0.5}, {-0.3333333333333333, -0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[-2, 3], 0.5}, {
      Rational[1, 3], Rational[-2, 3], 0.5}, {Rational[1, 3], -0.45, 0.5}, {
      Rational[-1, 3], -0.45, 
       0.5}}, {{-0.3333333333333333, -0.6666666666666666, 0.5}, {
     0.3333333333333333, -0.6666666666666666, 0.5}, {
     0.3333333333333333, -0.45, 0.5}, {-0.3333333333333333, -0.45, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
      Rational[1, 3], Rational[-2, 3], -0.5}, {Rational[1, 3], -0.45, -0.5}, {
      Rational[-1, 
        3], -0.45, -0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, \
{0.3333333333333333, -0.6666666666666666, -0.5}, {
     0.3333333333333333, -0.45, -0.5}, {-0.3333333333333333, -0.45, -0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], 0.2, -0.5}, {Rational[1, 3], 0.2, -0.5}, {
      Rational[1, 3], 0.2, 0.5}, {
      Rational[-1, 3], 0.2, 0.5}}, {{-0.3333333333333333, 0.2, -0.5}, {
     0.3333333333333333, 0.2, -0.5}, {0.3333333333333333, 0.2, 
     0.5}, {-0.3333333333333333, 0.2, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[1, 3], 0.2, -0.5}, {
      Rational[1, 3], Rational[2, 3], -0.5}, {
      Rational[1, 3], Rational[2, 3], 0.5}, {Rational[1, 3], 0.2, 0.5}}, {{
     0.3333333333333333, 0.2, -0.5}, {0.3333333333333333, 
     0.6666666666666666, -0.5}, {0.3333333333333333, 0.6666666666666666, 
     0.5}, {0.3333333333333333, 0.2, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
      Rational[1, 3], Rational[2, 3], -0.5}, {
      Rational[1, 3], Rational[2, 3], 0.5}, {
      Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
     0.6666666666666666, -0.5}, {0.3333333333333333, 
     0.6666666666666666, -0.5}, {0.3333333333333333, 0.6666666666666666, 
     0.5}, {-0.3333333333333333, 0.6666666666666666, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], 0.2, -0.5}, {
      Rational[-1, 3], Rational[2, 3], -0.5}, {
      Rational[-1, 3], Rational[2, 3], 0.5}, {
      Rational[-1, 3], 0.2, 0.5}}, {{-0.3333333333333333, 
     0.2, -0.5}, {-0.3333333333333333, 
     0.6666666666666666, -0.5}, {-0.3333333333333333, 0.6666666666666666, 
     0.5}, {-0.3333333333333333, 0.2, 0.5}}]], 
   Polygon3DBox[
    NCache[{{Rational[-1, 3], 0.2, 0.5}, {Rational[1, 3], 0.2, 0.5}, {
      Rational[1, 3], Rational[2, 3], 0.5}, {
      Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 0.2, 
     0.5}, {0.3333333333333333, 0.2, 0.5}, {0.3333333333333333, 
     0.6666666666666666, 0.5}, {-0.3333333333333333, 0.6666666666666666, 
     0.5}}]], Polygon3DBox[
    NCache[{{Rational[-1, 3], 0.2, -0.5}, {Rational[1, 3], 0.2, -0.5}, {
      Rational[1, 3], Rational[2, 3], -0.5}, {
      Rational[-1, 3], Rational[2, 3], -0.5}}, {{-0.3333333333333333, 
     0.2, -0.5}, {0.3333333333333333, 0.2, -0.5}, {0.3333333333333333, 
     0.6666666666666666, -0.5}, {-0.3333333333333333, 
     0.6666666666666666, -0.5}}]]},
  ImageSize->{291.72042227860834`, 398.56757432500075`},
  ImageSizeRaw->Automatic,
  ViewPoint->{-0.8257964156644424, -1.056771962596179, 3.1066530702584703`},
  ViewVertical->{-0.1908229526326667, -0.9491373337922971, 
   0.5760367648024057}]], "Output",
 CellChangeTimes->{{3.5588658835825176`*^9, 3.558865926096613*^9}, 
   3.5588659732559543`*^9, {3.558866009913001*^9, 3.5588660358152943`*^9}, 
   3.558866326260166*^9, 3.558866374115986*^9, 3.558867156707183*^9, 
   3.5592946291967955`*^9, 3.587195147527261*^9, 3.627038155801376*^9, 
   3.630412518671243*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Dipole3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"TranslateShape", "[", 
   RowBox[{
    RowBox[{"RotateShape", "[", 
     RowBox[{
      RowBox[{"RotateShape", "[", 
       RowBox[{
        RowBox[{"RotateShape", "[", 
         RowBox[{
          RowBox[{"TranslateShape", "[", 
           RowBox[{
            RowBox[{"AffineShape", "[", 
             RowBox[{"dipoleblocks", ",", 
              RowBox[{"{", 
               RowBox[{
                FractionBox["width", "2"], ",", 
                FractionBox["width", "2"], ",", "length"}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               FractionBox["width", "10"]}], ",", "0", ",", 
              FractionBox["length", "2"]}], "}"}]}], "]"}], ",", 
          FractionBox["\[Pi]", "2"], ",", "\[Pi]", ",", "0"}], "]"}], ",", 
        "0", ",", "phi", ",", "psi"}], "]"}], ",", 
      RowBox[{"-", "theta"}], ",", "0", ",", "0"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393830982664572*^9, 3.393831121364146*^9}, {
   3.393831181440733*^9, 3.393831191799843*^9}, {3.3938312232990365`*^9, 
   3.3938312976408834`*^9}, {3.3938313531394625`*^9, 3.393831404856889*^9}, 
   3.393831496323297*^9, {3.3938321716028843`*^9, 3.3938321926492205`*^9}, {
   3.393832339270467*^9, 3.393832345051569*^9}, {3.39384138464021*^9, 
   3.393841421689456*^9}, {3.3938456875271945`*^9, 3.3938456877615633`*^9}, {
   3.3938488328529224`*^9, 3.393848898398119*^9}, {3.393849191374994*^9, 
   3.3938492077027006`*^9}, {3.393849274841607*^9, 3.393849281841428*^9}, {
   3.3938493175436387`*^9, 3.3938493498396873`*^9}, {3.3938494213847303`*^9, 
   3.3938495583968477`*^9}, {3.3939190133323555`*^9, 3.393919019909428*^9}, {
   3.3939190579502153`*^9, 3.393919060996603*^9}, {3.39417367109426*^9, 
   3.3941737400335245`*^9}, {3.394173835425269*^9, 3.394173857894163*^9}, {
   3.3941783816330442`*^9, 3.3941784713517942`*^9}, {3.3997995846672792`*^9, 
   3.3997997749978404`*^9}, {3.6304127187162433`*^9, 3.630412735947243*^9}, {
   3.630412899408243*^9, 3.630412901723243*^9}, {3.630412990955243*^9, 
   3.630412996415243*^9}, 3.630413067598243*^9, 3.655132581903531*^9, {
   3.655132716885028*^9, 3.6551327335726967`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"Dipole3D", "[", 
   RowBox[{"1", ",", "1", ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938309576027136`*^9, 3.393830976336609*^9}, {
   3.3938311740346727`*^9, 3.3938311760502462`*^9}, {3.39384132846474*^9, 
   3.393841333730702*^9}, 3.393848884695345*^9, {3.39384933585567*^9, 
   3.3938493895105467`*^9}, {3.3938494450403748`*^9, 3.393849445305993*^9}, {
   3.393919037187913*^9, 3.393919067354961*^9}, {3.3941735662790766`*^9, 
   3.39417356677909*^9}, 3.3941736675160437`*^9, {3.3941737987062845`*^9, 
   3.3941738433628197`*^9}, {3.394173874456769*^9, 3.3941739113007545`*^9}, {
   3.3997931443192186`*^9, 3.399793146866126*^9}, {3.3997995104475794`*^9, 
   3.3997995891673365`*^9}, {3.630412591511243*^9, 3.630412615542243*^9}, {
   3.630412682346243*^9, 3.6304126856892433`*^9}, {3.6304127868742433`*^9, 
   3.630412812561243*^9}, 3.630412917825243*^9}],

Cell[BoxData[
 Graphics3DBox[
  GeometricTransformation3DBox[
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         GeometricTransformation3DBox[
          GeometricTransformation3DBox[{
            Polygon3DBox[
             NCache[{{Rational[-1, 3], -1, -0.5}, {1, -1, -0.5}, {
               1, -1, 0.5}, {
               Rational[-1, 3], -1, 0.5}}, {{-0.3333333333333333, -1, -0.5}, {
               1, -1, -0.5}, {1, -1, 0.5}, {-0.3333333333333333, -1, 0.5}}]], 
            Polygon3DBox[
             NCache[{{1, -1, -0.5}, {1, Rational[-2, 3], -0.5}, {
               1, Rational[-2, 3], 0.5}, {1, -1, 0.5}}, {{1, -1, -0.5}, {
               1, -0.6666666666666666, -0.5}, {1, -0.6666666666666666, 0.5}, {
               1, -1, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
               1, Rational[-2, 3], -0.5}, {1, Rational[-2, 3], 0.5}, {
               Rational[-1, 3], Rational[-2, 3], 
                0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, {
               1, -0.6666666666666666, -0.5}, {
               1, -0.6666666666666666, 
                0.5}, {-0.3333333333333333, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], -1, -0.5}, {
               Rational[-1, 3], Rational[-2, 3], -0.5}, {
               Rational[-1, 3], Rational[-2, 3], 0.5}, {
               Rational[-1, 3], -1, 
                0.5}}, {{-0.3333333333333333, -1, -0.5}, \
{-0.3333333333333333, -0.6666666666666666, -0.5}, {-0.3333333333333333, \
-0.6666666666666666, 0.5}, {-0.3333333333333333, -1, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], -1, 0.5}, {1, -1, 0.5}, {
               1, Rational[-2, 3], 0.5}, {
               Rational[-1, 3], Rational[-2, 3], 
                0.5}}, {{-0.3333333333333333, -1, 0.5}, {1, -1, 0.5}, {
               1, -0.6666666666666666, 
                0.5}, {-0.3333333333333333, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], -1, -0.5}, {1, -1, -0.5}, {
               1, Rational[-2, 3], -0.5}, {
               Rational[-1, 3], 
                Rational[-2, 3], -0.5}}, {{-0.3333333333333333, -1, -0.5}, {
               1, -1, -0.5}, {
               1, -0.6666666666666666, -0.5}, {-0.3333333333333333, \
-0.6666666666666666, -0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
               1, Rational[2, 3], -0.5}, {1, Rational[2, 3], 0.5}, {
               Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
               0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
               1, 0.6666666666666666, 0.5}, {-0.3333333333333333, 
               0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{1, Rational[2, 3], -0.5}, {1, 1, -0.5}, {1, 1, 0.5}, {
               1, Rational[2, 3], 0.5}}, {{1, 0.6666666666666666, -0.5}, {
               1, 1, -0.5}, {1, 1, 0.5}, {1, 0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], 1, -0.5}, {1, 1, -0.5}, {1, 1, 0.5}, {
               Rational[-1, 3], 1, 0.5}}, {{-0.3333333333333333, 1, -0.5}, {
               1, 1, -0.5}, {1, 1, 0.5}, {-0.3333333333333333, 1, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
               Rational[-1, 3], 1, -0.5}, {Rational[-1, 3], 1, 0.5}, {
               Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
               0.6666666666666666, -0.5}, {-0.3333333333333333, 
                1, -0.5}, {-0.3333333333333333, 1, 0.5}, {-0.3333333333333333,
                0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[2, 3], 0.5}, {
               1, Rational[2, 3], 0.5}, {1, 1, 0.5}, {
               Rational[-1, 3], 1, 0.5}}, {{-0.3333333333333333, 
               0.6666666666666666, 0.5}, {1, 0.6666666666666666, 0.5}, {
               1, 1, 0.5}, {-0.3333333333333333, 1, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
               1, Rational[2, 3], -0.5}, {1, 1, -0.5}, {
               Rational[-1, 3], 1, -0.5}}, {{-0.3333333333333333, 
               0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
               1, 1, -0.5}, {-0.3333333333333333, 1, -0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[2, 3], Rational[-2, 3], -0.5}, {
               1, Rational[-2, 3], -0.5}, {1, Rational[-2, 3], 0.5}, {
               Rational[2, 3], Rational[-2, 3], 0.5}}, {{
               0.6666666666666666, -0.6666666666666666, -0.5}, {
               1, -0.6666666666666666, -0.5}, {1, -0.6666666666666666, 0.5}, {
               0.6666666666666666, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{1, Rational[-2, 3], -0.5}, {1, Rational[2, 3], -0.5}, {
               1, Rational[2, 3], 0.5}, {1, Rational[-2, 3], 0.5}}, {{
               1, -0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
               1, 0.6666666666666666, 0.5}, {1, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[2, 3], Rational[2, 3], -0.5}, {
               1, Rational[2, 3], -0.5}, {1, Rational[2, 3], 0.5}, {
               Rational[2, 3], Rational[2, 3], 0.5}}, {{0.6666666666666666, 
               0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
               1, 0.6666666666666666, 0.5}, {0.6666666666666666, 
               0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[2, 3], Rational[-2, 3], -0.5}, {
               Rational[2, 3], Rational[2, 3], -0.5}, {
               Rational[2, 3], Rational[2, 3], 0.5}, {
               Rational[2, 3], Rational[-2, 3], 0.5}}, {{
              0.6666666666666666, -0.6666666666666666, -0.5}, {
              0.6666666666666666, 0.6666666666666666, -0.5}, {
              0.6666666666666666, 0.6666666666666666, 0.5}, {
              0.6666666666666666, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[2, 3], Rational[-2, 3], 0.5}, {
               1, Rational[-2, 3], 0.5}, {1, Rational[2, 3], 0.5}, {
               Rational[2, 3], Rational[2, 3], 0.5}}, {{
               0.6666666666666666, -0.6666666666666666, 0.5}, {
               1, -0.6666666666666666, 0.5}, {1, 0.6666666666666666, 0.5}, {
               0.6666666666666666, 0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[2, 3], Rational[-2, 3], -0.5}, {
               1, Rational[-2, 3], -0.5}, {1, Rational[2, 3], -0.5}, {
               Rational[2, 3], Rational[2, 3], -0.5}}, {{
               0.6666666666666666, -0.6666666666666666, -0.5}, {
               1, -0.6666666666666666, -0.5}, {1, 0.6666666666666666, -0.5}, {
               0.6666666666666666, 0.6666666666666666, -0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
               Rational[1, 3], Rational[-2, 3], -0.5}, {
               Rational[1, 3], Rational[-2, 3], 0.5}, {
               Rational[-1, 3], Rational[-2, 3], 
                0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, {
              0.3333333333333333, -0.6666666666666666, -0.5}, {
              0.3333333333333333, -0.6666666666666666, 
              0.5}, {-0.3333333333333333, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[1, 3], Rational[-2, 3], -0.5}, {
               Rational[1, 3], -0.45, -0.5}, {Rational[1, 3], -0.45, 0.5}, {
               Rational[1, 3], Rational[-2, 3], 0.5}}, {{
              0.3333333333333333, -0.6666666666666666, -0.5}, {
              0.3333333333333333, -0.45, -0.5}, {0.3333333333333333, -0.45, 
              0.5}, {0.3333333333333333, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], -0.45, -0.5}, {
               Rational[1, 3], -0.45, -0.5}, {Rational[1, 3], -0.45, 0.5}, {
               Rational[-1, 3], -0.45, 
                0.5}}, {{-0.3333333333333333, -0.45, -0.5}, {
              0.3333333333333333, -0.45, -0.5}, {0.3333333333333333, -0.45, 
              0.5}, {-0.3333333333333333, -0.45, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
               Rational[-1, 3], -0.45, -0.5}, {Rational[-1, 3], -0.45, 0.5}, {
               Rational[-1, 3], Rational[-2, 3], 
                0.5}}, {{-0.3333333333333333, -0.6666666666666666, -0.5}, \
{-0.3333333333333333, -0.45, -0.5}, {-0.3333333333333333, -0.45, 
              0.5}, {-0.3333333333333333, -0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[-2, 3], 0.5}, {
               Rational[1, 3], Rational[-2, 3], 0.5}, {
               Rational[1, 3], -0.45, 0.5}, {
               Rational[-1, 3], -0.45, 
                0.5}}, {{-0.3333333333333333, -0.6666666666666666, 0.5}, {
              0.3333333333333333, -0.6666666666666666, 0.5}, {
              0.3333333333333333, -0.45, 0.5}, {-0.3333333333333333, -0.45, 
              0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[-2, 3], -0.5}, {
               Rational[1, 3], Rational[-2, 3], -0.5}, {
               Rational[1, 3], -0.45, -0.5}, {
               Rational[-1, 
                 3], -0.45, -0.5}}, {{-0.3333333333333333, \
-0.6666666666666666, -0.5}, {0.3333333333333333, -0.6666666666666666, -0.5}, {
              0.3333333333333333, -0.45, -0.5}, {-0.3333333333333333, -0.45, \
-0.5}}]], Polygon3DBox[
             NCache[{{Rational[-1, 3], 0.2, -0.5}, {
               Rational[1, 3], 0.2, -0.5}, {Rational[1, 3], 0.2, 0.5}, {
               Rational[-1, 3], 0.2, 0.5}}, {{-0.3333333333333333, 
              0.2, -0.5}, {0.3333333333333333, 0.2, -0.5}, {
              0.3333333333333333, 0.2, 0.5}, {-0.3333333333333333, 0.2, 
              0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[1, 3], 0.2, -0.5}, {
               Rational[1, 3], Rational[2, 3], -0.5}, {
               Rational[1, 3], Rational[2, 3], 0.5}, {
               Rational[1, 3], 0.2, 0.5}}, {{0.3333333333333333, 0.2, -0.5}, {
              0.3333333333333333, 0.6666666666666666, -0.5}, {
              0.3333333333333333, 0.6666666666666666, 0.5}, {
              0.3333333333333333, 0.2, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], Rational[2, 3], -0.5}, {
               Rational[1, 3], Rational[2, 3], -0.5}, {
               Rational[1, 3], Rational[2, 3], 0.5}, {
               Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
              0.6666666666666666, -0.5}, {0.3333333333333333, 
              0.6666666666666666, -0.5}, {0.3333333333333333, 
              0.6666666666666666, 0.5}, {-0.3333333333333333, 
              0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], 0.2, -0.5}, {
               Rational[-1, 3], Rational[2, 3], -0.5}, {
               Rational[-1, 3], Rational[2, 3], 0.5}, {
               Rational[-1, 3], 0.2, 0.5}}, {{-0.3333333333333333, 
              0.2, -0.5}, {-0.3333333333333333, 
              0.6666666666666666, -0.5}, {-0.3333333333333333, 
              0.6666666666666666, 0.5}, {-0.3333333333333333, 0.2, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], 0.2, 0.5}, {
               Rational[1, 3], 0.2, 0.5}, {
               Rational[1, 3], Rational[2, 3], 0.5}, {
               Rational[-1, 3], Rational[2, 3], 0.5}}, {{-0.3333333333333333, 
              0.2, 0.5}, {0.3333333333333333, 0.2, 0.5}, {0.3333333333333333, 
              0.6666666666666666, 0.5}, {-0.3333333333333333, 
              0.6666666666666666, 0.5}}]], 
            Polygon3DBox[
             NCache[{{Rational[-1, 3], 0.2, -0.5}, {
               Rational[1, 3], 0.2, -0.5}, {
               Rational[1, 3], Rational[2, 3], -0.5}, {
               Rational[-1, 3], Rational[2, 3], -0.5}}, {{-0.3333333333333333,
               0.2, -0.5}, {0.3333333333333333, 0.2, -0.5}, {
              0.3333333333333333, 
              0.6666666666666666, -0.5}, {-0.3333333333333333, 
              0.6666666666666666, -0.5}}]]}, 
           NCache[{{{Rational[1, 2], 0, 0}, {0, Rational[1, 2], 0}, {0, 0, 
              1}}, {0, 0, 0}}, {{{0.5, 0, 0}, {0, 0.5, 0}, {0, 0, 1}}, {0, 0, 
             0}}]], NCache[{
           Rational[-1, 10], 0, Rational[1, 2]}, {-0.1, 0, 0.5}]], {{1, 0, 
         0}, {0, 0, -1}, {0, 1, 0}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, 1, 0}, {0, 0, -1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
     0, 1}}], {2, 1, 1}]]], "Output",
 CellChangeTimes->{
  3.5871951476092606`*^9, 3.6270381558323755`*^9, 3.6304125213542433`*^9, {
   3.6304125917932434`*^9, 3.6304126157602434`*^9}, {3.630412682872243*^9, 
   3.630412686068243*^9}, {3.630412721785243*^9, 3.630412743783243*^9}, {
   3.630412788044243*^9, 3.630412812869243*^9}, {3.6304129093012433`*^9, 
   3.630412918217243*^9}, 3.630413068388243*^9}]
}, Open  ]],

Cell[BoxData["."], "Input",
 CellChangeTimes->{3.630412615740243*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Quadrupole3D", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{3.3937682167929716`*^9}],

Cell["\<\
quadbarrel = Flatten[{Cylinder5[0.5, 0.5, 8], Cylinder5[0.3, 0.5, 8]}, 1];\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.3937687399548016`*^9, 3.393768740361044*^9}, 
   3.39376932959973*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"quadbarrel", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"AffineShape", "[", 
      RowBox[{
       RowBox[{"barrel", "[", "2", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"#", ",", "#", ",", "1"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{"0.3", ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393826077524522*^9, 3.393826079665092*^9}, {
   3.3938262004432497`*^9, 3.3938262045056458`*^9}, {3.3938262502857237`*^9, 
   3.3938262774256544`*^9}, {3.393826374923158*^9, 3.3938263791730494`*^9}, {
   3.3938264404839797`*^9, 3.393826505591688*^9}, 3.3938280504740133`*^9, {
   3.393828101019594*^9, 3.393828106363207*^9}, {3.393828166486668*^9, 
   3.3938282083762207`*^9}, 3.393828268327811*^9, {3.39382834512272*^9, 
   3.393828395980793*^9}, {3.393828466838354*^9, 3.3938284706820054`*^9}, {
   3.393828519805748*^9, 3.3938286057566724`*^9}, {3.3938286728955784`*^9, 
   3.39382868455153*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"quadbarrel", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393825780764659*^9, 3.3938257821396327`*^9}, {
   3.393825825498175*^9, 3.3938260430252485`*^9}, {3.393826082352523*^9, 
   3.3938261593349276`*^9}, {3.3938264850922127`*^9, 3.3938264855609508`*^9}, 
   3.393826519169465*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[{
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
          0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, 0.7071067811865475, 
          0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
          Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
          0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 0.}, {0., 0., 1.}}, {0., 0., 0.}}],
    GeometricTransformation3DBox[{
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], 
       NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
          0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, 0.7071067811865475, 
          0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
          Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
          0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
            Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] Pi], -1, 0.5}, {
           Tan[Rational[1, 8] 
             Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
           0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.587195147681261*^9, 3.627038155886376*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"quadfaces", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"TranslateShape", "[", 
      RowBox[{
       RowBox[{"AffineShape", "[", 
        RowBox[{
         RowBox[{"faceplate", "[", "2", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.5", ",", "1"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393827066639825*^9, 3.393827119857212*^9}, {
  3.3938288891087933`*^9, 3.39382889765545*^9}, {3.393828994199853*^9, 
  3.3938290357144156`*^9}, {3.393829098962796*^9, 3.393829131024475*^9}, {
  3.3938291621018047`*^9, 3.393829177617032*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"quadfaces", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938265955268855`*^9, 3.393826598073695*^9}, {
   3.3938266376820564`*^9, 3.393826667696913*^9}, {3.3938268374113183`*^9, 
   3.3938270047820334`*^9}, 3.3938270592181396`*^9, 3.393827103701376*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[{
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
           0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, 0.7071067811865475, 
           0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
           Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
           0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 
      0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, -0.5}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[{
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
           0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, 0.7071067811865475, 
           0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
           Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
           0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
            Tan[Rational[1, 8] Pi], -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}, {{-0.41421356237309503`, -1, 0}, {
            0.41421356237309503`, -1, 0}, {
            0.24852813742385702`, -0.6, 0}, {-0.24852813742385702`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 
      0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, 0.5}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.587195147735261*^9, 3.6270381559353757`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"quadpoles", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"PolyCuboid", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0.1", ",", 
             RowBox[{"-", "0.07"}], ",", 
             RowBox[{"-", "0.5"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.3", " ", ",", "0.07", ",", "0.5"}], "}"}]}], "]"}], 
         ",", "0", ",", "0", ",", "theta"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"theta", ",", 
         RowBox[{"\[Pi]", "/", "4"}], ",", 
         RowBox[{"2", "\[Pi]"}], ",", 
         RowBox[{"\[Pi]", "/", "2"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937692591323333`*^9, 3.3937692653978376`*^9}, {
  3.393827169434068*^9, 3.393827170809033*^9}, {3.39382726077548*^9, 
  3.3938272847279916`*^9}, {3.3938273624135027`*^9, 3.393827400303158*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"quadpoles", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393769130962919*^9, 3.3937691352440867`*^9}, {
  3.3937692175393815`*^9, 3.393769239757705*^9}, {3.3938271559500384`*^9, 
  3.393827158106233*^9}}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}],
      NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
       2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
       0.7071067811865475, -0.7071067811865475, 0}, {
       0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
    0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}],
      NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
       2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
       1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
       0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
    0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}],
      NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
        0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
       1}}, {{-0.7071067811865475, 0.7071067811865475, 
        0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 
    0, 0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 0.07, 
        0.5}, {0.1, -0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 0.5}, {
        0.1, 0.07, 0.5}}], 
       Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}],
      NCache[{{
       2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
        Rational[-1, 2], 0}, {0, 0, 1}}, {{
       0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
        0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
    1}}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.587195147762261*^9, 3.6270381559643755`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Quadrupole3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"TranslateShape", "[", 
    RowBox[{
     RowBox[{"RotateShape", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"TranslateShape", "[", 
          RowBox[{
           RowBox[{"AffineShape", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"quadbarrel", ",", "quadfaces", ",", "quadpoles"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"width", ",", "width", ",", "length"}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"length", "/", "2"}]}], "}"}]}], "]"}], ",", "0", ",", 
         RowBox[{"\[Pi]", "/", "2"}], ",", "0"}], "]"}], ",", "theta", ",", 
       "phi", ",", "psi"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393830874261097*^9, {3.3938315850554004`*^9, 3.393831589883402*^9}, 
   3.3938321258696804`*^9, 3.3938321644311934`*^9, {3.5587888206455727`*^9, 
   3.558788964047233*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Quadrupole3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"TranslateShape", "[", 
    RowBox[{
     RowBox[{"RotateShape", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"RotateShape", "[", 
          RowBox[{
           RowBox[{"TranslateShape", "[", 
            RowBox[{
             RowBox[{"AffineShape", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"quadbarrel", ",", "quadfaces", ",", "quadpoles"}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"width", ",", "width", ",", "length"}], "}"}]}], 
              "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"length", "/", "2"}]}], "}"}]}], "]"}], ",", "0", ",", 
           RowBox[{"\[Pi]", "/", "2"}], ",", "0"}], "]"}], ",", "0", ",", "0",
          ",", "psi"}], "]"}], ",", "theta", ",", "0", ",", "0"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393830874261097*^9, {3.3938315850554004`*^9, 3.393831589883402*^9}, 
   3.3938321258696804`*^9, 3.3938321644311934`*^9, {3.5587888206455727`*^9, 
   3.558788964047233*^9}, {3.654772616764024*^9, 3.6547726341393557`*^9}, {
   3.6547726941634884`*^9, 3.6547727493630595`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{
   RowBox[{"Quadrupole3D", "[", 
    RowBox[{"1", ",", "1", ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937692782100916`*^9, 3.393769317303091*^9}, {
  3.393832119057355*^9, 3.3938321214479184`*^9}}],

Cell[BoxData[
 Graphics3DBox[
  GeometricTransformation3DBox[
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         GeometricTransformation3DBox[
          GeometricTransformation3DBox[{{
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                   0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 
               0.}, {0., 0., 1.}}, {0., 0., 0.}}], 
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                   0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 8] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] Pi], -1, 0.5}, {
                    Tan[Rational[1, 8] 
                    Pi], -1, -0.5}}, {{-0.41421356237309503`, -1, -0.5}, \
{-0.41421356237309503`, -1, 0.5}, {0.41421356237309503`, -1, 0.5}, {
                    0.41421356237309503`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 
               0.}, {0., 0., 1.}}, {0., 0., 0.}}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                    0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 
                  1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5,
                 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, -0.5}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                    0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 
                  1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 8] Pi], -1, 0}, {
                    Tan[Rational[1, 8] Pi], -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 
                    0}}, {{-0.41421356237309503`, -1, 0}, {
                    0.41421356237309503`, -1, 0}, {
                    0.24852813742385702`, -0.6, 
                    0}, {-0.24852813742385702`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5,
                 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, 0.5}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 
                  0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                 2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                 0.7071067811865475, -0.7071067811865475, 0}, {
                 0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{
              1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 
                  0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                 2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                 1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                 0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
              1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 
                  0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                  0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                 1}}, {{-0.7071067811865475, 0.7071067811865475, 
                  0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.1, 0.07, -0.5}, {0.1, 
                  0.07, 0.5}, {0.1, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.1, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.1, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.1, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{
                 2^Rational[-1, 2], 2^Rational[-1, 2], 
                  0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                 1}}, {{0.7071067811865475, 0.7071067811865475, 
                  0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}}, {{{1, 0, 0}, {0,
             1, 0}, {0, 0, 1}}, {0, 0, 0}}], 
          NCache[{0, 0, Rational[1, 2]}, {0, 0, 0.5}]], {{1, 0, 0}, {0, 1, 
         0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 0, 1}, {0, 
       1, 0}, {-1, 0, 0}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {
     0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {0, 0, 0}],
  Axes->True]], "Output",
 CellChangeTimes->{3.587195147874261*^9, 3.627038156058376*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Sextupole3D", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{3.3937682167929716`*^9, 3.393827448973787*^9}],

Cell["\<\
quadbarrel = Flatten[{Cylinder5[0.5, 0.5, 8], Cylinder5[0.3, 0.5, 8]}, 1];\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.3937687399548016`*^9, 3.393768740361044*^9}, 
   3.39376932959973*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sextbarrel", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"AffineShape", "[", 
      RowBox[{
       RowBox[{"barrel", "[", "3", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"#", ",", "#", ",", "1"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{"0.3", ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393826077524522*^9, 3.393826079665092*^9}, {
   3.3938262004432497`*^9, 3.3938262045056458`*^9}, {3.3938262502857237`*^9, 
   3.3938262774256544`*^9}, {3.393826374923158*^9, 3.3938263791730494`*^9}, {
   3.3938264404839797`*^9, 3.393826505591688*^9}, {3.393827520112591*^9, 
   3.393827550752431*^9}, {3.393828630193547*^9, 3.3938286568022404`*^9}, 
   3.3938292526463614`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"sextbarrel", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393825780764659*^9, 3.3938257821396327`*^9}, {
   3.393825825498175*^9, 3.3938260430252485`*^9}, {3.393826082352523*^9, 
   3.3938261593349276`*^9}, {3.3938264850922127`*^9, 3.3938264855609508`*^9}, 
   3.393826519169465*^9, {3.3938275544867105`*^9, 3.3938275550491962`*^9}}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[{
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
         Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.8660254037844386, -0.5, 0}, {0.5, 0.8660254037844386, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
         Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.5, -0.8660254037844386, 0}, {0.8660254037844386, 0.5, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
         Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.5, -0.8660254037844386, 0}, {
         0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
      0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
         Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
         1}}, {{-0.8660254037844386, -0.5, 0}, {
         0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
      0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
         Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
         1}}, {{-0.8660254037844386, 0.5, 0}, {-0.5, -0.8660254037844386, 
          0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
         Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.5, 0.8660254037844386, 0}, {-0.8660254037844386, -0.5, 
          0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
         Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
         Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^
            Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 0.}, {0., 0., 1.}}, {0., 0., 0.}}],
    GeometricTransformation3DBox[{
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
         Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.8660254037844386, -0.5, 0}, {0.5, 0.8660254037844386, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
         Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.5, -0.8660254037844386, 0}, {0.8660254037844386, 0.5, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
         Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.5, -0.8660254037844386, 0}, {
         0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
      0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], 
       NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
         Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
         1}}, {{-0.8660254037844386, -0.5, 0}, {
         0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
      0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
         Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
         1}}, {{-0.8660254037844386, 0.5, 0}, {-0.5, -0.8660254037844386, 
          0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
         Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.5, 0.8660254037844386, 0}, {-0.8660254037844386, -0.5, 
          0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
         Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
         Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
         0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 0}, {0, 0, 
         1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
            3^Rational[1, 2], -1, 0.5}, {2 - 3^Rational[1, 2], -1, 0.5}, {
           2 - 3^Rational[
             1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
           0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.587195147947261*^9, 3.6270381561253757`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"sextfaces", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"TranslateShape", "[", 
      RowBox[{
       RowBox[{"AffineShape", "[", 
        RowBox[{
         RowBox[{"faceplate", "[", "3", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.5", ",", "1"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393827066639825*^9, 3.393827119857212*^9}, {
  3.3938275601115665`*^9, 3.3938275822984986`*^9}, {3.3938292122567706`*^9, 
  3.3938292180378723`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"sextfaces", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938265955268855`*^9, 3.393826598073695*^9}, {
   3.3938266376820564`*^9, 3.393826667696913*^9}, {3.3938268374113183`*^9, 
   3.3938270047820334`*^9}, 3.3938270592181396`*^9, 3.393827103701376*^9, 
   3.393827585329671*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[{
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
          Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.8660254037844386, -0.5, 0}, {0.5, 0.8660254037844386, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
          Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.5, -0.8660254037844386, 0}, {0.8660254037844386, 0.5, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
          Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.5, -0.8660254037844386, 0}, {
          0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
       0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
          Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
          1}}, {{-0.8660254037844386, -0.5, 0}, {
          0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
       0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
          Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
          1}}, {{-0.8660254037844386, 0.5, 0}, {-0.5, -0.8660254037844386, 
           0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
          Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.5, 0.8660254037844386, 0}, {-0.8660254037844386, -0.5, 
           0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
          Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
          Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 
      0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, -0.5}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[{
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
          Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.8660254037844386, -0.5, 0}, {0.5, 0.8660254037844386, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
          Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.5, -0.8660254037844386, 0}, {0.8660254037844386, 0.5, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
          Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.5, -0.8660254037844386, 0}, {
          0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
       0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
          Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
          1}}, {{-0.8660254037844386, -0.5, 0}, {
          0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {
       0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
          Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
          1}}, {{-0.8660254037844386, 0.5, 0}, {-0.5, -0.8660254037844386, 
           0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
          Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.5, 0.8660254037844386, 0}, {-0.8660254037844386, -0.5, 
           0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
          Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
          Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
          0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 0}, {0, 0, 
          1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
            2 - 3^Rational[1, 2], -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}, {{-0.2679491924311228, -1, 0}, {
            0.2679491924311228, -1, 0}, {
            0.16076951545867368`, -0.6, 0}, {-0.16076951545867368`, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 
      0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, 0.5}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.587195148023261*^9, 3.6270381561883755`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"sextpoles", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"PolyCuboid", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0.15", ",", 
             RowBox[{"-", "0.07"}], ",", 
             RowBox[{"-", "0.5"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.3", " ", ",", "0.07", ",", "0.5"}], "}"}]}], "]"}], 
         ",", "0", ",", "0", ",", "theta"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"theta", ",", 
         RowBox[{"\[Pi]", "/", "6"}], ",", 
         RowBox[{"2", "\[Pi]"}], ",", 
         RowBox[{"\[Pi]", "/", "3"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937692591323333`*^9, 3.3937692653978376`*^9}, {
  3.393827169434068*^9, 3.393827170809033*^9}, {3.39382726077548*^9, 
  3.3938272847279916`*^9}, {3.3938273624135027`*^9, 3.393827400303158*^9}, {
  3.393827589860805*^9, 3.3938276800928698`*^9}, {3.3938292593961887`*^9, 
  3.393829266880372*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"sextpoles", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393769130962919*^9, 3.3937691352440867`*^9}, {
   3.3937692175393815`*^9, 3.393769239757705*^9}, {3.3938271559500384`*^9, 
   3.393827158106233*^9}, 3.3938275973449883`*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
       Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
       0.8660254037844386, -0.5, 0}, {0.5, 0.8660254037844386, 0}, {0, 0, 
       1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0,
     1}}], GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
       Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
       1}}, {{-0.8660254037844386, -0.5, 0}, {0.5, -0.8660254037844386, 0}, {
       0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
       Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
       1}}, {{-0.8660254037844386, 0.5, 0}, {-0.5, -0.8660254037844386, 0}, {
       0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0,
     1}}], GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
       Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 1}}, {{
       0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 0}, {0, 0, 
       1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.5871951480572605`*^9, 3.627038156281376*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Sextupole3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"TranslateShape", "[", 
    RowBox[{
     RowBox[{"RotateShape", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"TranslateShape", "[", 
          RowBox[{
           RowBox[{"AffineShape", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"sextbarrel", ",", "sextfaces", ",", "sextpoles"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"width", ",", "width", ",", "length"}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"length", "/", "2"}]}], "}"}]}], "]"}], ",", "0", ",", 
         RowBox[{"\[Pi]", "/", "2"}], ",", "0"}], "]"}], ",", "theta", ",", 
       "phi", ",", "psi"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938276139383135`*^9, 3.3938276277192106`*^9}, {
  3.3938308456993284`*^9, 3.3938308643863497`*^9}, {3.393831598101941*^9, 
  3.393831599883146*^9}, {3.3938321345882072`*^9, 3.3938321587125893`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"Sextupole3D", "[", 
   RowBox[{"1", ",", "1", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937692782100916`*^9, 3.393769317303091*^9}, 
   3.393827664905759*^9}],

Cell[BoxData[
 Graphics3DBox[
  GeometricTransformation3DBox[
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         GeometricTransformation3DBox[
          GeometricTransformation3DBox[{{
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                   Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0,
                    1}}, {{0.8660254037844386, -0.5, 0}, {
                   0.5, 0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 
                1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                   Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0,
                    1}}, {{0.5, -0.8660254037844386, 0}, {
                   0.8660254037844386, 0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 
                1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                   Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 
                   0, 1}}, {{-0.5, -0.8660254037844386, 0}, {
                   0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                   Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 
                   0, 1}}, {{-0.8660254037844386, -0.5, 0}, {
                   0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                   Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 
                   0, 1}}, {{-0.8660254037844386, 0.5, 
                    0}, {-0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                   Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 
                   0, 
                   1}}, {{-0.5, 0.8660254037844386, 
                    0}, {-0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                   Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 
                   0, 1}}, {{
                   0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                   Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 
                   0, 1}}, {{
                   0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 0.}, {
               0., 0., 1.}}, {0., 0., 0.}}], 
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                   Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0,
                    1}}, {{0.8660254037844386, -0.5, 0}, {
                   0.5, 0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 
                1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                   Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 0,
                    1}}, {{0.5, -0.8660254037844386, 0}, {
                   0.8660254037844386, 0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 
                1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                   Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 
                   0, 1}}, {{-0.5, -0.8660254037844386, 0}, {
                   0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                   Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 
                   0, 1}}, {{-0.8660254037844386, -0.5, 0}, {
                   0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                   Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 
                   0, 1}}, {{-0.8660254037844386, 0.5, 
                    0}, {-0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^
                    Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                   Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 
                   0, 1}}, {{-0.5, 0.8660254037844386, 
                    0}, {-0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                   Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 
                   0, 1}}, {{
                   0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                   Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 
                   0, 1}}, {{
                   0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-2 + 3^Rational[1, 2], -1, -0.5}, {-2 + 
                    3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[1, 2], -1, 0.5}, {
                    2 - 3^Rational[
                    1, 2], -1, -0.5}}, {{-0.2679491924311228, -1, -0.5}, \
{-0.2679491924311228, -1, 0.5}, {0.2679491924311228, -1, 0.5}, {
                    0.2679491924311228, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {
               0., 0., 1.}}, {0., 0., 0.}}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                    Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 
                    0, 1}}, {{0.8660254037844386, -0.5, 0}, {
                    0.5, 0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                  1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                    Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 
                    0, 1}}, {{0.5, -0.8660254037844386, 0}, {
                    0.8660254037844386, 0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                  1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                    Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 
                    0, 1}}, {{-0.5, -0.8660254037844386, 0}, {
                    0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
                 0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                    Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 
                    0, 1}}, {{-0.8660254037844386, -0.5, 0}, {
                    0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
                 0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 
                  1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                    Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0,
                     0, 1}}, {{-0.8660254037844386, 0.5, 
                    0}, {-0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 
                 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                    Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0,
                     0, 1}}, {{-0.5, 0.8660254037844386, 
                    0}, {-0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 
                 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                    Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 
                    0, 1}}, {{
                    0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                    Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 
                    0, 1}}, {{
                    0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5,
                 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, -0.5}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                    Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 
                    0, 1}}, {{0.8660254037844386, -0.5, 0}, {
                    0.5, 0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                  1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                    Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 
                    0, 1}}, {{0.5, -0.8660254037844386, 0}, {
                    0.8660254037844386, 0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0,
                  1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {
                    Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0, 
                    0, 1}}, {{-0.5, -0.8660254037844386, 0}, {
                    0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
                 0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                    Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 
                    0, 1}}, {{-0.8660254037844386, -0.5, 0}, {
                    0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
                 0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 
                  1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                    Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0,
                     0, 1}}, {{-0.8660254037844386, 0.5, 
                    0}, {-0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 
                 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                    Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {0,
                     0, 1}}, {{-0.5, 0.8660254037844386, 
                    0}, {-0.8660254037844386, -0.5, 0}, {0, 0, 1}}]], {{1, 0, 
                 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {
                    Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {0, 
                    0, 1}}, {{
                    0.5, 0.8660254037844386, 0}, {-0.8660254037844386, 0.5, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                    Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 
                    0, 1}}, {{
                    0.8660254037844386, 0.5, 0}, {-0.5, 0.8660254037844386, 
                    0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-2 + 3^Rational[1, 2], -1, 0}, {
                    2 - 3^Rational[1, 2], -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 
                    0}}, {{-0.2679491924311228, -1, 0}, {
                    0.2679491924311228, -1, 0}, {
                    0.16076951545867368`, -0.6, 
                    0}, {-0.16076951545867368`, -0.6, 0}}]], {{1, 0, 0}, {0, 
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5,
                 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, 0.5}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{
                 Rational[1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                 Rational[1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 
                 1}}, {{0.8660254037844386, -0.5, 0}, {
                 0.5, 0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1,
               0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {
              0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{
                 Rational[-1, 2] 3^Rational[1, 2], Rational[-1, 2], 0}, {
                 Rational[1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0, 
                 1}}, {{-0.8660254037844386, -0.5, 0}, {
                 0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 
              1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{
                 Rational[-1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                 Rational[-1, 2], Rational[-1, 2] 3^Rational[1, 2], 0}, {0, 0,
                  1}}, {{-0.8660254037844386, 0.5, 
                  0}, {-0.5, -0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 
              0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {
              0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{Rational[1, 2] 3^Rational[1, 2], Rational[1, 2], 0}, {
                 Rational[-1, 2], Rational[1, 2] 3^Rational[1, 2], 0}, {0, 0, 
                 1}}, {{0.8660254037844386, 0.5, 0}, {-0.5, 
                  0.8660254037844386, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 
              0}, {0, 0, 1}}]}}, {{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}, {0, 0, 
            0}}], NCache[{0, 0, Rational[1, 2]}, {0, 0, 0.5}]], {{1, 0, 0}, {
         0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 0, 
       1}, {0, 1, 0}, {-1, 0, 0}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 
     0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {0, 0,
    0}]]], "Output",
 CellChangeTimes->{3.587195148202261*^9, 3.6270381564023757`*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Octupole3D", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.3937682167929716`*^9, 3.393827448973787*^9, {3.393827773887344*^9, 
   3.393827776074788*^9}}],

Cell["\<\
quadbarrel = Flatten[{Cylinder5[0.5, 0.5, 8], Cylinder5[0.3, 0.5, 8]}, 1];\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.3937687399548016`*^9, 3.393768740361044*^9}, 
   3.39376932959973*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"octbarrel", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"AffineShape", "[", 
      RowBox[{
       RowBox[{"barrel", "[", "4", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"#", ",", "#", ",", "1"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{"0.3", ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393826077524522*^9, 3.393826079665092*^9}, {
   3.3938262004432497`*^9, 3.3938262045056458`*^9}, {3.3938262502857237`*^9, 
   3.3938262774256544`*^9}, {3.393826374923158*^9, 3.3938263791730494`*^9}, {
   3.3938264404839797`*^9, 3.393826505591688*^9}, {3.393827520112591*^9, 
   3.393827550752431*^9}, 3.3938277859807844`*^9, {3.39382782893281*^9, 
   3.393827837791958*^9}, {3.3938286915201015`*^9, 3.393828697598071*^9}, 
   3.3938305815967145`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"octbarrel", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393825780764659*^9, 3.3938257821396327`*^9}, {
   3.393825825498175*^9, 3.3938260430252485`*^9}, {3.393826082352523*^9, 
   3.3938261593349276`*^9}, {3.3938264850922127`*^9, 3.3938264855609508`*^9}, 
   3.393826519169465*^9, {3.3938275544867105`*^9, 3.3938275550491962`*^9}, 
   3.3938277870276327`*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[{
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
         Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.9238795325112867, -0.3826834323650898, 0}, {
         0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
         Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.3826834323650898, -0.9238795325112867, 0}, {
         0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
         Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
         0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
         Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
         0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
          Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.9238795325112867, 0.3826834323650898, 
          0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
          0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, 0.7071067811865475, 
          0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
          Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.3826834323650898, 0.9238795325112867, 
          0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
          Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.3826834323650898, 0.9238795325112867, 0}, {-0.9238795325112867, 
          0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
          Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
          0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
          Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.9238795325112867, 0.3826834323650898, 0}, {-0.3826834323650898, 
          0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 0.}, {0., 0., 1.}}, {0., 0., 0.}}],
    GeometricTransformation3DBox[{
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
         Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.9238795325112867, -0.3826834323650898, 0}, {
         0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], 
       NCache[{{Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
         Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.3826834323650898, -0.9238795325112867, 0}, {
         0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
         Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
         0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], 
       NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
         2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
         0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
         Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
         0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
      0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0,
       0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], 
       NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
          Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.9238795325112867, 0.3826834323650898, 
          0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
          0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
         1}}, {{-0.7071067811865475, 0.7071067811865475, 
          0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
          Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
         1}}, {{-0.3826834323650898, 0.9238795325112867, 
          0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{
      1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[
            Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
          Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.3826834323650898, 0.9238795325112867, 0}, {-0.9238795325112867, 
          0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
          Rational[-1, 2], 0}, {0, 0, 1}}, {{
         0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
          0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[
            Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], NCache[{{
         Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
          Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
         0.9238795325112867, 0.3826834323650898, 0}, {-0.3826834323650898, 
          0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        Polygon3DBox[
         NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
            Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] Pi], -1, 0.5}, {
           Tan[Rational[1, 16] 
             Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
           0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
        1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 
      0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.6270381564813757`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"octfaces", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"TranslateShape", "[", 
      RowBox[{
       RowBox[{"AffineShape", "[", 
        RowBox[{
         RowBox[{"faceplate", "[", "4", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.5", ",", "1"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393827066639825*^9, 3.393827119857212*^9}, {
   3.3938275601115665`*^9, 3.3938275822984986`*^9}, 3.393827788011982*^9, {
   3.3938278429637003`*^9, 3.393827848338563*^9}, {3.393830574675017*^9, 
   3.3938305770343313`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"octfaces", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938265955268855`*^9, 3.393826598073695*^9}, {
   3.3938266376820564`*^9, 3.393826667696913*^9}, {3.3938268374113183`*^9, 
   3.3938270047820334`*^9}, 3.3938270592181396`*^9, 3.393827103701376*^9, 
   3.393827585329671*^9, 3.3938277885432186`*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[{
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
          Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.9238795325112867, -0.3826834323650898, 0}, {
          0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
          Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.3826834323650898, -0.9238795325112867, 0}, {
          0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
          Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
          0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
          Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
          0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
           Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.9238795325112867, 0.3826834323650898, 
           0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
           0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, 0.7071067811865475, 
           0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
           Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.3826834323650898, 0.9238795325112867, 
           0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
           Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.3826834323650898, 0.9238795325112867, 0}, {-0.9238795325112867, 
           0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
           Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
           0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
           Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.9238795325112867, 0.3826834323650898, 0}, {-0.3826834323650898, 
           0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 
      0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, -0.5}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[{
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
          Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.9238795325112867, -0.3826834323650898, 0}, {
          0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
          Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.3826834323650898, -0.9238795325112867, 0}, {
          0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
          Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
          0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
          2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
          0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
          Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
          0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
           Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.9238795325112867, 0.3826834323650898, 
           0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
           0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
          1}}, {{-0.7071067811865475, 0.7071067811865475, 
           0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
           Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
          1}}, {{-0.3826834323650898, 0.9238795325112867, 
           0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{
       1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
           Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.3826834323650898, 0.9238795325112867, 0}, {-0.9238795325112867, 
           0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {-2^Rational[-1, 2], 2^
           Rational[-1, 2], 0}, {0, 0, 1}}, {{
          0.7071067811865475, 0.7071067811865475, 0}, {-0.7071067811865475, 
           0.7071067811865475, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
        NCache[{{
          Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
           Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
          0.9238795325112867, 0.3826834323650898, 0}, {-0.3826834323650898, 
           0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0,
        1}}], GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         Polygon3DBox[
          NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
            Tan[Rational[1, 16] Pi], -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}, {{-0.198912367379658, -1, 0}, {0.198912367379658, -1, 0}, {
            0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
             0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 
        0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 
      0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, 0.5}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.6270381565603757`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"octpoles", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"PolyCuboid", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0.15", ",", 
             RowBox[{"-", "0.07"}], ",", 
             RowBox[{"-", "0.5"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.3", " ", ",", "0.07", ",", "0.5"}], "}"}]}], "]"}], 
         ",", "0", ",", "0", ",", "theta"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"theta", ",", 
         RowBox[{"\[Pi]", "/", "8"}], ",", 
         RowBox[{"2", "\[Pi]"}], ",", 
         RowBox[{"\[Pi]", "/", "4"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937692591323333`*^9, 3.3937692653978376`*^9}, {
   3.393827169434068*^9, 3.393827170809033*^9}, {3.39382726077548*^9, 
   3.3938272847279916`*^9}, {3.3938273624135027`*^9, 3.393827400303158*^9}, {
   3.393827589860805*^9, 3.3938276800928698`*^9}, 3.3938277894494457`*^9, {
   3.393827852932195*^9, 3.3938278549946423`*^9}, {3.3938305867684574`*^9, 
   3.3938305942526407`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"octpoles", ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393769130962919*^9, 3.3937691352440867`*^9}, {
   3.3937692175393815`*^9, 3.393769239757705*^9}, {3.3938271559500384`*^9, 
   3.393827158106233*^9}, 3.3938275973449883`*^9, 3.393827791199401*^9}],

Cell[BoxData[
 Graphics3DBox[{
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
       Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
       0.9238795325112867, -0.3826834323650898, 0}, {
       0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
    0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
       Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
       0.3826834323650898, -0.9238795325112867, 0}, {
       0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 0}, {
    0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
       Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
       1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
       0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 
    0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
       Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
       1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
       0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 
    0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
        Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {0, 0, 
       1}}, {{-0.9238795325112867, 0.3826834323650898, 
        0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 
    0, 0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
        Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {0, 0, 
       1}}, {{-0.3826834323650898, 0.9238795325112867, 
        0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 
    0, 0}, {0, 1, 0}, {0, 0, 1}}], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{
       Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
        Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
       0.3826834323650898, 0.9238795325112867, 0}, {-0.9238795325112867, 
        0.3826834323650898, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
    1}}], GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[{
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, -0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.3, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15, 0.07, 
        0.5}, {0.15, -0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 0.07, 
        0.5}, {0.15, 0.07, 0.5}}], 
       Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
        0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
      1}}], NCache[{{
       Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
        Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 1}}, {{
       0.9238795325112867, 0.3826834323650898, 0}, {-0.3826834323650898, 
        0.9238795325112867, 0}, {0, 0, 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
    1}}]},
  Axes->True]], "Output",
 CellChangeTimes->{3.6270381566013756`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Octupole3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"TranslateShape", "[", 
    RowBox[{
     RowBox[{"RotateShape", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"TranslateShape", "[", 
          RowBox[{
           RowBox[{"AffineShape", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"octbarrel", ",", "octfaces", ",", "octpoles"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"width", ",", "width", ",", "length"}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"length", "/", "2"}]}], "}"}]}], "]"}], ",", "0", ",", 
         RowBox[{"\[Pi]", "/", "2"}], ",", "0"}], "]"}], ",", "theta", ",", 
       "phi", ",", "psi"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938276139383135`*^9, 3.3938276277192106`*^9}, {
   3.3938277941055765`*^9, 3.3938278059802723`*^9}, 3.3938308825890093`*^9, {
   3.393831606164235*^9, 3.3938316075392*^9}, {3.393832140650552*^9, 
   3.39383215127528*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"Octupole3D", "[", 
   RowBox[{"1", ",", "1", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3937692782100916`*^9, 3.393769317303091*^9}, 
   3.393827664905759*^9, 3.393827808761451*^9}],

Cell[BoxData[
 Graphics3DBox[
  GeometricTransformation3DBox[
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         GeometricTransformation3DBox[
          GeometricTransformation3DBox[{{
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                   Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 
                   1}}, {{0.9238795325112867, -0.3826834323650898, 0}, {
                   0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                   0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                   Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 
                   1}}, {{0.3826834323650898, -0.9238795325112867, 0}, {
                   0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
                   0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
                   0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[
                    Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 
                    0}, {-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[
                    Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 
                    0}, {-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0,
                    1}}, {{
                   0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[
                    Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0,
                    1}}, {{
                   0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 0.}, {
               0., 0., 1.}}, {0., 0., 0.}}], 
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                   Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 
                   1}}, {{0.9238795325112867, -0.3826834323650898, 0}, {
                   0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                   0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                   Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 
                   1}}, {{0.3826834323650898, -0.9238795325112867, 0}, {
                   0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
                   0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                   2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                   0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
                   0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 
                    0}, {-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 
                    0}, {-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0,
                    1}}, {{
                   0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                   1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0,
                    1}}, {{
                   0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 16] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] Pi], -1, 0.5}, {
                    Tan[Rational[1, 16] 
                    Pi], -1, -0.5}}, {{-0.198912367379658, -1, -0.5}, \
{-0.198912367379658, -1, 0.5}, {0.198912367379658, -1, 0.5}, {
                    0.198912367379658, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 0}, {
                  0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 
                0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {
               0., 0., 1.}}, {0., 0., 0.}}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0,
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{0.9238795325112867, -0.3826834323650898, 0}, {
                    0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                    0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{0.3826834323650898, -0.9238795325112867, 0}, {
                    0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {
                  1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
                    0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
                    0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {
                  0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 
                    0}, {-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 
                    0}, {-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 
                  0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
                 1}}], GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{
                    0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{
                    0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0,
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
                 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 
                0., 0.}}], {0, 0, -0.5}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0,
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{0.9238795325112867, -0.3826834323650898, 0}, {
                    0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 1}}, {{
                    0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{0.3826834323650898, -0.9238795325112867, 0}, {
                    0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, -1, 0}, {
                  1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
                    0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {
                    2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, -0.7071067811865475, 0}, {
                    0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
                    0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{-1, 0, 0}, {
                  0, -1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 
                    0}, {-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], -2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{-0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, -0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 
                    0}, {-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 1, 
                  0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
                 1}}], GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{
                    0.3826834323650898, 0.9238795325112867, 
                    0}, {-0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    2^Rational[-1, 2], 2^Rational[-1, 2], 
                    0}, {-2^Rational[-1, 2], 2^Rational[-1, 2], 0}, {0, 0, 
                    1}}, {{0.7071067811865475, 0.7071067811865475, 
                    0}, {-0.7071067811865475, 0.7071067811865475, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
                    Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0,
                     1}}, {{
                    0.9238795325112867, 0.3826834323650898, 
                    0}, {-0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 16] Pi], -1, 0}, {
                    Tan[Rational[1, 16] Pi], -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}, {{-0.198912367379658, -1, 0}, {
                    0.198912367379658, -1, 0}, {
                    0.1193474204277948, -0.6, 0}, {-0.1193474204277948, -0.6, 
                    0}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0,
                   1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 
                 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 0.}, {0., 0., 1.}}, {0., 
                0., 0.}}], {0, 0, 0.5}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                 Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 
                 1}}, {{0.9238795325112867, -0.3826834323650898, 0}, {
                 0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 1}}]], {{
              1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                 Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 
                 1}}, {{0.3826834323650898, -0.9238795325112867, 0}, {
                 0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 1}}]], {{
              1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 
                  0}, {Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                 0, 0, 1}}, {{-0.3826834323650898, -0.9238795325112867, 0}, {
                 0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 1}}]], {{
              1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 
                  0}, {Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                 0, 0, 1}}, {{-0.9238795325112867, -0.3826834323650898, 0}, {
                 0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 1}}]], {{
              1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{-Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 
                  0}, {-Sin[Rational[1, 8] Pi], -Cos[Rational[1, 8] Pi], 0}, {
                 0, 0, 1}}, {{-0.9238795325112867, 0.3826834323650898, 
                  0}, {-0.3826834323650898, -0.9238795325112867, 0}, {0, 0, 
                 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{-Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 
                  0}, {-Cos[Rational[1, 8] Pi], -Sin[Rational[1, 8] Pi], 0}, {
                 0, 0, 1}}, {{-0.3826834323650898, 0.9238795325112867, 
                  0}, {-0.9238795325112867, -0.3826834323650898, 0}, {0, 0, 
                 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{
                 Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {-
                  Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {0, 0, 
                 1}}, {{0.3826834323650898, 0.9238795325112867, 
                  0}, {-0.9238795325112867, 0.3826834323650898, 0}, {0, 0, 
                 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[
               GeometricTransformation3DBox[{
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {
                  0.3, -0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.3, -0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.3, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, 0.07, -0.5}, {0.3, 0.07, -0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.15, 0.07, -0.5}, {0.15,
                   0.07, 0.5}, {0.15, -0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, 0.5}, {0.3, -0.07, 0.5}, {0.3, 
                  0.07, 0.5}, {0.15, 0.07, 0.5}}], 
                 Polygon3DBox[{{0.15, -0.07, -0.5}, {0.3, -0.07, -0.5}, {0.3, 
                  0.07, -0.5}, {0.15, 0.07, -0.5}}]}, {{1, 0, 0}, {0, 1, 0}, {
                0, 0, 1}}], 
               NCache[{{
                 Cos[Rational[1, 8] Pi], Sin[Rational[1, 8] Pi], 0}, {-
                  Sin[Rational[1, 8] Pi], Cos[Rational[1, 8] Pi], 0}, {0, 0, 
                 1}}, {{
                 0.9238795325112867, 0.3826834323650898, 
                  0}, {-0.3826834323650898, 0.9238795325112867, 0}, {0, 0, 
                 1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}]}}, {{{1, 0, 0}, {0,
             1, 0}, {0, 0, 1}}, {0, 0, 0}}], 
          NCache[{0, 0, Rational[1, 2]}, {0, 0, 0.5}]], {{1, 0, 0}, {0, 1, 
         0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{0, 0, 1}, {0, 
       1, 0}, {-1, 0, 0}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {
     0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {0, 0, 
   0}]]], "Output",
 CellChangeTimes->{3.627038156765376*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Line3D", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Line3D", "[", 
   RowBox[{"length_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"AbsoluteThickness", "[", "3", "]"}], ",", 
    RowBox[{"TranslateShape", "[", 
     RowBox[{
      RowBox[{"RotateShape", "[", 
       RowBox[{
        RowBox[{"RotateShape", "[", 
         RowBox[{
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "length", ",", "0"}], "}"}]}], "}"}], "]"}], 
          ",", "0", ",", "phi", ",", "psi"}], "]"}], ",", "theta", ",", "0", 
        ",", "0"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}]}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938322194922833`*^9, 3.3938322208203745`*^9}, {
  3.394176588297348*^9, 3.3941765903755264`*^9}, {3.655132823911729*^9, 
  3.655132854832821*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Line3D", "[", 
   RowBox[{"1", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "0"}], "Degree"}], ",", 
      RowBox[{
       RowBox[{"-", "90"}], "Degree"}], ",", 
      RowBox[{
       RowBox[{"-", "15"}], "  ", "Degree"}]}], "}"}]}], "]"}], "//", 
  RowBox[{
   RowBox[{"Graphics3D", "[", 
    RowBox[{"#", ",", 
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}]}], 
    "]"}], "&"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3998088595203705`*^9, {3.399808908458497*^9, 3.399809024788111*^9}, {
   3.3998090616948338`*^9, 3.3998090757575135`*^9}, 3.3998092450878057`*^9, {
   3.3998093454953413`*^9, 3.399809359542396*^9}, {3.399809410152419*^9, 
   3.399809410371172*^9}, {3.3998094461528797`*^9, 3.3998094559030046`*^9}}],

Cell[BoxData[
 Graphics3DBox[
  {AbsoluteThickness[3], 
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[Line3DBox[{{0, 0, 0}, {0, 1, 0}}], {{1, 0, 
       0}, {0, 1, 0}, {0, 0, 1}}], 
      NCache[{{(Rational[1, 2] 2^Rational[-1, 2]) (1 + 3^Rational[1, 2]), (
          Rational[1, 2] 2^Rational[-1, 2]) (-1 + 3^Rational[1, 2]), 
         0}, {(Rational[-1, 2] 2^Rational[-1, 2]) (-1 + 3^Rational[1, 2]), (
          Rational[1, 2] 2^Rational[-1, 2]) (1 + 3^Rational[1, 2]), 0}, {0, 0,
         1}}, {{0.9659258262890682, 0.2588190451025207, 
         0}, {-0.2588190451025207, 0.9659258262890682, 0}, {0, 0, 1}}]], {{0, 
     0, -1}, {0, 1, 0}, {1, 0, 0}}], {0, 0, 0}]},
  Axes->True,
  AxesLabel->{
    FormBox["\"x\"", TraditionalForm], 
    FormBox["\"y\"", TraditionalForm], 
    FormBox["\"z\"", TraditionalForm]}]], "Output",
 CellChangeTimes->{3.6270381568433757`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Arc3D", "[", 
   RowBox[{"length_", ",", "bend_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"l", "=", 
      RowBox[{"length", "/", "bend"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"AbsoluteThickness", "[", "3", "]"}], ",", 
      RowBox[{"TranslateShape", "[", 
       RowBox[{
        RowBox[{"RotateShape", "[", 
         RowBox[{
          RowBox[{"Line", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"l", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Cos", "[", "i", "]"}], "-", "1"}], ")"}]}], ",", 
               RowBox[{"l", " ", 
                RowBox[{"Sin", "[", "i", "]"}]}], ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"0", "bend"}], ",", 
               RowBox[{"-", "bend"}], ",", 
               RowBox[{"-", 
                FractionBox["bend", "12"]}]}], "}"}]}], "]"}], "]"}], ",", 
          "theta", ",", "phi", ",", 
          RowBox[{"psi", "-", "bend", "+", "\[Pi]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938322194922833`*^9, 3.3938322208203745`*^9}, {
   3.3938442677979155`*^9, 3.393844349108334*^9}, {3.393844399982032*^9, 
   3.3938444174815836`*^9}, {3.393844816736987*^9, 3.39384489300066*^9}, {
   3.393844948702359*^9, 3.393844959170841*^9}, {3.393845005857146*^9, 
   3.393845013653821*^9}, 3.3938450493560324`*^9, {3.3938451332288847`*^9, 
   3.3938451352757072`*^9}, {3.3938452078675995`*^9, 
   3.3938452233515778`*^9}, {3.393845264631771*^9, 3.3938453075681715`*^9}, {
   3.393845392753491*^9, 3.3938454055969124`*^9}, {3.3938454436115637`*^9, 
   3.393845448408316*^9}, {3.393845491407215*^9, 3.3938456074511194`*^9}, {
   3.3938456511375012`*^9, 3.3938456752150097`*^9}, {3.393845707979796*^9, 
   3.3938457330729036`*^9}, {3.3938457633221292`*^9, 
   3.3938457853371906`*^9}, {3.393845820992528*^9, 3.393845826679882*^9}, {
   3.3938459308490906`*^9, 3.393845935880212*^9}, {3.3938459784103727`*^9, 
   3.3938460100970616`*^9}, {3.393846292542956*^9, 3.3938463481821566`*^9}, {
   3.3938463977902613`*^9, 3.3938463997277117`*^9}, {3.393848819118899*^9, 
   3.3938488192595205`*^9}, {3.393848998083067*^9, 3.3938490383476615`*^9}, {
   3.3938495888023195`*^9, 3.3938496042081747`*^9}, {3.3939198335221577`*^9, 
   3.393919833740902*^9}, {3.3939199057660017`*^9, 3.393919957365137*^9}, {
   3.393929737565095*^9, 3.393929755002372*^9}, {3.3939308825816884`*^9, 
   3.3939308904722123`*^9}, {3.3939309745180116`*^9, 
   3.3939309754398746`*^9}, {3.3939355141348996`*^9, 3.393935529241954*^9}, {
   3.3939355761878667`*^9, 3.3939355771408453`*^9}, {3.393935614369501*^9, 
   3.393935631257532*^9}, 3.393936369581608*^9, {3.393936419308344*^9, 
   3.3939364860324683`*^9}, {3.393937463241721*^9, 3.3939374696626096`*^9}, {
   3.394177557528973*^9, 3.3941777119417896`*^9}, {3.39417775889221*^9, 
   3.394177759220316*^9}, {3.3941781057190933`*^9, 3.3941781270150146`*^9}, {
   3.3941785320705442`*^9, 3.3941785502424192`*^9}, {3.394189679245186*^9, 
   3.394189703901278*^9}, 3.399810980250641*^9, {3.399876759991926*^9, 
   3.3998767691795435`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["BPM3D", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"BPM3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"TranslateShape", "[", 
    RowBox[{
     RowBox[{"RotateShape", "[", 
      RowBox[{
       RowBox[{"RotateShape", "[", 
        RowBox[{
         RowBox[{"TranslateShape", "[", 
          RowBox[{
           RowBox[{"AffineShape", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"quadbarrel", ",", "quadfaces", ",", "quadpoles"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"width", ",", "width", ",", "length"}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"length", "/", "2"}]}], "}"}]}], "]"}], ",", "0", ",", 
         RowBox[{"\[Pi]", "/", "2"}], ",", "0"}], "]"}], ",", "theta", ",", 
       "phi", ",", "psi"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393827958648239*^9, 3.393827962616887*^9}, 
   3.393831614835888*^9, 3.3938322298826427`*^9, {3.651473697122321*^9, 
   3.6514737004976587`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"BPM3D", "[", 
   RowBox[{"0.1", ",", "0.2", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393827897321684*^9, 3.393827934242614*^9}}],

Cell[BoxData[
 Graphics3DBox[$CellContext`TranslateShape[
   $CellContext`RotateShape[
    $CellContext`RotateShape[
     $CellContext`TranslateShape[
      $CellContext`AffineShape[{$CellContext`quadbarrel, \
$CellContext`quadfaces, $CellContext`quadpoles}, {0.2, 0.2, 0.1}], {
      0, 0, 0.05}], 0, Rational[1, 2] Pi, 0], 0, 0, 0], {0, 0, 0}]]], "Output",
 CellChangeTimes->{3.6270381569483757`*^9, 3.651473708719481*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["RF Cavity", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"rfcbarrel", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"AffineShape", "[", 
      RowBox[{
       RowBox[{"barrel", "[", "7", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"#", ",", "#", ",", "1"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{"0.3", ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393768742673499*^9, 3.3937687429234943`*^9}, {
   3.3938287622839155`*^9, 3.393828767877522*^9}, 3.3938306309704504`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rfcfaces", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"TranslateShape", "[", 
      RowBox[{
       RowBox[{"AffineShape", "[", 
        RowBox[{
         RowBox[{"faceplate", "[", "7", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.5", ",", "1"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393830617642667*^9, 3.393830633126645*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RFCavity3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"TranslateShape", " ", "[", 
   RowBox[{
    RowBox[{"RotateShape", "[", 
     RowBox[{
      RowBox[{"RotateShape", "[", 
       RowBox[{
        RowBox[{"TranslateShape", "[", 
         RowBox[{
          RowBox[{"AffineShape", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"rfcbarrel", ",", "rfcfaces"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"width", ",", "width", ",", "length"}], "}"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", 
            RowBox[{"length", "/", "2"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"\[Pi]", "/", "2"}], ",", 
        RowBox[{"\[Pi]", "/", "2"}], ",", "0"}], "]"}], ",", "theta", ",", 
      "phi", ",", "psi"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3938316205544915`*^9, 3.393832234788767*^9, {3.6270473744483757`*^9, 
   3.627047380373376*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"RFCavity3D", "[", 
   RowBox[{"0.5", ",", "0.2", ",", 
    RowBox[{"{", 
     RowBox[{"0.5", ",", "1", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393827897321684*^9, 3.393827934242614*^9}, 
   3.3938280073657417`*^9, {3.627047300460376*^9, 3.627047359784376*^9}}],

Cell[BoxData[
 Graphics3DBox[
  GeometricTransformation3DBox[
   GeometricTransformation3DBox[
    GeometricTransformation3DBox[
     GeometricTransformation3DBox[
      GeometricTransformation3DBox[
       GeometricTransformation3DBox[
        GeometricTransformation3DBox[
         GeometricTransformation3DBox[
          GeometricTransformation3DBox[{{
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 0}, {
                   Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.9749279121818236, -0.2225209339563144, 0}, {
                   0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 0}, {
                   Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0, 
                   1}}, {{0.9009688679024191, -0.4338837391175581, 0}, {
                   0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 0}, {
                   Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.7818314824680298, -0.6234898018587335, 0}, {
                   0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 0}, {
                   Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.6234898018587335, -0.7818314824680298, 0}, {
                   0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 0}, {
                   Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0, 
                   1}}, {{0.4338837391175581, -0.9009688679024191, 0}, {
                   0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 0}, {
                   Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.2225209339563144, -0.9749279121818236, 0}, {
                   0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.2225209339563144, -0.9749279121818236, 0}, {
                   0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.4338837391175581, -0.9009688679024191, 0}, {
                   0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {
                   Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{-0.6234898018587335, -0.7818314824680298, 0}, {
                   0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.7818314824680298, -0.6234898018587335, 0}, {
                   0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9009688679024191, -0.4338837391175581, 0}, {
                   0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[
                    Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9749279121818236, -0.2225209339563144, 0}, {
                   0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 
                    0}, {-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 
                    0}, {-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 
                    0}, {-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 
                    0}, {-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 
                    0}, {-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 
                    0}, {-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {-
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {-
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0,
                    1}}, {{
                   0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {-
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {-
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {-
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0,
                    1}}, {{
                   0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {-
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.3, 0., 0.}, {0., 0.3, 
               0.}, {0., 0., 1.}}, {0., 0., 0.}}], 
             GeometricTransformation3DBox[{
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 0}, {
                   Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.9749279121818236, -0.2225209339563144, 0}, {
                   0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 0}, {
                   Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0, 
                   1}}, {{0.9009688679024191, -0.4338837391175581, 0}, {
                   0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 0}, {
                   Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.7818314824680298, -0.6234898018587335, 0}, {
                   0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 0}, {
                   Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.6234898018587335, -0.7818314824680298, 0}, {
                   0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 0}, {
                   Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0, 
                   1}}, {{0.4338837391175581, -0.9009688679024191, 0}, {
                   0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 0}, {
                   Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{0.2225209339563144, -0.9749279121818236, 0}, {
                   0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.2225209339563144, -0.9749279121818236, 0}, {
                   0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.4338837391175581, -0.9009688679024191, 0}, {
                   0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.6234898018587335, -0.7818314824680298, 0}, {
                   0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.7818314824680298, -0.6234898018587335, 0}, {
                   0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9009688679024191, -0.4338837391175581, 0}, {
                   0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9749279121818236, -0.2225209339563144, 0}, {
                   0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 
                    0}, {-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 
                    0}, {-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 
                    0}, {-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 
                    0}, {-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 
                    0}, {-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{-Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 
                    0}, {-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                   1}}, {{-0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1, 
                0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {-
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {-
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0,
                    1}}, {{
                   0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {-
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {-
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {-
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0,
                    1}}, {{
                   0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], 
                 NCache[{{
                   Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {-
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                   0, 1}}, {{
                   0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                   1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
               GeometricTransformation3DBox[
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  Polygon3DBox[
                   NCache[{{-Tan[Rational[1, 28] Pi], -1, -0.5}, {-
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] Pi], -1, 0.5}, {
                    Tan[Rational[1, 28] 
                    Pi], -1, -0.5}}, {{-0.11267293990011104`, -1, -0.5}, \
{-0.11267293990011104`, -1, 0.5}, {0.11267293990011104`, -1, 0.5}, {
                    0.11267293990011104`, -1, -0.5}}]], {{1, 0, 0}, {0, 1, 
                  0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0,
                 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 
               0.}, {0., 0., 1.}}, {0., 0., 0.}}]}, {
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 
                 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 0}, {
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.9749279121818236, -0.2225209339563144, 0}, {
                    0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 0}, {
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{0.9009688679024191, -0.4338837391175581, 0}, {
                    0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 0}, {
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.7818314824680298, -0.6234898018587335, 0}, {
                    0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 0}, {
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.6234898018587335, -0.7818314824680298, 0}, {
                    0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 0}, {
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{0.4338837391175581, -0.9009688679024191, 0}, {
                    0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 0}, {
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.2225209339563144, -0.9749279121818236, 0}, {
                    0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1,
                  0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi],
                     0}, {Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.2225209339563144, -0.9749279121818236, 0}, {
                    0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.4338837391175581, -0.9009688679024191, 0}, {
                    0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi],
                     0}, {Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.6234898018587335, -0.7818314824680298, 0}, {
                    0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi],
                     0}, {Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.7818314824680298, -0.6234898018587335, 0}, {
                    0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9009688679024191, -0.4338837391175581, 0}, {
                    0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi],
                     0}, {Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9749279121818236, -0.2225209339563144, 0}, {
                    0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 
                    0}, {-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 
                    0}, {-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 
                    0}, {-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 
                    0}, {-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 
                    0}, {-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 
                    0}, {-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1,
                  0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {-
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {-
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{
                    0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {-
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {-
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {-
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{
                    0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {-
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 
                 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 
                0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, -0.5}], 
             GeometricTransformation3DBox[
              GeometricTransformation3DBox[{
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 
                 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 0}, {
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.9749279121818236, -0.2225209339563144, 0}, {
                    0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 0}, {
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{0.9009688679024191, -0.4338837391175581, 0}, {
                    0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 0}, {
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.7818314824680298, -0.6234898018587335, 0}, {
                    0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 0}, {
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.6234898018587335, -0.7818314824680298, 0}, {
                    0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 0}, {
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{0.4338837391175581, -0.9009688679024191, 0}, {
                    0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 0}, {
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{0.2225209339563144, -0.9749279121818236, 0}, {
                    0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{0, -1, 0}, {1, 0, 0}, {0, 0, 1}}], {{1,
                  0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi],
                     0}, {Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.2225209339563144, -0.9749279121818236, 0}, {
                    0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.4338837391175581, -0.9009688679024191, 0}, {
                    0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi],
                     0}, {Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.6234898018587335, -0.7818314824680298, 0}, {
                    0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi],
                     0}, {Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.7818314824680298, -0.6234898018587335, 0}, {
                    0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9009688679024191, -0.4338837391175581, 0}, {
                    0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi],
                     0}, {Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9749279121818236, -0.2225209339563144, 0}, {
                    0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{-1, 0, 0}, {0, -1, 0}, {0, 0, 1}}], {{
                 1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 
                    0}, {-Sin[Rational[1, 14] Pi], -Cos[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, -0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 
                    0}, {-Sin[Rational[1, 7] Pi], -Cos[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, -0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 
                    0}, {-Sin[Rational[3, 14] Pi], -Cos[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, -0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 
                    0}, {-Cos[Rational[3, 14] Pi], -Sin[Rational[3, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, -0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 
                    0}, {-Cos[Rational[1, 7] Pi], -Sin[Rational[1, 7] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, -0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{-Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 
                    0}, {-Cos[Rational[1, 14] Pi], -Sin[Rational[1, 14] Pi], 
                    0}, {0, 0, 
                    1}}, {{-0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, -0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{0, 1, 0}, {-1, 0, 0}, {0, 0, 1}}], {{1,
                  0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {-
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.2225209339563144, 0.9749279121818236, 
                    0}, {-0.9749279121818236, 0.2225209339563144, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {-
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{
                    0.4338837391175581, 0.9009688679024191, 
                    0}, {-0.9009688679024191, 0.4338837391175581, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {-
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.6234898018587335, 0.7818314824680298, 
                    0}, {-0.7818314824680298, 0.6234898018587335, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[3, 14] Pi], Sin[Rational[3, 14] Pi], 0}, {-
                    Sin[Rational[3, 14] Pi], Cos[Rational[3, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.7818314824680298, 0.6234898018587335, 
                    0}, {-0.6234898018587335, 0.7818314824680298, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 7] Pi], Sin[Rational[1, 7] Pi], 0}, {-
                    Sin[Rational[1, 7] Pi], Cos[Rational[1, 7] Pi], 0}, {0, 0,
                     1}}, {{
                    0.9009688679024191, 0.4338837391175581, 
                    0}, {-0.4338837391175581, 0.9009688679024191, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], 
                  NCache[{{
                    Cos[Rational[1, 14] Pi], Sin[Rational[1, 14] Pi], 0}, {-
                    Sin[Rational[1, 14] Pi], Cos[Rational[1, 14] Pi], 0}, {0, 
                    0, 1}}, {{
                    0.9749279121818236, 0.2225209339563144, 
                    0}, {-0.2225209339563144, 0.9749279121818236, 0}, {0, 0, 
                    1}}]], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], 
                GeometricTransformation3DBox[
                 GeometricTransformation3DBox[
                  GeometricTransformation3DBox[
                   Polygon3DBox[
                    NCache[{{-Tan[Rational[1, 28] Pi], -1, 0}, {
                    Tan[Rational[1, 28] Pi], -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 
                    0}}, {{-0.11267293990011104`, -1, 0}, {
                    0.11267293990011104`, -1, 0}, {
                    0.06760376394006662, -0.6, 
                    0}, {-0.06760376394006662, -0.6, 0}}]], {{1, 0, 0}, {0, 1,
                    0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 
                 0, 0}, {0, 1, 0}, {0, 0, 1}}]}, {{{0.5, 0., 0.}, {0., 0.5, 
                0.}, {0., 0., 1.}}, {0., 0., 0.}}], {0, 0, 0.5}]}}, {{{0.2, 
            0., 0.}, {0., 0.2, 0.}, {0., 0., 0.5}}, {0., 0., 0.}}], {
          0, 0, 0.25}], {{1, 0, 0}, {0, 0, -1}, {0, 1, 0}}], {{1, 0, 0}, {0, 
        1, 0}, {0, 0, 1}}], {{0, 0, 1}, {0, 1, 0}, {-1, 0, 0}}], {{1, 0, 0}, {
      0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}], {{1, 0, 0}, {
    0, 1, 0}, {0, 0, 1}}], {1, 0.5, 0}]]], "Output",
 CellChangeTimes->{
  3.6270381571953754`*^9, 3.627047133084376*^9, 3.627047251525376*^9, {
   3.6270473011933756`*^9, 3.627047381485376*^9}, 3.6270474318653755`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["GWiggler", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6798983112689266`*^9, 3.6798983124769263`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Dipole3D", "[", 
   RowBox[{"length_", ",", "width_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta_:", "0"}], ",", 
      RowBox[{"phi_:", "0"}], ",", 
      RowBox[{"psi_:", "0"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"TranslateShape", "[", 
   RowBox[{
    RowBox[{"RotateShape", "[", 
     RowBox[{
      RowBox[{"RotateShape", "[", 
       RowBox[{
        RowBox[{"RotateShape", "[", 
         RowBox[{
          RowBox[{"TranslateShape", "[", 
           RowBox[{
            RowBox[{"AffineShape", "[", 
             RowBox[{"dipoleblocks", ",", 
              RowBox[{"{", 
               RowBox[{
                FractionBox["width", "2"], ",", 
                FractionBox["width", "2"], ",", "length"}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               FractionBox["width", "10"]}], ",", "0", ",", 
              FractionBox["length", "2"]}], "}"}]}], "]"}], ",", 
          FractionBox["\[Pi]", "2"], ",", "\[Pi]", ",", "0"}], "]"}], ",", 
        "0", ",", "phi", ",", "psi"}], "]"}], ",", 
      RowBox[{"-", "theta"}], ",", "0", ",", "0"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", "x", ",", "z"}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393830982664572*^9, 3.393831121364146*^9}, {
   3.393831181440733*^9, 3.393831191799843*^9}, {3.3938312232990365`*^9, 
   3.3938312976408834`*^9}, {3.3938313531394625`*^9, 3.393831404856889*^9}, 
   3.393831496323297*^9, {3.3938321716028843`*^9, 3.3938321926492205`*^9}, {
   3.393832339270467*^9, 3.393832345051569*^9}, {3.39384138464021*^9, 
   3.393841421689456*^9}, {3.3938456875271945`*^9, 3.3938456877615633`*^9}, {
   3.3938488328529224`*^9, 3.393848898398119*^9}, {3.393849191374994*^9, 
   3.3938492077027006`*^9}, {3.393849274841607*^9, 3.393849281841428*^9}, {
   3.3938493175436387`*^9, 3.3938493498396873`*^9}, {3.3938494213847303`*^9, 
   3.3938495583968477`*^9}, {3.3939190133323555`*^9, 3.393919019909428*^9}, {
   3.3939190579502153`*^9, 3.393919060996603*^9}, {3.39417367109426*^9, 
   3.3941737400335245`*^9}, {3.394173835425269*^9, 3.394173857894163*^9}, {
   3.3941783816330442`*^9, 3.3941784713517942`*^9}, {3.3997995846672792`*^9, 
   3.3997997749978404`*^9}, {3.6304127187162433`*^9, 3.630412735947243*^9}, {
   3.630412899408243*^9, 3.630412901723243*^9}, {3.630412990955243*^9, 
   3.630412996415243*^9}, 3.630413067598243*^9, 3.655132581903531*^9, {
   3.655132716885028*^9, 3.6551327335726967`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADDraw3D Program", "Subsubsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "element", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.399811052501566*^9, 3.3998110549703474`*^9}, 
   3.5587782031414456`*^9, {3.5587788448733187`*^9, 3.5587788448889446`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<sextupole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", 
     RowBox[{"Sextupole3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.35"}], ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", "0"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "rotation"}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.3938317657226505`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<bpm\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Purple", ",", 
     RowBox[{"BPM3D", "[", 
      RowBox[{"0", ",", 
       RowBox[{"widthscale", "*", "0.4"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"\[Pi]", "/", "4"}], ",", 
         RowBox[{"rotation", "+", 
          FractionBox["\[Pi]", "2"]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393831764503931*^9, 3.5587788211222553`*^9, {3.5587789507843137`*^9, 
   3.558778967425684*^9}, {3.5587790380538483`*^9, 3.5587790497887487`*^9}, {
   3.558779424602415*^9, 3.558779432040248*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<bpm\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Purple", ",", 
     RowBox[{"BPM3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.3"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "rotationh"}], "+", 
          RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393831745426295*^9, {3.393832292287295*^9, 3.3938322932716446`*^9}, 
   3.3941922764712567`*^9, {3.5587790139277673`*^9, 3.5587790296003447`*^9}, {
   3.558779133948769*^9, 3.558779210249062*^9}, {3.5587887272499704`*^9, 
   3.5587887872403913`*^9}, 3.5587888792061987`*^9, {3.558788973500056*^9, 
   3.558788980499832*^9}, 3.558789100559444*^9, {3.627038895616376*^9, 
   3.627038907880376*^9}, {3.6514737298985987`*^9, 3.651473751659775*^9}, 
   3.6514737925328617`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<marker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"BPM3D", "[", 
      RowBox[{"0", ",", 
       RowBox[{"widthscale", "*", "0.4"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"\[Pi]", "/", "4"}], ",", 
         RowBox[{"rotation", "+", 
          FractionBox["\[Pi]", "2"]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938317592696905`*^9, 3.3938317605509076`*^9}, 
   3.5587789836295347`*^9, {3.5587790481480503`*^9, 3.558779048991838*^9}, 
   3.5587794433063774`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<marker\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"BPM3D", "[", 
      RowBox[{"0", ",", 
       RowBox[{"widthscale", "*", "0.4"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", 
         RowBox[{"\[Pi]", "/", "4"}], ",", 
         RowBox[{"rotationh", "+", 
          FractionBox["\[Pi]", "2"]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938317592696905`*^9, 3.3938317605509076`*^9}, 
   3.5587789836295347`*^9, {3.5587790481480503`*^9, 3.558779048991838*^9}, 
   3.5587794433063774`*^9, {3.6270389780283756`*^9, 3.627038984970376*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<hkicker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Gray", ",", 
     RowBox[{"Dipole3D", "[", 
      RowBox[{
       RowBox[{"-", "length"}], ",", 
       RowBox[{"widthscale", "*", "0.35"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"\[Pi]", "+", "rotation"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.39383175556666*^9, 3.6270474744173756`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<vkicker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Gray", ",", 
     RowBox[{"Dipole3D", "[", 
      RowBox[{
       RowBox[{"-", "length"}], ",", 
       RowBox[{"widthscale", "*", "0.35"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"\[Pi]", "+", "rotation"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.3938317546135597`*^9, 3.627047473385376*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<kicker\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Gray", ",", 
     RowBox[{"Dipole3D", "[", 
      RowBox[{
       RowBox[{"-", "length"}], ",", 
       RowBox[{"widthscale", "*", "0.35"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"\[Pi]", "+", "rotation"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393831748894956*^9, 3.393831751004277*^9}, 
   3.627047472505376*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<kicker\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", 
     RowBox[{"Specularity", "[", "Blue", "]"}], ",", 
     RowBox[{"Dipole3D", "[", 
      RowBox[{"length", ",", " ", 
       FractionBox["widthscale", "2.5"], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            FractionBox["1", "2"], "bendv"}], "-", "rotationv"}], ")"}], " ", 
         ",", "0", ",", 
         RowBox[{"\[Pi]", "-", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox["1", "2"], "bendh"}], "+", "rotationh"}], ")"}]}]}], 
        "}"}]}], "]"}], ",", "Black", ",", "\[IndentingNewLine]", 
     RowBox[{"Line3D", "[", 
      RowBox[{"length", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", 
         RowBox[{"-", "rotationh"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938314675427837`*^9, 3.393831482214283*^9}, 
   3.3938315684776998`*^9, {3.3938316889902396`*^9, 3.3938316993805985`*^9}, {
   3.3938323181303835`*^9, 3.3938323195209723`*^9}, {3.393841257616456*^9, 
   3.393841264757538*^9}, {3.3938447163489323`*^9, 3.393844735895307*^9}, {
   3.3938447838784533`*^9, 3.393844784878428*^9}, {3.3938453347862253`*^9, 
   3.3938453378798957`*^9}, {3.3938453839568415`*^9, 3.393845387909865*^9}, {
   3.3938455246094904`*^9, 3.3938455253125973`*^9}, {3.393848937975231*^9, 
   3.3938489558185244`*^9}, {3.39391986036522*^9, 3.393919860474592*^9}, {
   3.3939309337841578`*^9, 3.3939309346747713`*^9}, {3.3941766321422205`*^9, 
   3.394176640486184*^9}, {3.394177315050701*^9, 3.394177386934885*^9}, {
   3.3941775125642524`*^9, 3.3941775373432817`*^9}, 3.3941777382527742`*^9, {
   3.394178283211913*^9, 3.3941782887585754`*^9}, 3.399790539801506*^9, 
   3.3997906368652487`*^9, {3.399793171225813*^9, 3.399793233851615*^9}, {
   3.3997932650238886`*^9, 3.399793308165066*^9}, {3.399793415447689*^9, 
   3.399793460417015*^9}, {3.399793895047578*^9, 3.3997939228291836`*^9}, {
   3.3997939889394045`*^9, 3.399793998783281*^9}, {3.399794099159566*^9, 
   3.3997943221155443`*^9}, {3.399794385116351*^9, 3.3997945418214817`*^9}, {
   3.3997945730562563`*^9, 3.3997947923559384`*^9}, {3.399794855841126*^9, 
   3.399795250846182*^9}, {3.399798997691016*^9, 3.399799049472929*^9}, {
   3.399799122067608*^9, 3.3997991881778293`*^9}, {3.399799221365754*^9, 
   3.399799226662697*^9}, {3.3997992673975935`*^9, 3.399799276038329*^9}, {
   3.399799311773161*^9, 3.3997994724314675`*^9}, {3.399799801670057*^9, 
   3.399799866155257*^9}, {3.399799966922172*^9, 3.399800006688306*^9}, {
   3.39980004254814*^9, 3.3998000498451085`*^9}, {3.3998013544711823`*^9, 
   3.3998014244408283`*^9}, 3.399801482644698*^9, {3.3998015225827093`*^9, 
   3.399801529817177*^9}, 3.3998015956461444`*^9, {3.399806702336509*^9, 
   3.3998067068834424`*^9}, {3.399810895499556*^9, 3.3998109024996457`*^9}, {
   3.399811018454255*^9, 3.39981102159492*^9}, {3.399874280569565*^9, 
   3.399874283335225*^9}, 3.3998747036531053`*^9, {3.399874749575568*^9, 
   3.399874750013074*^9}, {3.3998749434061737`*^9, 3.399874971594035*^9}, 
   3.3998752574883194`*^9, {3.399875328567354*^9, 3.3998753976932387`*^9}, {
   3.3998769385567117`*^9, 3.399876963197652*^9}, {3.3998817267429996`*^9, 
   3.3998817610246887`*^9}, {3.3998861351588016`*^9, 
   3.3998861391276026`*^9}, {3.399886184409432*^9, 3.399886187753225*^9}, 
   3.3998862645354576`*^9, {3.399886620821268*^9, 3.3998866310245237`*^9}, {
   3.3998866823376803`*^9, 3.399886741619689*^9}, 3.3998867936359797`*^9, {
   3.399900172947858*^9, 3.3999002684022045`*^9}, {3.399900303012023*^9, 
   3.3999003104027424`*^9}, {3.399900436169977*^9, 3.399900456326485*^9}, {
   3.399900944270231*^9, 3.3999009918958406`*^9}, {3.399901122413136*^9, 
   3.3999012365395966`*^9}, {3.558779092400033*^9, 3.5587791157292027`*^9}, {
   3.5587792880494223`*^9, 3.5587793020813007`*^9}, {3.5587878412919655`*^9, 
   3.5587878423076363`*^9}, {3.558789676324418*^9, 3.5587896788557653`*^9}, {
   3.558789810845208*^9, 3.558789817376709*^9}, {3.558789904301922*^9, 
   3.5587899532413015`*^9}, {3.5587900120718946`*^9, 3.558790012259403*^9}, 
   3.558790042838898*^9, {3.558790515735083*^9, 3.5587905187820945`*^9}, {
   3.55879114716962*^9, 3.558791155763755*^9}, {3.558791325990131*^9, 
   3.5587913264120245`*^9}, {3.6270385626783757`*^9, 3.627038610197376*^9}, {
   3.6270387581083755`*^9, 3.627038766091376*^9}, {3.627039059008376*^9, 
   3.627039063399376*^9}, 3.6270391426193757`*^9, 3.627039295897376*^9, 
   3.6304131192012434`*^9, {3.6304147211832433`*^9, 3.630414734573243*^9}, {
   3.6514740167892847`*^9, 3.6514740230369096`*^9}, 3.6514740811837234`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<quadrupole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",",
      "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"Quadrupole3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.5"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "rotation"}], "+", 
          RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393831745426295*^9, {3.393832292287295*^9, 3.3938322932716446`*^9}, 
   3.3941922764712567`*^9, {3.5587790139277673`*^9, 3.5587790296003447`*^9}, {
   3.558779133948769*^9, 3.558779210249062*^9}, {3.5587887272499704`*^9, 
   3.5587887872403913`*^9}, 3.5587888792061987`*^9, {3.558788973500056*^9, 
   3.558788980499832*^9}, 3.558789100559444*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<quadrupole\>\"", ",", "position_", ",", "length_", ",", "bendh_", 
     ",", "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"Quadrupole3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.5"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "rotationh"}], "+", 
          RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393831745426295*^9, {3.393832292287295*^9, 3.3938322932716446`*^9}, 
   3.3941922764712567`*^9, {3.5587790139277673`*^9, 3.5587790296003447`*^9}, {
   3.558779133948769*^9, 3.558779210249062*^9}, {3.5587887272499704`*^9, 
   3.5587887872403913`*^9}, 3.5587888792061987`*^9, {3.558788973500056*^9, 
   3.558788980499832*^9}, 3.558789100559444*^9, {3.627038895616376*^9, 
   3.627038907880376*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<sextupole\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", 
     RowBox[{"Sextupole3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.5"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "rotation"}], "+", 
          RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393831745426295*^9, {3.393832292287295*^9, 3.3938322932716446`*^9}, 
   3.3941922764712567`*^9, {3.5587790139277673`*^9, 3.5587790296003447`*^9}, {
   3.558779133948769*^9, 3.558779210249062*^9}, {3.5587887272499704`*^9, 
   3.5587887872403913`*^9}, 3.5587888792061987`*^9, {3.558788973500056*^9, 
   3.558788980499832*^9}, 3.558789100559444*^9, {3.587195212700261*^9, 
   3.587195215341261*^9}, {3.587195248391261*^9, 3.587195248886261*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<sextupole\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",",
      "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", 
     RowBox[{"Sextupole3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.5"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "rotationh"}], "+", 
          RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.393831745426295*^9, {3.393832292287295*^9, 3.3938322932716446`*^9}, 
   3.3941922764712567`*^9, {3.5587790139277673`*^9, 3.5587790296003447`*^9}, {
   3.558779133948769*^9, 3.558779210249062*^9}, {3.5587887272499704`*^9, 
   3.5587887872403913`*^9}, 3.5587888792061987`*^9, {3.558788973500056*^9, 
   3.558788980499832*^9}, 3.558789100559444*^9, {3.587195212700261*^9, 
   3.587195215341261*^9}, {3.587195248391261*^9, 3.587195248886261*^9}, {
   3.6270389281343756`*^9, 3.6270389340303755`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<rfc\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"RFCavity3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.8"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "rotation"}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.3938317438169613`*^9, 3.627047484144376*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<rfc\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"RFCavity3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.2"}], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "rotationh"}], "+", "\[Pi]"}]}], "}"}]}], "]"}]}], 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.3938317438169613`*^9, {3.6270470954023757`*^9, 3.6270471022733755`*^9}, 
   3.6270473891673756`*^9, 3.627047485136376*^9, {3.662277949873469*^9, 
   3.6622780108275633`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<lcav\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"RFCavity3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.8"}], ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", "0"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "rotation"}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938317360202856`*^9, 3.3938317398326883`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<lcav\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"RFCavity3D", "[", 
      RowBox[{"length", ",", 
       RowBox[{"widthscale", "*", "0.8"}], ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"position", ",", "0"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", "rotationh"}], "}"}]}], "]"}]}], 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938317360202856`*^9, 3.3938317398326883`*^9}, {
  3.627047171269376*^9, 3.6270471771653757`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<drift\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Black", ",", 
     RowBox[{"Line3D", "[", 
      RowBox[{"length", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"-", "rotation"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938317306766725`*^9, 3.3938317340984597`*^9}, {
   3.3938322986621313`*^9, 3.393832300802702*^9}, {3.393832534702964*^9, 
   3.3938325456089344`*^9}, {3.393841158634066*^9, 3.3938411784616833`*^9}, 
   3.393841231397828*^9, {3.393841261866728*^9, 3.3938412622105*^9}, {
   3.3941764310182066`*^9, 3.3941764450821466`*^9}, 3.3997935679027653`*^9, {
   3.3997998845148673`*^9, 3.3997999360155263`*^9}, {3.3998003660054054`*^9, 
   3.399800369880455*^9}, {3.3998006694936647`*^9, 3.3998006699155455`*^9}, 
   3.3998007096035533`*^9, {3.399801102342955*^9, 3.3998011218744555`*^9}, {
   3.3998011898753257`*^9, 3.3998012032192464`*^9}, {3.399801616162032*^9, 
   3.3998016754284153`*^9}, {3.399806710070983*^9, 3.3998067121491346`*^9}, {
   3.3998087785505843`*^9, 3.399808798863344*^9}, {3.3998094945284986`*^9, 
   3.399809518544431*^9}, {3.3998095627324967`*^9, 3.3998095945922794`*^9}, {
   3.3998743140699935`*^9, 3.3998743235232396`*^9}, {3.39987471965331*^9, 
   3.399874747763045*^9}, {3.3998752314411106`*^9, 3.399875238394325*^9}, {
   3.399876493551016*^9, 3.3998764943166504`*^9}, {3.399876620177636*^9, 
   3.399876620333888*^9}, {3.399876798679921*^9, 3.3998767996174335`*^9}, {
   3.399876921650245*^9, 3.399876960619494*^9}, {3.3998770069325867`*^9, 
   3.399877007323217*^9}, {3.3998864498815804`*^9, 3.3998864564754143`*^9}, 
   3.399886585805195*^9, {3.399886770432558*^9, 3.399886775151368*^9}, {
   3.399886812948727*^9, 3.399886813698737*^9}, {3.3999003211997557`*^9, 
   3.3999004048102007`*^9}, {3.3999004626234407`*^9, 3.399900540843192*^9}, {
   3.3999005736404867`*^9, 3.3999005936094923`*^9}, {3.5587784225731506`*^9, 
   3.558778433901783*^9}, 3.558779409023592*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<drift\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Black", ",", 
     RowBox[{"Arc3D", "[", 
      RowBox[{"length", ",", "0.00001", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "rotationv"}], ",", "0", ",", 
         RowBox[{"-", "rotationh"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938317306766725`*^9, 3.3938317340984597`*^9}, {
   3.3938322986621313`*^9, 3.393832300802702*^9}, {3.393832534702964*^9, 
   3.3938325456089344`*^9}, {3.393841158634066*^9, 3.3938411784616833`*^9}, 
   3.393841231397828*^9, {3.393841261866728*^9, 3.3938412622105*^9}, {
   3.3941764310182066`*^9, 3.3941764450821466`*^9}, 3.3997935679027653`*^9, {
   3.3997998845148673`*^9, 3.3997999360155263`*^9}, {3.3998003660054054`*^9, 
   3.399800369880455*^9}, {3.3998006694936647`*^9, 3.3998006699155455`*^9}, 
   3.3998007096035533`*^9, {3.399801102342955*^9, 3.3998011218744555`*^9}, {
   3.3998011898753257`*^9, 3.3998012032192464`*^9}, {3.399801616162032*^9, 
   3.3998016754284153`*^9}, {3.399806710070983*^9, 3.3998067121491346`*^9}, {
   3.3998087785505843`*^9, 3.399808798863344*^9}, {3.3998094945284986`*^9, 
   3.399809518544431*^9}, {3.3998095627324967`*^9, 3.3998095945922794`*^9}, {
   3.3998743140699935`*^9, 3.3998743235232396`*^9}, {3.39987471965331*^9, 
   3.399874747763045*^9}, {3.3998752314411106`*^9, 3.399875238394325*^9}, {
   3.399876493551016*^9, 3.3998764943166504`*^9}, {3.399876620177636*^9, 
   3.399876620333888*^9}, {3.399876798679921*^9, 3.3998767996174335`*^9}, {
   3.399876921650245*^9, 3.399876960619494*^9}, {3.3998770069325867`*^9, 
   3.399877007323217*^9}, {3.3998864498815804`*^9, 3.3998864564754143`*^9}, 
   3.399886585805195*^9, {3.399886770432558*^9, 3.399886775151368*^9}, {
   3.399886812948727*^9, 3.399886813698737*^9}, {3.3999003211997557`*^9, 
   3.3999004048102007`*^9}, {3.3999004626234407`*^9, 3.399900540843192*^9}, {
   3.3999005736404867`*^9, 3.3999005936094923`*^9}, {3.558779392960372*^9, 
   3.5587793937416573`*^9}, {3.6270387092663755`*^9, 3.627038741562376*^9}, {
   3.627039133809376*^9, 3.627039180228376*^9}, {3.6270392138363757`*^9, 
   3.6270392158513756`*^9}, {3.627047553116376*^9, 3.6270475532593756`*^9}, {
   3.6551328007354116`*^9, 3.655132810599398*^9}, {3.6551329367405877`*^9, 
   3.6551329694045725`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<symmline\>\"", ",", "position_", ",", "length_", ",", "bend_", ",", 
     "rotation_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"White", ",", 
     RowBox[{"Line3D", "[", 
      RowBox[{"length", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "rotation"}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393831726817396*^9, 3.3938317285204773`*^9}, 
   3.5587891252160096`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<symmline\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"White", ",", 
     RowBox[{"Line3D", "[", 
      RowBox[{"length", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", "rotationh"}], "}"}]}], "]"}]}], 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.393831726817396*^9, 3.3938317285204773`*^9}, 
   3.5587891252160096`*^9, {3.627039015161376*^9, 3.627039021753376*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<dipole\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", 
     RowBox[{"Specularity", "[", "Blue", "]"}], ",", 
     RowBox[{"Dipole3D", "[", 
      RowBox[{"length", ",", " ", 
       FractionBox["widthscale", "1.5"], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            FractionBox["1", "2"], "bendv"}], "-", "rotationv"}], ")"}], " ", 
         ",", "0", ",", 
         RowBox[{"\[Pi]", "-", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox["1", "2"], "bendh"}], "+", "rotationh"}], ")"}]}]}], 
        "}"}]}], "]"}], ",", "Black", ",", "\[IndentingNewLine]", 
     RowBox[{"Arc3D", "[", 
      RowBox[{"length", ",", "bendh", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bendv", "-", "rotationv"}], ")"}], ",", "0", ",", 
         RowBox[{"(", 
          RowBox[{"bendh", "-", "rotationh"}], ")"}]}], "}"}]}], "]"}]}], 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938314675427837`*^9, 3.393831482214283*^9}, 
   3.3938315684776998`*^9, {3.3938316889902396`*^9, 3.3938316993805985`*^9}, {
   3.3938323181303835`*^9, 3.3938323195209723`*^9}, {3.393841257616456*^9, 
   3.393841264757538*^9}, {3.3938447163489323`*^9, 3.393844735895307*^9}, {
   3.3938447838784533`*^9, 3.393844784878428*^9}, {3.3938453347862253`*^9, 
   3.3938453378798957`*^9}, {3.3938453839568415`*^9, 3.393845387909865*^9}, {
   3.3938455246094904`*^9, 3.3938455253125973`*^9}, {3.393848937975231*^9, 
   3.3938489558185244`*^9}, {3.39391986036522*^9, 3.393919860474592*^9}, {
   3.3939309337841578`*^9, 3.3939309346747713`*^9}, {3.3941766321422205`*^9, 
   3.394176640486184*^9}, {3.394177315050701*^9, 3.394177386934885*^9}, {
   3.3941775125642524`*^9, 3.3941775373432817`*^9}, 3.3941777382527742`*^9, {
   3.394178283211913*^9, 3.3941782887585754`*^9}, 3.399790539801506*^9, 
   3.3997906368652487`*^9, {3.399793171225813*^9, 3.399793233851615*^9}, {
   3.3997932650238886`*^9, 3.399793308165066*^9}, {3.399793415447689*^9, 
   3.399793460417015*^9}, {3.399793895047578*^9, 3.3997939228291836`*^9}, {
   3.3997939889394045`*^9, 3.399793998783281*^9}, {3.399794099159566*^9, 
   3.3997943221155443`*^9}, {3.399794385116351*^9, 3.3997945418214817`*^9}, {
   3.3997945730562563`*^9, 3.3997947923559384`*^9}, {3.399794855841126*^9, 
   3.399795250846182*^9}, {3.399798997691016*^9, 3.399799049472929*^9}, {
   3.399799122067608*^9, 3.3997991881778293`*^9}, {3.399799221365754*^9, 
   3.399799226662697*^9}, {3.3997992673975935`*^9, 3.399799276038329*^9}, {
   3.399799311773161*^9, 3.3997994724314675`*^9}, {3.399799801670057*^9, 
   3.399799866155257*^9}, {3.399799966922172*^9, 3.399800006688306*^9}, {
   3.39980004254814*^9, 3.3998000498451085`*^9}, {3.3998013544711823`*^9, 
   3.3998014244408283`*^9}, 3.399801482644698*^9, {3.3998015225827093`*^9, 
   3.399801529817177*^9}, 3.3998015956461444`*^9, {3.399806702336509*^9, 
   3.3998067068834424`*^9}, {3.399810895499556*^9, 3.3998109024996457`*^9}, {
   3.399811018454255*^9, 3.39981102159492*^9}, {3.399874280569565*^9, 
   3.399874283335225*^9}, 3.3998747036531053`*^9, {3.399874749575568*^9, 
   3.399874750013074*^9}, {3.3998749434061737`*^9, 3.399874971594035*^9}, 
   3.3998752574883194`*^9, {3.399875328567354*^9, 3.3998753976932387`*^9}, {
   3.3998769385567117`*^9, 3.399876963197652*^9}, {3.3998817267429996`*^9, 
   3.3998817610246887`*^9}, {3.3998861351588016`*^9, 
   3.3998861391276026`*^9}, {3.399886184409432*^9, 3.399886187753225*^9}, 
   3.3998862645354576`*^9, {3.399886620821268*^9, 3.3998866310245237`*^9}, {
   3.3998866823376803`*^9, 3.399886741619689*^9}, 3.3998867936359797`*^9, {
   3.399900172947858*^9, 3.3999002684022045`*^9}, {3.399900303012023*^9, 
   3.3999003104027424`*^9}, {3.399900436169977*^9, 3.399900456326485*^9}, {
   3.399900944270231*^9, 3.3999009918958406`*^9}, {3.399901122413136*^9, 
   3.3999012365395966`*^9}, {3.558779092400033*^9, 3.5587791157292027`*^9}, {
   3.5587792880494223`*^9, 3.5587793020813007`*^9}, {3.5587878412919655`*^9, 
   3.5587878423076363`*^9}, {3.558789676324418*^9, 3.5587896788557653`*^9}, {
   3.558789810845208*^9, 3.558789817376709*^9}, {3.558789904301922*^9, 
   3.5587899532413015`*^9}, {3.5587900120718946`*^9, 3.558790012259403*^9}, 
   3.558790042838898*^9, {3.558790515735083*^9, 3.5587905187820945`*^9}, {
   3.55879114716962*^9, 3.558791155763755*^9}, {3.558791325990131*^9, 
   3.5587913264120245`*^9}, {3.6270385626783757`*^9, 3.627038610197376*^9}, {
   3.6270387581083755`*^9, 3.627038766091376*^9}, {3.627039059008376*^9, 
   3.627039063399376*^9}, 3.6270391426193757`*^9, 3.627039295897376*^9, 
   3.6304131192012434`*^9, {3.6304147211832433`*^9, 3.630414734573243*^9}, 
   3.6551254612475367`*^9, 3.6551324696383057`*^9, 3.6551325342697678`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"element", "[", 
    RowBox[{
    "\"\<gwiggler\>\"", ",", "position_", ",", "length_", ",", "bendh_", ",", 
     "bendv_", ",", "rotationh_", ",", "rotationv_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"Orange", ",", 
     RowBox[{"Specularity", "[", "Orange", "]"}], ",", 
     RowBox[{"Dipole3D", "[", 
      RowBox[{"length", ",", " ", 
       FractionBox["widthscale", "4"], ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            FractionBox["1", "2"], "bendv"}], "-", "rotationv"}], ")"}], " ", 
         ",", "\[Pi]", ",", 
         RowBox[{"\[Pi]", "-", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox["1", "2"], "bendh"}], "+", "rotationh"}], ")"}]}]}], 
        "}"}]}], "]"}], ",", "Black", ",", "\[IndentingNewLine]", 
     RowBox[{"Line3D", "[", 
      RowBox[{"length", ",", "position", ",", 
       RowBox[{"{", 
        RowBox[{"rotationv", ",", "0", ",", 
         RowBox[{"-", "rotationh"}]}], "}"}]}], "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3938314675427837`*^9, 3.393831482214283*^9}, 
   3.3938315684776998`*^9, {3.3938316889902396`*^9, 3.3938316993805985`*^9}, {
   3.3938323181303835`*^9, 3.3938323195209723`*^9}, {3.393841257616456*^9, 
   3.393841264757538*^9}, {3.3938447163489323`*^9, 3.393844735895307*^9}, {
   3.3938447838784533`*^9, 3.393844784878428*^9}, {3.3938453347862253`*^9, 
   3.3938453378798957`*^9}, {3.3938453839568415`*^9, 3.393845387909865*^9}, {
   3.3938455246094904`*^9, 3.3938455253125973`*^9}, {3.393848937975231*^9, 
   3.3938489558185244`*^9}, {3.39391986036522*^9, 3.393919860474592*^9}, {
   3.3939309337841578`*^9, 3.3939309346747713`*^9}, {3.3941766321422205`*^9, 
   3.394176640486184*^9}, {3.394177315050701*^9, 3.394177386934885*^9}, {
   3.3941775125642524`*^9, 3.3941775373432817`*^9}, 3.3941777382527742`*^9, {
   3.394178283211913*^9, 3.3941782887585754`*^9}, 3.399790539801506*^9, 
   3.3997906368652487`*^9, {3.399793171225813*^9, 3.399793233851615*^9}, {
   3.3997932650238886`*^9, 3.399793308165066*^9}, {3.399793415447689*^9, 
   3.399793460417015*^9}, {3.399793895047578*^9, 3.3997939228291836`*^9}, {
   3.3997939889394045`*^9, 3.399793998783281*^9}, {3.399794099159566*^9, 
   3.3997943221155443`*^9}, {3.399794385116351*^9, 3.3997945418214817`*^9}, {
   3.3997945730562563`*^9, 3.3997947923559384`*^9}, {3.399794855841126*^9, 
   3.399795250846182*^9}, {3.399798997691016*^9, 3.399799049472929*^9}, {
   3.399799122067608*^9, 3.3997991881778293`*^9}, {3.399799221365754*^9, 
   3.399799226662697*^9}, {3.3997992673975935`*^9, 3.399799276038329*^9}, {
   3.399799311773161*^9, 3.3997994724314675`*^9}, {3.399799801670057*^9, 
   3.399799866155257*^9}, {3.399799966922172*^9, 3.399800006688306*^9}, {
   3.39980004254814*^9, 3.3998000498451085`*^9}, {3.3998013544711823`*^9, 
   3.3998014244408283`*^9}, 3.399801482644698*^9, {3.3998015225827093`*^9, 
   3.399801529817177*^9}, 3.3998015956461444`*^9, {3.399806702336509*^9, 
   3.3998067068834424`*^9}, {3.399810895499556*^9, 3.3998109024996457`*^9}, {
   3.399811018454255*^9, 3.39981102159492*^9}, {3.399874280569565*^9, 
   3.399874283335225*^9}, 3.3998747036531053`*^9, {3.399874749575568*^9, 
   3.399874750013074*^9}, {3.3998749434061737`*^9, 3.399874971594035*^9}, 
   3.3998752574883194`*^9, {3.399875328567354*^9, 3.3998753976932387`*^9}, {
   3.3998769385567117`*^9, 3.399876963197652*^9}, {3.3998817267429996`*^9, 
   3.3998817610246887`*^9}, {3.3998861351588016`*^9, 
   3.3998861391276026`*^9}, {3.399886184409432*^9, 3.399886187753225*^9}, 
   3.3998862645354576`*^9, {3.399886620821268*^9, 3.3998866310245237`*^9}, {
   3.3998866823376803`*^9, 3.399886741619689*^9}, 3.3998867936359797`*^9, {
   3.399900172947858*^9, 3.3999002684022045`*^9}, {3.399900303012023*^9, 
   3.3999003104027424`*^9}, {3.399900436169977*^9, 3.399900456326485*^9}, {
   3.399900944270231*^9, 3.3999009918958406`*^9}, {3.399901122413136*^9, 
   3.3999012365395966`*^9}, {3.558779092400033*^9, 3.5587791157292027`*^9}, {
   3.5587792880494223`*^9, 3.5587793020813007`*^9}, {3.5587878412919655`*^9, 
   3.5587878423076363`*^9}, {3.558789676324418*^9, 3.5587896788557653`*^9}, {
   3.558789810845208*^9, 3.558789817376709*^9}, {3.558789904301922*^9, 
   3.5587899532413015`*^9}, {3.5587900120718946`*^9, 3.558790012259403*^9}, 
   3.558790042838898*^9, {3.558790515735083*^9, 3.5587905187820945`*^9}, {
   3.55879114716962*^9, 3.558791155763755*^9}, {3.558791325990131*^9, 
   3.5587913264120245`*^9}, {3.6270385626783757`*^9, 3.627038610197376*^9}, {
   3.6270387581083755`*^9, 3.627038766091376*^9}, {3.627039059008376*^9, 
   3.627039063399376*^9}, 3.6270391426193757`*^9, 3.627039295897376*^9, 
   3.6304131192012434`*^9, {3.6304147211832433`*^9, 3.630414734573243*^9}, 
   3.6551254612475367`*^9, 3.6551324696383057`*^9, 3.6551325342697678`*^9, {
   3.6798983299234266`*^9, 3.6798983320034266`*^9}, {3.6798983666159267`*^9, 
   3.6798984208874264`*^9}, 3.6798984590124264`*^9, {3.6798984908649263`*^9, 
   3.6798985142754264`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADDraw3D", "[", 
   RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "text", ",", "thick", ",", "bpms", ",", "lengths", ",", "filled", ",", 
      "widthscale", ",", "symms", ",", "bends", ",", "closed", ",", "offset", 
      ",", "optShow", ",", "a", ",", "b", ",", "c", ",", "rot", ",", "sinc", 
      ",", "cosc", ",", "sym", ",", "pelement", ",", "wd", ",", "wq", ",", 
      "ws", ",", "wo", ",", "wrf", ",", "wkick", ",", "findrotations", ",", 
      "findrotationsv", ",", "cc", ",", "sum1", ",", "prepositions2", ",", 
      "layout", ",", "acceleratorlayout", ",", "Drawdrift", ",", 
      RowBox[{"anglesum", "=", "0"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"text", "=", 
      RowBox[{
       RowBox[{"Labels", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"thick", "=", 
      RowBox[{
       RowBox[{"Thick", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"bpms", "=", 
      RowBox[{
       RowBox[{"Monitors", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"lengths", "=", 
      RowBox[{
       RowBox[{"Lengths", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"filled", "=", 
      RowBox[{
       RowBox[{"Filled", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{"filled", ",", 
       RowBox[{"shape", "=", "\"\<Polygon\>\""}], ",", 
       RowBox[{"shape", "=", "\"\<Line\>\""}]}], "]"}], ";", 
     RowBox[{"widthscale", "=", 
      RowBox[{
       RowBox[{"WidthScale", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"symms", "=", 
      RowBox[{
       RowBox[{"Symms", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"bends", "=", 
      RowBox[{
       RowBox[{"Bends", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"closed", "=", 
      RowBox[{
       RowBox[{"CheckClosed", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     RowBox[{"offset", "=", 
      RowBox[{
       RowBox[{"Offset", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"Options", "[", "MADDraw", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vbends", "=", 
      RowBox[{
       RowBox[{"Global`VerticalBends", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`VerticalBends", "\[Rule]", "False"}], "}"}]}]}], ";", 
     RowBox[{"optShow", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Graphics3D", "]"}]}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "opts", "}"}], "]"}], ",", 
            RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], "}"}]}], 
       "]"}]}], ";", 
     RowBox[{"a", "=", 
      RowBox[{"MADFlatten", "[", "data", "]"}]}], ";", 
     RowBox[{"a", "=", 
      RowBox[{"MADFlatten", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"bpms", "===", "True"}], ",", 
       RowBox[{"b", "=", "a"}], ",", 
       RowBox[{"b", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "=!=", "\"\<BPM\>\""}], "&"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tilt", "[", "element_", "]"}], ":=", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{
        "element", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ",", "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "element", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<Extra\>\""}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "7", 
         "\[RightDoubleBracket]"}], " ", ",", "\[IndentingNewLine]", 
        "\"\<RectBend\>\"", ",", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
             "element", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<Extra\>\""}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "7", 
         "\[RightDoubleBracket]"}], " ", ",", "\[IndentingNewLine]", "_", ",",
         "0"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", "\"\<dipole\>\"", ",", 
             RowBox[{"ToLowerCase", "[", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}]}], "]"}], ",", 
           RowBox[{
           "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<SectorBend\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RectBend\>\""}]}], ",", 
             RowBox[{"N", "[", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], 
              "]"}], ",", "0"}], "]"}], ",", "\"\<\>\"", ",", 
           RowBox[{"tilt", "[", "#1", "]"}], ",", "#"}], "}"}], "&"}], ")"}], 
       "/@", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"symms", "===", "True"}], ",", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", "sym"}], "]"}]}], ";"}], ",", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"c", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
            "}"}]}], "]"}]}], ";", 
        RowBox[{"c", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<drift\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
            "}"}]}], "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"lattice", "=", "c"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"cc", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"prepositions2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"cc", "=", 
            RowBox[{"cc", "+", "\[IndentingNewLine]", 
             RowBox[{"If", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "===", 
                "\"\<dipole\>\""}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "*", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"bends", "===", "True"}], ",", 
                    RowBox[{"sinc", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     ",", "1"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "*", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"bends", "===", "True"}], ",", 
                    RowBox[{"cosc", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     ",", "0"}], "]"}]}], ",", "0"}], "}"}], ".", 
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "*", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"bends", "===", "True"}], ",", 
                    RowBox[{"sinc", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     ",", "1"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "*", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"bends", "===", "True"}], ",", 
                    RowBox[{"cosc", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "6"}], "\[RightDoubleBracket]"}], "]"}],
                     ",", "0"}], "]"}]}], ",", "0"}], "}"}], ".", 
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], 
              "]"}]}]}], ")"}], "&"}], "/@", 
         RowBox[{"MapThread", "[", 
          RowBox[{"List", ",", 
           RowBox[{"{", 
            RowBox[{"lattice", ",", "findrotations"}], "}"}]}], "]"}]}]}], 
       ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADDrawRot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "y_"}], "}"}], ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{"y", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"x", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{"y", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"roty", "[", 
       RowBox[{"line_", ",", "\[Theta]_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{
          RowBox[{
          "line", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cosc", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"1", "-", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinc2", "[", "\[Theta]_", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", "\[Theta]", "]"}], ">", "0"}], ",", 
        FractionBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "\[Theta]"], ",", "0"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sym", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<symmline\>\"", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"bends", "===", "True"}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
             RowBox[{"anglesum", "+=", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], "]"}], 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "3", 
                "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]", 
             "_", ",", "anglesum"}], "]"}], "&"}], "/@", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{"lattice", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ",", 
       RowBox[{"findrotations", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "lattice", "]"}], "}"}]}], "]"}]}]}], "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"findrotationsv", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"sum1", "=", "0"}], ";", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"sum1", "+=", 
            RowBox[{
             RowBox[{"Sin", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "5", "]"}], "]"}], "]"}], 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}],
            "&"}], ")"}], "/@", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"Prepend", "[", 
            RowBox[{"lattice", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "0"}], 
              "}"}]}], "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}]}]}], ")"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"cc", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";", 
       RowBox[{"RM", "=", 
        RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", 
       RowBox[{"startangle", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"prepositions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"v", "=", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{"startangle", ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              ".", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "*", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"bends", "===", "True"}], ",", 
                   RowBox[{"sinc", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], ",", "1"}], "]"}]}], 
                ",", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}], "*", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"bends", "===", "True"}], ",", 
                   RowBox[{"cosc", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], ",", "0"}], "]"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "5", "]"}], "]"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}], "*", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"bends", "===", "True"}], ",", 
                   RowBox[{"sinc", "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], ",", "0"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "5", "]"}], "]"}], "]"}]}]}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", "v", "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"rm", "=", 
             RowBox[{"Switch", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "\[IndentingNewLine]", "\"\<dipole\>\"", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{
                  RowBox[{"RotationMatrix", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                  RowBox[{"RotationMatrix", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ",", 
                 RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
               "\[IndentingNewLine]", "\"\<quadrupole\>\"", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bends", "===", "True"}], ",", 
                 RowBox[{
                  RowBox[{"angle", "=", 
                   RowBox[{
                    RowBox[{"GetMADErrors", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}],
                     "]"}], ",", "Global`MADdx"}], "]"}], "*", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "3"}], "\[RightDoubleBracket]"}],
                     "*", 
                    RowBox[{"#", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "4"}], 
                    "\[RightDoubleBracket]"}]}]}], ";", 
                  RowBox[{
                   RowBox[{"RotationMatrix", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], ".", 
                   RowBox[{"RotationMatrix", "[", 
                    RowBox[{"angle", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], 
                 ",", 
                 RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}], ",", 
               "\[IndentingNewLine]", "_", ",", 
               RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"RM", "=", 
             RowBox[{"RM", ".", "rm"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"cc", "+=", 
             RowBox[{"RM", ".", "v"}]}]}], ")"}], "&"}], "/@", "lattice"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"prepositions2", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"prepositions", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{"prepositions", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{"prepositions", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], "}"}], 
         "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xform", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Theta]_", ",", "tilt_", ",", "length_"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x_", ",", "r_"}], "}"}]}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dx", ",", "n", ",", "rt", ",", "rp"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dx", "=", 
          RowBox[{"r", ".", 
           RowBox[{"(", GridBox[{
              {
               RowBox[{"Cos", "[", "tilt", "]"}], 
               RowBox[{"-", 
                RowBox[{"Sin", "[", "tilt", "]"}]}], "0"},
              {
               RowBox[{"Sin", "[", "tilt", "]"}], 
               RowBox[{"Cos", "[", "tilt", "]"}], "0"},
              {"0", "0", "1"}
             }], ")"}], ".", 
           RowBox[{"(", GridBox[{
              {
               RowBox[{"Limit", "[", 
                RowBox[{
                 RowBox[{
                  FractionBox["length", "\[Theta]1"], 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Cos", "[", "\[Theta]1", "]"}], "-", "1"}], 
                   ")"}]}], ",", 
                 RowBox[{"\[Theta]1", "\[Rule]", "\[Theta]"}]}], "]"}]},
              {"0"},
              {
               RowBox[{"Limit", "[", 
                RowBox[{
                 RowBox[{
                  FractionBox["length", "\[Theta]1"], 
                  RowBox[{"Sin", "[", "\[Theta]1", "]"}]}], ",", 
                 RowBox[{"\[Theta]1", "\[Rule]", "\[Theta]"}]}], "]"}]}
             }], ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rt", "=", 
          RowBox[{"Transpose", "[", "r", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", "=", 
          RowBox[{
           RowBox[{
            RowBox[{
            "rt", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            RowBox[{"Cos", "[", "tilt", "]"}]}], "-", 
           RowBox[{
            RowBox[{
            "rt", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            RowBox[{"Sin", "[", "tilt", "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"rp", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Outer", "[", 
             RowBox[{"Times", ",", 
              RowBox[{"rt", ".", "n"}], ",", "n"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"1", "-", 
              RowBox[{"Cos", "[", "\[Theta]", "]"}]}], ")"}]}], "+", 
           RowBox[{"rt", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{
                "rt", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                ",", "n"}], "]"}], ",", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{
                "rt", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                ",", "n"}], "]"}], ",", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{
                "rt", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
                ",", "n"}], "]"}]}], "}"}], 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "+", "dx"}], ",", 
           RowBox[{"Transpose", "[", "rp", "]"}]}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{"{", 
       RowBox[{"(", GridBox[{
          {"0"},
          {"0"},
          {"0"}
         }], ")"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"localXYZ", "=", 
      RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x1", ",", "localXYZ"}], "}"}], "=", 
           RowBox[{"xform", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], ",", 
               RowBox[{"-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"x", "\[LeftDoubleBracket]", 
                RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
               "localXYZ"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"x", ",", "x1"}], "]"}]}]}], "]"}], "&"}], "/@", 
      "lattice"}], ";", "\[IndentingNewLine]", 
     RowBox[{"prepositions2", "=", 
      RowBox[{"Rest", "[", 
       RowBox[{"x", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1", ",", "2"}], "}"}], ",", "1"}], "]"}], "]"}],
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graph", "=", 
      RowBox[{"Graphics3D", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"element", "[", 
             RowBox[{
              RowBox[{"#1", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"#1", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], " ", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"bends", "===", "True"}], ",", 
                RowBox[{
                 RowBox[{"Cos", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "5"}], "]"}], "]"}], "]"}], 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], ",", 
                "0"}], "]"}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"bends", "===", "True"}], ",", 
                RowBox[{
                 RowBox[{"Sin", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "5"}], "]"}], "]"}], "]"}], 
                 RowBox[{"#1", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}], ",", 
                "0"}], "]"}], ",", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"-", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "4", 
                "\[RightDoubleBracket]"}]}]}], "]"}], "&"}], ")"}], "/@", 
          "\[IndentingNewLine]", 
          RowBox[{"MapThread", "[", 
           RowBox[{"List", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Rest", "[", "lattice", "]"}], ",", 
              RowBox[{"Drop", "[", 
               RowBox[{"prepositions2", ",", 
                RowBox[{"-", "1"}]}], "]"}], ",", 
              RowBox[{"Rest", "[", "findrotations", "]"}], ",", 
              RowBox[{"Rest", "[", "findrotationsv", "]"}]}], "}"}]}], 
           "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "opts", "}"}], "]"}], ",", 
           RowBox[{"Options", "[", "Graphics3D", "]"}]}], "]"}]}], ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"Options", "[", "MADDraw3D", "]"}], "}"}], "]"}], ",", 
           RowBox[{"Options", "[", "Graphics3D", "]"}]}], "]"}]}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{"graph", ",", "optShow", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{"Options", "[", "MADDraw3D", "]"}], "}"}], "]"}], ",", 
          RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}], ",", 
       RowBox[{"Lighting", "\[Rule]", "Automatic"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3941768199282775`*^9, 3.3941768821480923`*^9}, {
   3.394176912445161*^9, 3.394176947164133*^9}, {3.39417698894565*^9, 
   3.394177003398868*^9}, {3.3941770406491065`*^9, 3.394177052805434*^9}, {
   3.394177089227542*^9, 3.3941770907119265`*^9}, {3.3941771708841066`*^9, 
   3.394177173212217*^9}, {3.3941772129307127`*^9, 3.3941772882093563`*^9}, {
   3.394178236979314*^9, 3.3941782389323635`*^9}, {3.394178803427348*^9, 
   3.3941788102553864`*^9}, {3.3941896522453585`*^9, 3.394189652510982*^9}, {
   3.394189721713664*^9, 3.394189721869913*^9}, {3.3942858988324637`*^9, 
   3.3942859068322587`*^9}, {3.394285970502504*^9, 3.394286178419056*^9}, {
   3.3997937382955713`*^9, 3.3997937603271036`*^9}, {3.5587783661331224`*^9, 
   3.558778367976955*^9}, {3.5587785271247096`*^9, 3.5587785272340894`*^9}, {
   3.5587785737517986`*^9, 3.5587786202695074`*^9}, {3.558778690897671*^9, 
   3.558778691225811*^9}, {3.5587787315088654`*^9, 3.55877873261829*^9}, {
   3.5587787890583186`*^9, 3.5587787892614527`*^9}, {3.5587789932393403`*^9, 
   3.5587790019428554`*^9}, {3.5587793639903245`*^9, 
   3.5587793646466036`*^9}, {3.558788017471733*^9, 3.558788051066988*^9}, 
   3.5587880904437523`*^9, {3.5587881372427235`*^9, 3.558788170478587*^9}, {
   3.5587882234073706`*^9, 3.558788341200367*^9}, {3.5587883777578917`*^9, 
   3.5587884023534064`*^9}, {3.5587884650524497`*^9, 3.558788655200384*^9}, {
   3.5587890539193573`*^9, 3.5587890814341993`*^9}, 3.5871953023242607`*^9, {
   3.627037928008376*^9, 3.6270379960423756`*^9}, 3.627038081650376*^9, 
   3.627038134975376*^9, {3.627038185291376*^9, 3.6270381878703756`*^9}, {
   3.627038250326376*^9, 3.627038377265376*^9}, {3.627038784959376*^9, 
   3.627038787614376*^9}, {3.627039082128376*^9, 3.6270391025733757`*^9}, {
   3.627039202143376*^9, 3.627039278590376*^9}, {3.627039339397376*^9, 
   3.6270393409283757`*^9}, {3.6270472299353757`*^9, 
   3.6270472304083757`*^9}, {3.6270472692543755`*^9, 3.627047294069376*^9}, {
   3.6551246374381638`*^9, 3.6551246390213223`*^9}, {3.6551246873831577`*^9, 
   3.6551246899764175`*^9}, {3.655124823372755*^9, 3.6551248248439026`*^9}, {
   3.65512485892531*^9, 3.655124860437462*^9}, {3.655124947352152*^9, 
   3.6551249489363103`*^9}, {3.6551249843298492`*^9, 
   3.6551250060910254`*^9}, {3.655125120079423*^9, 3.655125359231336*^9}, {
   3.655125418242236*^9, 3.655125439618374*^9}, {3.6551255133967505`*^9, 
   3.6551255255509663`*^9}, {3.655131632759626*^9, 3.655131647032053*^9}, {
   3.6551317438597345`*^9, 3.6551317446118097`*^9}, {3.6551319795483017`*^9, 
   3.6551321124175873`*^9}, {3.655132148411186*^9, 3.655132229318276*^9}, {
   3.6551322693352776`*^9, 3.655132314912834*^9}, {3.6551323467940226`*^9, 
   3.6551323540497475`*^9}, {3.6551879096626997`*^9, 
   3.6551879166737003`*^9}},ExpressionUUID->"b73198eb-fcdd-4616-ad54-\
53ab326640bb"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Sin", "[", 
  RowBox[{
   RowBox[{"-", "\[Pi]"}], "/", "2"}], "]"}]], "Input",
 CellChangeTimes->{{3.6270383036603756`*^9, 3.6270383044683757`*^9}}],

Cell[BoxData[
 RowBox[{"-", "1"}]], "Output",
 CellChangeTimes->{3.627038304807376*^9, 3.627047246531376*^9}]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["MADGetTunes", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetTunes", "[", 
   RowBox[{"filename_:", "MADFileName"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", ",", "LinQx", ",", "LinQy"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"filename", "===", "MADFileName"}], ",", 
       RowBox[{"filename", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "filename", "]"}], ",", 
            RowBox[{"-", "3"}]}], "]"}], "<>", "\"\<print.txt\>\""}], 
         ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "filename", "]"}], ",", "Word"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"LinQx", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"Extract", "[", 
          RowBox[{"data", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"data", ",", "\"\<Qx\>\""}], "]"}], "+", "2"}], ")"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"LinQx", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Extract", "[", 
           RowBox[{"data", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<Q1\>\""}], "]"}], "+", "2"}], ")"}]}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"LinQy", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"Extract", "[", 
          RowBox[{"data", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"data", ",", "\"\<Qy\>\""}], "]"}], "+", "2"}], ")"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"LinQy", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"Extract", "[", 
           RowBox[{"data", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<Q2\>\""}], "]"}], "+", "2"}], ")"}]}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{"LinQx", ",", "LinQy"}], "}"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetChromaticity", "[", 
   RowBox[{"filename_:", "MADFileName"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", ",", "LinQx", ",", "LinQy"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"filename", "===", "MADFileName"}], ",", 
       RowBox[{"filename", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "filename", "]"}], ",", 
            RowBox[{"-", "3"}]}], "]"}], "<>", "\"\<print.txt\>\""}], 
         ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "filename", "]"}], ",", "Word"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"LinQx", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"Extract", "[", 
          RowBox[{"data", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"data", ",", "\"\<Qx'\>\""}], "]"}], "+", "2"}], ")"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"LinQy", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"Extract", "[", 
          RowBox[{"data", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"data", ",", "\"\<Qy'\>\""}], "]"}], "+", "2"}], ")"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{"LinQx", ",", "LinQy"}], "}"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetMomentumCompaction", "[", 
   RowBox[{"filename_:", "MADFileName"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", ",", "alphac", ",", "val"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"filename", "===", "MADFileName"}], ",", 
       RowBox[{"filename", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "filename", "]"}], ",", 
            RowBox[{"-", "3"}]}], "]"}], "<>", "\"\<print.txt\>\""}], 
         ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "filename", "]"}], ",", "Word"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"alphac", "=", 
      RowBox[{"ToString", "[", 
       RowBox[{"data", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<alfa\>\""}], "]"}], "]"}], "+", "2"}], 
        "\[RightDoubleBracket]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"val", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"StringReplacePart", "[", 
        RowBox[{"alphac", ",", "\"\<*10^\>\"", ",", 
         RowBox[{"StringPosition", "[", 
          RowBox[{"alphac", ",", "\"\<E\>\""}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "val", "}"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "MADCreateSRIData ",
 StyleBox["&", "Text"],
 " MADGetSRI"
}], "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCreateSRIData", "[", "ref_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "datafile", "}"}], ",", 
    RowBox[{
     RowBox[{"datafile", "=", 
      RowBox[{"OpenAppend", "[", 
       RowBox[{"ToString", "[", 
        RowBox[{"ref", "<>", "\"\<.mff\>\""}], "]"}], "]"}]}], ";", 
     RowBox[{"WriteString", "[", 
      RowBox[{
      "datafile", ",", "\[IndentingNewLine]", 
       "\"\<BMPM,NINT=0,SYNRAD=True,SINGLE=True;\\n\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "datafile", "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4827773675755424`*^9, 3.482777375310611*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetSRI", "[", 
   RowBox[{"filename_:", "MADFileName"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"filename", "===", "MADFileName"}], ",", 
       RowBox[{"filename", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "filename", "]"}], ",", 
            RowBox[{"-", "3"}]}], "]"}], "<>", "\"\<print.txt\>\""}], 
         ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "filename", "]"}], ",", "Word"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"I1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I1\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I2", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I2\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I3", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I3\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I4", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<(C)I4\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I5", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I5\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I6X", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I6X\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I6Y", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I6Y\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"I8", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"Read", "[", 
            RowBox[{
             RowBox[{"b", "=", 
              RowBox[{"StringToStream", "[", "#", "]"}]}], ",", "Real"}], 
            "]"}]}], ";", 
          RowBox[{"Close", "[", "b", "]"}], ";", "a"}], ")"}], "&"}], "/@", 
       RowBox[{"Extract", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"data", ",", "\"\<I8\>\""}], "]"}], "+", "8"}]}], 
        "]"}]}]}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4827770774409056`*^9, 3.4827770953636546`*^9}, {
  3.4827771325076075`*^9, 3.4827771334451914`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MADBMPM", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADBMPM", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "nint", ",", "delq", ",", "tauq", ",", "bucket", ",", "kappa", ",", 
      "i4i2", ",", "exdata", ",", "fx", ",", "fy", ",", "khm", ",", "synrad", 
      ",", "clorb", ",", "tousch", ",", "single", ",", "evary", ",", "midarc",
       ",", "interact", ",", "range", ",", "filename"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nint", "=", 
      RowBox[{
       RowBox[{"NInt", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"delq", "=", 
      RowBox[{
       RowBox[{"DelQ", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tauq", "=", 
      RowBox[{
       RowBox[{"TauQ", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bucket", "=", 
      RowBox[{
       RowBox[{"MADBucket", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"kappa", "=", 
      RowBox[{
       RowBox[{"Kappa", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"i4i2", "=", 
      RowBox[{
       RowBox[{"I4I2", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"exdata", "=", 
      RowBox[{
       RowBox[{"EXData", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fx", "=", 
      RowBox[{
       RowBox[{"FX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fy", "=", 
      RowBox[{
       RowBox[{"FY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"khm", "=", 
      RowBox[{
       RowBox[{"KHM", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"synrad", "=", 
      RowBox[{
       RowBox[{"SynRad", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"clorb", "=", 
      RowBox[{
       RowBox[{"Clorb", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tousch", "=", 
      RowBox[{
       RowBox[{"Tousch", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"single", "=", 
      RowBox[{
       RowBox[{"Single", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"evary", "=", 
      RowBox[{
       RowBox[{"EVary", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"midarc", "=", 
      RowBox[{
       RowBox[{"MidArc", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"interact", "=", 
      RowBox[{
       RowBox[{"Interact", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"range", "=", 
      RowBox[{
       RowBox[{"Range", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADBMPM", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"FileName", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"FileName", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"bmpm", "=", 
      RowBox[{"\"\<BMPM\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IntegerQ", "[", "nint", "]"}], ",", 
         RowBox[{"\"\<,NINT=\>\"", "<>", 
          RowBox[{"ToString", "[", "nint", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"delq", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DelQ=\>\"", "<>", 
          RowBox[{"ToString", "[", "delq", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"tauq", "=!=", "0"}], ",", 
         RowBox[{"\"\<,TauQ=\>\"", "<>", 
          RowBox[{"ToString", "[", "tauq", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"bucket", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Bucket=\>\"", "<>", 
          RowBox[{"ToString", "[", "bucket", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"kappa", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Kappa=\>\"", "<>", 
          RowBox[{"ToString", "[", "kappa", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"i4i2", "=!=", "0"}], ",", 
         RowBox[{"\"\<,I4I2=\>\"", "<>", 
          RowBox[{"ToString", "[", "i4i2", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"exdata", "=!=", "0"}], ",", 
         RowBox[{"\"\<,EXData=\>\"", "<>", 
          RowBox[{"ToString", "[", "exdata", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"fx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,FX=\>\"", "<>", 
          RowBox[{"ToString", "[", "fx", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"fy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,FY=\>\"", "<>", 
          RowBox[{"ToString", "[", "fy", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"khm", "=!=", "0"}], ",", 
         RowBox[{"\"\<,KHM=\>\"", "<>", 
          RowBox[{"ToString", "[", "khm", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"synrad", "===", "True"}], ",", "\"\<,SynRad=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"clorb", "===", "True"}], ",", "\"\<,CLORB=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"tousch", "===", "True"}], ",", "\"\<,Tousch=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"single", "===", "True"}], ",", "\"\<,Single=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"evary", "===", "True"}], ",", "\"\<,EVary=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"midarc", "===", "True"}], ",", "\"\<,MidArc=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"interact", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Interact=\>\"", "<>", 
          RowBox[{"ToString", "[", "interact", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"range", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Range=\>\"", "<>", 
          RowBox[{"ToString", "[", "range", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "bmpm", "]"}], ">", "80"}], ",", 
       RowBox[{"bmpm", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"bmpm", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"bmpm", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "65"}], "&"}]}], "]"}], "]"}], "+", "1"}]}], 
         "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "bmpm", "]"}], ">", "160"}], ",", 
       RowBox[{"bmpm", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"bmpm", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"bmpm", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "145"}], "&"}]}], "]"}], "]"}], "+", "1"}]}],
          "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "bmpm"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Resonance Plot", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResonancePlot", "[", 
   RowBox[{
   "range_", ",", "orderstart_", ",", "orderend_", ",", "periodicity_", ",", 
    "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"optPlot", ",", "optShow"}], "}"}], ",", 
    RowBox[{
     RowBox[{"legend", "=", 
      RowBox[{
       RowBox[{"Legend", "/.", "\[InvisibleSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
       RowBox[{"{", 
        RowBox[{"Legend", "\[Rule]", "False"}], "}"}]}]}], ";", 
     RowBox[{"optShow", "=", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "opts", "}"}], "]"}], ",", 
         RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}]}], ";", 
     RowBox[{"optPlot", "=", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "opts", "}"}], "]"}], ",", 
         RowBox[{"Options", "[", "ImplicitPlot", "]"}]}], "]"}]}]}], ";", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"legend", "===", "True"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Reverse", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"ImplicitPlot", "[", 
               RowBox[{
                RowBox[{"ResonanceEquationsAtOrder", "[", 
                 RowBox[{"range", ",", "n", ",", "periodicity"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", 
                  RowBox[{"range", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"range", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"y", ",", 
                  RowBox[{"range", "\[LeftDoubleBracket]", 
                   RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"range", "\[LeftDoubleBracket]", 
                   RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                 "}"}], ",", 
                RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
                RowBox[{"PlotStyle", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{
                  "ResPlotColours", "\[LeftDoubleBracket]", "n", 
                   "\[RightDoubleBracket]"}], "}"}]}], ",", "optPlot"}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "orderstart", ",", "orderend", ",", "1"}], 
               "}"}]}], "]"}], "]"}], ",", 
           RowBox[{"Graphics", "[", 
            RowBox[{"Legend", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                "LegendData", "\[LeftDoubleBracket]", "n", 
                 "\[RightDoubleBracket]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "orderstart", ",", "orderend", ",", "1"}], 
                 "}"}]}], "]"}], ",", 
              RowBox[{"LegendShadow", "\[Rule]", "None"}], ",", 
              RowBox[{"LegendPosition", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"range", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "+", 
                  RowBox[{
                   FractionBox["1", "4"], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    ")"}]}]}], ",", 
                 RowBox[{
                  RowBox[{"range", "\[LeftDoubleBracket]", 
                   RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
                  RowBox[{
                   FractionBox["1", "5"], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    ")"}]}]}]}], "}"}]}]}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"Reverse", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ImplicitPlot", "[", 
             RowBox[{
              RowBox[{"ResonanceEquationsAtOrder", "[", 
               RowBox[{"range", ",", "n", ",", "periodicity"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              ",", 
              RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                "ResPlotColours", "\[LeftDoubleBracket]", "n", 
                 "\[RightDoubleBracket]"}], "}"}]}], ",", "optPlot"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "orderstart", ",", "orderend", ",", "1"}], 
             "}"}]}], "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"DisplayFunction", "\[Rule]", "$DisplayFunction"}], ",", 
       "optShow"}], "]"}]}]}], "]"}]}]], "Text",
 InitializationCell->True,
 CellChangeTimes->{3.5266410308636975`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResonanceEquationsAtOrder", "[", 
   RowBox[{"range_", ",", "resorder_", ",", "periodicity_"}], "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ResEqn", "@@@", 
        RowBox[{"ResNumAtOrder", "[", "resorder", "]"}]}], "/.", 
       RowBox[{"l", "\[Rule]", "periodicity"}]}], " ", ",", 
      RowBox[{"{", 
       RowBox[{"pvalue", ",", 
        RowBox[{"First", "[", 
         RowBox[{"PValues", "[", 
          RowBox[{
           RowBox[{"ResNumAtOrder", "[", "resorder", "]"}], ",", "range", ",",
            "periodicity"}], "]"}], "]"}], ",", 
        RowBox[{"Last", "[", 
         RowBox[{"PValues", "[", 
          RowBox[{
           RowBox[{"ResNumAtOrder", "[", "resorder", "]"}], ",", "range", ",",
            "periodicity"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.655980110047372*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResonanceEquations", "[", 
   RowBox[{
   "range_", ",", "orderstart_", ",", "orderend_", ",", "periodicity_"}], 
   "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"ResonanceEquationsAtOrder", "[", 
       RowBox[{"range", ",", "n", ",", "periodicity"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"n", ",", "orderstart", ",", "orderend"}], "}"}]}], "]"}], 
    "]"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResonancePlot", "[", 
   RowBox[{
   "range_", ",", "orderstart_", ",", "orderend_", ",", "periodicity_", ",", 
    "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "optPlot", ",", "optShow", ",", "legend", ",", "RangePoints", ",", "l", 
      ",", "pvalue", ",", "x", ",", "y", ",", "m", ",", "n"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"legend", "=", 
      RowBox[{
       RowBox[{"ResonanceLegend", "/.", "\[VeryThinSpace]", 
        RowBox[{"{", "opts", "}"}]}], "/.", "\[VeryThinSpace]", 
       RowBox[{"{", 
        RowBox[{"ResonanceLegend", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"optShow", "=", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "opts", "}"}], "]"}], ",", 
         RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"optPlot", "=", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "opts", "}"}], "]"}], ",", 
         RowBox[{"Options", "[", "ContourPlot", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ResEqn", "[", 
       RowBox[{"m_", ",", "n_"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"m", " ", "x"}], "+", 
         RowBox[{"n", " ", "y"}]}], "\[Equal]", 
        RowBox[{"l", " ", "pvalue"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ResNumAtOrder", "[", "r_", "]"}], ":=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"r", "-", "x"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x", "-", "r"}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "0", ",", "r"}], "}"}]}], "]"}], ",", "1"}], 
       "]"}]}], ";", 
     RowBox[{"RangePoints", ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"range", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PValues", "[", 
       RowBox[{"resnums_", ",", "r_", ",", "p_"}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"equations", "=", 
          RowBox[{"{", 
           FractionBox[
            RowBox[{
             RowBox[{"m", " ", "x"}], "+", 
             RowBox[{"n", " ", "y"}]}], "l"], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Floor", "[", 
              RowBox[{"Min", "[", "#", "]"}], "]"}], ",", 
             RowBox[{"Ceiling", "[", 
              RowBox[{"Max", "[", "#", "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"equations", "/.", 
                   RowBox[{"l", "\[Rule]", "p"}]}], "/.", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"m", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"n", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], "&"}], "/@", 
                "resnums"}], "/.", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"x", "\[Rule]", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                 RowBox[{"y", "\[Rule]", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], "&"}], "/@", 
             "RangePoints"}], "]"}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"legend", "===", "True"}], ",", "\[IndentingNewLine]", 
         RowBox[{"GraphicsGrid", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Show", "[", 
               RowBox[{"Reverse", "[", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"ContourPlot", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"ResonanceEquationsAtOrder", "[", 
                    RowBox[{"range", ",", "n", ",", "periodicity"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"y", ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", 
                    RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
                    RowBox[{"ContourStyle", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    "ResPlotColours", "\[LeftDoubleBracket]", "n", 
                    "\[RightDoubleBracket]"}], "}"}]}], ",", 
                    RowBox[{"Evaluate", "[", "optPlot", "]"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "n", ",", "orderstart", ",", "orderend", ",", "1"}], 
                   "}"}]}], "]"}], "]"}], "]"}], ",", "SpanFromLeft", ",", 
              RowBox[{"Graphics", "[", 
               RowBox[{"Legend", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                   "LegendData", "\[LeftDoubleBracket]", "n", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    "n", ",", "orderstart", ",", "orderend", ",", "1"}], 
                    "}"}]}], "]"}], ",", 
                 RowBox[{"LegendShadow", "\[Rule]", "None"}], ",", 
                 RowBox[{"LegendPosition", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    FractionBox["1", "4"], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    FractionBox["1", "5"], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    ")"}]}]}]}], "}"}]}]}], "]"}], "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"SpanFromAbove", ",", "SpanFromBoth", ",", "Null"}], 
             "}"}]}], "}"}], "]"}], ",", 
         RowBox[{"Reverse", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ContourPlot", "[", 
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"ResonanceEquationsAtOrder", "[", 
                RowBox[{"range", ",", "n", ",", "periodicity"}], "]"}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                RowBox[{"range", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              ",", 
              RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
              RowBox[{"ContourStyle", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                "ResPlotColours", "\[LeftDoubleBracket]", "n", 
                 "\[RightDoubleBracket]"}], "}"}]}], ",", 
              RowBox[{"Evaluate", "[", "optPlot", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "orderstart", ",", "orderend", ",", "1"}], 
             "}"}]}], "]"}], "]"}]}], "]"}], ",", "optShow"}], "]"}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.526639178910039*^9, 3.526639444744969*^9}, {
  3.526639543106862*^9, 3.526639544013135*^9}, {3.5266397591905184`*^9, 
  3.5266397677844887`*^9}, {3.5266400556356077`*^9, 3.5266400629795456`*^9}, {
  3.526640168544748*^9, 3.5266401786387563`*^9}, {3.5266402145146747`*^9, 
  3.5266402535156727`*^9}, {3.526640373112485*^9, 3.526640383409623*^9}, {
  3.5266404166604743`*^9, 3.526640457364641*^9}, {3.5266405127566843`*^9, 
  3.5266408392181664`*^9}, {3.655980146384102*^9, 3.6559802225531282`*^9}, {
  3.704606215472289*^9, 3.7046062215905128`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResonanceLegend", "[", 
   RowBox[{"min_", ",", "max_"}], "]"}], ":=", 
  RowBox[{"Graphics", "[", 
   RowBox[{"Legend", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"LegendData", "[", 
        RowBox[{"[", "n", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "min", ",", "max", ",", "1"}], "}"}]}], "]"}], ",", 
     RowBox[{"LegendShadow", "\[Rule]", "None"}]}], "]"}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Closed Orbit", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetDisp", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"filename", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<GetDisp,Filename=\>\"", "<>", 
       RowBox[{"ToString", "[", "file", "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPutDisp", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"filename", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<PutDisp,Filename=\>\"", "<>", 
       RowBox[{"ToString", "[", "file", "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetKick", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"filename", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"add", "=", 
      RowBox[{
       RowBox[{"Add", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Add", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<Getkick,Filename=\>\"", "<>", 
       RowBox[{"ToString", "[", "file", "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"add", "===", "True"}], ",", "\"\<,Add\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPutKick", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"filename", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"plane", "=", 
      RowBox[{
       RowBox[{"Plane", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Plane", "\[Rule]", "\"\<\>\""}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<PutKick,Filename=\>\"", "<>", 
       RowBox[{"ToString", "[", "file", "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"plane", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Plane=\>\"", "<>", 
          RowBox[{"ToString", "[", "plane", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetOrbit", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"filename", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<GetOrbit,Filename=\>\"", "<>", 
       RowBox[{"ToString", "[", "file", "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPutOrbit", "[", 
   RowBox[{"file_", ",", "opts___"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"filename", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<PutOrbit,Filename=\>\"", "<>", 
       RowBox[{"ToString", "[", "file", "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADMicado", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data", ",", "filename", ",", "error", ",", "ncorr", ",", "c2list", ",", 
      "m1list", ",", "dxweight", ",", "dyweight", ",", "plane"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"error", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Error", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"Error", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ncorr", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NCorr", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"NCorr", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c2list", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"C2List", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"C2List", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m1list", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"M1List", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"M1List", "\[Rule]", "False"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dxweight", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"DXWeight", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"DXWeight", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dyweight", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"DYWeight", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"DYWeight", "\[Rule]", "0"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"plane", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Plane", "/.", 
         RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{"Plane", "\[Rule]", "Both"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<Micado\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"error", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Error=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{"error", ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ncorr", "=!=", "0"}], ",", 
         RowBox[{"\"\<,NCorr=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{"ncorr", ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"c2list", "===", "True"}], ",", "\"\<,C2List\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"m1list", "===", "True"}], ",", "\"\<,M1List\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dxweight", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DXWeight=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{"dxweight", ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dyweight", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DYWeight=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{"dyweight", ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"plane", "===", "X"}], "||", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Plane", "/.", 
             RowBox[{"{", "opts", "}"}]}], ")"}], "===", "Y"}]}], ",", 
         RowBox[{"\"\<,Plane=\>\"", 
          RowBox[{"ToString", "[", "plane", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADCorrect", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", ",", "filename"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Filename", "\[Rule]", "MADFileName"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<Correct\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Error", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"Error", "\[Rule]", "0"}], "}"}]}], ")"}], "=!=", "0"}], 
         ",", 
         RowBox[{"\"\<,Error=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Error", "/.", 
                RowBox[{"{", "opts", "}"}]}], "/.", 
               RowBox[{"{", 
                RowBox[{"Error", "\[Rule]", "0"}], "}"}]}], ")"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"NCorr", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"NCorr", "\[Rule]", "0"}], "}"}]}], ")"}], "=!=", "0"}], 
         ",", 
         RowBox[{"\"\<,NCorr=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"NCorr", "/.", 
                RowBox[{"{", "opts", "}"}]}], "/.", 
               RowBox[{"{", 
                RowBox[{"NCorr", "\[Rule]", "0"}], "}"}]}], ")"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Iterate", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"Iterate", "\[Rule]", "0"}], "}"}]}], ")"}], "=!=", 
          "0"}], ",", 
         RowBox[{"\"\<,Iterate=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Iterate", "/.", 
              RowBox[{"{", "opts", "}"}]}], "/.", 
             RowBox[{"{", 
              RowBox[{"Iterate", "\[Rule]", "0"}], "}"}]}], ")"}], "]"}]}], 
         ",", "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"C1List", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"C1List", "\[Rule]", "False"}], "}"}]}], ")"}], "===", 
          "True"}], ",", "\"\<,C1List\>\"", ",", "\"\<\>\""}], "]"}], "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"C2List", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"C2List", "\[Rule]", "False"}], "}"}]}], ")"}], "===", 
          "True"}], ",", "\"\<,C2List\>\"", ",", "\"\<\>\""}], "]"}], "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"M1List", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"M1List", "\[Rule]", "False"}], "}"}]}], ")"}], "===", 
          "True"}], ",", "\"\<,M1List\>\"", ",", "\"\<\>\""}], "]"}], "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"M2List", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"M2List", "\[Rule]", "False"}], "}"}]}], ")"}], "===", 
          "True"}], ",", "\"\<,M2List\>\"", ",", "\"\<\>\""}], "]"}], "<>", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"DXWeight", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"DXWeight", "\[Rule]", "0"}], "}"}]}], ")"}], "=!=", 
          "0"}], ",", 
         RowBox[{"\"\<,DXWeight=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"DXWeight", "/.", 
                RowBox[{"{", "opts", "}"}]}], "/.", 
               RowBox[{"{", 
                RowBox[{"DXWeight", "\[Rule]", "0"}], "}"}]}], ")"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"DYWeight", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{"DYWeight", "\[Rule]", "0"}], "}"}]}], ")"}], "=!=", 
          "0"}], ",", 
         RowBox[{"\"\<,DYWeight=\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"DYWeight", "/.", 
                RowBox[{"{", "opts", "}"}]}], "/.", 
               RowBox[{"{", 
                RowBox[{"DYWeight", "\[Rule]", "0"}], "}"}]}], ")"}], ",", 
             RowBox[{"ExponentFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Plane", "/.", 
              RowBox[{"{", "opts", "}"}]}], "/.", 
             RowBox[{"{", 
              RowBox[{"Plane", "\[Rule]", "Both"}], "}"}]}], ")"}], "===", 
           "X"}], "||", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Plane", "/.", 
             RowBox[{"{", "opts", "}"}]}], ")"}], "===", "Y"}]}], ",", 
         RowBox[{"\"\<,Plane=\>\"", 
          RowBox[{"ToString", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Plane", "/.", 
              RowBox[{"{", "opts", "}"}]}], "/.", 
             RowBox[{"{", 
              RowBox[{"Plane", "\[Rule]", "Both"}], "}"}]}], ")"}], "]"}]}], 
         ",", "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "data", "]"}], ">", "80"}], ",", 
       RowBox[{"data", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"data", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"data", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "65"}], "&"}]}], "]"}], "]"}], "+", "1"}]}], 
         "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "data", "]"}], ">", "160"}], ",", 
       RowBox[{"data", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"data", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"data", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "145"}], "&"}]}], "]"}], "]"}], "+", "1"}]}],
          "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", "\n", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Plot Commands", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADPlot", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"File", "\[Rule]", "MADFileName"}], ",", 
     RowBox[{"HAxis", "\[Rule]", "\"\<X\>\""}], ",", 
     RowBox[{"VAxis", "\[Rule]", "\"\<PX\>\""}], ",", 
     RowBox[{"VAxis1", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"VAxis2", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"VAxis3", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"VAxis4", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Bars", "\[Rule]", "0"}], ",", 
     RowBox[{"Style", "\[Rule]", "0"}], ",", 
     RowBox[{"Symbol", "\[Rule]", "0"}], ",", 
     RowBox[{"MaxPlot", "\[Rule]", "0"}], ",", 
     RowBox[{"Sort", "\[Rule]", "False"}], ",", 
     RowBox[{"Spline", "\[Rule]", "False"}], ",", 
     RowBox[{"Multiple", "\[Rule]", "False"}], ",", 
     RowBox[{"FFT", "\[Rule]", "False"}], ",", 
     RowBox[{"HMin", "\[Rule]", "0"}], ",", 
     RowBox[{"HMax", "\[Rule]", "0"}], ",", 
     RowBox[{"VMin", "\[Rule]", "0"}], ",", 
     RowBox[{"VMax", "\[Rule]", "0"}], ",", 
     RowBox[{"Table", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Title", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Param", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Range", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Deltap", "\[Rule]", "0"}], ",", 
     RowBox[{"Particle", "\[Rule]", "0"}], ",", 
     RowBox[{"Turns", "\[Rule]", "0"}], ",", 
     RowBox[{"Colour", "\[Rule]", "100"}], ",", 
     RowBox[{"Filename", "\[Rule]", "\"\<\>\""}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPlot", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "filename", ",", "data", ",", "haxis", ",", "vaxis", ",", "vaxis1", ",", 
      "vaxis2", ",", "vaxis3", ",", "vaxis4", ",", "bars", ",", "style", ",", 
      "symbol", ",", "maxplot", ",", "sort", ",", "spline", ",", "multiple", 
      ",", "fft", ",", "hmin", ",", "hmax", ",", "vmin", ",", "vmax", ",", 
      "table", ",", "title", ",", "param", ",", "range", ",", "deltap", ",", 
      "particle", ",", "turns", ",", "colour", ",", "file"}], "}"}], ",", 
    RowBox[{
     RowBox[{"file", "=", 
      RowBox[{
       RowBox[{"File", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"haxis", "=", 
      RowBox[{
       RowBox[{"HAxis", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vaxis", "=", 
      RowBox[{
       RowBox[{"VAxis", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vaxis1", "=", 
      RowBox[{
       RowBox[{"VAxis1", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vaxis2", "=", 
      RowBox[{
       RowBox[{"VAxis2", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vaxis3", "=", 
      RowBox[{
       RowBox[{"VAxis3", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vaxis4", "=", 
      RowBox[{
       RowBox[{"VAxis4", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bars", "=", 
      RowBox[{
       RowBox[{"Bars", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"style", "=", 
      RowBox[{
       RowBox[{"Style", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"symbol", "=", 
      RowBox[{
       RowBox[{"Symbol", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"maxplot", "=", 
      RowBox[{
       RowBox[{"MaxPlot", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sort", "=", 
      RowBox[{
       RowBox[{"Sort", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"spline", "=", 
      RowBox[{
       RowBox[{"Spline", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"multiple", "=", 
      RowBox[{
       RowBox[{"Multiple", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fft", "=", 
      RowBox[{
       RowBox[{"FFT", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hmin", "=", 
      RowBox[{
       RowBox[{"HMin", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hmax", "=", 
      RowBox[{
       RowBox[{"HMax", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vmin", "=", 
      RowBox[{
       RowBox[{"VMin", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vmax", "=", 
      RowBox[{
       RowBox[{"VMax", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"table", "=", 
      RowBox[{
       RowBox[{"Table", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"title", "=", 
      RowBox[{
       RowBox[{"Title", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"param", "=", 
      RowBox[{
       RowBox[{"Param", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"range", "=", 
      RowBox[{
       RowBox[{"Range", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"deltap", "=", 
      RowBox[{
       RowBox[{"Deltap", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"particle", "=", 
      RowBox[{
       RowBox[{"Particle", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"turns", "=", 
      RowBox[{
       RowBox[{"Turns", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"colour", "=", 
      RowBox[{
       RowBox[{"Colour", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<Plot\>\"", "<>", "\"\<,VAxis=\>\"", "<>", 
       RowBox[{"ToString", "[", "vaxis", "]"}], "<>", "\"\<,HAxis=\>\"", "<>", 
       RowBox[{"ToString", "[", "haxis", "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vaxis1", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,VAxis1=\>\"", "<>", 
          RowBox[{"ToString", "[", "vaxis1", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vaxis2", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,VAxis2=\>\"", "<>", 
          RowBox[{"ToString", "[", "vaxis2", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vaxis3", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,VAxis3=\>\"", "<>", 
          RowBox[{"ToString", "[", "vaxis3", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vaxis4", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,VAxis4=\>\"", "<>", 
          RowBox[{"ToString", "[", "vaxis4", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"bars", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Bars=\>\"", "<>", 
          RowBox[{"ToString", "[", "bars", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"style", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Style=\>\"", "<>", 
          RowBox[{"ToString", "[", "style", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"symbol", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Symbol=\>\"", "<>", 
          RowBox[{"ToString", "[", "symbol", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"maxplot", "=!=", "0"}], ",", 
         RowBox[{"\"\<,MaxPlot=\>\"", "<>", 
          RowBox[{"ToString", "[", "maxplot", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sort", "===", "True"}], ",", "\"\<,Sort=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"spline", "===", "True"}], ",", "\"\<,Spline=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"multiple", "===", "True"}], ",", "\"\<,Multiple=True\>\"", 
         ",", "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"colour", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Colour=\>\"", "<>", 
          RowBox[{"ToString", "[", "colour", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"fft", "===", "True"}], ",", "\"\<,FFT=True\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"hmin", "=!=", "0"}], ",", 
         RowBox[{"\"\<,HMin=\>\"", "<>", 
          RowBox[{"ToString", "[", "hmin", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"hmax", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Hmax=\>\"", "<>", 
          RowBox[{"ToString", "[", "hmax", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vmin", "=!=", "0"}], ",", 
         RowBox[{"\"\<,VMin=\>\"", "<>", 
          RowBox[{"ToString", "[", "vmin", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vmax", "=!=", "0"}], ",", 
         RowBox[{"\"\<,VMax=\>\"", "<>", 
          RowBox[{"ToString", "[", "vmax", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"table", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Table=\>\"", "<>", 
          RowBox[{"ToString", "[", "table", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"title", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Title=\>\"", "<>", 
          RowBox[{"ToString", "[", "title", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"param", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Param=\>\"", "<>", 
          RowBox[{"ToString", "[", "param", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"range", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Range=\>\"", "<>", 
          RowBox[{"ToString", "[", "range", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"deltap", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Deltap=\>\"", "<>", 
          RowBox[{"ToString", "[", "deltap", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"particle", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Particle=\>\"", "<>", 
          RowBox[{"ToString", "[", "particle", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"turns", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Turns=\>\"", "<>", 
          RowBox[{"ToString", "[", "turns", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "data", "]"}], ">", "80"}], ",", 
       RowBox[{"data", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"data", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"data", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "65"}], "&"}]}], "]"}], "]"}], "+", "1"}]}], 
         "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "data", "]"}], ">", "160"}], ",", 
       RowBox[{"data", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"data", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"data", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "145"}], "&"}]}], "]"}], "]"}], "+", "1"}]}],
          "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "data", "]"}], ">", "240"}], ",", 
       RowBox[{"data", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"data", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"data", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "215"}], "&"}]}], "]"}], "]"}], "+", "1"}]}],
          "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"file", ",", "data"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Print and Select Commands", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "MADPrint", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Filename", "\[Rule]", "MADFileName"}], ",", 
    RowBox[{"Range", "\[Rule]", "\"\<\>\""}], ",", 
    RowBox[{"Type", "\[Rule]", "\"\<\>\""}], ",", 
    RowBox[{"Full", "\[Rule]", "False"}], ",", 
    RowBox[{"Clear", "\[Rule]", "False"}]}], "}"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADPrint", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "filename", ",", "data", ",", "range", ",", "type", ",", "full", ",", 
      "clear"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPrint", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"range", "=", 
      RowBox[{
       RowBox[{"Range", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPrint", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"type", "=", 
      RowBox[{
       RowBox[{"Type", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPrint", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"full", "=", 
      RowBox[{
       RowBox[{"Full", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPrint", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"clear", "=", 
      RowBox[{
       RowBox[{"Clear", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADPrint", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<Print\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"range", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Range=\>\"", "<>", 
          RowBox[{"ToString", "[", "range", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"type", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Type=\>\"", "<>", 
          RowBox[{"ToString", "[", "type", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"full", "===", "True"}], ",", "\"\<,Full\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"clear", "===", "True"}], ",", "\"\<,Clear\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADSelect", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Filename", "\[Rule]", "MADFileName"}], ",", 
     RowBox[{"Flag", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Range", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Type", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Full", "\[Rule]", "False"}], ",", 
     RowBox[{"Clear", "\[Rule]", "False"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSelect", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "filename", ",", "data", ",", "range", ",", "type", ",", "full", ",", 
      "clear", ",", "flag"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADSelect", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"flag", "=", 
      RowBox[{
       RowBox[{"Flag", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADSelect", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"range", "=", 
      RowBox[{
       RowBox[{"Range", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADSelect", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"type", "=", 
      RowBox[{
       RowBox[{"Type", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADSelect", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"full", "=", 
      RowBox[{
       RowBox[{"Full", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADSelect", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"clear", "=", 
      RowBox[{
       RowBox[{"Clear", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADSelect", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"\"\<Select\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"flag", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Flag=\>\"", "<>", 
          RowBox[{"ToString", "[", "flag", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"range", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Range=\>\"", "<>", 
          RowBox[{"ToString", "[", "range", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"type", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Type=\>\"", "<>", 
          RowBox[{"ToString", "[", "type", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"full", "===", "True"}], ",", "\"\<,Full\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"clear", "===", "True"}], ",", "\"\<,Clear\>\"", ",", 
         "\"\<\>\""}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"filename", ",", "data"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Optics Command", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MADoptics", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"BETX", "\[Rule]", "0"}], ",", 
     RowBox[{"ALFX", "\[Rule]", "0"}], ",", 
     RowBox[{"MUX", "\[Rule]", "0"}], ",", 
     RowBox[{"BETY", "\[Rule]", "0"}], ",", 
     RowBox[{"ALFY", "\[Rule]", "0"}], ",", 
     RowBox[{"MUY", "\[Rule]", "0"}], ",", 
     RowBox[{"DX", "\[Rule]", "0"}], ",", 
     RowBox[{"DPX", "\[Rule]", "0"}], ",", 
     RowBox[{"DY", "\[Rule]", "0"}], ",", 
     RowBox[{"DPY", "\[Rule]", "0"}], ",", 
     RowBox[{"X", "\[Rule]", "0"}], ",", 
     RowBox[{"PX", "\[Rule]", "0"}], ",", 
     RowBox[{"Y", "\[Rule]", "0"}], ",", 
     RowBox[{"PY", "\[Rule]", "0"}], ",", 
     RowBox[{"T", "\[Rule]", "0"}], ",", 
     RowBox[{"PT", "\[Rule]", "0"}], ",", 
     RowBox[{"WX", "\[Rule]", "0"}], ",", 
     RowBox[{"PHIX", "\[Rule]", "0"}], ",", 
     RowBox[{"DMUX", "\[Rule]", "0"}], ",", 
     RowBox[{"WY", "\[Rule]", "0"}], ",", 
     RowBox[{"PHIY", "\[Rule]", "0"}], ",", 
     RowBox[{"DMUY", "\[Rule]", "0"}], ",", 
     RowBox[{"DDX", "\[Rule]", "0"}], ",", 
     RowBox[{"DDY", "\[Rule]", "0"}], ",", 
     RowBox[{"DDPX", "\[Rule]", "0"}], ",", 
     RowBox[{"DDPY", "\[Rule]", "0"}], ",", 
     RowBox[{"Line", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"BETAO", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Centre", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Filename", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Deltap", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"Columns", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"File", "\[Rule]", "MADFileName"}]}], "}"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOptics", "[", "opts___", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "betx", ",", "alfx", ",", "mux", ",", "bety", ",", "alfy", ",", "muy", 
      ",", "dx", ",", "dpx", ",", "dy", ",", "dpy", ",", "x", ",", "px", ",", 
      "y", ",", "py", ",", "t", ",", "pt", ",", "wx", ",", "phix", ",", 
      "dmux", ",", "wy", ",", "phiy", ",", "dmuy", ",", "ddx", ",", "ddy", 
      ",", "ddpx", ",", "ddpy", ",", "line", ",", "betao", ",", "centre", ",",
       "filename", ",", "deltap", ",", "columns"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"betx", "=", 
      RowBox[{
       RowBox[{"BETX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alfx", "=", 
      RowBox[{
       RowBox[{"ALFX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mux", "=", 
      RowBox[{
       RowBox[{"MUX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bety", "=", 
      RowBox[{
       RowBox[{"BETY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alfy", "=", 
      RowBox[{
       RowBox[{"ALFY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"muy", "=", 
      RowBox[{
       RowBox[{"MUY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dx", "=", 
      RowBox[{
       RowBox[{"DX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dpx", "=", 
      RowBox[{
       RowBox[{"DPX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dy", "=", 
      RowBox[{
       RowBox[{"DY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dpy", "=", 
      RowBox[{
       RowBox[{"DPY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{
       RowBox[{"X", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"px", "=", 
      RowBox[{
       RowBox[{"PX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"y", "=", 
      RowBox[{
       RowBox[{"Y", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"py", "=", 
      RowBox[{
       RowBox[{"PY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t", "=", 
      RowBox[{
       RowBox[{"T", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pt", "=", 
      RowBox[{
       RowBox[{"PT", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"wx", "=", 
      RowBox[{
       RowBox[{"WX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"phix", "=", 
      RowBox[{
       RowBox[{"PHIX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dmux", "=", 
      RowBox[{
       RowBox[{"DMUX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"wy", "=", 
      RowBox[{
       RowBox[{"WY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"phiy", "=", 
      RowBox[{
       RowBox[{"PHIY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dmuy", "=", 
      RowBox[{
       RowBox[{"DMUY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ddx", "=", 
      RowBox[{
       RowBox[{"DDX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ddy", "=", 
      RowBox[{
       RowBox[{"DDY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ddpx", "=", 
      RowBox[{
       RowBox[{"DDPX", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ddpy", "=", 
      RowBox[{
       RowBox[{"DDPY", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"line", "=", 
      RowBox[{
       RowBox[{"Line", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"betao", "=", 
      RowBox[{
       RowBox[{"BETAO", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"centre", "=", 
      RowBox[{
       RowBox[{"Centre", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filename", "=", 
      RowBox[{
       RowBox[{"Filename", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"deltap", "=", 
      RowBox[{
       RowBox[{"Deltap", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"columns", "=", 
      RowBox[{
       RowBox[{"Columns", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"file", "=", 
      RowBox[{
       RowBox[{"File", "/.", 
        RowBox[{"{", "opts", "}"}]}], "/.", 
       RowBox[{"Options", "[", "MADoptics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"bmpm", "=", 
      RowBox[{"\"\<Optics\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"betx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,BETX=\>\"", "<>", 
          RowBox[{"ToString", "[", "betx", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"alfx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,ALFX=\>\"", "<>", 
          RowBox[{"ToString", "[", "alfx", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"mux", "=!=", "0"}], ",", 
         RowBox[{"\"\<,MUX=\>\"", "<>", 
          RowBox[{"ToString", "[", "mux", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"bety", "=!=", "0"}], ",", 
         RowBox[{"\"\<,BETY=\>\"", "<>", 
          RowBox[{"ToString", "[", "bety", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"alfy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,ALFY=\>\"", "<>", 
          RowBox[{"ToString", "[", "alfy", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"muy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,MUY=\>\"", "<>", 
          RowBox[{"ToString", "[", "muy", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DX=\>\"", "<>", 
          RowBox[{"ToString", "[", "dx", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dpx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DPX=\>\"", "<>", 
          RowBox[{"ToString", "[", "dpx", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DY=\>\"", "<>", 
          RowBox[{"ToString", "[", "dy", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dpy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DPY=\>\"", "<>", 
          RowBox[{"ToString", "[", "dpy", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", "=!=", "0"}], ",", 
         RowBox[{"\"\<,X=\>\"", "<>", 
          RowBox[{"ToString", "[", "x", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"px", "=!=", "0"}], ",", 
         RowBox[{"\"\<,PX=\>\"", "<>", 
          RowBox[{"ToString", "[", "px", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"y", "=!=", "0"}], ",", 
         RowBox[{"\"\<,Y=\>\"", "<>", 
          RowBox[{"ToString", "[", "y", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"t", "=!=", "0"}], ",", 
         RowBox[{"\"\<,T=\>\"", "<>", 
          RowBox[{"ToString", "[", "t", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"pt", "=!=", "0"}], ",", 
         RowBox[{"\"\<,PT=\>\"", "<>", 
          RowBox[{"ToString", "[", "pt", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"wx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,WX=\>\"", "<>", 
          RowBox[{"ToString", "[", "wx", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"phix", "=!=", "0"}], ",", 
         RowBox[{"\"\<,PHIX=\>\"", "<>", 
          RowBox[{"ToString", "[", "phix", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dmux", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DMUX=\>\"", "<>", 
          RowBox[{"ToString", "[", "dmux", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"wy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,WY=\>\"", "<>", 
          RowBox[{"ToString", "[", "wy", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"phiy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,PHIY=\>\"", "<>", 
          RowBox[{"ToString", "[", "phiy", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dmuy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DMUY=\>\"", "<>", 
          RowBox[{"ToString", "[", "dmuy", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ddx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DDX=\>\"", "<>", 
          RowBox[{"ToString", "[", "ddx", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ddy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DDY=\>\"", "<>", 
          RowBox[{"ToString", "[", "ddy", "]"}]}], ",", "\"\<\>\""}], "]"}], "<>",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ddpx", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DDPX=\>\"", "<>", 
          RowBox[{"ToString", "[", "ddpx", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ddpy", "=!=", "0"}], ",", 
         RowBox[{"\"\<,DDPY=\>\"", "<>", 
          RowBox[{"ToString", "[", "ddpy", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"line", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Line=\>\"", "<>", 
          RowBox[{"ToString", "[", "line", "]"}]}], ",", "\"\<\>\""}], "]"}], 
       "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"betao", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,BETAO=\>\"", "<>", 
          RowBox[{"ToString", "[", "betao", "]"}]}], ",", "\"\<\>\""}], "]"}],
        "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"centre", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Centre=\>\"", "<>", 
          RowBox[{"ToString", "[", "centre", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"filename", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Filename=\>\"", "<>", 
          RowBox[{"ToString", "[", "filename", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"deltap", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Deltap=\>\"", "<>", 
          RowBox[{"ToString", "[", "deltap", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"columns", "=!=", "\"\<\>\""}], ",", 
         RowBox[{"\"\<,Columns=\>\"", "<>", 
          RowBox[{"ToString", "[", "columns", "]"}]}], ",", "\"\<\>\""}], 
        "]"}], "<>", "\[IndentingNewLine]", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "bmpm", "]"}], ">", "80"}], ",", 
       RowBox[{"bmpm", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"bmpm", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"bmpm", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "65"}], "&"}]}], "]"}], "]"}], "+", "1"}]}], 
         "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "bmpm", "]"}], ">", "160"}], ",", 
       RowBox[{"bmpm", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"bmpm", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"bmpm", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "145"}], "&"}]}], "]"}], "]"}], "+", "1"}]}],
          "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", "bmpm", "]"}], ">", "240"}], ",", 
       RowBox[{"bmpm", "=", 
        RowBox[{"StringInsert", "[", 
         RowBox[{"bmpm", ",", "\"\<&\\n\>\"", ",", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"StringPosition", "[", 
                RowBox[{"bmpm", ",", "\"\<,\>\""}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", ">", "225"}], "&"}]}], "]"}], "]"}], "+", "1"}]}],
          "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"file", ",", "bmpm"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 Evaluatable->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADSplitElements", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"elementslice", "[", 
   RowBox[{"element_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
     "element", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ">", 
     "0"}], ",", 
    RowBox[{"MADFlat", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"element", ",", 
         RowBox[{
          RowBox[{
          "element", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
          "/", "slice"}], ",", "3"}], "]"}], ",", 
       RowBox[{"{", "slice", "}"}]}], "]"}], "]"}], ",", "element"}], 
   "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"bendsliceextra", "[", 
   RowBox[{"bend_", ",", "no_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"extra", "=", 
      RowBox[{"(", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "<>", "\"\<Extra\>\""}], ")"}]}], ")"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"sbend", "[", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
         "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "<>", 
         RowBox[{"ToString", "[", "no", "]"}]}], ")"}], "]"}], ",", 
      FractionBox[
       RowBox[{"bend", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
        "slice"], ",", 
      RowBox[{"bend", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
      ",", 
      FractionBox[
       RowBox[{"bend", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}],
        "slice"], ",", 
      RowBox[{"bend", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
      ",", 
      RowBox[{"Global`XAp", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`YAp", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`E1", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "1", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], ",",
          "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`E2", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "3", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], ",",
          "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`Tilt", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`K2", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`H1", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`HGap", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "2", ",", "0", ",", "_", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], 
        "]"}]}], ",", 
      RowBox[{"Global`FInt", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "1", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}], 
         ",", "3", ",", "\"\<0\>\"", ",", "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`FIntX", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "3", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}], 
         ",", "1", ",", "\"\<0\>\"", ",", "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`K3", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.4801460760887604`*^9, {3.480146174027514*^9, 3.480146177449433*^9}, {
   3.480146372561305*^9, 3.480146374280077*^9}, {3.4801466657369328`*^9, 
   3.4801466872528334`*^9}, 3.5066745786979694`*^9, {3.506674690217163*^9, 
   3.5066747247026415`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bendsliceextrar", "[", 
   RowBox[{"bend_", ",", "no_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"extra", "=", 
      RowBox[{"(", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "<>", "\"\<Extra\>\""}], ")"}]}], ")"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Switch", "[", 
      RowBox[{"no", ",", "2", ",", "rbend", ",", "_", ",", "rbend"}], "]"}], 
     "[", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
         "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "<>", 
         RowBox[{"ToString", "[", "no", "]"}]}], ")"}], "]"}], ",", 
      FractionBox[
       RowBox[{"bend", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
        "slice"], ",", 
      RowBox[{"bend", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
      ",", 
      FractionBox[
       RowBox[{"bend", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}],
        "slice"], ",", 
      RowBox[{"bend", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
      ",", 
      RowBox[{"Global`XAp", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`YAp", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`E1", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "1", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], ",",
          "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`E2", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "3", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], ",",
          "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`Tilt", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`K2", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`H1", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"Global`HGap", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], 
      ",", 
      RowBox[{"Global`FInt", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "1", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}], 
         ",", "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`FIntX", "\[Rule]", 
       RowBox[{"Switch", "[", 
        RowBox[{"no", ",", "3", ",", 
         RowBox[{
         "extra", "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}], 
         ",", "_", ",", "0"}], "]"}]}], ",", 
      RowBox[{"Global`K3", "\[Rule]", 
       RowBox[{
       "extra", "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.480146004634721*^9, 3.4801460176973877`*^9}, {
   3.506674353612642*^9, 3.506674382582319*^9}, {3.5066744340058393`*^9, 
   3.5066744364121666`*^9}, {3.506674506336279*^9, 3.506674512836487*^9}, {
   3.5066745573379107`*^9, 3.5066745599004927`*^9}, 3.5066746325121913`*^9, 
   3.506674726218315*^9, 3.5066748043770657`*^9, {3.507976343745534*^9, 
   3.507976380465459*^9}, {3.507986010617364*^9, 3.5079860176644645`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bendslice", "[", 
   RowBox[{"bend_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"bendsliceextra", "[", 
        RowBox[{"bend", ",", "#", ",", "slice"}], "]"}], "&"}], "/@", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"slice", ">", "2"}], ",", 
        RowBox[{"Range", "[", "3", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "<>", "\"\<1\>\""}], ")"}]}], "]"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"slice", ">", "2"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                "<>", "\"\<2\>\""}], ")"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"slice", "-", "2"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "}"}]}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Symbol", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "<>", "\"\<3\>\""}], ")"}]}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.64395331188929*^9, 3.643953345494638*^9}, {
  3.6439535101522245`*^9, 3.643953510573778*^9}, {3.643953548640105*^9, 
  3.6439535521249514`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bendslicer", "[", 
   RowBox[{"bend_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"bendsliceextrar", "[", 
       RowBox[{"bend", ",", "#", ",", "slice"}], "]"}], "&"}], "/@", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"slice", ">", "2"}], ",", 
       RowBox[{"Range", "[", "3", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "<>", "\"\<1\>\""}], ")"}]}], "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"slice", ">", "2"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
              "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "<>", "\"\<2\>\""}], ")"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"slice", "-", "2"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ",", 
      RowBox[{"Evaluate", "[", 
       RowBox[{"Symbol", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "bend", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "<>", "\"\<3\>\""}], ")"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", ")"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643953566283143*^9, 3.643953568009507*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElements", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"slice_", "/;", 
      RowBox[{"(", 
       RowBox[{"Not", "[", 
        RowBox[{"slice", ">", "1"}], "]"}], ")"}]}]}], "]"}], ":=", 
   RowBox[{"MADFlat", "[", "data", "]"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElements", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"slice_", "/;", 
      RowBox[{"(", 
       RowBox[{"slice", ">", "1"}], ")"}]}], ",", "options___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"c", "=", 
        RowBox[{"{", "}"}]}], ",", "b", ",", "a", ",", 
       RowBox[{"bendname", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"noflat", "=", 
       RowBox[{
        RowBox[{"NoFlat", "/.", 
         RowBox[{"{", "options", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADSplitElements", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"noflat", "=!=", "True"}], ",", 
        RowBox[{"MADFlat", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", "\"\<SectorBend\>\"", ",", 
             RowBox[{"bendslice", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<RectBend\>\"", 
             ",", 
             RowBox[{"bendslicer", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<Quadrupole\>\"", 
             ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<Drift\>\"", ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
             RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"MADFlat", "[", "data", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            "\"\<SectorBend\>\"", ",", 
            RowBox[{"bendslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<RectBend\>\"", ",", 
            RowBox[{"bendslicer", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<Quadrupole\>\"", 
            ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<Drift\>\"", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
            RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", 
         RowBox[{"MADFlat", "[", "data", "]"}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitDipoles", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"slice_", "/;", 
      RowBox[{"(", 
       RowBox[{"slice", ">", "1"}], ")"}]}], ",", "options___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"c", "=", 
        RowBox[{"{", "}"}]}], ",", "b", ",", "a", ",", 
       RowBox[{"bendname", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"noflat", "=", 
       RowBox[{
        RowBox[{"NoFlat", "/.", 
         RowBox[{"{", "options", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADSplitElements", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"noflat", "=!=", "True"}], ",", "\[IndentingNewLine]", 
        RowBox[{"MADFlat", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", "\"\<SectorBend\>\"", ",", 
             RowBox[{"bendslice", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<RectBend\>\"", 
             ",", 
             RowBox[{"bendslicer", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
             RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"MADFlat", "[", "data", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            "\"\<SectorBend\>\"", ",", 
            RowBox[{"bendslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<RectBend\>\"", ",", 
            RowBox[{"bendslicer", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
            RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", 
         RowBox[{"MADFlat", "[", "data", "]"}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6439532718656855`*^9, {3.6439534663296785`*^9, 3.643953466570567*^9}, {
   3.6439535340272365`*^9, 3.6439535343785315`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSplitDipolesLength", "[", 
   RowBox[{"latt_", ",", "len_"}], "]"}], ":=", 
  RowBox[{"MADFlatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<SectorBend\>\""}], "]"}],
         "||", 
        RowBox[{"StringMatchQ", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<RectBend\>\""}], "]"}]}],
        ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "\[GreaterEqual]", 
          RowBox[{"2", "len"}]}], ",", 
         RowBox[{"MADSplitDipoles", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Floor", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "/", "len"}], "]"}], ",", 
           RowBox[{"NoFlat", "\[Rule]", "True"}]}], "]"}], ",", "#"}], "]"}], 
       ",", "#"}], "]"}], "&"}], "/@", 
    RowBox[{"MADFlatten", "[", "latt", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6439530322783313`*^9, 3.6439531281278954`*^9}, {
  3.6439534094650555`*^9, 3.6439534133313074`*^9}, {3.6441309962131743`*^9, 
  3.644130999381491*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSplitElementsLength", "[", 
   RowBox[{"latt_", ",", "len_"}], "]"}], ":=", 
  RowBox[{"MADFlatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "\[GreaterEqual]", 
        RowBox[{"2", "len"}]}], ",", 
       RowBox[{"MADSplitElements", "[", 
        RowBox[{"#", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "/", "len"}], "]"}]}], "]"}], ",",
        "#"}], "]"}], "&"}], "/@", 
    RowBox[{"MADFlatten", "[", "latt", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6439530322783313`*^9, 3.6439531281278954`*^9}, {
  3.6439534094650555`*^9, 3.6439534133313074`*^9}, {3.644040799541142*^9, 
  3.644040822667142*^9}, {3.6441310051320667`*^9, 3.6441310080123544`*^9}, {
  3.644557633057335*^9, 3.644557634328335*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsAll", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"slice_", "/;", 
      RowBox[{"(", 
       RowBox[{"slice", ">", "1"}], ")"}]}], ",", "options___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"c", "=", 
        RowBox[{"{", "}"}]}], ",", "b", ",", "a", ",", 
       RowBox[{"bendname", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"noflat", "=", 
       RowBox[{
        RowBox[{"NoFlat", "/.", 
         RowBox[{"{", "options", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADSplitElements", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"noflat", "=!=", "True"}], ",", 
        RowBox[{"MADFlat", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", "\"\<SectorBend\>\"", ",", 
             RowBox[{"bendslice", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<RectBend\>\"", 
             ",", 
             RowBox[{"bendslicer", "[", 
              RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "slice"}], "]"}]}], "]"}], "&"}], "/@", 
          RowBox[{"MADFlat", "[", "data", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            "\"\<SectorBend\>\"", ",", 
            RowBox[{"bendslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<RectBend\>\"", ",", 
            RowBox[{"bendslicer", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}]}], "]"}], "&"}], "/@", 
         RowBox[{"MADFlat", "[", "data", "]"}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsAllSpecific", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"slicem_", "/;", 
      RowBox[{"(", 
       RowBox[{"slicem", ">", "1"}], ")"}]}], ",", 
     RowBox[{"sliced_", "/;", 
      RowBox[{"(", 
       RowBox[{"sliced", ">", "1"}], ")"}]}], ",", "options___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"c", "=", 
        RowBox[{"{", "}"}]}], ",", "b", ",", "a", ",", 
       RowBox[{"bendname", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"noflat", "=", 
       RowBox[{
        RowBox[{"NoFlat", "/.", 
         RowBox[{"{", "options", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADSplitElements", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"noflat", "=!=", "True"}], ",", "\[IndentingNewLine]", 
        RowBox[{"MADFlat", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",",
              "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
             RowBox[{"bendslice", "[", 
              RowBox[{"#", ",", "slicem"}], "]"}], ",", 
             "\[IndentingNewLine]", "\"\<RectBend\>\"", ",", 
             RowBox[{"bendslicer", "[", 
              RowBox[{"#", ",", "slicem"}], "]"}], ",", 
             "\[IndentingNewLine]", "\"\<Quadrupole\>\"", ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "slicem"}], "]"}], ",", 
             "\[IndentingNewLine]", "\"\<Sextupole\>\"", ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "slicem"}], "]"}], ",", 
             "\[IndentingNewLine]", "\"\<Octupole\>\"", ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "slicem"}], "]"}], ",", "\[IndentingNewLine]",
              "_", ",", 
             RowBox[{"elementslice", "[", 
              RowBox[{"#", ",", "sliced"}], "]"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], "/@", 
          RowBox[{"MADFlat", "[", "data", "]"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            "\[IndentingNewLine]", "\"\<SectorBend\>\"", ",", 
            RowBox[{"bendslice", "[", 
             RowBox[{"#", ",", "slicem"}], "]"}], ",", "\[IndentingNewLine]", 
            "\"\<RectBend\>\"", ",", 
            RowBox[{"bendslicer", "[", 
             RowBox[{"#", ",", "slicem"}], "]"}], ",", "\[IndentingNewLine]", 
            "\"\<Quadrupole\>\"", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slicem"}], "]"}], ",", "\[IndentingNewLine]", 
            "\"\<Sextupole\>\"", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slicem"}], "]"}], ",", "\[IndentingNewLine]", 
            "\"\<Octupole\>\"", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slicem"}], "]"}], ",", "\[IndentingNewLine]", 
            "_", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "sliced"}], "]"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"MADFlat", "[", "data", "]"}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADSplitElementsSextQuad", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"slice_", "/;", 
      RowBox[{"(", 
       RowBox[{"slice", ">", "1"}], ")"}]}], ",", "options___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"noflat", "=", 
       RowBox[{
        RowBox[{"NoFlat", "/.", 
         RowBox[{"{", "options", "}"}]}], "/.", 
        RowBox[{"Options", "[", "MADSplitElements", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"minlength", "=", 
       RowBox[{
        RowBox[{"Global`MinLength", "/.", 
         RowBox[{"{", "options", "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"Global`MinLength", "\[Rule]", "0.2"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"noflat", "=!=", "True"}], ",", 
        RowBox[{"MADFlat", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             ",", "\"\<Quadrupole\>\"", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
                ">", "minlength"}], ",", 
               RowBox[{"elementslice", "[", 
                RowBox[{"#", ",", "slice"}], "]"}], ",", 
               RowBox[{"{", "#", "}"}]}], "]"}], ",", "\"\<Sextupole\>\"", 
             ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
                ">", "minlength"}], ",", 
               RowBox[{"elementslice", "[", 
                RowBox[{"#", ",", "slice"}], "]"}], ",", 
               RowBox[{"{", "#", "}"}]}], "]"}], ",", "_", ",", 
             RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"MADFlat", "[", "data", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            "\"\<Quadrupole\>\"", ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "\"\<Sextupole\>\"", 
            ",", 
            RowBox[{"elementslice", "[", 
             RowBox[{"#", ",", "slice"}], "]"}], ",", "_", ",", 
            RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", 
         RowBox[{"MADFlat", "[", "data", "]"}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Old", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSplitElements", "[", 
   RowBox[{"data_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", "b", ",", "a", ",", 
      RowBox[{"bendname", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"c", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "=!=", "\"\<SectorBend\>\""}], "&&", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "=!=", "\"\<RectBend\>\""}]}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<Sextupole\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<Multipole\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<HBPM\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<VBPM\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<BPM\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<Kicker\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<VKicker\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<HKicker\>\""}], "&&", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "=!=", "\"\<Marker\>\""}]}], ",", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"b", "=", 
                RowBox[{"{", "}"}]}], ";", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"a", "=", 
                   RowBox[{"ReplacePart", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ")"}], "/", "slice"}], ",", 
                    "3"}], "]"}]}], ";", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"b", ",", "a"}], "]"}], ";"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Iota]", ",", "1", ",", "slice"}], "}"}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{
              RowBox[{"b", "=", "#"}], ";"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"bendname", ",", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"slice", ">", "1"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"MADClear", "[", 
                RowBox[{"Evaluate", "[", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ")"}], 
                 "]"}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"MADClear", "[", 
                RowBox[{"Evaluate", "[", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<3\>\""}], ")"}], 
                 "]"}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   "===", "\"\<SectorBend\>\""}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"sbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"sbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<3\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"rbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"rbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<3\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"b", "=", 
                  RowBox[{"{", "}"}]}], ";", 
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"a", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ")"}], "/", "slice"}], ",", 
                    "3"}], "]"}]}], ";", 
                    RowBox[{"a", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"a", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], ")"}], "/", "slice"}], ",", 
                    "6"}], "]"}]}], ";", 
                    RowBox[{"a", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"a", ",", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ",", 
                    "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"b", ",", "a"}], "]"}], ";"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"\[Iota]", ",", "1", ",", "slice"}], "}"}]}], 
                  "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"slice", "\[GreaterEqual]", "2"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"MADClear", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<2\>\""}], ")"}], 
                    "]"}], "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"sbend", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<2\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"rbend", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<2\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{"b", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"b", ",", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"[", "\[Iota]", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Last", "[", "bendname", "]"}], "<>", 
                    "\"\<2\>\""}], ",", "1"}], "]"}], ",", "\[Iota]"}], 
                    "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Iota]", ",", "2", ",", 
                    RowBox[{"slice", "-", "1"}]}], "}"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{"b", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"b", ",", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"[", "\[Iota]", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Last", "[", "bendname", "]"}], "<>", 
                    "\"\<3\>\""}], ",", "1"}], "]"}], ",", "\[Iota]"}], 
                    "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Iota]", ",", "slice", ",", "slice"}], "}"}]}], 
                   "]"}], ";"}]}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"b", "=", "#"}], ";"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"c", ",", "b"}], "]"}], ";"}], ")"}], "&"}], "/@", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "data", "]"}], ",", "7"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"MADClearExtra", "[", 
            RowBox[{"(", 
             RowBox[{"#", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], ")"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sbendExtra", "[", 
          RowBox[{
           RowBox[{"#", "<>", "\"\<1\>\""}], ",", 
           RowBox[{"Global`XAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`YAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`E1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"E2", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`Tilt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`H1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`HGap", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`FInt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K3", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sbendExtra", "[", 
          RowBox[{
           RowBox[{"#", "<>", "\"\<2\>\""}], ",", 
           RowBox[{"Global`XAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`YAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"E1", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`E2", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`Tilt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`H1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`HGap", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`FInt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K3", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sbendExtra", "[", 
          RowBox[{
           RowBox[{"#", "<>", "\"\<3\>\""}], ",", 
           RowBox[{"Global`XAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`YAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"E1", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`E2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`Tilt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`H1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`HGap", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`FInt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K3", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ";"}], ")"}], "&"}], "/@", "bendname"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "c"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADSplitDipoles", "[", 
   RowBox[{"data_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", "b", ",", "a", ",", 
      RowBox[{"bendname", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"c", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "=!=", "\"\<SectorBend\>\""}], "&&", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "=!=", "\"\<RectBend\>\""}]}], ",", 
           RowBox[{
            RowBox[{"b", "=", "#"}], ";"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"bendname", ",", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"slice", ">", "1"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"MADClear", "[", 
                RowBox[{"Evaluate", "[", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ")"}], 
                 "]"}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"MADClear", "[", 
                RowBox[{"Evaluate", "[", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<3\>\""}], ")"}], 
                 "]"}], "]"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                   "===", "\"\<SectorBend\>\""}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"sbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"sbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<3\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"rbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"rbend", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<3\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"b", "=", 
                  RowBox[{"{", "}"}]}], ";", 
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"a", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ")"}], "/", "slice"}], ",", 
                    "3"}], "]"}]}], ";", 
                    RowBox[{"a", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"a", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], ")"}], "/", "slice"}], ",", 
                    "6"}], "]"}]}], ";", 
                    RowBox[{"a", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"a", ",", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<1\>\""}], ",", 
                    "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"b", ",", "a"}], "]"}], ";"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"\[Iota]", ",", "1", ",", "slice"}], "}"}]}], 
                  "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"slice", "\[GreaterEqual]", "2"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"MADClear", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<2\>\""}], ")"}], 
                    "]"}], "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "===", "\"\<SectorBend\>\""}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"sbend", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<2\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"rbend", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Symbol", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "<>", "\"\<2\>\""}], ")"}]}], 
                    "]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                    FractionBox[
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "6", 
                    "\[RightDoubleBracket]"}], "slice"], ",", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}]}], "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{"b", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"b", ",", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"[", "\[Iota]", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Last", "[", "bendname", "]"}], "<>", 
                    "\"\<2\>\""}], ",", "1"}], "]"}], ",", "\[Iota]"}], 
                    "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Iota]", ",", "2", ",", 
                    RowBox[{"slice", "-", "1"}]}], "}"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{"b", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"b", ",", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"[", "\[Iota]", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Last", "[", "bendname", "]"}], "<>", 
                    "\"\<3\>\""}], ",", "1"}], "]"}], ",", "\[Iota]"}], 
                    "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Iota]", ",", "slice", ",", "slice"}], "}"}]}], 
                   "]"}], ";"}]}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"b", "=", "#"}], ";"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"c", ",", "b"}], "]"}], ";"}], ")"}], "&"}], "/@", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "data", "]"}], ",", "7"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"MADClearExtra", "[", 
            RowBox[{"(", 
             RowBox[{"#", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], ")"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sbendExtra", "[", 
          RowBox[{
           RowBox[{"#", "<>", "\"\<1\>\""}], ",", 
           RowBox[{"Global`XAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`YAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`E1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"E2", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`Tilt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`H1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`HGap", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`FInt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K3", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sbendExtra", "[", 
          RowBox[{
           RowBox[{"#", "<>", "\"\<2\>\""}], ",", 
           RowBox[{"Global`XAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`YAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"E1", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`E2", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`Tilt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`H1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`HGap", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`FInt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K3", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sbendExtra", "[", 
          RowBox[{
           RowBox[{"#", "<>", "\"\<3\>\""}], ",", 
           RowBox[{"Global`XAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`YAp", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"E1", "\[Rule]", "0"}], ",", 
           RowBox[{"Global`E2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`Tilt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K2", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`H1", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`HGap", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "10", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`FInt", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "11", "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Global`K3", "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], 
             "\[LeftDoubleBracket]", "12", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ";"}], ")"}], "&"}], "/@", "bendname"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"MADFlatten", "[", "c", "]"}]}]}], "]"}]}]], "Input"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["MADGetApertures", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetApertures", "[", 
   RowBox[{"lattice_", ",", "slice_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "slices", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "slice", "]"}], "===", "Rule"}], ",", 
       RowBox[{"(", 
        RowBox[{"slices", "=", 
         RowBox[{
          RowBox[{"Slice", "/.", 
           RowBox[{"{", "slice", "}"}]}], "/.", 
          RowBox[{"{", 
           RowBox[{"Slice", "\[Rule]", "1"}], "}"}]}]}], ")"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"NumberQ", "[", "slice", "]"}], ",", 
         RowBox[{"slices", "=", "slice"}], ",", 
         RowBox[{"slices", "=", "1"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADGetApertures", "[", 
      RowBox[{
       RowBox[{"MADFlatten", "[", 
        RowBox[{"MADSplitElements", "[", 
         RowBox[{"lattice", ",", "slices"}], "]"}], "]"}], ",", "1"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetApertures", "[", "lattice_", "]"}], ":=", 
  RowBox[{"MADGetApertures", "[", 
   RowBox[{"lattice", ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetApertures", "[", 
   RowBox[{"lattice2_", ",", "1"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ap", ",", "apy", ",", "apx", ",", "apy2", ",", "apx2", ",", "multipole",
       ",", "sextupole", ",", "bpm", ",", "kick", ",", "nosplitlist", ",", 
      "apertures", ",", "slices", ",", "sliceopt", ",", "lattice"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"lattice", "=", 
      RowBox[{"MADFlatten", "[", "lattice2", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"apx", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
         RowBox[{"lattice", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"apy", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
         RowBox[{"lattice", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ap", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"apx", ",", "apy"}], "}"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetAperturesJAV", "[", 
   RowBox[{"lattice_", ",", 
    RowBox[{"slice_:", "1"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ap", ",", "apy", ",", "apx", ",", "apy2", ",", "apx2", ",", "multipole",
       ",", "sextupole", ",", "bpm", ",", "kick", ",", "marker", ",", 
      "nosplitlist", ",", "apertures", ",", "slices", ",", "sliceopt"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "slice", "]"}], "===", "Rule"}], ",", 
       RowBox[{"(", 
        RowBox[{"slices", "=", 
         RowBox[{
          RowBox[{"Slice", "/.", 
           RowBox[{"{", "slice", "}"}]}], "/.", 
          RowBox[{"{", 
           RowBox[{"Slice", "\[Rule]", "1"}], "}"}]}]}], ")"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"NumberQ", "[", "slice", "]"}], ",", 
         RowBox[{"slices", "=", "slice"}], ",", 
         RowBox[{"slices", "=", "1"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"multipole", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], ",", 
         "\"\<Multipole\>\""}], "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sextupole", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], ",", 
         "\"\<Sextupole\>\""}], "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpm", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<BPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<HBPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<VBPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"kick", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<Kicker\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<HKicker\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<VKicker\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"marker", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
           ",", "\"\<Marker\>\""}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "}"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"nosplitlist", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
          "multipole", ",", "sextupole", ",", "bpm", ",", "kick", ",", 
           "marker"}], "}"}], "]"}], ",", "Greater"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"slices", ">", "1"}], ",", 
       RowBox[{
        RowBox[{"apx", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"apx2", "=", "apx"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"apx2", "=", 
           RowBox[{"MapThread", "[", 
            RowBox[{"List", ",", 
             RowBox[{"{", 
              RowBox[{"apx2", ",", "apx"}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"(", 
            RowBox[{"slices", "-", "1"}], ")"}], "}"}]}], "]"}], ";", 
        RowBox[{"apx2", "=", 
         RowBox[{"Flatten", "[", "apx2", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"apx2", "=", 
            RowBox[{"Drop", "[", 
             RowBox[{"apx2", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "-", "1"}], ")"}], "*", "slices"}], ")"}], 
                  "+", "1"}], ")"}], ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "-", "1"}], ")"}], "*", "slices"}], ")"}], 
                  "+", 
                  RowBox[{"(", 
                   RowBox[{"slices", "-", "1"}], ")"}]}], ")"}]}], "}"}]}], 
             "]"}]}], ")"}], "&"}], "/@", "nosplitlist"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"apy", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"apy2", "=", "apy"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"apy2", "=", 
           RowBox[{"MapThread", "[", 
            RowBox[{"List", ",", 
             RowBox[{"{", 
              RowBox[{"apy2", ",", "apy"}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"(", 
            RowBox[{"slices", "-", "1"}], ")"}], "}"}]}], "]"}], ";", 
        RowBox[{"apy2", "=", 
         RowBox[{"Flatten", "[", "apy2", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"apy2", "=", 
            RowBox[{"Drop", "[", 
             RowBox[{"apy2", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "-", "1"}], ")"}], "*", "slices"}], ")"}], 
                  "+", "1"}], ")"}], ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "-", "1"}], ")"}], "*", "slices"}], ")"}], 
                  "+", 
                  RowBox[{"(", 
                   RowBox[{"slices", "-", "1"}], ")"}]}], ")"}]}], "}"}]}], 
             "]"}]}], ")"}], "&"}], "/@", "nosplitlist"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ap", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{"List", ",", 
           RowBox[{"{", 
            RowBox[{"apx2", ",", "apy2"}], "}"}]}], "]"}]}], ";"}], ",", 
       RowBox[{
        RowBox[{"apx", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"apy", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Symbol", "@", 
               RowBox[{"(", 
                RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ap", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{"List", ",", 
           RowBox[{"{", 
            RowBox[{"apx", ",", "apy"}], "}"}]}], "]"}]}], ";"}]}], "]"}], 
     ";", "\[IndentingNewLine]", "ap"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADGetLengths", "[", 
    RowBox[{"lattice_", ",", 
     RowBox[{"slice_:", "1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ap", ",", "apx", ",", "apx2", ",", "multipole", ",", "sextupole", ",", 
       "bpm", ",", "kick", ",", "nosplitlist", ",", "apertures"}], "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"multipole", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], ",", 
          "\"\<Multipole\>\""}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sextupole", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], ",", 
          "\"\<Sextupole\>\""}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bpm", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             ",", "\"\<BPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             ",", "\"\<HBPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             ",", "\"\<VBPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kick", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             ",", "\"\<Kicker\>\""}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             ",", "\"\<HKicker\>\""}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
             ",", "\"\<VKicker\>\""}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nosplitlist", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"multipole", ",", "sextupole", ",", "bpm", ",", "kick"}], 
           "}"}], "]"}], ",", "Greater"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"slice", ">", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"apx", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<Sextupole\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<Multipole\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<BPM\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<HBPM\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<VBPM\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<Kicker\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<HKicker\>\""}], "||", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                 "===", "\"\<VKicker\>\""}]}], ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
                "/", "slice"}]}], "]"}], "&"}], "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}]}], 
           ")"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"apx2", "=", "apx"}], ";", "\n", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"apx2", "=", 
            RowBox[{"MapThread", "[", 
             RowBox[{"List", ",", 
              RowBox[{"{", 
               RowBox[{"apx2", ",", "apx"}], "}"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"(", 
             RowBox[{"slice", "-", "1"}], ")"}], "}"}]}], "]"}], ";", 
         RowBox[{"apx2", "=", 
          RowBox[{"Flatten", "[", "apx2", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"apx2", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"apx2", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "-", "1"}], ")"}], "*", "slice"}], ")"}], 
                   "+", "1"}], ")"}], ",", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "-", "1"}], ")"}], "*", "slice"}], ")"}], 
                   "+", 
                   RowBox[{"(", 
                    RowBox[{"slice", "-", "1"}], ")"}]}], ")"}]}], "}"}]}], 
              "]"}]}], ")"}], "&"}], "/@", "nosplitlist"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ap", "=", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"FoldList", "[", 
             RowBox[{"Plus", ",", "0", ",", "apx2"}], "]"}], ",", "1"}], 
           "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"apx", "=", 
          RowBox[{
           RowBox[{"#", "&"}], "/@", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ap", "=", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"FoldList", "[", 
             RowBox[{"Plus", ",", "0", ",", "apx"}], "]"}], ",", "1"}], 
           "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", "ap"}]}], 
    "]"}]}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.3878803709752026`*^9, 3.3878803785842853`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetCollimators", "[", "inlattice_", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ap", ",", "apy", ",", "apx", ",", "apy2", ",", "apx2", ",", "lattice"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"lattice", "=", 
      RowBox[{"MADFlatten", "[", "inlattice", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"apx", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"lattice", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RCOLLIMATOR\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<ECOLLIMATOR\>\""}]}], "&"}]}], "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"apy", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"lattice", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<RCOLLIMATOR\>\""}], "||", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "===", "\"\<ECOLLIMATOR\>\""}]}], "&"}]}], "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "4"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ap", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"apx", ",", "apy"}], "}"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Peak Determination", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindPeaks", "[", 
   RowBox[{"data1_", ",", "data2_", ",", "Opts___"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "b", ",", "c", ",", "m", ",", "y", ",", "z", ",", "n", ",", 
      "new", ",", "old", ",", "average"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"average", "=", 
      RowBox[{
       RowBox[{"Global`Average", "/.", 
        RowBox[{"{", "Opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Average", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m", "=", "0"}], ";", 
     RowBox[{"c", "=", 
      RowBox[{"{", "}"}]}], ";", 
     RowBox[{"b", "=", 
      RowBox[{
      "data1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
     RowBox[{"z", "=", 
      RowBox[{
      "data2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
     RowBox[{"n", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"a", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"y", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"a", "=!=", "b"}], "&&", 
            RowBox[{"y", "=!=", "z"}]}], ",", 
           RowBox[{
            RowBox[{"m", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"a", "-", "b"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"y", "-", "z"}], ")"}]}]}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"m", "<", "0"}], "&&", 
             RowBox[{"n", ">", "0"}]}], ")"}], ",", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"c", ",", 
             RowBox[{"{", 
              RowBox[{"b", ",", "z"}], "}"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b", "=", "a"}], ";", "\[IndentingNewLine]", 
         RowBox[{"z", "=", "y"}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", "=", "m"}], ";"}], "\[IndentingNewLine]", ")"}], "&"}], 
      "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{"data1", ",", "data2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"average", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"old", "=", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"new", "=", "#"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"new", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                RowBox[{"old", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{
                 RowBox[{"new", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "===", 
                 RowBox[{"old", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "&&", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"new", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                   RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "<", "2"}]}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"c", "=", 
                RowBox[{"ReplacePart", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"ReplacePart", "[", 
                   RowBox[{"old", ",", 
                    RowBox[{
                    RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"new", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                    RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "2"}], 
                    ")"}]}], ",", "1"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"c", ",", "old"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Delete", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"c", ",", "new"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}]}],
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"old", "=", "new"}], ";"}], ")"}], "&"}], "/@", "c"}], 
        ";"}]}], "]"}], ";", "\[IndentingNewLine]", "c"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindTroughs", "[", 
   RowBox[{"data1_", ",", "data2_", ",", "Opts___"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "b", ",", "c", ",", "m", ",", "y", ",", "z", ",", "n", ",", 
      "new", ",", "old", ",", "average"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"average", "=", 
      RowBox[{
       RowBox[{"Global`Average", "/.", 
        RowBox[{"{", "Opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Average", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m", "=", "0"}], ";", 
     RowBox[{"c", "=", 
      RowBox[{"{", "}"}]}], ";", 
     RowBox[{"b", "=", 
      RowBox[{
      "data1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
     RowBox[{"z", "=", 
      RowBox[{
      "data2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
     RowBox[{"n", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"a", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"y", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"a", "=!=", "b"}], "&&", 
            RowBox[{"y", "=!=", "z"}]}], ",", 
           RowBox[{
            RowBox[{"m", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"a", "-", "b"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"y", "-", "z"}], ")"}]}]}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"m", ">", "0"}], "&&", 
             RowBox[{"n", "<", "0"}]}], ")"}], ",", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"c", ",", 
             RowBox[{"{", 
              RowBox[{"b", ",", "z"}], "}"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b", "=", "a"}], ";", "\[IndentingNewLine]", 
         RowBox[{"z", "=", "y"}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", "=", "m"}], ";"}], "\[IndentingNewLine]", ")"}], "&"}], 
      "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{"data1", ",", "data2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"average", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"old", "=", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"new", "=", "#"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"new", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                RowBox[{"old", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{
                 RowBox[{"new", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "===", 
                 RowBox[{"old", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "&&", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"new", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                   RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "<", "2"}]}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"c", "=", 
                RowBox[{"ReplacePart", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"ReplacePart", "[", 
                   RowBox[{"old", ",", 
                    RowBox[{
                    RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"new", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                    RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "2"}], 
                    ")"}]}], ",", "1"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"c", ",", "old"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Delete", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"c", ",", "new"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}]}],
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"old", "=", "new"}], ";"}], ")"}], "&"}], "/@", "c"}], 
        ";"}]}], "]"}], ";", "\[IndentingNewLine]", "c"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindTurningPoints", "[", 
   RowBox[{"data1_", ",", "data2_", ",", "Opts___"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "b", ",", "c", ",", "m", ",", "y", ",", "z", ",", "n", ",", 
      "new", ",", "old", ",", "average"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"average", "=", 
      RowBox[{
       RowBox[{"Global`Average", "/.", 
        RowBox[{"{", "Opts", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"Global`Average", "\[Rule]", "True"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m", "=", "0"}], ";", 
     RowBox[{"c", "=", 
      RowBox[{"{", "}"}]}], ";", 
     RowBox[{"b", "=", 
      RowBox[{
      "data1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
     RowBox[{"z", "=", 
      RowBox[{
      "data2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
     RowBox[{"n", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"a", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"y", "=", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"a", "=!=", "b"}], "&&", 
            RowBox[{"y", "=!=", "z"}]}], ",", 
           RowBox[{
            RowBox[{"m", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"a", "-", "b"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"y", "-", "z"}], ")"}]}]}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"m", ">", "0"}], "&&", 
              RowBox[{"n", "<", "0"}]}], ")"}], "||", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"m", "<", "0"}], "&&", 
              RowBox[{"n", ">", "0"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"c", ",", 
             RowBox[{"{", 
              RowBox[{"b", ",", "z"}], "}"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b", "=", "a"}], ";", "\[IndentingNewLine]", 
         RowBox[{"z", "=", "y"}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", "=", "m"}], ";"}], "\[IndentingNewLine]", ")"}], "&"}], 
      "/@", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{"data1", ",", "data2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"average", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"old", "=", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"new", "=", "#"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"new", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                RowBox[{"old", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{
                 RowBox[{"new", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "===", 
                 RowBox[{"old", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "&&", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"new", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                   RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "<", "2"}]}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"c", "=", 
                RowBox[{"ReplacePart", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"ReplacePart", "[", 
                   RowBox[{"old", ",", 
                    RowBox[{
                    RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"new", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                    RowBox[{"old", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "2"}], 
                    ")"}]}], ",", "1"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"c", ",", "old"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Delete", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"c", ",", "new"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}]}],
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"old", "=", "new"}], ";"}], ")"}], "&"}], "/@", "c"}], 
        ";"}]}], "]"}], ";", "\[IndentingNewLine]", "c"}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADFlatten", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFlatten", "[", "list_", "]"}], ":=", 
   RowBox[{"ExpandLattice", "[", "list", "]"}]}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"ee0840ba-8864-4bb8-a5a1-10631b696827"],

Cell["MADFlat[list_] := Level[list, {-2}];", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.417244737592224*^9, 3.4172447395141115`*^9}, 
   3.726296247878924*^9},ExpressionUUID->"a99ad48e-2166-46e3-b257-\
685a2b505201"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADFlat", "[", "list_", "]"}], ":=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "list", "]"}], ",", "7"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.417244737592224*^9, 3.4172447395141115`*^9}, {
  3.726296251590295*^9, 
  3.7262962595580916`*^9}},ExpressionUUID->"ae3dae97-4a59-4e48-99c6-\
a790a3a6752d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["MADBETA0", "Subsection",
 CellChangeTimes->{{3.5152210333379736`*^9, 3.5152210401661863`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "MADBETA0", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"MADBETA0", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MADBETA0", "[", 
    RowBox[{"file_", ",", "name_String", ",", 
     RowBox[{"alfx_:", "Null"}], ",", 
     RowBox[{"betx_:", "Null"}], ",", 
     RowBox[{"alfy_:", "Null"}], ",", 
     RowBox[{"bety_:", "Null"}], ",", 
     RowBox[{"dx_:", "Null"}], ",", 
     RowBox[{"dpx_:", "Null"}], ",", 
     RowBox[{"x_:", "Null"}], ",", 
     RowBox[{"px_:", "Null"}], ",", 
     RowBox[{"y_:", "Null"}], ",", 
     RowBox[{"py_:", "Null"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MADStringWrite", "[", 
       RowBox[{"file", ",", 
        RowBox[{
        "name", "<>", "\"\<: BETA0,&\\n\>\"", "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"alfx", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "alfx", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"betx", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "betx", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"alfy", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "alfy", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"bety", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "bety", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"dx", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "dx", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"dpx", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "dpx", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"x", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "x", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"px", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "px", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"y", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "y", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"py", "===", "Null"}], ",", "\"\<\>\"", ",", 
           RowBox[{"\"\<alfx=\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NumberRight", "[", "py", "]"}], "]"}], "<>", 
            "\"\<,&\\n\>\""}]}], "]"}], "<>", "\"\<;\\n\>\""}]}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MADBETA0", "[", 
   RowBox[{"file_", ",", "name_String", ",", 
    RowBox[{"{", "twissrules__Rule", "}"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"MADStringWrite", "[", 
     RowBox[{"file", ",", 
      RowBox[{
      "name", "<>", "\"\<: BETA0,&\\n\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{"HoldForm", ",", 
               RowBox[{"HoldForm", "[", "twissrules", "]"}], ",", "2"}], 
              "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"#", ",", "1", ",", "1"}], "\[RightDoubleBracket]"}], 
            "]"}], "<>", "\"\<=\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"NumberRight", "[", 
             RowBox[{
              RowBox[{"HoldForm", "[", "twissrules", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"#", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
            "]"}], "<>", "\"\<,&\\n\>\""}], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"HoldForm", "[", "twissrules", "]"}], "]"}], "]"}]}], 
        "]"}], "<>", "\"\<;\\n\>\""}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5152196001477537`*^9, 3.5152198159161406`*^9}, {
  3.515219851182217*^9, 3.515219967793085*^9}, {3.5152200271532197`*^9, 
  3.5152200278876038`*^9}, {3.5152206924429855`*^9, 3.5152207083181887`*^9}, {
  3.5152207506624804`*^9, 3.5152209678683853`*^9}, {3.515221011650196*^9, 
  3.515221012103327*^9}, {3.515221169370965*^9, 3.5152211866680613`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["End", "Subsection",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"End", "[", " ", "]"}]], "Input",
 Evaluatable->True,
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"EndPackage", "[", " ", "]"}]], "Input",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["MADZAP Commands", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADGetZAPData", "[", "file_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "a", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "a", "=", 
      "\"\<select,flag=optics,full;\\noptics,filename=\\\"zap.optics.txt\\\",\
columns=s,betx,alfx,bety,alfy,dx,ddx;\\n\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"MADStringWrite", "[", 
      RowBox[{"file", ",", "a"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"RunMAD", "[", 
      RowBox[{"ToString", "[", "file", "]"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MADOutputZAPData", "[", 
   RowBox[{"lattice_", ",", 
    RowBox[{"infile_:", "\"\<zap.optics.txt\>\""}], ",", 
    RowBox[{"outfile_:", "\"\<zaplat.dat\>\""}], ",", 
    RowBox[{"slice_:", "1"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "b", ",", "ap", ",", "ap2", ",", "multipole", ",", "sextupole",
       ",", "bpm", ",", "nosplitlist"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mfsInterpret", "[", 
      RowBox[{"tfsRead", "[", 
       RowBox[{"ToString", "[", "infile", "]"}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"multipole", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], ",", 
         "\"\<Multipole\>\""}], "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sextupole", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], ",", 
         "\"\<Sextupole\>\""}], "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bpm", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<BPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<HBPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
            ",", "\"\<VBPM\>\""}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nosplitlist", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"multipole", ",", "sextupole", ",", "bpm"}], "}"}], "]"}], 
        ",", "Greater"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapThread", "[", 
          RowBox[{"List", ",", 
           RowBox[{"{", 
            RowBox[{
            "S", ",", "BETX", ",", "ALFX", ",", "BETY", ",", "ALFY", ",", 
             "DX", ",", "DDX"}], "}"}]}], "]"}], "]"}], ",", "7"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ap", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Symbol", "@", 
            RowBox[{"(", 
             RowBox[{"#", "<>", "\"\<Extra\>\""}], ")"}]}], ")"}], "&"}], "/@", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "lattice", "]"}], ",", "7"}], "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ap2", "=", "ap"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"ap2", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{"List", ",", 
          RowBox[{"{", 
           RowBox[{"ap2", ",", "ap"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"(", 
         RowBox[{"slice", "-", "1"}], ")"}], "}"}]}], "]"}], ";", 
     RowBox[{"ap2", "=", 
      RowBox[{"Flatten", "[", "ap2", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"ap2", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"ap2", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"#", "+", "1"}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"#", "+", 
               RowBox[{"(", 
                RowBox[{"slice", "-", "1"}], ")"}]}], ")"}]}], "}"}]}], 
          "]"}]}], ")"}], "&"}], "/@", "nosplitlist"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "ap2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fileout", "=", 
      RowBox[{"OpenWrite", "[", 
       RowBox[{"ToString", "[", "outfile", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"fileout", ",", 
       RowBox[{
        RowBox[{"ToString", "[", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Length", "[", "S", "]"}], "-", "2"}], ")"}], "]"}], "<>", 
        "\"\<,\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Last", "[", "S", "]"}], "]"}], "<>", "\"\<\\n\>\""}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"fileout", ",", "\"\<Lattice Produced from MAD Data\\n\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"WriteString", "[", 
            RowBox[{"fileout", ",", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"NumberForm", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"ExponentFunction", "\[Rule]", 
                  RowBox[{"(", 
                   RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
              "\"\< \\t\>\""}]}], "]"}], "&"}], "/@", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
         RowBox[{"WriteString", "[", 
          RowBox[{"fileout", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"WriteString", "[", 
          RowBox[{"fileout", ",", "\"\<\\n\>\""}], "]"}], ";"}], ")"}], "&"}],
       "/@", "b"}], ";", "\[IndentingNewLine]", 
     RowBox[{"WriteString", "[", 
      RowBox[{"fileout", ",", "\"\<0/DYNAMIC APERTURE CALCULATION\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Close", "[", "fileout", "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MADZAP", "[", 
    RowBox[{"lattice_", ",", 
     RowBox[{"slice_:", "1"}], ",", 
     RowBox[{"file_:", "\"\<madzap\>\""}], ",", 
     RowBox[{"infile_:", "\"\<zap.optics.txt\>\""}], ",", 
     RowBox[{"outfile_:", "\"\<zaplat.dat\>\""}]}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MADGetZAPData", "[", 
      RowBox[{"(", 
       RowBox[{"file", "<>", "\"\<.mff\>\""}], ")"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MADOutputZAPData", "[", 
      RowBox[{"lattice", ",", "infile", ",", "outfile", ",", "slice"}], "]"}],
      ";"}], ")"}]}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
ScreenStyleEnvironment->"Working",
WindowToolbars->"EditBar",
WindowSize->{1920, 998},
WindowMargins->{{Automatic, 1722}, {Automatic, 64}},
Visible->True,
PrintingCopies->1,
PrintingPageRange->{Automatic, Automatic},
PrintingOptions->{"PrintCellBrackets"->False,
"PrintMultipleHorizontalPages"->False,
"PrintRegistrationMarks"->False,
"PrintingMargins"->{{36, 54}, {72, 72}}},
ShowSelection->True,
InputAliases->{"notation" -> RowBox[{"Notation", "[", 
     RowBox[{
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> "NotationTemplateStyle"],
        " ", "\[DoubleLongLeftRightArrow]", " ", 
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> 
        "NotationTemplateStyle"]}], "]"}], "notation>" -> 
  RowBox[{"Notation", "[", 
     RowBox[{
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> "NotationTemplateStyle"],
        " ", "\[DoubleLongRightArrow]", " ", 
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> 
        "NotationTemplateStyle"]}], "]"}], "notation<" -> 
  RowBox[{"Notation", "[", 
     RowBox[{
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> "NotationTemplateStyle"],
        " ", "\[DoubleLongLeftArrow]", " ", 
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> 
        "NotationTemplateStyle"]}], "]"}], "symb" -> RowBox[{"Symbolize", "[", 
     TagBox[
     "\[Placeholder]", NotationBoxTag, TagStyle -> "NotationTemplateStyle"], 
     "]"}], "infixnotation" -> RowBox[{"InfixNotation", "[", 
     RowBox[{
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> "NotationTemplateStyle"],
        ",", "\[Placeholder]"}], "]"}], "addia" -> 
  RowBox[{"AddInputAlias", "[", 
     RowBox[{"\"\[Placeholder]\"", "\[Rule]", 
       TagBox[
       "\[Placeholder]", NotationBoxTag, TagStyle -> 
        "NotationTemplateStyle"]}], "]"}], "pattwraper" -> 
  TagBox["\[Placeholder]", NotationPatternTag, TagStyle -> 
    "NotationPatternWrapperStyle"], "madeboxeswraper" -> 
  TagBox["\[Placeholder]", NotationMadeBoxesTag, TagStyle -> 
    "NotationMadeBoxesWrapperStyle"]},
FrontEndVersion->"11.2 for Microsoft Windows (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Reference section"->{
  Cell[1213, 49, 60, 1, 67, "Section",ExpressionUUID->"40648e29-e0d9-484b-a0b0-0494841bea24",
   CellTags->"Reference section"],
  Cell[1298, 54, 62, 1, 70, "Subsubsection",ExpressionUUID->"4ef819e7-ad2b-48fb-bf5b-7bc2d92a7942",
   CellTags->"Reference section"],
  Cell[1363, 57, 135, 6, 70, "Text",ExpressionUUID->"9521c758-5248-4e00-8062-462adc8e19e6",
   CellTags->"Reference section"],
  Cell[1535, 68, 63, 1, 70, "Subsubsection",ExpressionUUID->"11c855d8-d2b0-4aa9-bc9f-ef37882817d2",
   CellTags->"Reference section"],
  Cell[1601, 71, 62, 1, 70, "Text",ExpressionUUID->"5f5a9d4c-ccdb-44b3-aee7-9f229a2765c1",
   CellTags->"Reference section"],
  Cell[1700, 77, 64, 1, 70, "Subsubsection",ExpressionUUID->"9860f1f0-322a-47a3-95bf-cec7b4605499",
   CellTags->"Reference section"],
  Cell[1767, 80, 187, 6, 70, "Text",ExpressionUUID->"c0ae894f-a803-41bf-b7cf-ebaa5a62bca4",
   CellTags->"Reference section"],
  Cell[1957, 88, 131, 3, 70, "Text",ExpressionUUID->"bce737a5-e76b-492a-a0b2-3f9c3761921a",
   CellTags->"Reference section"],
  Cell[2125, 96, 73, 1, 70, "Subsubsection",ExpressionUUID->"e8cd53f7-3db3-4ca2-950c-89c93432c88f",
   CellTags->"Reference section"],
  Cell[2201, 99, 119, 2, 70, "Text",ExpressionUUID->"20f916e4-126d-4f14-9d1b-6fe054df9149",
   CellTags->"Reference section"],
  Cell[2357, 106, 129, 5, 70, "Subsubsection",ExpressionUUID->"3f8d9842-8d26-437b-9580-edbc7385c8b6",
   CellTags->"Reference section"],
  Cell[2489, 113, 119, 2, 70, "Text",ExpressionUUID->"5b6f0449-05d2-4a06-ae02-103e8e3f3bd4",
   CellTags->"Reference section"],
  Cell[2645, 120, 64, 1, 70, "Subsubsection",ExpressionUUID->"603c5b5c-de21-4312-9328-9e69839816b7",
   CellTags->"Reference section"],
  Cell[5306, 182, 65, 1, 70, "Subsubsection",ExpressionUUID->"93adc050-bf60-4271-a8ae-6a53b7e63634",
   CellTags->"Reference section"],
  Cell[5374, 185, 84, 1, 70, "Text",ExpressionUUID->"4e1b4c76-8eb2-4463-9c59-2918060768c6",
   CellTags->"Reference section"],
  Cell[5495, 191, 69, 1, 70, "Subsubsection",ExpressionUUID->"196e0db6-990c-4cd0-82bf-3931843dd7d8",
   CellTags->"Reference section"],
  Cell[5567, 194, 102, 1, 70, "Text",ExpressionUUID->"e73b05ce-ff0c-482a-8a57-9a46492b96bf",
   CellTags->"Reference section"],
  Cell[5672, 197, 119, 3, 70, "Text",ExpressionUUID->"954ccda6-6ef6-4aeb-aa29-463a31129602",
   CellTags->"Reference section"],
  Cell[5794, 202, 370, 10, 70, "Text",ExpressionUUID->"d589e5ef-55ce-4e3b-b9cf-682d41d342c9",
   CellTags->"Reference section"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Reference section", 1756955, 42596}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 608, 23, 231, "Title",ExpressionUUID->"657f691f-ecb7-4b01-b739-7ca4e1b45ad0"],
Cell[CellGroupData[{
Cell[1213, 49, 60, 1, 67, "Section",ExpressionUUID->"40648e29-e0d9-484b-a0b0-0494841bea24",
 CellTags->"Reference section"],
Cell[CellGroupData[{
Cell[1298, 54, 62, 1, 70, "Subsubsection",ExpressionUUID->"4ef819e7-ad2b-48fb-bf5b-7bc2d92a7942",
 CellTags->"Reference section"],
Cell[1363, 57, 135, 6, 70, "Text",ExpressionUUID->"9521c758-5248-4e00-8062-462adc8e19e6",
 CellTags->"Reference section"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1535, 68, 63, 1, 70, "Subsubsection",ExpressionUUID->"11c855d8-d2b0-4aa9-bc9f-ef37882817d2",
 CellTags->"Reference section"],
Cell[1601, 71, 62, 1, 70, "Text",ExpressionUUID->"5f5a9d4c-ccdb-44b3-aee7-9f229a2765c1",
 CellTags->"Reference section"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1700, 77, 64, 1, 70, "Subsubsection",ExpressionUUID->"9860f1f0-322a-47a3-95bf-cec7b4605499",
 CellTags->"Reference section"],
Cell[1767, 80, 187, 6, 70, "Text",ExpressionUUID->"c0ae894f-a803-41bf-b7cf-ebaa5a62bca4",
 CellTags->"Reference section"],
Cell[1957, 88, 131, 3, 70, "Text",ExpressionUUID->"bce737a5-e76b-492a-a0b2-3f9c3761921a",
 CellTags->"Reference section"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2125, 96, 73, 1, 70, "Subsubsection",ExpressionUUID->"e8cd53f7-3db3-4ca2-950c-89c93432c88f",
 CellTags->"Reference section"],
Cell[2201, 99, 119, 2, 70, "Text",ExpressionUUID->"20f916e4-126d-4f14-9d1b-6fe054df9149",
 CellTags->"Reference section"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2357, 106, 129, 5, 70, "Subsubsection",ExpressionUUID->"3f8d9842-8d26-437b-9580-edbc7385c8b6",
 CellTags->"Reference section"],
Cell[2489, 113, 119, 2, 70, "Text",ExpressionUUID->"5b6f0449-05d2-4a06-ae02-103e8e3f3bd4",
 CellTags->"Reference section"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2645, 120, 64, 1, 70, "Subsubsection",ExpressionUUID->"603c5b5c-de21-4312-9328-9e69839816b7",
 CellTags->"Reference section"],
Cell[2712, 123, 186, 6, 70, "Text",ExpressionUUID->"bf02d0d1-d0ce-4115-a816-0faa87c33471"],
Cell[2901, 131, 1572, 23, 70, "Text",ExpressionUUID->"e66d1f24-d230-4ec4-9471-847ad82770ef"],
Cell[4476, 156, 608, 12, 70, "Text",ExpressionUUID->"05816bf7-a62d-4f8d-affb-c9e0ba2b873f"],
Cell[5087, 170, 182, 7, 70, "Text",ExpressionUUID->"ad62d37e-ce3a-4ca1-ab91-58a51b3aa4d2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5306, 182, 65, 1, 70, "Subsubsection",ExpressionUUID->"93adc050-bf60-4271-a8ae-6a53b7e63634",
 CellTags->"Reference section"],
Cell[5374, 185, 84, 1, 70, "Text",ExpressionUUID->"4e1b4c76-8eb2-4463-9c59-2918060768c6",
 CellTags->"Reference section"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5495, 191, 69, 1, 70, "Subsubsection",ExpressionUUID->"196e0db6-990c-4cd0-82bf-3931843dd7d8",
 CellTags->"Reference section"],
Cell[5567, 194, 102, 1, 70, "Text",ExpressionUUID->"e73b05ce-ff0c-482a-8a57-9a46492b96bf",
 CellTags->"Reference section"],
Cell[5672, 197, 119, 3, 70, "Text",ExpressionUUID->"954ccda6-6ef6-4aeb-aa29-463a31129602",
 CellTags->"Reference section"],
Cell[5794, 202, 370, 10, 70, "Text",ExpressionUUID->"d589e5ef-55ce-4e3b-b9cf-682d41d342c9",
 CellTags->"Reference section"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[6213, 218, 57, 1, 53, "Section",ExpressionUUID->"9f2ca813-677c-4594-bf10-75bbc24283cb",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[6295, 223, 27, 0, 53, "Subsection",ExpressionUUID->"93453004-5d64-47fd-ae95-b21bd4b9cb2e"],
Cell[6325, 225, 100, 2, 70, "Input",ExpressionUUID->"9b77aea5-d049-4c99-bc86-87d1d0e0acdf"],
Cell[6428, 229, 795, 16, 70, "Input",ExpressionUUID->"473b3d45-da07-4820-8561-fc2270795689",
 Evaluatable->True,
 InitializationCell->True],
Cell[7226, 247, 146, 4, 70, "Input",ExpressionUUID->"c1acd28a-9c36-4b6b-b4db-2398856c4963",
 Evaluatable->True,
 InitializationCell->True],
Cell[7375, 253, 145, 4, 70, "Input",ExpressionUUID->"15f2da34-e182-4baf-932b-59e678c44959",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[7557, 262, 51, 0, 37, "Subsection",ExpressionUUID->"c1c40160-8ff0-473c-b717-547f7364561c"],
Cell[CellGroupData[{
Cell[7633, 266, 30, 0, 44, "Subsubsection",ExpressionUUID->"8fb63e7e-dd05-4617-ba5a-7d0e59838b68"],
Cell[7666, 268, 4105, 108, 368, "Input",ExpressionUUID->"51951e15-1dec-4bd7-ba23-0c15f95e9d09",
 InitializationCell->True],
Cell[11774, 378, 164, 5, 44, "Input",ExpressionUUID->"30c3bc34-03a6-493c-9c9f-cd98a3f85c34",
 InitializationCell->True],
Cell[11941, 385, 8416, 230, 330, "Input",ExpressionUUID->"506bdeea-f375-47d1-898e-559440a0ebdc",
 InitializationCell->True],
Cell[20360, 617, 3518, 109, 539, "Input",ExpressionUUID->"97d42c92-1a9f-4fa3-b863-666b8837f730",
 InitializationCell->True],
Cell[23881, 728, 1728, 43, 102, "Input",ExpressionUUID->"fb84f9ae-3a64-412b-82bd-8c6b3d47e833",
 Evaluatable->True,
 InitializationCell->True],
Cell[25612, 773, 1651, 42, 102, "Input",ExpressionUUID->"2dad235e-b5da-49d5-bf2f-c6f1a1a5985b",
 Evaluatable->True,
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[27300, 820, 32, 0, 44, "Subsubsection",ExpressionUUID->"7b044c6b-4277-41b4-8de2-8df72186e2b5"],
Cell[27335, 822, 270, 8, 44, "Input",ExpressionUUID->"4d1fcd1d-2dac-4bf2-a001-814b6d316e67",
 InitializationCell->True],
Cell[27608, 832, 269, 7, 44, "Input",ExpressionUUID->"6b23de85-e833-4a2a-b33c-88e19f591902",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[27914, 844, 32, 0, 44, "Subsubsection",ExpressionUUID->"09c2ae22-c830-483f-bc06-1bc5690dcab1"],
Cell[27949, 846, 1089, 25, 70, "Input",ExpressionUUID->"f7b64650-ff4e-4623-bbc9-aad4c9f907b0",
 InitializationCell->True],
Cell[29041, 873, 1076, 25, 70, "Input",ExpressionUUID->"8d7bfc0b-ab9e-4818-822f-99a068950003",
 InitializationCell->True],
Cell[30120, 900, 2111, 62, 70, "Input",ExpressionUUID->"7e11326d-345b-4bae-9673-c2025d03f7c8",
 InitializationCell->True],
Cell[32234, 964, 1082, 24, 70, "Input",ExpressionUUID->"925c6868-5cf9-4068-aa40-91466813c99f",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[33353, 993, 104, 1, 36, "Subsubsection",ExpressionUUID->"b4fc40ea-10c1-465f-9e9b-000a5ff899f6"],
Cell[33460, 996, 4295, 133, 70, "Input",ExpressionUUID->"f92c035f-a8b0-463e-bcc2-a355ed3cbc85",
 Evaluatable->False]
}, Closed]],
Cell[CellGroupData[{
Cell[37792, 1134, 33, 0, 36, "Subsubsection",ExpressionUUID->"0533d17d-8ee2-42e9-b960-52e3b151d496"],
Cell[37828, 1136, 419, 13, 70, "Input",ExpressionUUID->"8b2e9254-de73-4b30-a200-2500959c1b98",
 InitializationCell->True],
Cell[38250, 1151, 315, 10, 70, "Input",ExpressionUUID->"f257c959-fb61-44e2-bfd5-1c3c4409d7e4",
 Evaluatable->True,
 InitializationCell->True],
Cell[38568, 1163, 280, 9, 70, "Input",ExpressionUUID->"5152470e-6218-4463-8307-881e6b413bcc",
 Evaluatable->True,
 InitializationCell->True],
Cell[38851, 1174, 160, 5, 70, "Input",ExpressionUUID->"fd4c627d-a57e-45bd-bc77-04fb7f0673ec",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[39048, 1184, 45, 0, 36, "Subsubsection",ExpressionUUID->"d8195959-aa59-4f1f-b7c9-901d58cbfabd"],
Cell[39096, 1186, 909, 30, 70, "Input",ExpressionUUID->"dd357654-d6b6-4004-8b75-ea74fe7b1b87",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[40042, 1221, 47, 0, 36, "Subsubsection",ExpressionUUID->"7d171ae3-d30e-47a9-8d04-d04abb9bfca5"],
Cell[40092, 1223, 1469, 47, 70, "Input",ExpressionUUID->"77b8e956-6497-4832-a80c-8799bcbec147",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[41598, 1275, 33, 0, 36, "Subsubsection",ExpressionUUID->"2abb2437-cf29-4ebb-8b6c-a6f2ea8cd900"],
Cell[41634, 1277, 180, 6, 70, "Input",ExpressionUUID->"be613281-148a-4aeb-95e8-851c736e2c14",
 Evaluatable->True,
 InitializationCell->True],
Cell[41817, 1285, 339, 10, 70, "Input",ExpressionUUID->"8e2ff40e-6f1a-40cf-a026-947b3eb1cdb4",
 Evaluatable->True,
 InitializationCell->True],
Cell[42159, 1297, 230, 7, 70, "Input",ExpressionUUID->"83fc8b78-b296-43ac-99c7-e49be45ce422",
 Evaluatable->True,
 InitializationCell->True],
Cell[42392, 1306, 355, 10, 70, "Input",ExpressionUUID->"98114c65-37df-4dab-8d1a-21dcbab5728f",
 Evaluatable->True,
 InitializationCell->True],
Cell[42750, 1318, 138, 4, 70, "Input",ExpressionUUID->"d6541f91-d18f-440e-b703-eed48b14f72a",
 InitializationCell->True],
Cell[42891, 1324, 139, 4, 70, "Input",ExpressionUUID->"34b9ae64-1754-41ff-9ea5-3139d3a79618",
 InitializationCell->True],
Cell[43033, 1330, 138, 4, 70, "Input",ExpressionUUID->"f156658b-0cbd-47d8-81ff-8be4e899b9a9",
 InitializationCell->True],
Cell[43174, 1336, 139, 4, 70, "Input",ExpressionUUID->"018802f7-992d-4008-a6bf-a259b174f132",
 InitializationCell->True],
Cell[43316, 1342, 131, 4, 70, "Input",ExpressionUUID->"f14bb763-838a-4998-81e0-0dc9c8b1bddf",
 InitializationCell->True],
Cell[43450, 1348, 131, 4, 70, "Input",ExpressionUUID->"db1e85a2-b18e-4782-b26f-d3546ac3b633",
 InitializationCell->True],
Cell[43584, 1354, 134, 4, 70, "Input",ExpressionUUID->"6f24a375-cddc-4276-8cb1-cd564c325da4",
 InitializationCell->True],
Cell[43721, 1360, 134, 4, 70, "Input",ExpressionUUID->"08902feb-f186-4c16-85b6-ae4ee994bbff",
 InitializationCell->True],
Cell[43858, 1366, 146, 5, 70, "Input",ExpressionUUID->"e71a3ff7-39ee-4f42-aba9-6ddade297e3b",
 InitializationCell->True],
Cell[44007, 1373, 141, 4, 70, "Input",ExpressionUUID->"ec01ab8a-780c-4296-b914-a95af9a36074",
 InitializationCell->True],
Cell[44151, 1379, 138, 4, 70, "Input",ExpressionUUID->"595758e5-f6fb-45dc-985f-b1a247850a18",
 InitializationCell->True],
Cell[44292, 1385, 145, 5, 70, "Input",ExpressionUUID->"98653c9b-25ba-4bbf-9e4f-12207113e558",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[44474, 1395, 33, 0, 36, "Subsubsection",ExpressionUUID->"37a2ab38-c5f0-48e0-8399-141a0c0e124e"],
Cell[44510, 1397, 828, 26, 70, "Input",ExpressionUUID->"3c86dd0c-6478-495c-bfd6-b50b6a12f22e",
 Evaluatable->True,
 InitializationCell->True],
Cell[45341, 1425, 481, 13, 70, "Input",ExpressionUUID->"d9bbbdb3-1842-462e-93e3-ce68a2f34edf",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[45859, 1443, 42, 0, 36, "Subsubsection",ExpressionUUID->"97e1f96b-aed6-4555-8ea8-0c3dc7ed049b"],
Cell[45904, 1445, 2493, 78, 70, "Input",ExpressionUUID->"bc585b05-ab93-40fd-ae7b-60d21e3e07bd",
 Evaluatable->True,
 InitializationCell->True],
Cell[48400, 1525, 2350, 73, 70, "Input",ExpressionUUID->"71a0094a-8569-4ab1-ba88-743694adea31",
 InitializationCell->True],
Cell[50753, 1600, 1034, 25, 70, "Input",ExpressionUUID->"2d104d92-a203-4ca6-a46b-7c0d10b6de7d",
 Evaluatable->True,
 InitializationCell->True],
Cell[51790, 1627, 1028, 24, 70, "Input",ExpressionUUID->"854f6b2b-56e0-45f5-a608-4f0fe673d586",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[52855, 1656, 34, 0, 36, "Subsubsection",ExpressionUUID->"cdc963b0-e84d-43e0-b7b4-e26d0b7d5324"],
Cell[52892, 1658, 445, 14, 70, "Input",ExpressionUUID->"c5fc63fb-b230-4899-8f97-45d77266e818",
 Evaluatable->True,
 InitializationCell->True],
Cell[53340, 1674, 335, 10, 70, "Input",ExpressionUUID->"60b07a20-7643-4406-94ef-75fb85caa36c",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[53712, 1689, 94, 0, 36, "Subsubsection",ExpressionUUID->"56fdd13b-215f-4368-9346-26bc46bc7348"],
Cell[53809, 1691, 1133, 33, 70, "Input",ExpressionUUID->"5973d425-dc85-4887-824e-493fd001421c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[54979, 1729, 34, 0, 36, "Subsubsection",ExpressionUUID->"6cfbd35b-54b9-4e42-9ae1-8d3b1d5660f9"],
Cell[55016, 1731, 356, 10, 70, "Input",ExpressionUUID->"ad62a90c-9f71-43b4-8695-c542fcd610e8"],
Cell[55375, 1743, 302, 9, 70, "Input",ExpressionUUID->"b2d290bb-1dfc-4938-9e64-b50a90a5b262",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[55714, 1757, 30, 0, 36, "Subsubsection",ExpressionUUID->"f0a50b5e-55b6-4c05-804b-cb7675e1fa21"],
Cell[55747, 1759, 208, 6, 46, "Input",ExpressionUUID->"60fd404a-eb96-44d6-8b24-ca7ed131a4de",
 InitializationCell->True],
Cell[55958, 1767, 891, 32, 180, "Input",ExpressionUUID->"4d1821a2-67eb-461b-a13e-e8a08e11797e",
 InitializationCell->True],
Cell[56852, 1801, 134, 4, 46, "Input",ExpressionUUID->"8a1fcf1e-ff0a-4b3c-a356-c1c88d347e92",
 InitializationCell->True],
Cell[56989, 1807, 134, 4, 46, "Input",ExpressionUUID->"bb376934-c362-4045-b6d0-7f93b83a14f7",
 InitializationCell->True],
Cell[57126, 1813, 160, 5, 46, "Input",ExpressionUUID->"f74fc117-b3f3-4aad-9c31-141c4a5a630a",
 Evaluatable->True,
 InitializationCell->True],
Cell[57289, 1820, 160, 5, 46, "Input",ExpressionUUID->"0353106d-447b-4de2-a0e3-fd0409d6dc8e",
 Evaluatable->True,
 InitializationCell->True],
Cell[57452, 1827, 167, 6, 46, "Input",ExpressionUUID->"557a6d41-66e1-4e45-a93b-bac5ebeeddb5",
 Evaluatable->True,
 InitializationCell->True],
Cell[57622, 1835, 165, 6, 46, "Input",ExpressionUUID->"6b46e8ab-5928-4c27-be41-da28e3a24f82",
 Evaluatable->True,
 InitializationCell->True],
Cell[57790, 1843, 165, 6, 46, "Input",ExpressionUUID->"d57a6697-f198-471c-8b79-4281e5cc0a58",
 Evaluatable->True,
 InitializationCell->True],
Cell[57958, 1851, 159, 5, 46, "Input",ExpressionUUID->"55df48be-74c3-4367-89da-11b2bfa0b26e",
 Evaluatable->True,
 InitializationCell->True],
Cell[58120, 1858, 138, 4, 46, "Input",ExpressionUUID->"ddd5f78f-d725-41e7-971c-e449db6e71a8",
 InitializationCell->True],
Cell[58261, 1864, 139, 4, 46, "Input",ExpressionUUID->"8a764d99-b0c9-4181-94bf-abf846c7c6b3",
 InitializationCell->True]
}, Closed]],
Cell[58415, 1871, 29, 0, 36, "Subsubsection",ExpressionUUID->"5a53b2e1-bcc6-4fad-ae3a-c2b79cf950cf"]
}, Closed]],
Cell[CellGroupData[{
Cell[58481, 1876, 38, 0, 37, "Subsection",ExpressionUUID->"046ede75-d9be-4a18-a712-6be2fb097856"],
Cell[58522, 1878, 838, 25, 121, "Input",ExpressionUUID->"7750bf2f-f934-472a-973b-cbbf2d1709ab",
 InitializationCell->True],
Cell[59363, 1905, 138, 4, 44, "Input",ExpressionUUID->"9c5b39be-843c-4480-93a2-9e4fdbc57b39",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[59526, 1913, 38, 0, 44, "Subsubsection",ExpressionUUID->"c9161b19-714d-4a08-a462-c2213063573a"],
Cell[59567, 1915, 132, 3, 44, "Input",ExpressionUUID->"6d63a63c-0976-4b7b-a19f-7511d4e83ff3",
 InitializationCell->True],
Cell[59702, 1920, 205, 4, 44, "Input",ExpressionUUID->"8ac37496-66c6-4222-b684-0ef80640050c",
 InitializationCell->True],
Cell[59910, 1926, 99, 3, 44, "Input",ExpressionUUID->"7dcaf49f-ac4d-4614-9b16-65dbc4ee92da",
 InitializationCell->True],
Cell[60012, 1931, 79, 2, 44, "Input",ExpressionUUID->"2178af2a-f9e5-49b7-88ee-b863ac2a1cd8",
 InitializationCell->True],
Cell[60094, 1935, 357, 11, 44, "Input",ExpressionUUID->"610c3684-06c7-4e2a-b9e0-2072a781e171",
 InitializationCell->True],
Cell[60454, 1948, 82, 2, 44, "Input",ExpressionUUID->"a2d6c161-cc91-471b-9ad2-3ebfdb38cd97",
 InitializationCell->True],
Cell[60539, 1952, 152, 3, 44, "Input",ExpressionUUID->"ce24fa2a-c90b-4ee1-a5f5-8282c98d308c",
 InitializationCell->True],
Cell[60694, 1957, 153, 4, 44, "Input",ExpressionUUID->"d6086526-6791-44b5-8137-8a0dc5f1b473",
 InitializationCell->True],
Cell[60850, 1963, 150, 4, 44, "Input",ExpressionUUID->"f1e0a583-0576-4520-9889-2145ad775b56",
 InitializationCell->True],
Cell[61003, 1969, 80, 2, 44, "Input",ExpressionUUID->"f8f8262d-1ccd-4d4d-9628-7f958af6e0f2",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[61120, 1976, 36, 0, 44, "Subsubsection",ExpressionUUID->"82caa8df-656f-4c02-b256-6fc5f145fcbc"],
Cell[61159, 1978, 184, 5, 44, "Input",ExpressionUUID->"ad33ad29-6eda-4abe-8552-9fc571f1a012",
 InitializationCell->True],
Cell[61346, 1985, 265, 7, 44, "Input",ExpressionUUID->"aba3eb25-33c5-4ed4-82c5-e0ad63e6d258",
 InitializationCell->True],
Cell[61614, 1994, 478, 10, 83, "Input",ExpressionUUID->"684f67c9-6379-4b1b-9594-bcf9e7b4b9f7",
 InitializationCell->True],
Cell[62095, 2006, 274, 7, 44, "Input",ExpressionUUID->"e8cbfcc6-1370-44f1-86f8-193bf5931d56",
 InitializationCell->True],
Cell[62372, 2015, 357, 9, 64, "Input",ExpressionUUID->"d5f131cc-0900-43a1-9683-2b8acc6dd2ba",
 Evaluatable->True,
 InitializationCell->True],
Cell[62732, 2026, 294, 8, 64, "Input",ExpressionUUID->"1e950f14-f5a9-47ff-8faa-92888815cb78",
 Evaluatable->True,
 InitializationCell->True],
Cell[63029, 2036, 337, 9, 64, "Input",ExpressionUUID->"a6f8bac0-e49e-49f3-bb58-51da6859bb0d",
 Evaluatable->True,
 InitializationCell->True],
Cell[63369, 2047, 243, 7, 64, "Input",ExpressionUUID->"96c81946-d9f5-4dcd-b66c-ffcfc8b5cf1d",
 Evaluatable->True,
 InitializationCell->True],
Cell[63615, 2056, 285, 7, 64, "Input",ExpressionUUID->"9fd7cff0-2194-464a-8fc5-1b43f7b871bc",
 InitializationCell->True],
Cell[63903, 2065, 246, 7, 64, "Input",ExpressionUUID->"8991e86f-b23b-48a5-882d-757f4b02e2cc",
 Evaluatable->True,
 InitializationCell->True],
Cell[64152, 2074, 221, 7, 64, "Input",ExpressionUUID->"92efe12a-7761-4eca-a7f1-6bc4bea81c80",
 Evaluatable->True,
 InitializationCell->True],
Cell[64376, 2083, 222, 7, 64, "Input",ExpressionUUID->"dcaded27-ab80-4791-85a4-b88bf0ca167c",
 Evaluatable->True,
 InitializationCell->True],
Cell[64601, 2092, 225, 7, 64, "Input",ExpressionUUID->"8ef04de2-55a5-4e6a-b20e-816b4eb6adfa",
 Evaluatable->True,
 InitializationCell->True],
Cell[64829, 2101, 304, 8, 64, "Input",ExpressionUUID->"ba0228a8-8c25-4694-88e6-11054620b8dd",
 Evaluatable->True,
 InitializationCell->True],
Cell[65136, 2111, 245, 7, 66, "Input",ExpressionUUID->"d8d6f024-1d97-471b-90bd-b98679fe50ac",
 Evaluatable->True,
 InitializationCell->True],
Cell[65384, 2120, 247, 7, 66, "Input",ExpressionUUID->"20dedb84-d03d-4360-a33d-9aeae7f6afa3",
 Evaluatable->True,
 InitializationCell->True],
Cell[65634, 2129, 211, 7, 66, "Input",ExpressionUUID->"355cdee2-2d8f-4a5f-a0e3-2cfb997a03f4",
 Evaluatable->True,
 InitializationCell->True],
Cell[65848, 2138, 282, 8, 66, "Input",ExpressionUUID->"544b245c-7617-4664-ab50-24c990b16f64",
 Evaluatable->True,
 InitializationCell->True],
Cell[66133, 2148, 331, 9, 66, "Input",ExpressionUUID->"c665b4ff-f783-486a-85d2-e3c573e4abae",
 Evaluatable->True,
 InitializationCell->True],
Cell[66467, 2159, 394, 10, 66, "Input",ExpressionUUID->"b8c7a859-1d5e-42c2-86f8-faea3be83935",
 Evaluatable->True,
 InitializationCell->True],
Cell[66864, 2171, 214, 7, 64, "Input",ExpressionUUID->"d82504f6-4575-4593-8695-ab906fb7d42e",
 Evaluatable->True,
 InitializationCell->True],
Cell[67081, 2180, 202, 6, 64, "Input",ExpressionUUID->"5c0d744c-3652-49da-beec-4bc9956f9a71",
 Evaluatable->True,
 InitializationCell->True],
Cell[67286, 2188, 223, 7, 64, "Input",ExpressionUUID->"6037fbb4-b317-4045-bf04-e3f8c7cc8f80",
 Evaluatable->True,
 InitializationCell->True],
Cell[67512, 2197, 560, 12, 102, "Input",ExpressionUUID->"73d34e0b-3ca3-4dc3-b210-62e98323afd1",
 Evaluatable->True,
 InitializationCell->True],
Cell[68075, 2211, 263, 7, 64, "Input",ExpressionUUID->"cfcff51c-1c2b-4234-8908-9ab47c9bdb98",
 Evaluatable->True,
 InitializationCell->True],
Cell[68341, 2220, 334, 8, 64, "Input",ExpressionUUID->"784ee217-050d-4cd4-ae54-b08ddf26bd68",
 Evaluatable->True,
 InitializationCell->True],
Cell[68678, 2230, 341, 8, 64, "Input",ExpressionUUID->"320e4083-dc8e-4354-b1b6-fa0d17d5411c",
 Evaluatable->True,
 InitializationCell->True],
Cell[69022, 2240, 268, 7, 64, "Input",ExpressionUUID->"4ed7ae5f-70f0-45e2-82ac-ae8e0a4f5b17",
 Evaluatable->True,
 InitializationCell->True],
Cell[69293, 2249, 242, 7, 64, "Input",ExpressionUUID->"525e31f6-f949-4a46-81d7-77f0ed4f81ea",
 Evaluatable->True,
 InitializationCell->True],
Cell[69538, 2258, 240, 7, 64, "Input",ExpressionUUID->"72f30593-9239-4897-a7ad-08e6faa742af",
 Evaluatable->True,
 InitializationCell->True],
Cell[69781, 2267, 296, 8, 64, "Input",ExpressionUUID->"a33aa808-dcb6-4e26-906f-e0d30db6a784",
 Evaluatable->True,
 InitializationCell->True],
Cell[70080, 2277, 302, 8, 64, "Input",ExpressionUUID->"b9a3971e-10ec-40b9-b353-8f82f426bc0b",
 Evaluatable->True,
 InitializationCell->True],
Cell[70385, 2287, 343, 8, 64, "Input",ExpressionUUID->"d8a96164-c078-453d-b2b0-608272a6f9b3",
 Evaluatable->True,
 InitializationCell->True],
Cell[70731, 2297, 251, 7, 64, "Input",ExpressionUUID->"72e525a2-e898-45b6-a1db-85bf7aa0e5b3",
 Evaluatable->True,
 InitializationCell->True],
Cell[70985, 2306, 253, 7, 64, "Input",ExpressionUUID->"8a27d682-0212-4a83-b706-d3fb4f56b358",
 Evaluatable->True,
 InitializationCell->True],
Cell[71241, 2315, 264, 7, 64, "Input",ExpressionUUID->"0a7468d5-46f7-41df-9a1d-a8b7b1bc8746",
 Evaluatable->True,
 InitializationCell->True],
Cell[71508, 2324, 354, 9, 64, "Input",ExpressionUUID->"8212222f-37ad-43c1-af31-86b5949500d5",
 Evaluatable->True,
 InitializationCell->True],
Cell[71865, 2335, 262, 7, 64, "Input",ExpressionUUID->"9ee41015-5d4f-4e02-b3ec-bdbcda6d7c29",
 Evaluatable->True,
 InitializationCell->True],
Cell[72130, 2344, 313, 8, 64, "Input",ExpressionUUID->"ec4c42ce-9a7b-4449-b52c-e7b48ecaa4a4",
 Evaluatable->True,
 InitializationCell->True],
Cell[72446, 2354, 193, 6, 64, "Input",ExpressionUUID->"c5e519c7-2561-4b5b-941f-7a039ae5c703",
 InitializationCell->True],
Cell[72642, 2362, 244, 6, 64, "Input",ExpressionUUID->"0ef05016-0e92-4f7d-8e7f-af0049f14844",
 InitializationCell->True],
Cell[72889, 2370, 230, 6, 64, "Input",ExpressionUUID->"fd3ff4af-da66-4c31-af8e-a6ddca369239",
 InitializationCell->True],
Cell[73122, 2378, 227, 6, 64, "Input",ExpressionUUID->"96b3e83d-4b89-4437-947c-706ce0306d1a",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[73386, 2389, 52, 0, 44, "Subsubsection",ExpressionUUID->"f0bcb594-16df-4060-90c4-7d38389ec3c1"],
Cell[73441, 2391, 204, 6, 44, "Input",ExpressionUUID->"3adfdd01-2952-4f7b-8070-681feec3e8e3",
 InitializationCell->True],
Cell[73648, 2399, 177, 5, 44, "Input",ExpressionUUID->"b4a47c8d-5809-49aa-bd6f-90390f0fd56c",
 InitializationCell->True],
Cell[73828, 2406, 229, 6, 44, "Input",ExpressionUUID->"0dd782f9-78e7-446f-ba01-9ef5927427e9",
 InitializationCell->True],
Cell[74060, 2414, 202, 6, 44, "Input",ExpressionUUID->"1e1a2a84-b3c3-4af0-80a1-71f802af9357",
 InitializationCell->True],
Cell[74265, 2422, 214, 6, 44, "Input",ExpressionUUID->"db710861-6b50-4bff-afa5-33cb7c1287e8",
 InitializationCell->True],
Cell[74482, 2430, 219, 6, 44, "Input",ExpressionUUID->"ead13db5-7c0f-4267-a7ec-b85fbdfa9554",
 InitializationCell->True],
Cell[74704, 2438, 223, 6, 44, "Input",ExpressionUUID->"f0fdc3a4-ace7-4cec-a0db-27c79d4f5b77",
 InitializationCell->True],
Cell[74930, 2446, 227, 6, 44, "Input",ExpressionUUID->"f0860f66-7a35-4ca9-b70c-16cb4645201e",
 InitializationCell->True],
Cell[75160, 2454, 195, 5, 44, "Input",ExpressionUUID->"597945d0-7c7f-4cff-a386-62ae8adebe3e",
 InitializationCell->True],
Cell[75358, 2461, 198, 5, 44, "Input",ExpressionUUID->"41ef5796-0089-4066-b767-3669018a360d",
 InitializationCell->True],
Cell[75559, 2468, 206, 5, 44, "Input",ExpressionUUID->"b33df4ae-019b-49e9-a50c-c26829de2a86",
 InitializationCell->True],
Cell[75768, 2475, 203, 5, 44, "Input",ExpressionUUID->"65c74eb5-d400-4e32-9aa4-15dd41f44008",
 InitializationCell->True],
Cell[75974, 2482, 193, 5, 44, "Input",ExpressionUUID->"65d0f372-8529-4481-87af-7639aedc2552",
 InitializationCell->True],
Cell[76170, 2489, 269, 6, 44, "Input",ExpressionUUID->"15a41336-8711-4a3b-abdc-1b5cb3a5b12c",
 InitializationCell->True],
Cell[76442, 2497, 270, 6, 44, "Input",ExpressionUUID->"df794fa5-467e-41b8-88ea-b21fc89debc8",
 InitializationCell->True],
Cell[76715, 2505, 675, 12, 121, "Input",ExpressionUUID->"d983218d-64f8-4ef5-9885-2b9e8370618b",
 InitializationCell->True],
Cell[77393, 2519, 274, 7, 44, "Input",ExpressionUUID->"6d6793bc-bbcc-465f-89de-167e93ab3629",
 InitializationCell->True],
Cell[77670, 2528, 230, 7, 44, "Input",ExpressionUUID->"6c15ee0e-2702-4129-ac7c-eb9a2b91a983",
 Evaluatable->True,
 InitializationCell->True],
Cell[77903, 2537, 307, 8, 44, "Input",ExpressionUUID->"e766e59c-465c-4e65-b345-7244a7f6c118",
 Evaluatable->True,
 InitializationCell->True],
Cell[78213, 2547, 366, 9, 44, "Input",ExpressionUUID->"8617b5e4-fbdb-4578-8ab0-e7d87f9a19ed",
 Evaluatable->True,
 InitializationCell->True],
Cell[78582, 2558, 252, 7, 44, "Input",ExpressionUUID->"0eafec38-3eb3-423c-a0ec-00cdbe463dbb",
 Evaluatable->True,
 InitializationCell->True],
Cell[78837, 2567, 245, 6, 44, "Input",ExpressionUUID->"a283a928-9389-4c2b-9442-5e5b17d5efaf",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[79119, 2578, 54, 0, 44, "Subsubsection",ExpressionUUID->"5f721a2d-273a-4686-8496-1dec6de340ce"],
Cell[79176, 2580, 418, 9, 70, "Input",ExpressionUUID->"5dee8291-917c-4e85-8c73-2a4ce1b68d45",
 InitializationCell->True],
Cell[79597, 2591, 170, 5, 70, "Input",ExpressionUUID->"a3707448-5627-4da4-958f-7fbc3dad8cc3",
 InitializationCell->True],
Cell[79770, 2598, 168, 5, 70, "Input",ExpressionUUID->"2f5d06d3-99a6-4934-af25-7dc32ea19389",
 InitializationCell->True],
Cell[79941, 2605, 170, 5, 70, "Input",ExpressionUUID->"f9944102-b6fe-4d68-9826-6c326b9027bd",
 InitializationCell->True],
Cell[80114, 2612, 166, 5, 70, "Input",ExpressionUUID->"6949b2d0-f5a2-45e4-adc7-f5e52b77c65e",
 InitializationCell->True],
Cell[80283, 2619, 1198, 33, 70, "Input",ExpressionUUID->"c092793c-e9be-49a1-a76c-6a46f338a011",
 InitializationCell->True],
Cell[81484, 2654, 449, 9, 70, "Input",ExpressionUUID->"6631cf3f-05ee-4d38-80b1-1521bc39cdc9",
 InitializationCell->True],
Cell[81936, 2665, 516, 10, 70, "Input",ExpressionUUID->"e8ed6ce4-3630-497e-9c4e-3bf8e7e23422",
 InitializationCell->True],
Cell[82455, 2677, 1007, 17, 70, "Input",ExpressionUUID->"eb226d60-8f5f-4c55-a709-39f60c04307d",
 InitializationCell->True],
Cell[83465, 2696, 256, 6, 70, "Input",ExpressionUUID->"83fa2d10-c20b-4cd2-806e-3d359deafbad",
 InitializationCell->True],
Cell[83724, 2704, 259, 6, 70, "Input",ExpressionUUID->"827598a8-7411-468a-8b25-471ba79d6691",
 InitializationCell->True],
Cell[83986, 2712, 374, 9, 70, "Input",ExpressionUUID->"9298ca31-b960-4563-aa99-ca79ba61d2a8",
 Evaluatable->True,
 InitializationCell->True],
Cell[84363, 2723, 415, 9, 70, "Input",ExpressionUUID->"d7e61682-9768-4c55-9ed4-f2d9ff92ce53",
 Evaluatable->True,
 InitializationCell->True],
Cell[84781, 2734, 308, 8, 70, "Input",ExpressionUUID->"9039c44f-1d6d-423a-bbd8-5bf876319790",
 Evaluatable->True,
 InitializationCell->True],
Cell[85092, 2744, 255, 7, 70, "Input",ExpressionUUID->"9fb59c93-8759-46c7-97dd-3ea18ec8117e",
 Evaluatable->True,
 InitializationCell->True],
Cell[85350, 2753, 429, 9, 70, "Input",ExpressionUUID->"2ebe5a9b-fa55-4b10-8987-ae7cac83d347",
 Evaluatable->True,
 InitializationCell->True],
Cell[85782, 2764, 253, 7, 70, "Input",ExpressionUUID->"4f921085-1538-4ee2-8f06-576cbc570468",
 Evaluatable->True,
 InitializationCell->True],
Cell[86038, 2773, 242, 7, 70, "Input",ExpressionUUID->"7fad555a-0412-490d-9146-c7ce1a2375b0",
 Evaluatable->True,
 InitializationCell->True],
Cell[86283, 2782, 245, 7, 70, "Input",ExpressionUUID->"3cad946c-3b4a-4c70-ba66-e2a5eb96b1ee",
 Evaluatable->True,
 InitializationCell->True],
Cell[86531, 2791, 156, 5, 70, "Input",ExpressionUUID->"34380e9b-645a-4ceb-925a-8300d1e2a672",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[86724, 2801, 54, 0, 36, "Subsubsection",ExpressionUUID->"f4d8152c-50cb-43e6-a7ca-4085a7ad063c"],
Cell[86781, 2803, 248, 6, 70, "Input",ExpressionUUID->"d7025db8-1928-44bc-a149-8ee7e0358383",
 InitializationCell->True],
Cell[87032, 2811, 248, 6, 70, "Input",ExpressionUUID->"20c5a57b-8ab1-423b-9d6a-c0194e505e6f",
 InitializationCell->True],
Cell[87283, 2819, 203, 6, 70, "Input",ExpressionUUID->"e96fc02c-18e3-4af7-8eb1-77d2f031125b",
 InitializationCell->True],
Cell[87489, 2827, 150, 5, 70, "Input",ExpressionUUID->"0c4c7d7f-6a1a-4d9c-bfee-5a941921878b",
 InitializationCell->True],
Cell[87642, 2834, 227, 6, 70, "Input",ExpressionUUID->"656cb11e-6866-4caa-ac46-65250a803994",
 InitializationCell->True],
Cell[87872, 2842, 240, 6, 70, "Input",ExpressionUUID->"87f13ae3-c3a5-4826-9ebd-fce022141193",
 InitializationCell->True],
Cell[88115, 2850, 268, 6, 70, "Input",ExpressionUUID->"b869f556-c194-44bb-8df1-24f8b045969b",
 InitializationCell->True],
Cell[88386, 2858, 351, 8, 70, "Input",ExpressionUUID->"8847634a-99a6-4765-bfaf-fdad25fe60d7",
 Evaluatable->True,
 InitializationCell->True],
Cell[88740, 2868, 345, 8, 70, "Input",ExpressionUUID->"d5094b69-0ea2-4195-a71d-9d525d24c087",
 Evaluatable->True,
 InitializationCell->True],
Cell[89088, 2878, 323, 8, 70, "Input",ExpressionUUID->"e3a91e2d-b533-4011-b7da-775a3b625de8",
 Evaluatable->True,
 InitializationCell->True],
Cell[89414, 2888, 590, 11, 70, "Input",ExpressionUUID->"8b096a05-eafc-4eda-98a2-746702651f5b",
 Evaluatable->True,
 InitializationCell->True],
Cell[90007, 2901, 294, 8, 70, "Input",ExpressionUUID->"9be03da3-b42d-448f-b7d3-931e8228090c",
 InitializationCell->True],
Cell[90304, 2911, 244, 6, 70, "Input",ExpressionUUID->"7ce06038-e0d6-419a-a99c-cea6d513c471",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[90585, 2922, 45, 0, 36, "Subsubsection",ExpressionUUID->"1dd8dff3-829a-4324-a8ad-681b080b679e"],
Cell[90633, 2924, 243, 6, 44, "Input",ExpressionUUID->"2cbf9591-114d-4b13-b89a-b414fb284c19",
 InitializationCell->True],
Cell[90879, 2932, 213, 6, 44, "Input",ExpressionUUID->"5b6fb937-65e8-4a67-b943-450d27801c41",
 InitializationCell->True],
Cell[91095, 2940, 239, 6, 44, "Input",ExpressionUUID->"e50db1de-304b-45c1-a03d-ae0e33a605f3",
 InitializationCell->True],
Cell[91337, 2948, 228, 6, 44, "Input",ExpressionUUID->"70a37bd0-a090-4777-9eab-d7d866e20839",
 InitializationCell->True],
Cell[91568, 2956, 259, 6, 44, "Input",ExpressionUUID->"ce08f35f-6263-4060-9135-ebb0030996e4",
 InitializationCell->True],
Cell[91830, 2964, 308, 7, 44, "Input",ExpressionUUID->"ebfad565-c2ff-4abd-a416-62ff649d6e2b",
 InitializationCell->True],
Cell[92141, 2973, 302, 7, 44, "Input",ExpressionUUID->"d67d685c-9efe-44fe-8004-45237a1d56dd",
 InitializationCell->True],
Cell[92446, 2982, 317, 7, 44, "Input",ExpressionUUID->"b6b71ca7-ede0-4ea5-953a-44a53b900bec",
 InitializationCell->True],
Cell[92766, 2991, 154, 5, 44, "Input",ExpressionUUID->"159704f3-cc0b-47ec-97c2-8bb8f2fc97c5",
 InitializationCell->True],
Cell[92923, 2998, 147, 5, 44, "Input",ExpressionUUID->"5e40bb5a-5958-4a88-bf27-5e86b26eddf7",
 InitializationCell->True],
Cell[93073, 3005, 1318, 41, 216, "Input",ExpressionUUID->"d639a56f-fe0b-456b-8565-e65c62f75e77",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[94428, 3051, 32, 0, 44, "Subsubsection",ExpressionUUID->"7ef85148-73bc-4fcb-8c07-d5e99ea8af58"],
Cell[94463, 3053, 581, 11, 159, "Input",ExpressionUUID->"3e334dd0-d01c-4657-96b5-139ee31882ac",
 InitializationCell->True],
Cell[95047, 3066, 542, 10, 159, "Input",ExpressionUUID->"24a3a7f9-51c7-4e93-9375-4223c87b4b2b",
 InitializationCell->True],
Cell[95592, 3078, 756, 13, 235, "Input",ExpressionUUID->"4d0638e5-a398-4aa8-9ba0-ac9bec5d3a9d",
 InitializationCell->True],
Cell[96351, 3093, 594, 11, 159, "Input",ExpressionUUID->"35f2d5bd-4fdc-40ab-ae1a-416d8b12f116",
 InitializationCell->True],
Cell[96948, 3106, 335, 8, 44, "Input",ExpressionUUID->"884d5da3-6ff5-40f9-889e-13777a1e3ed0",
 InitializationCell->True],
Cell[97286, 3116, 377, 8, 44, "Input",ExpressionUUID->"62c3d157-0c75-4721-bbe1-12f204be60c6",
 InitializationCell->True],
Cell[97666, 3126, 208, 6, 44, "Input",ExpressionUUID->"e79bae08-0d6b-433c-a2bc-bde7a6743a24",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[97911, 3137, 31, 0, 44, "Subsubsection",ExpressionUUID->"9d3323e5-8963-4d65-ace7-e3ef3c4a78c8"],
Cell[97945, 3139, 267, 6, 70, "Input",ExpressionUUID->"cd1ca2ce-ed45-4427-82eb-9dc7a5b67298",
 InitializationCell->True],
Cell[98215, 3147, 360, 8, 70, "Input",ExpressionUUID->"abee5f25-7202-4103-a641-bf50a87c4532",
 InitializationCell->True],
Cell[98578, 3157, 321, 7, 70, "Input",ExpressionUUID->"31656fbb-f55e-4a62-841f-8fc9b4b9816d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[98936, 3169, 29, 0, 36, "Subsubsection",ExpressionUUID->"7fd7c1bb-9b00-4655-acfb-6aa59c95cd2d"],
Cell[98968, 3171, 264, 6, 46, "Input",ExpressionUUID->"b1400578-237d-48bf-988b-599131e45319",
 InitializationCell->True],
Cell[99235, 3179, 256, 6, 46, "Input",ExpressionUUID->"7902545b-5dbf-4d6b-a54b-1315d8a86125",
 InitializationCell->True],
Cell[99494, 3187, 260, 6, 46, "Input",ExpressionUUID->"92f791b5-5fbd-4322-ad44-cf0db8cb578e",
 InitializationCell->True],
Cell[99757, 3195, 174, 6, 46, "Input",ExpressionUUID->"2c7f6f37-ff54-4181-aa9b-345043edd12f",
 Evaluatable->True,
 InitializationCell->True],
Cell[99934, 3203, 279, 7, 46, "Input",ExpressionUUID->"7dd3261b-eb1b-44fc-b01f-8dc37161750d",
 InitializationCell->True],
Cell[100216, 3212, 186, 5, 46, "Input",ExpressionUUID->"1f6c5f23-3bf8-4014-9646-feb7ac793445",
 InitializationCell->True],
Cell[100405, 3219, 220, 6, 46, "Input",ExpressionUUID->"c97f28b5-2379-423f-a05f-f5b0863bc04b",
 InitializationCell->True],
Cell[100628, 3227, 342, 7, 46, "Input",ExpressionUUID->"bdbbbacc-7c51-49e7-9637-c6b9a7f41cba",
 InitializationCell->True],
Cell[100973, 3236, 466, 9, 85, "Input",ExpressionUUID->"3d089508-395d-42b2-80f4-b75fe480276e",
 InitializationCell->True],
Cell[101442, 3247, 229, 6, 46, "Input",ExpressionUUID->"0a8faf1d-c69a-4ae8-b789-20fc2ddb16a4",
 InitializationCell->True],
Cell[101674, 3255, 269, 7, 46, "Input",ExpressionUUID->"5fdfedfc-e881-4a48-b422-c26b8bdfc52a",
 Evaluatable->True,
 InitializationCell->True],
Cell[101946, 3264, 333, 8, 46, "Input",ExpressionUUID->"1b90c45b-979d-42e9-a7e4-ab632c5fecaf",
 Evaluatable->True,
 InitializationCell->True],
Cell[102282, 3274, 278, 7, 46, "Input",ExpressionUUID->"2424f971-cb52-4b02-b559-79ec28b86563",
 Evaluatable->True,
 InitializationCell->True],
Cell[102563, 3283, 343, 8, 66, "Input",ExpressionUUID->"1160bfe6-48f8-4955-ab30-9131f4fee940",
 Evaluatable->True,
 InitializationCell->True],
Cell[102909, 3293, 421, 9, 66, "Input",ExpressionUUID->"57318228-721e-4809-91fc-b3cb417ead49",
 Evaluatable->True,
 InitializationCell->True],
Cell[103333, 3304, 280, 7, 46, "Input",ExpressionUUID->"05d1498a-4fd1-4d26-a5a5-695b6d567557",
 Evaluatable->True,
 InitializationCell->True],
Cell[103616, 3313, 250, 7, 46, "Input",ExpressionUUID->"e5d4ae5f-9e4b-4a50-beb8-bb342d29186d",
 Evaluatable->True,
 InitializationCell->True],
Cell[103869, 3322, 960, 17, 123, "Input",ExpressionUUID->"eeb329e0-2771-454a-8182-2652b5d3e895",
 Evaluatable->True,
 InitializationCell->True],
Cell[104832, 3341, 482, 10, 85, "Input",ExpressionUUID->"72e45bc4-fe3b-4780-8bb0-af75f73fb594",
 InitializationCell->True],
Cell[105317, 3353, 216, 6, 46, "Input",ExpressionUUID->"548e11f8-fda5-42cd-8d25-c7719af8acbd",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[105582, 3365, 29, 0, 37, "Subsection",ExpressionUUID->"582ff2b7-26b7-4009-881a-68c882a6f3a0"],
Cell[105614, 3367, 139, 4, 70, "Input",ExpressionUUID->"cf9152c0-60e9-4c88-a909-765755aff1d8",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[105802, 3377, 38, 0, 53, "Section",ExpressionUUID->"10b36191-a73b-439e-9bfe-9de3db144f25"],
Cell[105843, 3379, 640, 20, 44, "Input",ExpressionUUID->"91ca0be3-fb1d-4db2-bbd7-8f6fee2f902e",
 InitializationCell->True],
Cell[106486, 3401, 3597, 89, 121, "Input",ExpressionUUID->"6623892f-7eca-46e6-96f0-22d76922f4cd",
 Evaluatable->True,
 InitializationCell->True],
Cell[110086, 3492, 4152, 102, 121, "Input",ExpressionUUID->"649886ab-57e2-41d2-842e-9b3a86d67c38",
 Evaluatable->True,
 InitializationCell->True],
Cell[114241, 3596, 957, 25, 44, "Input",ExpressionUUID->"769c29f9-7b2b-4f15-8aa7-a442350525c4",
 InitializationCell->True],
Cell[115201, 3623, 172, 5, 44, "Input",ExpressionUUID->"76c77173-40a5-4105-abec-bc95c5088be0",
 InitializationCell->True],
Cell[115376, 3630, 379, 11, 44, "Input",ExpressionUUID->"1a4810c1-b2b1-4bc4-8d8e-ad815dacdfa7",
 InitializationCell->True],
Cell[115758, 3643, 1058, 29, 44, "Input",ExpressionUUID->"432e395b-4e1f-479d-a08c-b80a70684ca3",
 Evaluatable->True,
 InitializationCell->True],
Cell[116819, 3674, 302, 9, 44, "Input",ExpressionUUID->"03638138-9f4f-4204-85c9-3fbaea88d48d",
 Evaluatable->True,
 InitializationCell->True],
Cell[117124, 3685, 651, 20, 44, "Input",ExpressionUUID->"651cd886-9f88-4640-95b2-50271c7f8342",
 Evaluatable->True,
 InitializationCell->True],
Cell[117778, 3707, 175, 5, 44, "Input",ExpressionUUID->"3fbffc12-b24c-4b48-9421-ab24988f8275",
 Evaluatable->True,
 InitializationCell->True],
Cell[117956, 3714, 135, 3, 44, "Input",ExpressionUUID->"832544e2-92cd-4583-a2bb-445b9e21fde7",
 InitializationCell->True],
Cell[118094, 3719, 1110, 30, 44, "Input",ExpressionUUID->"7d465925-0cee-424e-9435-9821ab5c3bff",
 Evaluatable->True,
 InitializationCell->True],
Cell[119207, 3751, 1108, 30, 44, "Input",ExpressionUUID->"33c12497-9f2b-48b4-b407-68dfbba6a81f",
 Evaluatable->True,
 InitializationCell->True],
Cell[120318, 3783, 1102, 30, 44, "Input",ExpressionUUID->"3437d779-1b4f-4e47-a8f0-22533fd78ed0",
 Evaluatable->True,
 InitializationCell->True],
Cell[121423, 3815, 1314, 31, 83, "Input",ExpressionUUID->"b5d03b00-9a27-42aa-ad9a-706c9777af77",
 Evaluatable->True,
 InitializationCell->True],
Cell[122740, 3848, 527, 12, 44, "Input",ExpressionUUID->"edfdc19b-d373-4aa0-af60-97579865864b",
 Evaluatable->True,
 InitializationCell->True],
Cell[123270, 3862, 825, 24, 44, "Input",ExpressionUUID->"a1ba5455-5b25-4b6a-afc7-449ebe194736",
 Evaluatable->True,
 InitializationCell->True],
Cell[124098, 3888, 1855, 46, 44, "Input",ExpressionUUID->"dcf80c68-e20b-4f83-b864-a63ca89fb79b",
 Evaluatable->True,
 InitializationCell->True],
Cell[125956, 3936, 476, 12, 44, "Input",ExpressionUUID->"057f100d-95f7-4aa4-b7b9-ed1afba9d8cd",
 InitializationCell->True],
Cell[126435, 3950, 659, 16, 44, "Input",ExpressionUUID->"c0d3997e-44c9-40a5-810f-34304928b9a9",
 InitializationCell->True],
Cell[127097, 3968, 915, 25, 44, "Input",ExpressionUUID->"24418dd1-2851-4feb-a3ab-e5c509386941",
 Evaluatable->True,
 InitializationCell->True],
Cell[128015, 3995, 478, 13, 44, "Input",ExpressionUUID->"cffd2a95-4741-4e1e-b611-fb31bc1b478d",
 Evaluatable->True,
 InitializationCell->True],
Cell[128496, 4010, 476, 13, 44, "Input",ExpressionUUID->"c3d9b89d-e5b2-43db-8aa1-6b57fb2f52dd",
 Evaluatable->True,
 InitializationCell->True],
Cell[128975, 4025, 470, 13, 44, "Input",ExpressionUUID->"9fd6cae4-eaac-4ed2-8803-c297d61f832a",
 Evaluatable->True,
 InitializationCell->True],
Cell[129448, 4040, 596, 16, 44, "Input",ExpressionUUID->"277400e3-196a-401f-b4ba-93907deb1c2e",
 Evaluatable->True,
 InitializationCell->True],
Cell[130047, 4058, 570, 14, 44, "Input",ExpressionUUID->"86015fde-0fb3-4c38-be3b-80f529d2b879",
 Evaluatable->True,
 InitializationCell->True],
Cell[130620, 4074, 790, 19, 44, "Input",ExpressionUUID->"0507e0c2-adc2-4ce3-835f-196af7fc2194",
 Evaluatable->True,
 InitializationCell->True],
Cell[131413, 4095, 719, 17, 44, "Input",ExpressionUUID->"d63ff617-fb5c-49ca-96a6-2472b0714f5f",
 Evaluatable->True,
 InitializationCell->True],
Cell[132135, 4114, 513, 15, 44, "Input",ExpressionUUID->"8a79e5e5-6c65-4c1e-86e3-063ed00f4a1a",
 InitializationCell->True],
Cell[132651, 4131, 305, 8, 44, "Input",ExpressionUUID->"1ecc1fad-fdd6-4c45-b9dc-d7e1f8183eb5",
 InitializationCell->True],
Cell[132959, 4141, 303, 8, 44, "Input",ExpressionUUID->"51ce12a2-a674-4e24-8352-8c8213e018f7",
 InitializationCell->True],
Cell[133265, 4151, 297, 8, 44, "Input",ExpressionUUID->"73c9d8d7-b5dd-4ead-8551-400886052174",
 InitializationCell->True],
Cell[133565, 4161, 970, 25, 83, "Input",ExpressionUUID->"69d878af-7df6-4ca5-a440-220badff2546",
 Evaluatable->True,
 InitializationCell->True],
Cell[134538, 4188, 968, 25, 83, "Input",ExpressionUUID->"40a2f7d2-d8b6-4abc-b6dc-b294eded66bf",
 Evaluatable->True,
 InitializationCell->True],
Cell[135509, 4215, 960, 25, 64, "Input",ExpressionUUID->"65029a13-7e9b-45e2-9fbe-462131788c90",
 Evaluatable->True,
 InitializationCell->True],
Cell[136472, 4242, 131, 3, 44, "Input",ExpressionUUID->"d41576df-e107-40cb-b7df-8504fa5b75d6",
 InitializationCell->True],
Cell[136606, 4247, 1418, 43, 102, "Input",ExpressionUUID->"466a0a81-aa4c-4f6e-b6a8-f47358bc2e19",
 Evaluatable->True,
 InitializationCell->True],
Cell[138027, 4292, 491, 11, 44, "Input",ExpressionUUID->"c9870bf1-da77-41e6-bd01-4c0fbe736aad",
 InitializationCell->True],
Cell[138521, 4305, 598, 12, 44, "Input",ExpressionUUID->"18d55e8d-5992-4751-9b8d-14cb1d7e05d1",
 InitializationCell->True],
Cell[139122, 4319, 594, 13, 44, "Input",ExpressionUUID->"bd2d4578-45a3-4b37-a910-16a7cbec7e92",
 InitializationCell->True],
Cell[139719, 4334, 253, 5, 44, "Input",ExpressionUUID->"df2d8fee-2b5d-4dcc-992d-3596aa974556",
 InitializationCell->True],
Cell[139975, 4341, 297, 8, 44, "Input",ExpressionUUID->"ea1aa9d2-1dca-4fdc-b2ef-86dfb147f1a4",
 InitializationCell->True],
Cell[140275, 4351, 2600, 53, 64, "Input",ExpressionUUID->"e43cf72e-04a7-4b1d-9263-8e55fde2963e",
 InitializationCell->True],
Cell[142878, 4406, 1880, 39, 64, "Input",ExpressionUUID->"1e4bcf49-5d8e-4b1a-b4cf-37eb9fe8aa6e",
 InitializationCell->True],
Cell[144761, 4447, 1593, 35, 64, "Input",ExpressionUUID->"0c266bab-1227-4b94-b138-39c0435cbbd4",
 InitializationCell->True],
Cell[146357, 4484, 9254, 224, 406, "Input",ExpressionUUID->"4213b487-c503-4bb8-8b70-381439da1a5e",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[155636, 4712, 29, 0, 44, "Subsubsection",ExpressionUUID->"bed2396a-eb12-4bf2-b0ba-159066134995"],
Cell[155668, 4714, 110, 3, 46, "Input",ExpressionUUID->"a3cf2182-c25f-4521-83ec-a8934298b6c4",
 InitializationCell->True],
Cell[155781, 4719, 193, 4, 46, "Input",ExpressionUUID->"265563aa-d906-47cc-ac36-741e1c899bac",
 InitializationCell->True],
Cell[155977, 4725, 2314, 59, 126, "Input",ExpressionUUID->"61e20594-bd8b-44d2-9ded-00a4fca50e6e",
 Evaluatable->True],
Cell[158294, 4786, 8387, 190, 484, "Input",ExpressionUUID->"cd7b8c88-1090-4115-aa32-e253758c815c",
 Evaluatable->True,
 InitializationCell->True],
Cell[166684, 4978, 108, 3, 31, "Input",ExpressionUUID->"86eb534f-fcd6-4632-8fc3-124fbf387d29",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[166829, 4986, 30, 0, 36, "Subsubsection",ExpressionUUID->"ccbd66de-eb32-4075-8a47-5a8c5b70b151"],
Cell[166862, 4988, 93, 2, 46, "Input",ExpressionUUID->"68ecf414-c44d-4ca2-9753-2865c48b0131",
 InitializationCell->True],
Cell[166958, 4992, 128, 3, 46, "Input",ExpressionUUID->"8953796a-289c-48ea-a536-cf3689f4e2b2",
 InitializationCell->True],
Cell[167089, 4997, 175, 4, 46, "Input",ExpressionUUID->"813b138d-75b2-4fb0-80cf-6523cfda24c9",
 InitializationCell->True],
Cell[167267, 5003, 2899, 68, 218, "Input",ExpressionUUID->"34f4c5e7-9d57-4a04-a3ce-7e3b051e240d",
 Evaluatable->True,
 InitializationCell->True],
Cell[170169, 5073, 2991, 69, 218, "Input",ExpressionUUID->"4f387163-1c4c-4442-8456-227b7f363956",
 Evaluatable->True,
 InitializationCell->True],
Cell[173163, 5144, 91, 2, 46, "Input",ExpressionUUID->"3ea66c6d-3645-40fa-b6ef-57b017414fab",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[173291, 5151, 29, 0, 36, "Subsubsection",ExpressionUUID->"4ce342c2-042a-4633-b86a-cc322da392fa"],
Cell[173323, 5153, 92, 2, 46, "Input",ExpressionUUID->"25fed41d-11c8-4584-be80-8ba5cf7e8769",
 InitializationCell->True],
Cell[173418, 5157, 127, 3, 46, "Input",ExpressionUUID->"216e447c-4d19-4cf0-ad7d-f636a7edf67c",
 InitializationCell->True],
Cell[173548, 5162, 1915, 47, 123, "Input",ExpressionUUID->"a7c32615-c7d1-4eac-89b0-fae82f900844",
 Evaluatable->True,
 InitializationCell->True],
Cell[175466, 5211, 90, 2, 46, "Input",ExpressionUUID->"45c4d715-89c2-4da9-b185-fe2076b764ff",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[175593, 5218, 29, 0, 36, "Subsubsection",ExpressionUUID->"7c42189f-331b-41a5-8121-c2b8fe707ced"],
Cell[175625, 5220, 92, 2, 70, "Input",ExpressionUUID->"575838c6-9f21-4c13-a06b-cb8143418cc3",
 InitializationCell->True],
Cell[175720, 5224, 127, 3, 70, "Input",ExpressionUUID->"caae5fed-a963-4699-8b9a-e81757229d88",
 InitializationCell->True],
Cell[175850, 5229, 1915, 47, 70, "Input",ExpressionUUID->"5ef928bc-882a-41d2-a179-7a74206b74d9",
 Evaluatable->True,
 InitializationCell->True],
Cell[177768, 5278, 90, 2, 70, "Input",ExpressionUUID->"1b985be7-f254-4083-86ed-f35ed0e52cbb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[177895, 5285, 30, 0, 36, "Subsubsection",ExpressionUUID->"48bc3d30-5481-42a7-8b0b-dc64722c166b"],
Cell[177928, 5287, 93, 2, 70, "Input",ExpressionUUID->"654d7ee7-586b-40ac-9e19-b28d9e0b8edb",
 InitializationCell->True],
Cell[178024, 5291, 128, 3, 70, "Input",ExpressionUUID->"8e82f82f-9e60-4422-a4c8-6893dbecdfd7",
 InitializationCell->True],
Cell[178155, 5296, 2075, 52, 70, "Input",ExpressionUUID->"437778ef-0309-403d-94fc-54a513e4f5ab",
 Evaluatable->True,
 InitializationCell->True],
Cell[180233, 5350, 91, 2, 70, "Input",ExpressionUUID->"ceab60a6-8b45-48c6-88f2-cf19275de1b7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[180361, 5357, 30, 0, 36, "Subsubsection",ExpressionUUID->"d78b61b3-16ad-4889-a624-cdc30b99521d"],
Cell[180394, 5359, 93, 2, 46, "Input",ExpressionUUID->"bda80366-00d0-40a7-bbc3-953be18d3f4a",
 InitializationCell->True],
Cell[180490, 5363, 128, 3, 46, "Input",ExpressionUUID->"90f53168-fd34-423d-a815-3e240cd3987d",
 InitializationCell->True],
Cell[180621, 5368, 2075, 52, 123, "Input",ExpressionUUID->"67bd1793-a0a2-4880-9bb7-0194ae265990",
 Evaluatable->True,
 InitializationCell->True],
Cell[182699, 5422, 91, 2, 46, "Input",ExpressionUUID->"ca76d489-fe15-438e-87cd-2d4d9aa2f1b8",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[182827, 5429, 50, 0, 36, "Subsubsection",ExpressionUUID->"b661046d-8a5f-4dc1-af2f-69d0ce2f9e54"],
Cell[182880, 5431, 129, 3, 44, "Input",ExpressionUUID->"2d0a412f-64a8-4840-b140-563afe2622c0",
 InitializationCell->True],
Cell[183012, 5436, 1946, 49, 121, "Input",ExpressionUUID->"59fd27d0-b2e0-4227-9b83-3b6b6c52307d",
 Evaluatable->True,
 InitializationCell->True],
Cell[184961, 5487, 127, 3, 44, "Input",ExpressionUUID->"0c51b391-6ef9-45fb-a71c-d69c432eff8b",
 InitializationCell->True],
Cell[185091, 5492, 1985, 50, 121, "Input",ExpressionUUID->"17636ddc-13d5-49de-bb56-60fa75075680",
 Evaluatable->True,
 InitializationCell->True],
Cell[187079, 5544, 133, 3, 44, "Input",ExpressionUUID->"368c5b85-d278-42f4-a80e-c7c687b130b7",
 InitializationCell->True],
Cell[187215, 5549, 2004, 50, 121, "Input",ExpressionUUID->"a844afb9-f2ac-4e00-9e76-ad4529ead2a7",
 Evaluatable->True,
 InitializationCell->True],
Cell[189222, 5601, 130, 3, 44, "Input",ExpressionUUID->"7c148848-2952-45eb-990c-d97695d0a97f",
 InitializationCell->True],
Cell[189355, 5606, 1997, 50, 121, "Input",ExpressionUUID->"39cb2190-de17-44fe-9177-6d3752b9ad37",
 Evaluatable->True,
 InitializationCell->True],
Cell[191355, 5658, 173, 4, 44, "Input",ExpressionUUID->"5a7987b8-f996-4472-ba3d-03dcf5fd4f85",
 InitializationCell->True],
Cell[191531, 5664, 2066, 51, 121, "Input",ExpressionUUID->"95bd5d43-8d0c-4fb3-864b-10d89796190e",
 Evaluatable->True,
 InitializationCell->True],
Cell[193600, 5717, 223, 5, 44, "Input",ExpressionUUID->"242ef934-1cd5-41d1-99f8-0a3b7ba954b8",
 InitializationCell->True],
Cell[193826, 5724, 2114, 52, 121, "Input",ExpressionUUID->"11f5e804-8dbe-4775-95da-04b8f0b651a4",
 Evaluatable->True,
 InitializationCell->True],
Cell[195943, 5778, 2167, 53, 121, "Input",ExpressionUUID->"13dfaced-e438-41bd-bdde-380bdbce7c84",
 Evaluatable->True,
 InitializationCell->True],
Cell[198113, 5833, 256, 6, 44, "Input",ExpressionUUID->"0bf188cf-a6d8-40a8-971b-c57c1e68813a",
 InitializationCell->True],
Cell[198372, 5841, 2143, 53, 121, "Input",ExpressionUUID->"0d4b638b-c3ad-41ef-9861-0a6ad8ca80fa",
 Evaluatable->True,
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[200552, 5899, 30, 0, 44, "Subsubsection",ExpressionUUID->"32e284e2-2f82-4e8f-8a91-63f714a87cd8"],
Cell[200585, 5901, 93, 2, 46, "Input",ExpressionUUID->"72cca4b1-986a-4e1b-9dd9-34043c930317",
 InitializationCell->True],
Cell[200681, 5905, 128, 3, 46, "Input",ExpressionUUID->"d0445b31-0b04-444b-831b-8e7f7f3d3a37",
 InitializationCell->True],
Cell[200812, 5910, 173, 4, 46, "Input",ExpressionUUID->"53cfdbf7-07e8-4b95-a901-8f54e5398795",
 InitializationCell->True],
Cell[200988, 5916, 174, 4, 46, "Input",ExpressionUUID->"70ea2a08-9439-4b4d-9f01-794648a05bf1",
 InitializationCell->True],
Cell[201165, 5922, 3094, 70, 237, "Input",ExpressionUUID->"fea084e0-83da-45b7-8a5d-8af2f08c1d61",
 Evaluatable->True,
 InitializationCell->True],
Cell[204262, 5994, 3188, 72, 237, "Input",ExpressionUUID->"3f521fa7-1623-408b-a497-93fc7f06f7ca",
 Evaluatable->True,
 InitializationCell->True],
Cell[207453, 6068, 3249, 73, 237, "Input",ExpressionUUID->"1bce3ca8-d961-4323-98ef-93e2472f29b6",
 Evaluatable->True,
 InitializationCell->True],
Cell[210705, 6143, 5321, 134, 351, "Input",ExpressionUUID->"244c4d79-a2b1-42bc-8e06-cfc7143c097a",
 Evaluatable->True,
 InitializationCell->True],
Cell[216029, 6279, 91, 2, 46, "Input",ExpressionUUID->"607eb47b-021f-4659-86b9-965e92d26582",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[216157, 6286, 30, 0, 36, "Subsubsection",ExpressionUUID->"85d99b25-3368-46ca-aab4-9d7909db4754"],
Cell[216190, 6288, 93, 2, 70, "Input",ExpressionUUID->"14b933e6-c9af-4fb8-be6a-08309a660cf6",
 InitializationCell->True],
Cell[216286, 6292, 128, 3, 70, "Input",ExpressionUUID->"03a87f70-31b9-46af-974a-09eeecd60fd5",
 InitializationCell->True],
Cell[216417, 6297, 1857, 45, 70, "Input",ExpressionUUID->"2823c8df-7c0c-40b7-9f3e-e13a6e54fd53",
 Evaluatable->True,
 InitializationCell->True],
Cell[218277, 6344, 3564, 103, 70, "Input",ExpressionUUID->"15a9941e-047e-40dc-ab66-54f53bd259ad",
 Evaluatable->True,
 InitializationCell->True],
Cell[221844, 6449, 91, 2, 70, "Input",ExpressionUUID->"7dcde141-00e7-4055-a00e-dc961c98d62f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[221972, 6456, 29, 0, 36, "Subsubsection",ExpressionUUID->"3b1d47f4-0553-4e67-8327-f0ef7e9f654a"],
Cell[222004, 6458, 92, 2, 70, "Input",ExpressionUUID->"4cd764ca-22d6-4c23-9de5-587269244427",
 InitializationCell->True],
Cell[222099, 6462, 61, 1, 70, "Input",ExpressionUUID->"6d6ecea7-bd1b-4a0c-ae21-7737ff97a3f1"],
Cell[222163, 6465, 127, 3, 70, "Input",ExpressionUUID->"56d6664f-f300-46c1-925d-955c220dde13",
 InitializationCell->True],
Cell[222293, 6470, 6366, 155, 70, "Input",ExpressionUUID->"bc1d73b4-8303-4323-a159-68c7a36abe28",
 Evaluatable->True,
 InitializationCell->True],
Cell[228662, 6627, 90, 2, 70, "Input",ExpressionUUID->"6c51ea25-9d8b-45aa-8531-906e25a63150",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[228789, 6634, 28, 0, 36, "Subsubsection",ExpressionUUID->"9e7f767e-a765-4ad7-9aff-e49808a588a0"],
Cell[228820, 6636, 91, 2, 70, "Input",ExpressionUUID->"022ec441-7f0b-4815-a714-1c76a2b3e0f5",
 InitializationCell->True],
Cell[228914, 6640, 126, 3, 70, "Input",ExpressionUUID->"714fe159-8cd7-4635-9378-1b754b2d1ebc",
 InitializationCell->True],
Cell[229043, 6645, 1958, 49, 70, "Input",ExpressionUUID->"9f3e2a98-eebd-4f50-a12c-d9e4f98241e0",
 Evaluatable->True,
 InitializationCell->True],
Cell[231004, 6696, 89, 2, 70, "Input",ExpressionUUID->"7b27819e-ee39-42bf-afd1-9409d3559cbf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[231130, 6703, 44, 0, 36, "Subsubsection",ExpressionUUID->"771d942f-ae02-4f25-a564-11745bac893d"],
Cell[231177, 6705, 128, 3, 70, "Input",ExpressionUUID->"1c99770e-2e60-4095-898e-2d10a720274d",
 InitializationCell->True],
Cell[231308, 6710, 1963, 49, 70, "Input",ExpressionUUID->"b0ad072b-6db6-4266-8bb0-55d5f437c0ce",
 Evaluatable->True,
 InitializationCell->True],
Cell[233274, 6761, 128, 3, 70, "Input",ExpressionUUID->"bb77fb4b-907c-4918-a9ca-b572ecdae8c2",
 InitializationCell->True],
Cell[233405, 6766, 1963, 49, 70, "Input",ExpressionUUID->"2e87d97c-88e6-4264-9968-83f251ef19a8",
 Evaluatable->True,
 InitializationCell->True],
Cell[235371, 6817, 127, 3, 70, "Input",ExpressionUUID->"a7e5520c-fe85-4adc-a9b8-3f3fe53151e3",
 InitializationCell->True],
Cell[235501, 6822, 1916, 47, 70, "Input",ExpressionUUID->"39331bdb-f5d4-4a4d-a09b-f07b253e7249",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[237454, 6874, 41, 0, 36, "Subsubsection",ExpressionUUID->"9bd65317-6f51-45d9-be1c-fc7cd58a565f"],
Cell[237498, 6876, 127, 3, 70, "Input",ExpressionUUID->"7cf9b5a0-3a35-4cd7-88e4-448ed4722f51",
 InitializationCell->True],
Cell[237628, 6881, 1925, 49, 70, "Input",ExpressionUUID->"b109a229-b215-401f-8e1b-e6ac483e223d",
 Evaluatable->True,
 InitializationCell->True],
Cell[239556, 6932, 127, 3, 70, "Input",ExpressionUUID->"265d20b0-ef05-4428-8b99-66c2e8d6d0dc",
 InitializationCell->True],
Cell[239686, 6937, 1925, 49, 70, "Input",ExpressionUUID->"fe0cf456-7b05-418a-9e3f-c3f8e616e00a",
 Evaluatable->True,
 InitializationCell->True],
Cell[241614, 6988, 126, 3, 70, "Input",ExpressionUUID->"5112cc74-ee02-4abd-9b08-81be44d2f665",
 InitializationCell->True],
Cell[241743, 6993, 1926, 49, 70, "Input",ExpressionUUID->"ef9379a9-d53d-485c-98aa-5f2ef1fd68ce",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[243706, 7047, 28, 0, 36, "Subsubsection",ExpressionUUID->"5d0a7cf6-15ba-4ed5-9adb-4de4030085d5"],
Cell[243737, 7049, 126, 3, 46, "Input",ExpressionUUID->"e5cb4da9-3d9d-4d3c-b21d-70bea9f4b61b",
 InitializationCell->True],
Cell[243866, 7054, 1906, 48, 123, "Input",ExpressionUUID->"95abb792-799b-4515-a35b-a54f7e4e63d3",
 InitializationCell->True],
Cell[245775, 7104, 3410, 98, 256, "Input",ExpressionUUID->"79663a03-a1be-4052-a1a2-abd3e7bdabaf",
 Evaluatable->True,
 InitializationCell->True],
Cell[249188, 7204, 127, 3, 46, "Input",ExpressionUUID->"a18377b6-102a-4e70-8543-272d404ee886",
 InitializationCell->True],
Cell[249318, 7209, 1911, 48, 123, "Input",ExpressionUUID->"98bd0300-4953-4e80-b45b-e95c55b0d93b",
 InitializationCell->True],
Cell[251232, 7259, 4598, 127, 332, "Input",ExpressionUUID->"d4f63ca0-8f96-4028-8bec-2408401ca302",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[255867, 7391, 29, 0, 36, "Subsubsection",ExpressionUUID->"344eeaa5-8a57-4cb3-b09e-8d654cb010fa"],
Cell[255899, 7393, 92, 2, 44, "Input",ExpressionUUID->"4d27efee-0c4f-4af7-a8ab-fbd90618a254",
 InitializationCell->True],
Cell[255994, 7397, 127, 3, 44, "Input",ExpressionUUID->"60eb7979-3ada-494f-abdd-c84612b8d3a7",
 InitializationCell->True],
Cell[256124, 7402, 1916, 46, 159, "Input",ExpressionUUID->"6bce459a-07b8-4260-83c6-63eadb485632",
 InitializationCell->True],
Cell[258043, 7450, 213, 5, 44, "Input",ExpressionUUID->"f0af7aca-44f9-4bc5-a7b4-de33da11644b",
 InitializationCell->True],
Cell[258259, 7457, 807, 22, 44, "Input",ExpressionUUID->"a73bf094-57a1-467b-8cee-a90dce738827",
 InitializationCell->True],
Cell[259069, 7481, 1112, 31, 44, "Input",ExpressionUUID->"ed54328f-1f09-4025-af1f-1bae83575681",
 InitializationCell->True],
Cell[260184, 7514, 403, 10, 44, "Input",ExpressionUUID->"b00bbbbb-eb5c-41ad-8f4b-0ede7acd1abf",
 InitializationCell->True],
Cell[260590, 7526, 458, 13, 44, "Input",ExpressionUUID->"e60b74e2-1f85-4c9a-b27e-3702e488f4a7",
 InitializationCell->True],
Cell[261051, 7541, 81, 2, 28, "Input",ExpressionUUID->"2686f70e-eb0f-48b0-9579-f59bf24bc170"]
}, Closed]],
Cell[CellGroupData[{
Cell[261169, 7548, 34, 0, 36, "Subsubsection",ExpressionUUID->"f8c19d71-4b00-4bd9-948d-01aa21032cf6"],
Cell[261206, 7550, 132, 3, 70, "Input",ExpressionUUID->"c46f781a-e18f-4588-aee5-ade1065c5928",
 InitializationCell->True],
Cell[261341, 7555, 2378, 58, 70, "Input",ExpressionUUID->"adfc3c6c-6610-4ebd-8a9a-0b14970f7724",
 InitializationCell->True],
Cell[263722, 7615, 2503, 61, 70, "Input",ExpressionUUID->"4c3de918-9184-48d4-861f-0fad5cff6e4c",
 InitializationCell->True],
Cell[266228, 7678, 6710, 191, 70, "Input",ExpressionUUID->"872b8217-2458-457f-ba12-221a12136ae3",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[272975, 7874, 31, 0, 36, "Subsubsection",ExpressionUUID->"9001f00d-9166-4b6c-b17c-b0274c64ecde"],
Cell[273009, 7876, 94, 2, 46, "Input",ExpressionUUID->"c97c0fec-384b-4881-b970-0f69a01a1754",
 InitializationCell->True],
Cell[273106, 7880, 129, 3, 46, "Input",ExpressionUUID->"00dc4566-7bfe-435f-abfa-f0cc4af2fa32",
 InitializationCell->True],
Cell[273238, 7885, 2079, 52, 123, "Input",ExpressionUUID->"e4599481-8b82-4389-8ad2-f0fd20c3a2e0",
 Evaluatable->True,
 InitializationCell->True],
Cell[275320, 7939, 2211, 61, 123, "Input",ExpressionUUID->"c3528b20-f417-42be-914e-8a861ccd22c9",
 InitializationCell->True],
Cell[277534, 8002, 92, 2, 46, "Input",ExpressionUUID->"6cab9162-a011-46dd-9408-c728d4aaf0a5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[277663, 8009, 30, 0, 36, "Subsubsection",ExpressionUUID->"61f0816b-d560-43be-993e-eeb286d36376"],
Cell[277696, 8011, 100, 2, 70, "Input",ExpressionUUID->"9bb2597f-02f1-49d4-8b54-88f1fc91128c",
 InitializationCell->True],
Cell[277799, 8015, 93, 2, 70, "Input",ExpressionUUID->"83d396dc-7fa8-4048-821a-09789bd0d7f8",
 InitializationCell->True],
Cell[277895, 8019, 128, 3, 70, "Input",ExpressionUUID->"4149db38-17d1-41ed-a5fd-159d0ece1f48",
 InitializationCell->True],
Cell[278026, 8024, 2437, 63, 70, "Input",ExpressionUUID->"cde9d2dc-99ed-4705-ab64-3cf10e8ee2c6",
 Evaluatable->True,
 InitializationCell->True],
Cell[280466, 8089, 702, 21, 70, "Input",ExpressionUUID->"584aab45-5a50-43ae-8895-bc5fefb4dd00",
 InitializationCell->True],
Cell[281171, 8112, 660, 19, 70, "Input",ExpressionUUID->"5ad5b779-908a-40c2-917f-316db04f19f7",
 InitializationCell->True],
Cell[281834, 8133, 557, 16, 70, "Input",ExpressionUUID->"924c3df2-4180-41ae-9b92-b7a30c248f93",
 InitializationCell->True],
Cell[282394, 8151, 91, 2, 70, "Input",ExpressionUUID->"465848d1-f288-4c7b-8eca-f3b73cb9381a",
 InitializationCell->True],
Cell[282488, 8155, 98, 2, 70, "Input",ExpressionUUID->"751a355e-c98a-4cdf-aadf-5751750fcadf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[282623, 8162, 30, 0, 36, "Subsubsection",ExpressionUUID->"d22266eb-4423-421c-b8e9-0a344ce619c9"],
Cell[282656, 8164, 128, 3, 70, "Input",ExpressionUUID->"19abcbee-0597-4ea9-9219-e389831b16a5",
 InitializationCell->True],
Cell[282787, 8169, 1838, 46, 70, "Input",ExpressionUUID->"04eacd42-a8f1-4824-86fb-5d309b4400f8",
 Evaluatable->True,
 InitializationCell->True],
Cell[284628, 8217, 110, 3, 70, "Input",ExpressionUUID->"6e201ad9-5251-4a78-98d8-9ef3ae9ad213"],
Cell[284741, 8222, 2222, 64, 70, "Input",ExpressionUUID->"f4ab21a3-d596-46db-aaae-4dd89e2fd399",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[287000, 8291, 33, 0, 36, "Subsubsection",ExpressionUUID->"2c8524d7-aed3-4118-8b71-723bd7e8a244"],
Cell[287036, 8293, 96, 2, 70, "Input",ExpressionUUID->"3980908a-10dd-4dfa-b952-07f3546d567b",
 InitializationCell->True],
Cell[287135, 8297, 131, 3, 70, "Input",ExpressionUUID->"e7d8b17f-1008-4701-8937-4d505b24089c",
 InitializationCell->True],
Cell[287269, 8302, 1963, 49, 70, "Input",ExpressionUUID->"4f05ce9f-5faf-4a2d-b4f1-3c906af936eb",
 Evaluatable->True,
 InitializationCell->True],
Cell[289235, 8353, 94, 2, 70, "Input",ExpressionUUID->"e656919d-92c0-465d-ae01-0f800a36dbad",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[289366, 8360, 152, 2, 36, "Subsubsection",ExpressionUUID->"b28e0edb-66cc-40bf-973b-ecfd4e6a5e04"],
Cell[289521, 8364, 217, 4, 46, "Input",ExpressionUUID->"53cce049-e0af-4dec-946c-3fd554d87fa4",
 InitializationCell->True],
Cell[289741, 8370, 197, 4, 46, "Input",ExpressionUUID->"3cb10ea3-1e3d-44fd-9bfd-ecc72797b4b9",
 InitializationCell->True],
Cell[289941, 8376, 2244, 54, 123, "Input",ExpressionUUID->"434b7bbe-11b1-4750-8c3d-c6fbed21a065",
 Evaluatable->True,
 InitializationCell->True],
Cell[292188, 8432, 157, 3, 46, "Input",ExpressionUUID->"4b63ca0d-e924-4047-ad3a-cafc4f1949ea",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[292382, 8440, 202, 3, 36, "Subsubsection",ExpressionUUID->"6b0f0174-34f9-45e9-92bc-8bbe1e956e2e"],
Cell[292587, 8445, 239, 4, 46, "Input",ExpressionUUID->"d4e20a67-3072-435c-9fa3-0480e68686b1",
 InitializationCell->True],
Cell[292829, 8451, 223, 5, 46, "Input",ExpressionUUID->"a01a7d35-950a-4bb5-8c78-aea66cd4d4e3",
 InitializationCell->True],
Cell[293055, 8458, 2304, 55, 123, "Input",ExpressionUUID->"6d51954c-91bb-4d8d-b2f6-edc7757120fc",
 Evaluatable->True,
 InitializationCell->True],
Cell[295362, 8515, 181, 4, 46, "Input",ExpressionUUID->"73d0bab8-a7f0-4941-87db-7ff776c1379d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[295580, 8524, 252, 3, 36, "Subsubsection",ExpressionUUID->"77950cc1-42ef-4355-b234-086c8b7554c8"],
Cell[295835, 8529, 296, 5, 44, "Input",ExpressionUUID->"1113bb05-a5f9-4b18-bd62-b5247b6e180b",
 InitializationCell->True],
Cell[296134, 8536, 248, 5, 44, "Input",ExpressionUUID->"cfb59db2-ab51-47bf-be53-f635c4d44cdb",
 InitializationCell->True],
Cell[296385, 8543, 2585, 57, 140, "Input",ExpressionUUID->"d61d9011-7d81-46e0-87ad-1aa06dd8bc6d",
 Evaluatable->True,
 InitializationCell->True],
Cell[298973, 8602, 4065, 108, 273, "Input",ExpressionUUID->"de0d8e4e-4e4f-4571-b987-6b93d31820b5",
 InitializationCell->True],
Cell[303041, 8712, 184, 4, 44, "Input",ExpressionUUID->"088aa335-3778-4fb7-81d2-570ac6448723",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[303262, 8721, 209, 3, 36, "Subsubsection",ExpressionUUID->"03748430-dcc0-4038-b4c0-2f381ab4edff"],
Cell[303474, 8726, 270, 5, 44, "Input",ExpressionUUID->"ed5ea245-973a-4fde-820f-00558e35cfda",
 InitializationCell->True],
Cell[303747, 8733, 226, 5, 44, "Input",ExpressionUUID->"c748fd0f-d59a-4894-9f0f-9398a6d9282c",
 InitializationCell->True],
Cell[303976, 8740, 2311, 55, 121, "Input",ExpressionUUID->"813fa975-3c61-4b98-8dad-acc1206c5474",
 Evaluatable->True,
 InitializationCell->True],
Cell[306290, 8797, 184, 4, 44, "Input",ExpressionUUID->"b9d32561-252d-45ea-b3db-ea9e6e9494c7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[306511, 8806, 101, 1, 36, "Subsubsection",ExpressionUUID->"8302d224-4956-4bf2-bb36-6f725654b424"],
Cell[306615, 8809, 166, 3, 46, "Input",ExpressionUUID->"5606bf09-cddc-42ba-aaff-844d610a35e4",
 InitializationCell->True],
Cell[306784, 8814, 175, 4, 46, "Input",ExpressionUUID->"411d113a-b59b-41bb-b8ca-09b487ff387e",
 InitializationCell->True],
Cell[306962, 8820, 2142, 50, 123, "Input",ExpressionUUID->"f1781d5c-3903-4d2c-a59f-e5320ec34ddf",
 Evaluatable->True,
 InitializationCell->True],
Cell[309107, 8872, 1053, 29, 85, "Input",ExpressionUUID->"37e77691-d684-49df-b2a7-d278e9a3d8d5",
 Evaluatable->True,
 InitializationCell->True],
Cell[310163, 8903, 135, 3, 46, "Input",ExpressionUUID->"d24702a6-b210-42d8-873d-dc7ec9486349",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[310347, 8912, 63, 1, 67, "Section",ExpressionUUID->"df86c298-c23a-47e1-b4ae-93612adbf885",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[310435, 8917, 30, 0, 53, "Subsection",ExpressionUUID->"373006bb-5897-492c-8a52-af0a169be051"],
Cell[310468, 8919, 129, 3, 70, "Input",ExpressionUUID->"59d8e55c-2407-495d-93b4-d3ece81fd08f",
 InitializationCell->True],
Cell[310600, 8924, 555, 17, 70, "Input",ExpressionUUID->"00c5ed47-d2e7-4155-8e3b-6b0404cd15cb",
 InitializationCell->True],
Cell[311158, 8943, 134, 3, 70, "Input",ExpressionUUID->"edd5d9ab-d49f-40c8-8f0f-5bf020862946",
 InitializationCell->True],
Cell[311295, 8948, 385, 12, 70, "Input",ExpressionUUID->"db9829c4-4f46-45eb-ad7f-c45b3b46d2a2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[311717, 8965, 84, 0, 37, "Subsection",ExpressionUUID->"21d30154-19e5-46fc-b3d5-0a59db986fb4"],
Cell[311804, 8967, 2886, 73, 178, "Input",ExpressionUUID->"4b59fb76-5aed-46e0-af7e-f6d7ed74c84e",
 Evaluatable->True,
 InitializationCell->True],
Cell[314693, 9042, 953, 26, 44, "Input",ExpressionUUID->"49564d14-1640-4fe9-9648-0d94e8c0b858",
 InitializationCell->True],
Cell[315649, 9070, 504, 13, 44, "Input",ExpressionUUID->"0c0cfb5a-e5eb-4fd1-a9ef-c07930cd5ef8",
 Evaluatable->True,
 InitializationCell->True],
Cell[316156, 9085, 1915, 52, 140, "Input",ExpressionUUID->"ca1c7e82-41cf-4ff0-b0a6-2e458830ea62",
 InitializationCell->True],
Cell[318074, 9139, 553, 16, 44, "Input",ExpressionUUID->"4a4db1c6-8f6f-40a5-9295-1d199632a06e",
 InitializationCell->True],
Cell[318630, 9157, 228, 4, 34, "Text",ExpressionUUID->"4dcc2125-f8ae-4bae-a84a-2d7f99e964ab",
 InitializationCell->True],
Cell[318861, 9163, 414, 12, 44, "Input",ExpressionUUID->"1a039f9e-133b-428a-a5a9-5703890ae694",
 InitializationCell->True],
Cell[319278, 9177, 2081, 55, 121, "Input",ExpressionUUID->"cd0cbea3-ec36-4279-a7f0-882f25fd5b2b",
 InitializationCell->True],
Cell[321362, 9234, 468, 15, 44, "Input",ExpressionUUID->"f34d92a8-6909-4a62-8fc3-6a824fb3b1e6",
 InitializationCell->True],
Cell[321833, 9251, 2147, 58, 159, "Input",ExpressionUUID->"1c523cbd-1c4e-4534-abc8-4af4895ab539",
 InitializationCell->True],
Cell[323983, 9311, 1925, 52, 140, "Input",ExpressionUUID->"6dcb8707-6fbb-4dc6-86ba-073e2fc307d7",
 InitializationCell->True],
Cell[325911, 9365, 458, 13, 44, "Input",ExpressionUUID->"cae5e0d4-9a88-4319-b1b8-0a91142b6baa",
 InitializationCell->True],
Cell[326372, 9380, 1547, 39, 28, "Input",ExpressionUUID->"5bae5c7f-e291-45a3-ac64-53456722df18"],
Cell[327922, 9421, 14280, 319, 254, "Input",ExpressionUUID->"e3e66b4d-d433-476a-b8d6-8a4844ebef40",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[342239, 9745, 31, 0, 37, "Subsection",ExpressionUUID->"2cf8888f-fa4a-4d2d-afe4-fc53820c919d"],
Cell[342273, 9747, 334, 8, 70, "Input",ExpressionUUID->"78d61914-c83c-4721-9be3-85dcc4fedb1e",
 InitializationCell->True],
Cell[342610, 9757, 271, 6, 70, "Input",ExpressionUUID->"e1879cbd-6c55-490f-9e1b-45dabc6bcf56",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[342918, 9768, 30, 0, 37, "Subsection",ExpressionUUID->"6cb0b149-7d24-453f-a808-50ac339bb66d"],
Cell[342951, 9770, 431, 12, 70, "Input",ExpressionUUID->"3f7befe4-db3c-4574-a156-7326964a8747",
 InitializationCell->True],
Cell[343385, 9784, 169, 5, 70, "Input",ExpressionUUID->"e27f4435-b604-47f3-936b-996b34d8d346",
 Evaluatable->True,
 InitializationCell->True],
Cell[343557, 9791, 48, 0, 70, "Text",ExpressionUUID->"1674c7c2-513f-44cd-b755-6eeeb94f381b"],
Cell[343608, 9793, 7228, 179, 70, "Input",ExpressionUUID->"3291992a-b1d6-4139-8b78-043b50fca233",
 Evaluatable->True,
 InitializationCell->True],
Cell[350839, 9974, 170, 5, 70, "Input",ExpressionUUID->"333e2c4a-5593-4b2c-992f-f96443505217",
 Evaluatable->True,
 InitializationCell->True],
Cell[351012, 9981, 5678, 138, 70, "Input",ExpressionUUID->"3c432ef3-da9d-43b0-bca9-7afbd2c1d410",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[356727, 10124, 34, 0, 37, "Subsection",ExpressionUUID->"c763e052-3427-4fab-a4fe-bcbb34604af1"],
Cell[356764, 10126, 4529, 110, 70, "Input",ExpressionUUID->"12c14078-de2c-4524-971b-e15af7f04506",
 Evaluatable->True,
 InitializationCell->True],
Cell[361296, 10238, 4581, 111, 70, "Input",ExpressionUUID->"9d970915-4ccc-4e25-a025-c6624a0513bc",
 Evaluatable->True,
 InitializationCell->True],
Cell[365880, 10351, 3319, 87, 70, "Input",ExpressionUUID->"3443654b-e24b-4dae-8269-0e587b8fb6b4"],
Cell[369202, 10440, 169, 5, 70, "Input",ExpressionUUID->"f761a568-9806-48cd-8bdc-f27b7659c56d",
 Evaluatable->True,
 InitializationCell->True],
Cell[369374, 10447, 4362, 109, 70, "Input",ExpressionUUID->"4581f8a1-0cb9-4cb4-b7df-a2b7378ff666",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[373773, 10561, 39, 0, 37, "Subsection",ExpressionUUID->"9026a752-e9ff-4d0f-982a-4be717fba0f1"],
Cell[373815, 10563, 1997, 49, 70, "Input",ExpressionUUID->"87ff2b08-73bf-4604-b822-e01bb75cf9e9",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[375849, 10617, 33, 0, 37, "Subsection",ExpressionUUID->"33162236-5a77-439e-9790-a2d1617d4290"],
Cell[375885, 10619, 5133, 116, 577, "Input",ExpressionUUID->"f300ac1d-4801-49b2-a187-7cf24e5f7702",
 Evaluatable->True,
 InitializationCell->True],
Cell[381021, 10737, 4489, 86, 710, "Input",ExpressionUUID->"0b72b3c2-2845-49d0-ae28-1186de62fb0c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[385547, 10828, 36, 0, 37, "Subsection",ExpressionUUID->"f82bfbb6-fa83-4426-a313-8a6c5a86e1f4"],
Cell[385586, 10830, 1370, 33, 70, "Input",ExpressionUUID->"60a043f1-1d84-4265-851d-f46fb6c93883",
 InitializationCell->True],
Cell[386959, 10865, 1021, 26, 70, "Input",ExpressionUUID->"a298ac31-f364-427d-996e-c9a8aec671c5",
 InitializationCell->True],
Cell[387983, 10893, 775, 20, 70, "Input",ExpressionUUID->"f26fdca6-91d1-44ba-a940-3378d19aeb4c",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[388795, 10918, 132, 3, 37, "Subsection",ExpressionUUID->"923e6cd3-1e30-4c67-a24d-8a1b03bb7e3a"],
Cell[388930, 10923, 2865, 72, 152, "Input",ExpressionUUID->"8fa231c6-106d-4c1f-baad-3e9e37954ef8",
 InitializationCell->True],
Cell[391798, 10997, 2193, 59, 72, "Input",ExpressionUUID->"ba5fb9e4-e015-443e-abc8-d442185e57c8",
 Evaluatable->True,
 InitializationCell->True],
Cell[393994, 11058, 2184, 59, 72, "Input",ExpressionUUID->"a9a312df-c0d6-44c4-85ee-fdedff1844bd",
 Evaluatable->True,
 InitializationCell->True],
Cell[396181, 11119, 2821, 73, 72, "Input",ExpressionUUID->"0345425e-8a0e-418e-b299-40d66f160ae9",
 Evaluatable->True,
 InitializationCell->True],
Cell[399005, 11194, 1386, 35, 52, "Input",ExpressionUUID->"a711f690-26a3-4ada-ade7-5ea2e0c7341b",
 Evaluatable->True,
 InitializationCell->True],
Cell[400394, 11231, 1003, 27, 52, "Input",ExpressionUUID->"f480c4dc-431b-497c-9785-3ac1b7a6db9a",
 Evaluatable->True,
 InitializationCell->True],
Cell[401400, 11260, 1003, 27, 52, "Input",ExpressionUUID->"3d970560-3c91-4478-8032-e04db1f0d51a",
 Evaluatable->True,
 InitializationCell->True],
Cell[402406, 11289, 2162, 58, 92, "Input",ExpressionUUID->"4320229c-7be4-49fa-82a0-eba60a2f5bfe",
 Evaluatable->True,
 InitializationCell->True],
Cell[404571, 11349, 984, 26, 31, "Input",ExpressionUUID->"9104d237-630e-4120-9ec7-f96155d631a3",
 Evaluatable->True,
 InitializationCell->True],
Cell[405558, 11377, 1416, 38, 72, "Input",ExpressionUUID->"108131b2-9570-4952-8051-4297b25b1f1f",
 Evaluatable->True,
 InitializationCell->True],
Cell[406977, 11417, 1418, 38, 72, "Input",ExpressionUUID->"5bf6906c-74c5-48f9-90d8-6084126ed2a9",
 Evaluatable->True,
 InitializationCell->True],
Cell[408398, 11457, 799, 22, 31, "Input",ExpressionUUID->"24c7b490-3265-4ce6-9cb3-df992e8a81f2",
 Evaluatable->True,
 InitializationCell->True],
Cell[409200, 11481, 10755, 288, 252, "Input",ExpressionUUID->"b7d49b2a-1f25-44f5-aea2-dc24a2fd27bb",
 Evaluatable->True,
 InitializationCell->True],
Cell[419958, 11771, 10827, 289, 252, "Input",ExpressionUUID->"e073a542-6eb2-468b-975b-1a499df2e953",
 Evaluatable->True,
 InitializationCell->True],
Cell[430788, 12062, 2199, 59, 72, "Input",ExpressionUUID->"f59a7d2c-18a2-48e5-ad27-782ce186af42",
 Evaluatable->True,
 InitializationCell->True],
Cell[432990, 12123, 2161, 58, 92, "Input",ExpressionUUID->"a98c047e-ce81-4139-bcba-052009e3227c",
 Evaluatable->True,
 InitializationCell->True],
Cell[435154, 12183, 2159, 58, 92, "Input",ExpressionUUID->"30030217-2be0-4634-b8b4-e8d3a73d1cd8",
 Evaluatable->True,
 InitializationCell->True],
Cell[437316, 12243, 2357, 64, 92, "Input",ExpressionUUID->"9cb499a6-c253-4b82-9140-1c373f9a36aa",
 Evaluatable->True,
 InitializationCell->True],
Cell[439676, 12309, 1948, 53, 72, "Input",ExpressionUUID->"6a6823df-8380-4a08-a528-0efb8c7c014f",
 Evaluatable->True,
 InitializationCell->True],
Cell[441627, 12364, 1947, 53, 72, "Input",ExpressionUUID->"e9a7d1bf-8a7b-4822-b797-2c845446c8cf",
 Evaluatable->True,
 InitializationCell->True],
Cell[443577, 12419, 1877, 52, 72, "Input",ExpressionUUID->"1ad9fb5a-c61b-4dfc-af8a-f2888ce6a243",
 Evaluatable->True,
 InitializationCell->True],
Cell[445457, 12473, 1935, 53, 72, "Input",ExpressionUUID->"95dcc6bd-0bfa-4e2d-92f3-5263189838fd",
 Evaluatable->True,
 InitializationCell->True],
Cell[447395, 12528, 1855, 49, 72, "Input",ExpressionUUID->"f1ad7145-1163-4073-ace5-4707addc0dec",
 Evaluatable->True,
 InitializationCell->True],
Cell[449253, 12579, 1981, 53, 72, "Input",ExpressionUUID->"08292af3-d836-49f4-86bc-bacec1c41962",
 Evaluatable->True,
 InitializationCell->True],
Cell[451237, 12634, 1131, 31, 31, "Input",ExpressionUUID->"deea594b-b20e-4551-b830-0553d64ef192",
 Evaluatable->True,
 InitializationCell->True],
Cell[452371, 12667, 1187, 32, 72, "Input",ExpressionUUID->"e00488b3-955b-44ae-92f6-67174936367e",
 Evaluatable->True,
 InitializationCell->True],
Cell[453561, 12701, 9334, 252, 212, "Input",ExpressionUUID->"db84cf0b-0c63-4e76-99ce-7de861280ea6",
 Evaluatable->True,
 InitializationCell->True],
Cell[462898, 12955, 6425, 165, 152, "Input",ExpressionUUID->"d7dfbb31-515f-4e1e-88d8-520f3d9bc18c",
 Evaluatable->True,
 InitializationCell->True],
Cell[469326, 13122, 10895, 296, 252, "Input",ExpressionUUID->"d374322d-d136-4a65-8ee4-ae81af01da57",
 Evaluatable->True,
 InitializationCell->True],
Cell[480224, 13420, 25876, 680, 472, "Input",ExpressionUUID->"18e1bd0f-d0fb-4ee2-944f-b4fa3d92a138",
 Evaluatable->True,
 InitializationCell->True],
Cell[506103, 14102, 745, 21, 31, "Input",ExpressionUUID->"98fb1679-a75c-40ad-a6de-391f9e98bcfd",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[506885, 14128, 29, 0, 37, "Subsection",ExpressionUUID->"d31c348a-4e9d-40d9-b696-23764ed7b429"],
Cell[506917, 14130, 12112, 305, 70, "Input",ExpressionUUID->"0ea486c1-3d56-41c8-97b2-7f73bf71e7ed",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[519066, 14440, 36, 0, 37, "Subsection",ExpressionUUID->"92947e60-4db8-4470-a65f-e1644cee6695"],
Cell[519105, 14442, 592, 16, 70, "Input",ExpressionUUID->"4ab26e59-55f8-46c3-ab4e-ab42f8b9172c",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[519734, 14463, 33, 0, 37, "Subsection",ExpressionUUID->"77a583d3-0ffe-4e10-bb7c-17ca426cd712"],
Cell[519770, 14465, 1371, 34, 102, "Input",ExpressionUUID->"34825302-96fc-4c46-8ef3-b246a2af6794",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[521178, 14504, 40, 0, 37, "Subsection",ExpressionUUID->"110df24e-3aa3-4793-b6d2-f10fdb2e6af4"],
Cell[521221, 14506, 827, 22, 28, "Input",ExpressionUUID->"e7bd82f2-1bc7-443c-819b-617925501483",
 Evaluatable->True],
Cell[522051, 14530, 1125, 31, 67, "Input",ExpressionUUID->"41b2ae1a-ccad-44b8-837b-6552eaa3c989",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[523213, 14566, 91, 0, 37, "Subsection",ExpressionUUID->"75b8dc83-119a-4970-b5a2-66d5ca74b9ba"],
Cell[523307, 14568, 15381, 391, 558, "Input",ExpressionUUID->"c4d02006-a0dd-4620-b58b-04e7351b68cd",
 InitializationCell->True],
Cell[538691, 14961, 857, 22, 86, "Input",ExpressionUUID->"0a9a1977-54cf-4f17-9372-d405182777d1"]
}, Closed]],
Cell[CellGroupData[{
Cell[539585, 14988, 40, 0, 37, "Subsection",ExpressionUUID->"cdfced05-8ae3-40df-b51a-32a6bba31fd6"],
Cell[539628, 14990, 1261, 33, 105, "Input",ExpressionUUID->"4555b9fc-c2be-43e4-b73d-694231c67286",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[540926, 15028, 38, 0, 37, "Subsection",ExpressionUUID->"04c6d133-539a-4fc6-891e-0b354ceb3261"],
Cell[540967, 15030, 3717, 105, 70, "Input",ExpressionUUID->"934ff96d-ac29-47d8-9d5d-e9d63c4f597a",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[544721, 15140, 38, 0, 37, "Subsection",ExpressionUUID->"f936e615-6f4d-4065-a094-9e411fc2b756"],
Cell[544762, 15142, 2361, 66, 70, "Input",ExpressionUUID->"665615c2-bbf8-49e1-89f7-5a5e4c28ed33",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[547160, 15213, 29, 0, 37, "Subsection",ExpressionUUID->"09c458c4-5676-4aae-a468-989947ce002b"],
Cell[547192, 15215, 479, 14, 70, "Input",ExpressionUUID->"96997284-07cb-4d58-9450-97ee5b364c84",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[547708, 15234, 50, 0, 37, "Subsection",ExpressionUUID->"d6623594-0632-44ac-9a0c-f4e5138089b9"],
Cell[547761, 15236, 2562, 72, 70, "Input",ExpressionUUID->"655cac80-52ea-4d6b-aeba-ffb364e8305c",
 Evaluatable->True,
 InitializationCell->True],
Cell[550326, 15310, 916, 27, 70, "Input",ExpressionUUID->"db48011f-8664-4d45-9c37-037448ff646c",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[551279, 15342, 29, 0, 37, "Subsection",ExpressionUUID->"91af2808-1ea4-448b-9a82-5b7474641280"],
Cell[551311, 15344, 1498, 35, 70, "Input",ExpressionUUID->"0f21c2dc-895a-42e9-bfba-505beecd71a0",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[552846, 15384, 28, 0, 37, "Subsection",ExpressionUUID->"85cc325e-bb00-4c7f-ae42-dc42d784dccd"],
Cell[552877, 15386, 404, 11, 44, "Input",ExpressionUUID->"6b368a1b-fbc9-4e4f-a7ae-efa501f705f5",
 Evaluatable->True,
 InitializationCell->True],
Cell[553284, 15399, 646, 18, 44, "Input",ExpressionUUID->"af512216-c3bc-440b-834b-c45a538b254c",
 Evaluatable->True,
 InitializationCell->True],
Cell[CellGroupData[{
Cell[553955, 15421, 120, 1, 28, "Input",ExpressionUUID->"82d8eb07-74ee-4c40-bb49-d424cef0b9de"],
Cell[554078, 15424, 230, 4, 32, "Output",ExpressionUUID->"e97a0e0f-de49-49ec-b3ad-dd44c5d86fd6"]
}, Open  ]],
Cell[554323, 15431, 1347, 31, 121, "Input",ExpressionUUID->"d1ee3d60-a8f9-437c-a468-dedc2ecfd836",
 InitializationCell->True],
Cell[555673, 15464, 618, 16, 44, "Input",ExpressionUUID->"76fa36fc-942c-4ba7-aa86-a816badc33b0",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[556328, 15485, 33, 0, 37, "Subsection",ExpressionUUID->"c57f0833-bbae-4383-95be-9925393a9325"],
Cell[556364, 15487, 2655, 64, 70, "Input",ExpressionUUID->"18a098e5-dd78-40ba-aec5-063ef7f3015e",
 Evaluatable->True,
 InitializationCell->True],
Cell[559022, 15553, 895, 20, 70, "Text",ExpressionUUID->"874091af-cd9a-4a66-a9a1-1a7fd0ff18ad",
 Evaluatable->True,
 InitializationCell->True],
Cell[559920, 15575, 800, 24, 70, "Input",ExpressionUUID->"5d68387f-d111-4d69-a880-a8fd7a820ffb",
 Evaluatable->True,
 InitializationCell->True],
Cell[560723, 15601, 3584, 90, 70, "Input",ExpressionUUID->"08997ead-a791-41cd-a267-be8aaf64894c",
 Evaluatable->True,
 InitializationCell->True],
Cell[564310, 15693, 3584, 90, 70, "Input",ExpressionUUID->"9a39c1f7-1dc3-4428-8af1-2ef8bdd3e548",
 Evaluatable->True,
 InitializationCell->True],
Cell[567897, 15785, 3893, 94, 70, "Input",ExpressionUUID->"6cfc28cb-d737-4114-b70a-3e44c8ca357b",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[571827, 15884, 67, 0, 37, "Subsection",ExpressionUUID->"5eef7c6a-dd1a-4ce9-9237-4cbee1895959"],
Cell[571897, 15886, 314, 10, 70, "Input",ExpressionUUID->"c301f32f-aa9d-4863-b1f8-87114a369b4f",
 InitializationCell->True],
Cell[572214, 15898, 590, 19, 70, "Input",ExpressionUUID->"de772b90-c2f0-41f4-92c1-8e71242d9f9b",
 InitializationCell->True],
Cell[572807, 15919, 479, 12, 70, "Input",ExpressionUUID->"cd2e261c-bda1-4c70-ab08-a0069ffb9998",
 InitializationCell->True],
Cell[573289, 15933, 669, 19, 70, "Input",ExpressionUUID->"356e4ce9-510a-470d-860e-f9358d7523f2",
 InitializationCell->True],
Cell[573961, 15954, 869, 30, 70, "Input",ExpressionUUID->"4eeee090-5a91-49ed-8d86-37372c70436e",
 InitializationCell->True],
Cell[574833, 15986, 615, 17, 70, "Input",ExpressionUUID->"5ffa8e88-d9c6-49c3-9eea-020b140a3359",
 InitializationCell->True],
Cell[575451, 16005, 1510, 44, 70, "Input",ExpressionUUID->"9824c6bd-81cd-4548-8ccb-5d7509c64c54",
 InitializationCell->True],
Cell[576964, 16051, 216, 6, 70, "Input",ExpressionUUID->"4ed7091b-1793-44af-937c-e1981ed30ef0",
 InitializationCell->True],
Cell[577183, 16059, 566, 16, 70, "Input",ExpressionUUID->"4688c849-46d3-430c-a3db-3e000cdcf67a",
 InitializationCell->True],
Cell[577752, 16077, 317, 9, 70, "Input",ExpressionUUID->"f6fdb2e1-3e94-4d32-bc22-4a67cb2f0f79",
 InitializationCell->True],
Cell[578072, 16088, 347, 11, 70, "Input",ExpressionUUID->"e12a5a24-bf4d-42b3-ba71-d5b0d1072055",
 InitializationCell->True],
Cell[578422, 16101, 1221, 34, 70, "Input",ExpressionUUID->"904314b8-d194-486d-9f68-a74cff162084",
 InitializationCell->True],
Cell[579646, 16137, 1728, 45, 70, "Input",ExpressionUUID->"74474bd1-766c-4f8b-943e-d82e4ee86bf7",
 InitializationCell->True],
Cell[581377, 16184, 368, 10, 70, "Input",ExpressionUUID->"234e9148-f8b5-40b6-a9c4-b2c26465dff2",
 InitializationCell->True],
Cell[581748, 16196, 2033, 56, 70, "Input",ExpressionUUID->"ac0615f3-e7af-4ce3-baa2-699703ad7c4f",
 InitializationCell->True],
Cell[583784, 16254, 683, 21, 70, "Input",ExpressionUUID->"2825ea14-8c3b-4f38-ae9d-79e7caf18032",
 InitializationCell->True],
Cell[584470, 16277, 546, 19, 70, "Input",ExpressionUUID->"a20be234-bdfe-4c82-9c51-0dbb058f05d7",
 InitializationCell->True],
Cell[585019, 16298, 6773, 170, 70, "Input",ExpressionUUID->"9396f871-33e5-437e-a849-83587fd07539",
 Evaluatable->True,
 InitializationCell->True],
Cell[591795, 16470, 1608, 45, 70, "Input",ExpressionUUID->"117aded8-b99f-401f-9a15-bfca19f3bed9",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[593440, 16520, 31, 0, 37, "Subsection",ExpressionUUID->"dbc66973-4423-44fa-bd4f-c53b0a3f6e64"],
Cell[593474, 16522, 3683, 96, 70, "Input",ExpressionUUID->"1b90a9a5-5d99-4468-bdf9-a2cee0963040",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[597194, 16623, 36, 0, 37, "Subsection",ExpressionUUID->"870af249-34e6-4a96-b9b1-94f751dbe1d6"],
Cell[597233, 16625, 5284, 131, 70, "Input",ExpressionUUID->"67d3306f-2fae-4bc7-80d3-7353cbf1669d",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[602554, 16761, 34, 0, 37, "Subsection",ExpressionUUID->"fb8af2ab-a0d7-4684-8cb5-95dcd78ccf29"],
Cell[602591, 16763, 3429, 88, 70, "Input",ExpressionUUID->"1d380a80-3a5f-4b79-95c0-c9919dbb79db",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[606057, 16856, 30, 0, 37, "Subsection",ExpressionUUID->"35733b02-0b9e-41a1-98c8-d051be6cec83"],
Cell[606090, 16858, 3737, 101, 70, "Input",ExpressionUUID->"ddb16571-65c8-4ab7-9a41-cc4823539a1b",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[609864, 16964, 41, 0, 37, "Subsection",ExpressionUUID->"9dff5808-8f9e-4371-8c14-6080d28d4d2c"],
Cell[609908, 16966, 76, 0, 34, "Text",ExpressionUUID->"a2a46b33-c6de-49c4-a78c-90408e09a342"],
Cell[609987, 16968, 112, 3, 34, "Text",ExpressionUUID->"b938eb09-c9a6-4dfb-9e87-11bd1d3ccacb"],
Cell[610102, 16973, 105, 3, 34, "Text",ExpressionUUID->"fe0ff6db-4f97-4355-8111-cf5b9089074e"],
Cell[610210, 16978, 623, 14, 44, "Input",ExpressionUUID->"5b20ee17-50ca-4b9c-9390-53d25c72227d",
 InitializationCell->True],
Cell[610836, 16994, 553, 11, 44, "Input",ExpressionUUID->"7199fd9d-f506-4d43-8402-0b2f854be070",
 InitializationCell->True],
Cell[611392, 17007, 185, 4, 44, "Input",ExpressionUUID->"3d83da27-a81f-49f0-99c6-4ccddbccbfe5",
 InitializationCell->True],
Cell[611580, 17013, 10502, 232, 425, "Input",ExpressionUUID->"3346ed2f-3784-423e-8191-9bff723006b3",
 InitializationCell->True],
Cell[622085, 17247, 608, 19, 44, "Input",ExpressionUUID->"c7e11058-c0e3-42f3-b758-c25d86e3d338",
 InitializationCell->True],
Cell[622696, 17268, 421, 11, 67, "Input",ExpressionUUID->"b85cf9e2-54bd-45f0-bd60-fbb430a2abc3"],
Cell[623120, 17281, 1217, 33, 28, "Input",ExpressionUUID->"f4fb3ca0-492c-4b8f-84e1-c3334574ceeb"],
Cell[CellGroupData[{
Cell[624362, 17318, 30, 0, 44, "Subsubsection",ExpressionUUID->"9e977755-0008-4edf-88af-682e41043107"],
Cell[624395, 17320, 297, 7, 44, "Input",ExpressionUUID->"33a5ef42-3066-4ea6-a945-074b89224a4e",
 InitializationCell->True],
Cell[624695, 17329, 7203, 161, 307, "Input",ExpressionUUID->"d1df4752-6fe3-4427-85fb-44d15787f3fc",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[631935, 17495, 58, 1, 44, "Subsubsection",ExpressionUUID->"bd7ba0c9-7dad-497f-90c5-ec8dc04b6551",
 InitializationCell->True],
Cell[631996, 17498, 173, 5, 44, "Input",ExpressionUUID->"c25ae126-d55f-4017-a8dc-a9b22fbc0d53",
 InitializationCell->True],
Cell[632172, 17505, 2185, 58, 61, "Text",ExpressionUUID->"085d912f-566e-43f1-844d-03c35c8e7793"],
Cell[634360, 17565, 20351, 444, 744, "Input",ExpressionUUID->"2c5d06ed-9354-4bbe-9abf-3479a092f510",
 InitializationCell->True],
Cell[654714, 18011, 94, 1, 28, "Input",ExpressionUUID->"8afd6ade-250b-4bc6-bfb5-43bb80a06141"],
Cell[654811, 18014, 20454, 447, 649, "Input",ExpressionUUID->"7ca759c4-bd6a-45c9-aeba-b045e28768ab",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[675302, 18466, 62, 1, 44, "Subsubsection",ExpressionUUID->"e5464d4b-9cba-4389-aecd-1ba084b7c4e3",
 InitializationCell->True],
Cell[675367, 18469, 275, 7, 44, "Input",ExpressionUUID->"daa13124-d360-457a-a79f-d4db8c066faf",
 InitializationCell->True],
Cell[675645, 18478, 10248, 230, 256, "Input",ExpressionUUID->"5adafa75-371d-47f3-a45c-e366d8449155",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[685930, 18713, 61, 1, 44, "Subsubsection",ExpressionUUID->"e2b69362-1fef-4786-86c2-66766058ca5c",
 InitializationCell->True],
Cell[685994, 18716, 176, 5, 44, "Input",ExpressionUUID->"5393cad0-bb73-41e8-97f2-cb59e91a1056",
 InitializationCell->True],
Cell[686173, 18723, 7792, 187, 191, "Input",ExpressionUUID->"a80df69f-6460-45b8-b4ad-5f934533e602",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[694002, 18915, 60, 1, 44, "Subsubsection",ExpressionUUID->"fb37aabd-5de1-478b-8342-fc2ba925b82c",
 InitializationCell->True],
Cell[694065, 18918, 174, 5, 44, "Input",ExpressionUUID->"e4db90cf-fc46-4521-bf07-62cb0ec1805c",
 InitializationCell->True],
Cell[694242, 18925, 4189, 111, 148, "Input",ExpressionUUID->"23e27a77-b9ba-40ac-b872-0308e8c09f23",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[698468, 19041, 75, 1, 44, "Subsubsection",ExpressionUUID->"457b6088-4c40-4e9b-9848-93a13785fb91",
 InitializationCell->True],
Cell[698546, 19044, 175, 5, 44, "Input",ExpressionUUID->"3df02477-32c4-4ad7-b7c3-98e9d0ae74e7",
 InitializationCell->True],
Cell[698724, 19051, 3980, 109, 148, "Input",ExpressionUUID->"fd978b7e-54b0-493a-9e4f-8e1ba2c51077",
 InitializationCell->True],
Cell[702707, 19162, 3956, 109, 148, "Input",ExpressionUUID->"70a3cb1e-e93a-4d02-8d6b-194592b47a7f",
 InitializationCell->True],
Cell[706666, 19273, 3958, 109, 148, "Input",ExpressionUUID->"6def011d-9730-49a7-b6df-622550a3c147",
 InitializationCell->True],
Cell[710627, 19384, 4011, 110, 148, "Input",ExpressionUUID->"e032c11e-3eb5-4c38-85ba-fcf7453d9ceb",
 InitializationCell->True],
Cell[714641, 19496, 3261, 86, 110, "Input",ExpressionUUID->"27285127-3063-4e35-b8b2-6aba9943b9b9",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[717939, 19587, 59, 1, 39, "Subsubsection",ExpressionUUID->"b38c6bac-845d-4f62-bd1f-b663d9b3389f",
 InitializationCell->True],
Cell[718001, 19590, 177, 5, 46, "Input",ExpressionUUID->"5b1f421c-c2b5-4abf-bd56-ae698f45e162",
 InitializationCell->True],
Cell[718181, 19597, 3129, 82, 131, "Input",ExpressionUUID->"d2e16286-47b5-400a-b03f-106c6ff4e4e9",
 InitializationCell->True],
Cell[721313, 19681, 3226, 85, 131, "Input",ExpressionUUID->"8836a7e3-8852-4294-9240-e41d7310f5f0",
 InitializationCell->True],
Cell[724542, 19768, 3175, 84, 131, "Input",ExpressionUUID->"755ebafc-35a5-476a-8ba2-4f87ed89c3db",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[727754, 19857, 59, 1, 39, "Subsubsection",ExpressionUUID->"ef713b52-36ca-4289-b08e-9f33532064a0",
 InitializationCell->True],
Cell[727816, 19860, 2705, 69, 93, "Input",ExpressionUUID->"8e61032d-731e-4e80-8f34-836197f4b637",
 InitializationCell->True],
Cell[730524, 19931, 2755, 69, 119, "Input",ExpressionUUID->"4c1b177e-25a3-4484-9a4f-5e16423eaae1",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[733316, 20005, 69, 1, 39, "Subsubsection",ExpressionUUID->"aed44d1d-488c-4e15-8742-c8aee3a431ee",
 InitializationCell->True],
Cell[733388, 20008, 4571, 118, 131, "Input",ExpressionUUID->"2680feba-320a-4f63-b5f6-1824cd2c401a",
 InitializationCell->True],
Cell[737962, 20128, 3354, 81, 112, "Input",ExpressionUUID->"19888c00-4532-46b2-a13d-9961060a678b",
 InitializationCell->True],
Cell[741319, 20211, 2498, 67, 93, "Input",ExpressionUUID->"07bd7108-8483-4bd1-9227-85b40b8a4cc4",
 InitializationCell->True],
Cell[743820, 20280, 2499, 67, 93, "Input",ExpressionUUID->"c3f50212-65bf-4a49-8f5f-8ca707bfecf9",
 InitializationCell->True],
Cell[746322, 20349, 2507, 67, 93, "Input",ExpressionUUID->"3169d1b1-380d-4737-8eb4-ae02e8ffd948",
 InitializationCell->True],
Cell[748832, 20418, 4300, 115, 131, "Input",ExpressionUUID->"dc1e691f-3c02-47ab-8bc7-3fa87d2024a6",
 InitializationCell->True],
Cell[753135, 20535, 2532, 67, 91, "Input",ExpressionUUID->"59c60f75-943b-4add-b91a-29e253508cc3",
 InitializationCell->True],
Cell[755670, 20604, 2532, 67, 91, "Input",ExpressionUUID->"ece6fb19-4a87-494d-80c1-3c24c53260cd",
 InitializationCell->True],
Cell[758205, 20673, 2583, 68, 91, "Input",ExpressionUUID->"8883103d-0785-4e47-8276-320de76f202c",
 InitializationCell->True],
Cell[760791, 20743, 2549, 67, 91, "Input",ExpressionUUID->"ed90ad9b-7145-4da5-8845-92b0513ca606",
 InitializationCell->True],
Cell[763343, 20812, 2532, 66, 91, "Input",ExpressionUUID->"e75d7ecb-3e1d-4efd-ad4e-b7de151aff30",
 InitializationCell->True],
Cell[765878, 20880, 2580, 67, 91, "Input",ExpressionUUID->"e3c8b799-e71c-49b9-856d-4a4b40181356",
 InitializationCell->True],
Cell[768461, 20949, 924, 20, 64, "Input",ExpressionUUID->"6c7bc4af-4f88-464b-9e83-fcb46d2e335a",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[769422, 20974, 61, 1, 44, "Subsubsection",ExpressionUUID->"80fc4f05-bb98-4ad7-9b1f-8ab0602b8947",
 InitializationCell->True],
Cell[769486, 20977, 2596, 68, 83, "Text",ExpressionUUID->"8f1124ae-efd9-407f-8d1c-b3d1dfb0e04a",
 InitializationCell->True],
Cell[772085, 21047, 4308, 113, 148, "Input",ExpressionUUID->"04baac39-9805-43ce-85ab-9478798d0365",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[776430, 21165, 63, 1, 44, "Subsubsection",ExpressionUUID->"6f813822-27f4-451b-8edf-66eabda3504c",
 InitializationCell->True],
Cell[776496, 21168, 4358, 115, 129, "Input",ExpressionUUID->"467cdcf2-20d3-4585-b72d-145aecbe1899",
 InitializationCell->True],
Cell[780857, 21285, 4334, 115, 129, "Input",ExpressionUUID->"9f9b977c-256d-482e-b9b6-99e18d159723",
 InitializationCell->True]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[785240, 21406, 29, 0, 37, "Subsection",ExpressionUUID->"96569d57-b679-431d-92e1-dd0da8f47f8f"],
Cell[785272, 21408, 46400, 1106, 2163, "Input",ExpressionUUID->"693673f4-de8a-4982-8332-c36af2bb5bb2",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[831697, 22518, 249, 5, 28, "Input",ExpressionUUID->"9ff84742-52be-4c6a-a3a2-1f4085c41a80"],
Cell[831949, 22525, 221, 3, 32, "Output",ExpressionUUID->"69694572-dbe9-4e1c-90af-0cb313d4d710"]
}, Open  ]],
Cell[832185, 22531, 14627, 310, 559, "Input",ExpressionUUID->"36069cc9-f809-4687-aa0b-910b505ac5b4",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[846837, 22845, 214, 5, 28, "Input",ExpressionUUID->"6dfb02cb-38d3-4930-9276-94589fa2c2b0"],
Cell[847054, 22852, 161, 3, 32, "Output",ExpressionUUID->"f48bf77a-ce77-49a8-9d0f-7aca1f5ddac6"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[847264, 22861, 35, 0, 37, "Subsection",ExpressionUUID->"51a03054-7de6-4655-bd0a-d60363f3a172"],
Cell[847302, 22863, 2041, 36, 83, "Input",ExpressionUUID->"2089c42c-360e-40a0-8d23-58f556b5d897",
 InitializationCell->True],
Cell[849346, 22901, 1912, 51, 140, "Input",ExpressionUUID->"cdf33156-fa2a-4377-a25b-690f1c842c87",
 InitializationCell->True],
Cell[851261, 22954, 1038, 27, 178, "Input",ExpressionUUID->"ee6f8eba-c840-40b6-a60b-1d7d1faaa04f",
 InitializationCell->True],
Cell[852302, 22983, 903, 26, 121, "Input",ExpressionUUID->"6dc6ed74-ddbe-4622-a90d-0f1c2f17503d",
 InitializationCell->True],
Cell[853208, 23011, 245, 5, 34, "Text",ExpressionUUID->"4578672d-27fb-425d-bcd2-a9c04d6bfc00"],
Cell[853456, 23018, 132, 2, 28, "Input",ExpressionUUID->"2f6c7e80-244b-4d5d-9b48-f5b13bdc425d"],
Cell[853591, 23022, 22167, 524, 1230, "Input",ExpressionUUID->"e692d3de-8190-4547-9445-4384eed58cb0",
 InitializationCell->True],
Cell[875761, 23548, 21899, 521, 1153, "Input",ExpressionUUID->"e46ad888-51c9-4cf2-ae7a-47dcd59b8a7f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[897697, 24074, 89, 0, 37, "Subsection",ExpressionUUID->"56958279-83a4-49ed-89b5-82b525d59f09"],
Cell[897789, 24076, 15897, 392, 935, "Input",ExpressionUUID->"927129ac-f4f2-49b9-acf9-50a31b881b18",
 InitializationCell->True],
Cell[913689, 24470, 1058, 31, 44, "Input",ExpressionUUID->"ded1d82b-9bc6-458b-90b2-c1257ef25c29",
 InitializationCell->True],
Cell[914750, 24503, 14662, 344, 745, "Input",ExpressionUUID->"92065a82-f37d-4497-8544-794ef817c1c8",
 InitializationCell->True],
Cell[929415, 24849, 1828, 44, 83, "Input",ExpressionUUID->"dd9421be-e413-4c61-b7f0-c5855cd80e6e",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[931280, 24898, 116, 2, 53, "Subsection",ExpressionUUID->"2c233607-366b-4903-8483-4d197010d740",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[931421, 24904, 68, 1, 44, "Subsubsection",ExpressionUUID->"ecaa96da-9452-431a-a28d-6f47c4259664",
 InitializationCell->True],
Cell[931492, 24907, 2838, 76, 70, "Input",ExpressionUUID->"da9123f1-0890-420c-8ddf-b52f3e25046a",
 InitializationCell->True],
Cell[934333, 24985, 355, 9, 70, "Input",ExpressionUUID->"9bbe6333-8348-4e84-868f-62868a38b838",
 InitializationCell->True],
Cell[934691, 24996, 552, 12, 70, "Input",ExpressionUUID->"28171146-3cbb-479f-b18d-5b0cfd0defd0",
 InitializationCell->True],
Cell[935246, 25010, 1262, 27, 70, "Input",ExpressionUUID->"ad68139a-075c-49a5-93b6-0266d6c08525",
 InitializationCell->True],
Cell[936511, 25039, 1239, 25, 70, "Input",ExpressionUUID->"1aa85512-4d65-4b28-bcb7-84fb4fe77fa7",
 InitializationCell->True],
Cell[937753, 25066, 585, 17, 70, "Input",ExpressionUUID->"dc76f887-247b-45ff-9c76-3a8e880be4a9",
 InitializationCell->True],
Cell[938341, 25085, 1342, 41, 70, "Input",ExpressionUUID->"fe9b3ddf-d4ed-4f8e-91c6-0727d36b380d",
 InitializationCell->True],
Cell[939686, 25128, 590, 16, 70, "Input",ExpressionUUID->"51b59880-a80f-429c-8eec-5829d6a844b6",
 InitializationCell->True],
Cell[940279, 25146, 1169, 36, 70, "Input",ExpressionUUID->"d882e155-6aca-4f8e-9932-3b115cfd7962",
 InitializationCell->True],
Cell[941451, 25184, 526, 15, 70, "Input",ExpressionUUID->"32a9902b-7809-444a-bc40-fe3cfd1a7a06",
 InitializationCell->True],
Cell[941980, 25201, 594, 18, 70, "Input",ExpressionUUID->"eb7bec38-4339-448e-9a4d-f4cd4cba4204",
 InitializationCell->True],
Cell[942577, 25221, 921, 26, 70, "Input",ExpressionUUID->"ac4c791a-2dcf-4a89-87ba-2726a6336275",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[943535, 25252, 60, 1, 36, "Subsubsection",ExpressionUUID->"875a67a3-727b-4d9b-8e05-997b287f1b0b",
 InitializationCell->True],
Cell[943598, 25255, 3830, 76, 75, "Input",ExpressionUUID->"cbdb6464-8144-476a-bbf2-4a8b435a27ee",
 InitializationCell->True],
Cell[947431, 25333, 2856, 75, 52, "Input",ExpressionUUID->"60bfb717-5497-4c8a-a334-02d0d46d62cc",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[950312, 25412, 380, 8, 31, "Input",ExpressionUUID->"229a019e-d76e-4787-ab53-36a2d4178d04"],
Cell[950695, 25422, 10855, 210, 414, "Output",ExpressionUUID->"1b8eec8c-90fe-44ed-af5b-7aade7f24aaa"]
}, Open  ]],
Cell[961565, 25635, 2629, 55, 67, "Input",ExpressionUUID->"fdeb987f-6777-4420-8cd7-afbb4cb92c5b",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[964219, 25694, 1088, 19, 31, "Input",ExpressionUUID->"9ebc2fcd-03f0-4df6-ba0d-8745eeb07536",
 InitializationCell->True],
Cell[965310, 25715, 13438, 237, 447, "Output",ExpressionUUID->"91ad8fd5-e636-438f-974e-f8bd8e117398"]
}, Open  ]],
Cell[978763, 25955, 69, 1, 31, "Input",ExpressionUUID->"d78e42dd-a32d-4bac-b6ec-446f066a56a0"]
}, Closed]],
Cell[CellGroupData[{
Cell[978869, 25961, 108, 2, 36, "Subsubsection",ExpressionUUID->"bc32060c-cd31-49ab-9001-2a7462ba9fed",
 InitializationCell->True],
Cell[978980, 25965, 218, 5, 30, "Text",ExpressionUUID->"f1a0087c-3574-4c15-9817-2946dd02da4d",
 InitializationCell->True],
Cell[979201, 25972, 998, 21, 31, "Input",ExpressionUUID->"b116ea41-920a-452a-ac1c-584468a31ed0",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[980224, 25997, 406, 8, 31, "Input",ExpressionUUID->"acdacf48-5e09-4ee6-9cac-601d1c2fc928",
 InitializationCell->True],
Cell[980633, 26007, 13194, 259, 417, "Output",ExpressionUUID->"a4c900a3-5cb5-40a3-8a63-2ad0b374ecca"]
}, Open  ]],
Cell[993842, 26269, 816, 21, 31, "Input",ExpressionUUID->"4ad4e018-6fa4-495e-8a28-673ebfb8edc3",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[994683, 26294, 377, 7, 31, "Input",ExpressionUUID->"aad7cc0b-9510-4871-af28-6224a8396b52",
 InitializationCell->True],
Cell[995063, 26303, 13355, 257, 417, "Output",ExpressionUUID->"7ef20a12-3dc9-4622-b219-168e0fbe0b2e"]
}, Open  ]],
Cell[1008433, 26563, 1030, 27, 70, "Input",ExpressionUUID->"d1dc76ce-6e21-41dc-8663-e4a88d30a80d",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1009488, 26594, 327, 7, 70, "Input",ExpressionUUID->"70d100d4-c220-4c41-9ac4-4e0e3b6f3e5d",
 InitializationCell->True],
Cell[1009818, 26603, 4454, 84, 70, "Output",ExpressionUUID->"8c43f796-044b-456d-a67d-2eab02dad384"]
}, Open  ]],
Cell[1014287, 26690, 1452, 39, 70, "Input",ExpressionUUID->"c9470cd7-750f-4a21-847f-62492c7e2af5",
 InitializationCell->True],
Cell[1015742, 26731, 1679, 42, 70, "Input",ExpressionUUID->"2a5430c4-ee7f-4f12-bd7e-08b0bdf402ba",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1017446, 26777, 479, 12, 70, "Input",ExpressionUUID->"f5cd2d20-af27-4f14-b3e1-19dd40db4356",
 InitializationCell->True],
Cell[1017928, 26791, 37935, 666, 70, "Output",ExpressionUUID->"bb3f327f-252e-4a4e-9c7d-5ebf32de5321"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1055912, 27463, 129, 2, 36, "Subsubsection",ExpressionUUID->"6c87c9b7-3864-4f56-bad7-03402227a949",
 InitializationCell->True],
Cell[1056044, 27467, 218, 5, 70, "Text",ExpressionUUID->"31e11de4-e12d-479a-96a5-6df713babfe6",
 InitializationCell->True],
Cell[1056265, 27474, 776, 18, 70, "Input",ExpressionUUID->"d4e4c3f8-e1a6-4a5a-abe9-7d04ef472416",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1057066, 27496, 456, 8, 70, "Input",ExpressionUUID->"eb85f0d4-98c4-4353-8ca2-804be7532ab6",
 InitializationCell->True],
Cell[1057525, 27506, 18921, 352, 70, "Output",ExpressionUUID->"98f92bb8-19ad-45e5-b4bd-a6c83bf58808"]
}, Open  ]],
Cell[1076461, 27861, 724, 20, 70, "Input",ExpressionUUID->"1b695d2b-35a8-44cb-83ed-afbfe5be3f35",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1077210, 27885, 403, 8, 70, "Input",ExpressionUUID->"9716d007-1d2e-4369-83b2-a4d8abf6d271",
 InitializationCell->True],
Cell[1077616, 27895, 19623, 373, 70, "Output",ExpressionUUID->"8d3594b8-6bb8-4001-9ba1-c9f9c9499b3b"]
}, Open  ]],
Cell[1097254, 28271, 1133, 29, 70, "Input",ExpressionUUID->"96d3cf67-c0d9-48e0-9729-2777f7775686",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1098412, 28304, 353, 7, 70, "Input",ExpressionUUID->"319f3366-3f9f-4ad5-b143-eac6b04446e5",
 InitializationCell->True],
Cell[1098768, 28313, 6216, 111, 70, "Output",ExpressionUUID->"12b0be67-bfe4-4cbe-9888-50d8e6ebb185"]
}, Open  ]],
Cell[1104999, 28427, 1476, 38, 70, "Input",ExpressionUUID->"36e69ebe-a098-4d7b-92ce-9a9ead54f131",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1106500, 28469, 388, 10, 70, "Input",ExpressionUUID->"d00855a1-b99f-46ed-a71f-40c82e27a123",
 InitializationCell->True],
Cell[1106891, 28481, 55929, 1011, 70, "Output",ExpressionUUID->"6f0973b4-7af1-47fb-8e61-6d24bf07e414"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1162869, 29498, 181, 4, 36, "Subsubsection",ExpressionUUID->"fffcda67-c468-4d8c-90a1-b5fad46b1b3a",
 InitializationCell->True],
Cell[1163053, 29504, 218, 5, 70, "Text",ExpressionUUID->"fc5d43db-ba62-4c83-866f-c3504ea264a5",
 InitializationCell->True],
Cell[1163274, 29511, 848, 19, 70, "Input",ExpressionUUID->"432ac86f-93d3-48e4-a971-3b882169bfee",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1164147, 29534, 483, 9, 70, "Input",ExpressionUUID->"209543f4-8104-40ae-90fa-d1711dec5c19",
 InitializationCell->True],
Cell[1164633, 29545, 26578, 518, 70, "Output",ExpressionUUID->"dc1923c6-b000-43f7-80ac-923d1043b70d"]
}, Open  ]],
Cell[1191226, 30066, 797, 21, 70, "Input",ExpressionUUID->"731c8d8d-0a09-4cb5-a102-e694fc5abd7b",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1192048, 30091, 426, 8, 70, "Input",ExpressionUUID->"9ca2366d-6401-48d1-b511-9d230edec47f",
 InitializationCell->True],
Cell[1192477, 30101, 26259, 479, 70, "Output",ExpressionUUID->"c6367487-af8a-4c21-9c21-e7ce155c3929"]
}, Open  ]],
Cell[1218751, 30583, 1214, 30, 70, "Input",ExpressionUUID->"d682bd96-d8c1-40e8-aef8-5a62674fbd78",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1219990, 30617, 374, 7, 70, "Input",ExpressionUUID->"9428dab4-1d5d-4d21-a10a-ce7186b6e603",
 InitializationCell->True],
Cell[1220367, 30626, 9024, 164, 70, "Output",ExpressionUUID->"43f478f9-be92-4ad5-83e9-ff02a78c26f9"]
}, Open  ]],
Cell[1229406, 30793, 1494, 39, 70, "Input",ExpressionUUID->"3caecdfa-7883-413c-bb54-9de8eca6c832",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1230925, 30836, 409, 10, 70, "Input",ExpressionUUID->"6430de81-72a0-4b32-9ab4-2d833383ee8e",
 InitializationCell->True],
Cell[1231337, 30848, 75286, 1289, 70, "Output",ExpressionUUID->"347baae5-e055-482f-8ae3-ef70091f8932"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1306672, 32143, 58, 1, 36, "Subsubsection",ExpressionUUID->"733fc681-8a85-4873-a641-b8bc47a2e1fb",
 InitializationCell->True],
Cell[1306733, 32146, 1231, 34, 31, "Input",ExpressionUUID->"0d328160-7167-4ebd-9291-ccaf66a7d5ab",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1307989, 32184, 1010, 27, 31, "Input",ExpressionUUID->"c6568758-a648-4037-b442-bcabe8811068",
 InitializationCell->True],
Cell[1309002, 32213, 965, 20, 223, "Output",ExpressionUUID->"2cd038ac-37ff-4436-b673-c1a052a09e85"]
}, Open  ]],
Cell[1309982, 32236, 3675, 74, 75, "Input",ExpressionUUID->"8fc51bdf-5734-4aca-8fff-79e9e23423fe",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1313694, 32315, 57, 1, 36, "Subsubsection",ExpressionUUID->"7a5730a7-5471-41c9-baf1-c2c008cd600e",
 InitializationCell->True],
Cell[1313754, 32318, 1416, 38, 70, "Input",ExpressionUUID->"2d4cb0de-5656-4a81-ae53-14ea18781c00",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1315195, 32360, 358, 9, 70, "Input",ExpressionUUID->"13a82486-8be1-41e8-838e-756e5aaff8b4",
 InitializationCell->True],
Cell[1315556, 32371, 424, 8, 70, "Output",ExpressionUUID->"0b85ab12-cf3f-4127-a7c4-e558ffe31894"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1316029, 32385, 61, 1, 36, "Subsubsection",ExpressionUUID->"c1e0a0e7-2671-4f86-9545-e2b10faafa3d",
 InitializationCell->True],
Cell[1316093, 32388, 519, 14, 44, "Input",ExpressionUUID->"07219753-c360-4cc0-8d29-ec749868e77a",
 InitializationCell->True],
Cell[1316615, 32404, 617, 18, 44, "Input",ExpressionUUID->"7b6adb37-8d62-4476-98f6-887658e6c7de",
 InitializationCell->True],
Cell[1317235, 32424, 1332, 37, 44, "Input",ExpressionUUID->"f78326f4-64e9-4edd-8905-e237be533b64",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1318592, 32465, 439, 10, 44, "Input",ExpressionUUID->"f374364a-0d7b-4584-8d48-9ef6bc26f7e9",
 InitializationCell->True],
Cell[1319034, 32477, 118495, 2100, 418, "Output",ExpressionUUID->"80f2e427-49fd-4305-ba56-93b91daccf5c"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1437578, 34583, 130, 2, 44, "Subsubsection",ExpressionUUID->"d2f52b4d-48ea-46f8-a33c-4f43db51f943",
 InitializationCell->True],
Cell[1437711, 34587, 2629, 55, 91, "Input",ExpressionUUID->"d591fbe1-cd04-42a2-8355-2b1318768257",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[1440377, 34647, 69, 1, 39, "Subsubsection",ExpressionUUID->"e58985ce-0f65-44d1-9f5e-f7f7f3f5b54e",
 InitializationCell->True],
Cell[1440449, 34650, 255, 5, 46, "Input",ExpressionUUID->"660c339d-3c7b-4497-a5be-f52fc131d5e3",
 InitializationCell->True],
Cell[1440707, 34657, 649, 19, 46, "Input",ExpressionUUID->"255c249a-0cb0-4579-b5fa-493e4261f8c1",
 InitializationCell->True],
Cell[1441359, 34678, 809, 22, 60, "Input",ExpressionUUID->"eb5b4d90-aa59-452d-af5c-0c784f932d9a",
 InitializationCell->True],
Cell[1442171, 34702, 1129, 26, 46, "Input",ExpressionUUID->"8e557d61-6b78-4faf-acbf-e4cbe5ed268f",
 InitializationCell->True],
Cell[1443303, 34730, 764, 21, 58, "Input",ExpressionUUID->"6ab853cd-0fe6-4912-9ca8-40c12dbd310b",
 InitializationCell->True],
Cell[1444070, 34753, 857, 21, 58, "Input",ExpressionUUID->"ea936871-d041-40cb-a868-f470a84cb1a0",
 InitializationCell->True],
Cell[1444930, 34776, 624, 18, 44, "Input",ExpressionUUID->"643c1321-30aa-4c5b-8f7c-caf21397e42b",
 InitializationCell->True],
Cell[1445557, 34796, 625, 18, 44, "Input",ExpressionUUID->"1ad2f600-ff12-4da5-9275-716f4d4e16a5",
 InitializationCell->True],
Cell[1446185, 34816, 650, 19, 44, "Input",ExpressionUUID->"b2065942-425d-450e-8fe6-e75cf10d7794",
 InitializationCell->True],
Cell[1446838, 34837, 4972, 83, 91, "Input",ExpressionUUID->"1c22e789-2516-4180-ad5d-a7b681706f19",
 InitializationCell->True],
Cell[1451813, 34922, 969, 24, 44, "Input",ExpressionUUID->"b6da6562-a20e-46f5-a47b-209e18330c21",
 InitializationCell->True],
Cell[1452785, 34948, 1064, 25, 44, "Input",ExpressionUUID->"60693557-160c-4b37-9d14-347daabfc799",
 InitializationCell->True],
Cell[1453852, 34975, 1064, 25, 44, "Input",ExpressionUUID->"386654eb-6928-466b-87d1-1288ded9e6b3",
 InitializationCell->True],
Cell[1454919, 35002, 1163, 26, 44, "Input",ExpressionUUID->"29222580-1762-422f-90b3-06be075f648a",
 InitializationCell->True],
Cell[1456085, 35030, 566, 16, 44, "Input",ExpressionUUID->"e31e9454-f589-42ce-a3be-170caeab811d",
 InitializationCell->True],
Cell[1456654, 35048, 806, 21, 44, "Input",ExpressionUUID->"78374636-e81a-4543-bf71-ca19d0392cfd",
 InitializationCell->True],
Cell[1457463, 35071, 669, 19, 44, "Input",ExpressionUUID->"e29eeb5d-3f67-45f2-8662-1106d51a5d2b",
 InitializationCell->True],
Cell[1458135, 35092, 767, 20, 44, "Input",ExpressionUUID->"d29c484d-c9b4-489d-b0d6-8df3c1f998b6",
 InitializationCell->True],
Cell[1458905, 35114, 2189, 38, 44, "Input",ExpressionUUID->"e7fedb8c-dbd5-4bcf-82a5-7eb2a2c44f1b",
 InitializationCell->True],
Cell[1461097, 35154, 2558, 43, 44, "Input",ExpressionUUID->"4fa6c6f7-a7ac-4f58-af4b-1160f835284a",
 InitializationCell->True],
Cell[1463658, 35199, 548, 16, 44, "Input",ExpressionUUID->"edef31d6-9c4a-4335-a740-b9f8864808da",
 InitializationCell->True],
Cell[1464209, 35217, 641, 16, 44, "Input",ExpressionUUID->"6f956af7-8d03-408f-9aa2-c66a50af249c",
 InitializationCell->True],
Cell[1464853, 35235, 5090, 86, 91, "Input",ExpressionUUID->"80eeffa2-cbd0-41bb-b4f6-781e6a053b5c",
 InitializationCell->True],
Cell[1469946, 35323, 5164, 86, 91, "Input",ExpressionUUID->"e2fdd588-f610-4512-92a4-99d80efbeb36",
 InitializationCell->True],
Cell[1475113, 35411, 36530, 858, 1735, "Input",ExpressionUUID->"b73198eb-fcdd-4616-ad54-53ab326640bb",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1511668, 36273, 172, 4, 28, "Input",ExpressionUUID->"d15f1206-ed70-4376-b4df-d9f4d1bccc2c"],
Cell[1511843, 36279, 109, 2, 32, "Output",ExpressionUUID->"887a21e1-b6d4-412c-8386-42def3a41a13"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1512013, 36288, 33, 0, 37, "Subsection",ExpressionUUID->"736dd5f0-8d51-4173-b350-3e7d00be61fd"],
Cell[1512049, 36290, 2714, 77, 70, "Input",ExpressionUUID->"0b15c0bf-a40d-4e2e-af8b-c14753d12b59",
 InitializationCell->True],
Cell[1514766, 36369, 1861, 53, 70, "Input",ExpressionUUID->"081a38fd-7b66-4936-8396-b164b2efbd3a",
 InitializationCell->True],
Cell[1516630, 36424, 1717, 45, 70, "Input",ExpressionUUID->"ba5e23c3-111c-4cdf-9aba-eaeeb1329143",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1518384, 36474, 93, 4, 37, "Subsection",ExpressionUUID->"f36afd2d-fbc6-4852-a5f5-a063c4f9074b"],
Cell[1518480, 36480, 706, 18, 70, "Input",ExpressionUUID->"c7300ea2-19f2-4c4f-8208-a2cab1b2f73d",
 InitializationCell->True],
Cell[1519189, 36500, 6001, 171, 70, "Input",ExpressionUUID->"8baf30b2-7382-43e0-8a68-a1fa716f6274",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1525227, 36676, 29, 0, 37, "Subsection",ExpressionUUID->"b7b1661f-da5b-46d6-8d09-1a1578daeb05"],
Cell[1525259, 36678, 10274, 265, 70, "Input",ExpressionUUID->"46b3fd6f-069f-4ab1-b575-daa1f68fb28e",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1535570, 36948, 36, 0, 37, "Subsection",ExpressionUUID->"f7643624-5f9c-46be-be33-4a613643d425"],
Cell[1535609, 36950, 6344, 142, 229, "Text",ExpressionUUID->"bf9953e7-9344-4edb-b8bd-46395988f0d9",
 InitializationCell->True],
Cell[1541956, 37094, 998, 26, 64, "Input",ExpressionUUID->"10f9be9c-f433-4e47-9dfb-6b4b2a332552",
 InitializationCell->True],
Cell[1542957, 37122, 529, 15, 44, "Input",ExpressionUUID->"45775c36-5a9a-42e7-9e76-f3095ebc7e5f",
 InitializationCell->True],
Cell[1543489, 37139, 11879, 281, 481, "Input",ExpressionUUID->"54aa9bd0-e240-4b52-aa64-2aeb074e8d01",
 InitializationCell->True],
Cell[1555371, 37422, 503, 14, 44, "Input",ExpressionUUID->"e54c1c6b-c20b-4eb2-b379-27ef22ccf82b",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1555911, 37441, 34, 0, 37, "Subsection",ExpressionUUID->"70df1e23-52b1-423a-b6c5-e67edeec349a"],
Cell[1555948, 37443, 849, 23, 70, "Input",ExpressionUUID->"52ae6ced-d815-45ea-b5b2-32db8da2118d",
 InitializationCell->True],
Cell[1556800, 37468, 849, 23, 70, "Input",ExpressionUUID->"4da3e8ee-6a69-43d2-b040-332489e9e5bb",
 InitializationCell->True],
Cell[1557652, 37493, 1225, 34, 70, "Input",ExpressionUUID->"20525394-5d7e-4684-a81b-b4e2da504436",
 InitializationCell->True],
Cell[1558880, 37529, 1313, 35, 70, "Input",ExpressionUUID->"4cb96b9e-9626-4a7f-9051-3b00f744ec51",
 InitializationCell->True],
Cell[1560196, 37566, 851, 23, 70, "Input",ExpressionUUID->"af94ac7a-d1c8-455d-a0c9-12e0b4ed3045",
 InitializationCell->True],
Cell[1561050, 37591, 851, 23, 70, "Input",ExpressionUUID->"3e109edf-836e-4e78-b93f-502cdea06cf1",
 InitializationCell->True],
Cell[1561904, 37616, 5331, 142, 70, "Input",ExpressionUUID->"bd8e6a27-18b2-414d-af62-5a0e191198d6",
 InitializationCell->True],
Cell[1567238, 37760, 9163, 243, 70, "Input",ExpressionUUID->"fdec9b19-e6f9-4a12-89c9-5a4e9a5a78a7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1576438, 38008, 35, 0, 37, "Subsection",ExpressionUUID->"19609198-7753-4f8d-a984-70437844671a"],
Cell[1576476, 38010, 1570, 34, 70, "Input",ExpressionUUID->"74b4e66a-3d16-4b3f-8e39-0d69f03c5245",
 InitializationCell->True],
Cell[1578049, 38046, 14663, 376, 70, "Input",ExpressionUUID->"d732fe8a-7fdc-4bf7-9f46-457c661bdc12",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1592749, 38427, 47, 0, 37, "Subsection",ExpressionUUID->"00ac2bac-9af8-45d4-ba45-c82210d2045c"],
Cell[1592799, 38429, 402, 10, 70, "Input",ExpressionUUID->"fab09abb-8c5e-4801-b9dc-fc0019da19eb",
 InitializationCell->True],
Cell[1593204, 38441, 2521, 66, 70, "Input",ExpressionUUID->"dbdf860e-acde-4381-b7c8-dfbfbdd2e278",
 InitializationCell->True],
Cell[1595728, 38509, 481, 12, 70, "Input",ExpressionUUID->"63030009-0f5c-4e46-b194-322151521034",
 InitializationCell->True],
Cell[1596212, 38523, 3002, 78, 70, "Input",ExpressionUUID->"7c857dcb-4c9a-4bdd-90db-6c38b393818c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1599251, 38606, 36, 0, 37, "Subsection",ExpressionUUID->"82de1b84-2663-4ec5-ab7c-3ebd97291a80"],
Cell[1599290, 38608, 1659, 38, 70, "Input",ExpressionUUID->"182d120d-79e2-4cf9-95cf-3083e18fc8e9"],
Cell[1600952, 38648, 17499, 456, 70, "Input",ExpressionUUID->"4fd9655d-919f-4838-a1e0-65ba948f650c",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1618488, 39109, 38, 0, 37, "Subsection",ExpressionUUID->"883e7112-fd80-4f71-862e-102df1d01977"],
Cell[1618529, 39111, 693, 21, 44, "Input",ExpressionUUID->"1b6ce1c7-4381-49e9-b397-8cb903f3f12d",
 InitializationCell->True],
Cell[1619225, 39134, 3654, 88, 147, "Input",ExpressionUUID->"8d60d029-b9d5-448b-a0f4-b3e2afd5eec0",
 InitializationCell->True],
Cell[1622882, 39224, 3770, 90, 147, "Input",ExpressionUUID->"1fb3b7de-576c-4584-a1b7-8f293bda2176",
 InitializationCell->True],
Cell[1626655, 39316, 1946, 54, 102, "Input",ExpressionUUID->"7ec61fb5-8937-44e7-959b-e0ee74ac9125",
 InitializationCell->True],
Cell[1628604, 39372, 1746, 49, 102, "Input",ExpressionUUID->"cfe5a63b-8a92-4bbc-aa53-4fa826ca7b03",
 InitializationCell->True],
Cell[1630353, 39423, 333, 10, 44, "Input",ExpressionUUID->"3779b905-0682-4c52-8641-8890ba2728f6",
 InitializationCell->True],
Cell[1630689, 39435, 2626, 65, 121, "Input",ExpressionUUID->"ea1f96e7-5599-4a7d-a8e6-ae88828c4955",
 InitializationCell->True],
Cell[1633318, 39502, 2280, 58, 121, "Input",ExpressionUUID->"31b5436f-189b-499a-9b87-7d6a6a4e67f5",
 InitializationCell->True],
Cell[1635601, 39562, 1394, 38, 44, "Input",ExpressionUUID->"7c502881-46b1-4415-aed9-a83b6766f09e",
 InitializationCell->True],
Cell[1636998, 39602, 980, 25, 44, "Input",ExpressionUUID->"d02c717f-eee2-4017-ada5-b1b4376dcf90",
 InitializationCell->True],
Cell[1637981, 39629, 2221, 57, 121, "Input",ExpressionUUID->"49f2432a-7275-4c13-93f1-87932b3aaedf",
 InitializationCell->True],
Cell[1640205, 39688, 3613, 84, 70, "Input",ExpressionUUID->"7c9015df-dc89-47a9-9587-2db90a7c21e4",
 InitializationCell->True],
Cell[1643821, 39774, 2814, 72, 70, "Input",ExpressionUUID->"adcef474-593c-481c-a5a8-4f243247b00f",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1646660, 39850, 28, 0, 70, "Subsubsection",ExpressionUUID->"6f45a7ae-64cb-4bf9-8024-4ca9f0ce96a4"],
Cell[1646691, 39852, 25447, 589, 978, "Input",ExpressionUUID->"a44fcc09-db35-4726-91d5-9b5157c6fda2"],
Cell[1672141, 40443, 23089, 532, 997, "Input",ExpressionUUID->"9493211a-06bb-426a-8c0c-6b1354251d35"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1695279, 40981, 37, 0, 37, "Subsection",ExpressionUUID->"d197c921-b7a5-4244-b901-ac6162d06700"],
Cell[1695319, 40983, 1126, 31, 70, "Input",ExpressionUUID->"9a552084-4941-49ba-8b6f-994e714ce324",
 InitializationCell->True],
Cell[1696448, 41016, 198, 5, 70, "Input",ExpressionUUID->"e38db67e-e399-4ec4-8f3a-0b4835a0672e",
 InitializationCell->True],
Cell[1696649, 41023, 1824, 49, 70, "Input",ExpressionUUID->"8a4507ad-cb50-4dfe-a07f-1ef95fceb201",
 InitializationCell->True],
Cell[1698476, 41074, 11457, 296, 70, "Input",ExpressionUUID->"f02f0f95-d6c3-4e89-9a1b-f9019534a79b",
 InitializationCell->True],
Cell[1709936, 41372, 8752, 217, 70, "Input",ExpressionUUID->"5c13acb7-47b2-4397-ba79-c26dbfec18ba",
 InitializationCell->True],
Cell[1718691, 41591, 2647, 73, 70, "Input",ExpressionUUID->"77b1c929-5f87-4e44-bdc2-468e090bbaf9",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1721375, 41669, 40, 0, 37, "Subsection",ExpressionUUID->"faa5dd9f-d6e1-49d1-875f-55abfca7d740"],
Cell[1721418, 41671, 5513, 140, 70, "Input",ExpressionUUID->"e67d41fe-9289-499f-8629-9132c55a06df",
 InitializationCell->True],
Cell[1726934, 41813, 5515, 140, 70, "Input",ExpressionUUID->"5c5b03ce-0314-4f40-8807-939179da1295",
 InitializationCell->True],
Cell[1732452, 41955, 5696, 145, 70, "Input",ExpressionUUID->"a7af7cde-ca0c-49c7-9066-ad50a123942a",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1738185, 42105, 32, 0, 37, "Subsection",ExpressionUUID->"3f398f55-7f4d-4a44-ab52-ac4099c50826"],
Cell[1738220, 42107, 239, 6, 44, "Input",ExpressionUUID->"ee0840ba-8864-4bb8-a5a1-10631b696827",
 InitializationCell->True],
Cell[1738462, 42115, 230, 4, 34, "Text",ExpressionUUID->"a99ad48e-2166-46e3-b257-685a2b505201",
 InitializationCell->True],
Cell[1738695, 42121, 418, 12, 44, "Input",ExpressionUUID->"ae3dae97-4a59-4e48-99c6-a790a3a6752d",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[1739150, 42138, 100, 1, 53, "Subsection",ExpressionUUID->"069fcf83-a8e2-4d43-9b31-f387640d27fd"],
Cell[1739253, 42141, 6203, 139, 70, "Input",ExpressionUUID->"07b1f7e4-80f0-4b9b-93d6-49224c5fe0c8",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1745493, 42285, 52, 1, 37, "Subsection",ExpressionUUID->"2240a135-69b6-4a4b-be47-ae6614f75b1f",
 InitializationCell->True],
Cell[1745548, 42288, 103, 3, 70, "Input",ExpressionUUID->"28904071-8634-4276-8ee9-054ba42274ce",
 Evaluatable->True,
 InitializationCell->True],
Cell[1745654, 42293, 110, 3, 70, "Input",ExpressionUUID->"9ad2c395-b696-457b-8e5a-a45ca386ddb5",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1745801, 42301, 37, 0, 37, "Subsection",ExpressionUUID->"712c2342-1ea2-4d9b-8824-5f151588022f"],
Cell[1745841, 42303, 644, 16, 70, "Input",ExpressionUUID->"792174af-9093-483d-a360-283d1970e784",
 InitializationCell->True],
Cell[1746488, 42321, 7331, 189, 70, "Input",ExpressionUUID->"656d6f57-82b0-4920-b4db-011477e9149d",
 InitializationCell->True],
Cell[1753822, 42512, 709, 18, 70, "Input",ExpressionUUID->"8eb32441-8bac-4664-89af-598912d1e41a",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}, Open  ]]
}
]
*)

